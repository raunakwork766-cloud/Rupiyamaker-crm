<VirtualHost *:80>
    ServerAdmin admin@rupiyamaker
    DocumentRoot "/www/wwwroot/RupiyaMe/rupiyamaker-UI/crm/"
    ServerName 80.rupiyamaker
    ServerAlias rupiyamaker.com
    #errorDocument 404 /404.html
    ErrorLog "/www/wwwlogs/rupiyamaker-error_log"
    CustomLog "/www/wwwlogs/rupiyamaker-access_log" combined
    #HTTP_TO_HTTPS_START
    <IfModule mod_rewrite.c>
        RewriteEngine on
        RewriteCond %{SERVER_PORT} !^443$
        RewriteRule (.*) https://%{SERVER_NAME}$1 [L,R=301]
    </IfModule>
    #HTTP_TO_HTTPS_END

    

    #DENY FILES
     <Files ~ (\.user.ini|\.htaccess|\.git|\.svn|\.project|LICENSE|README.md|package.json|package-lock.json|\.env)$>
       Order allow,deny
       Deny from all
    </Files>

    #SSL
    ProxyPass /.well-known/ !

    # HTTP reverse proxy related settings begin >>>
    <IfModule mod_proxy.c>
        ProxyRequests Off
        SSLProxyEngine on
        ProxyPass / http://127.0.0.1:4521/
        ProxyPassReverse / http://127.0.0.1:4521/
    </IfModule>
    # End of HTTP reverse proxy related settings <<<
</VirtualHost>
<VirtualHost *:443>
    ServerAdmin admin@rupiyamaker
    DocumentRoot "/www/wwwroot/RupiyaMe/rupiyamaker-UI/crm/"
    ServerName 443.rupiyamaker
    ServerAlias rupiyamaker.com
    #errorDocument 404 /404.html
    ErrorLog "/www/wwwlogs/rupiyamaker-error_log"
    CustomLog "/www/wwwlogs/rupiyamaker-access_log" combined

    #SSL
    SSLEngine On
    SSLCertificateFile /www/server/panel/vhost/cert/rupiyamaker/fullchain.pem
    SSLCertificateKeyFile /www/server/panel/vhost/cert/rupiyamaker/privkey.pem
    SSLCipherSuite EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5
    SSLProtocol All -SSLv2 -SSLv3 -TLSv1
    SSLHonorCipherOrder On

    #DENY FILES
     <Files ~ (\.user.ini|\.htaccess|\.git|\.svn|\.project|LICENSE|README.md|package.json|package-lock.json|\.env)$>
       Order allow,deny
       Deny from all
    </Files>

    #SSL
    ProxyPass /.well-known/ !

    # HTTP reverse proxy related settings begin >>>
    <IfModule mod_proxy.c>
        ProxyRequests Off
        SSLProxyEngine off
        
        # API proxy to backend on port 8049 (HTTP, not HTTPS) - ADD THIS BEFORE THE ROOT PROXY
        # Remove /api prefix and forward to backend root
        ProxyPass /api/ http://127.0.0.1:8049/
        ProxyPassReverse /api/ http://127.0.0.1:8049/
        
        # Handle /api without trailing slash
        ProxyPass /api http://127.0.0.1:8049/
        ProxyPassReverse /api http://127.0.0.1:8049/
        
        # Frontend proxy to Vite dev server on port 4521
        ProxyPass / http://127.0.0.1:4521/
        ProxyPassReverse / http://127.0.0.1:4521/
    </IfModule>
    # End of HTTP reverse proxy related settings <<<
</VirtualHost>
