const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/AboutSection-dhoQmkhr.js","chunks/vendor-mui-C1GmDdcn.js","chunks/vendor-react-EzoxUMNY.js","chunks/vendor-utils-QXd9EeNt.js","chunks/vendor-antd-BB3a0mYC.js","chunks/HowToProcessSection-B4y7S0l5.js","chunks/ImportantQuestionsSection-Ipz1C9QW.js","assets/main-9KtUfBSi.js","chunks/employee-components-BKn44sLk.js","chunks/vendor-office-CbbGW2MO.js","styles/employee-components-CAryrO_Y.css","chunks/task-components-L9yQQxLU.js","styles/task-components-DguWJUkH.css","styles/main-XR3RDF9c.css","chunks/ObligationSection-COad_a3R.js","chunks/html2canvas.esm-CPDoSj43.js","chunks/Attachments-DU1bIGm9.js","chunks/TaskSectionInLead-C2XyroAs.js","chunks/LeadActivity-BH0mdg5t.js","chunks/CopyLeadSection-BXlzOuyy.js","chunks/Remark-MXC4aR8c.js","chunks/FileSentToLoginSection-NSkilrkc.js","chunks/ReassignmentPanel-DHQZISo8.js","chunks/leadApiHelper-Bq4A4HGf.js","chunks/RequestReassignmentButton-CQtopnlf.js","chunks/LeadDetails-0201Intp.js","chunks/OperationsSection-Dvm0LGPE.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty;import{j as t}from"./vendor-mui-C1GmDdcn.js";import{r as a,R as s}from"./vendor-react-EzoxUMNY.js";import{S as n,s as i}from"./vendor-antd-BB3a0mYC.js";
/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},o=(...e)=>e.filter((e,t,a)=>Boolean(e)&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim(),l=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};
/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c=a.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:n,className:i="",children:r,iconNode:c,...m},u)=>a.createElement("svg",{ref:u,...d,width:t,height:t,stroke:e,strokeWidth:n?24*Number(s)/Number(t):s,className:o("lucide",i),...!r&&!l(m)&&{"aria-hidden":"true"},...m},[...c.map(([e,t])=>a.createElement(e,t)),...Array.isArray(r)?r:[r]])),m=(e,t)=>{const s=a.forwardRef(({className:s,...n},i)=>{return a.createElement(c,{ref:i,iconNode:t,className:o(`lucide-${l=r(e),l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,s),...n});var l});return s.displayName=r(e),s},u=m("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),g=m("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),p=m("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]),y=m("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),h=m("building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),f=m("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),b=m("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),x=m("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),_=m("check-check",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),w=m("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),v=m("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),j=m("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),N=m("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),k=m("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),S=m("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),C=m("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),L=m("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),A=m("circle-help",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),T=m("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),I=m("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),D=m("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]),E=m("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),P=m("corner-down-right",[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),M=m("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),$=m("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),R=m("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),B=m("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),O=m("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),F=m("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),q=m("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),U=m("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),z=m("file-spreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),V=m("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),H=m("frown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),J=m("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),Y=m("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),W=m("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),G=m("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),K=m("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),Q=m("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Z=m("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]),X=m("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),ee=m("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),te=m("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),ae=m("menu",[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]]),se=m("message-circle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),ne=m("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),ie=m("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]),re=m("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),oe=m("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),le=m("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),de=m("power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),ce=m("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),me=m("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),ue=m("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),ge=m("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),pe=m("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),ye=m("settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),he=m("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),fe=m("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),be=m("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),xe=m("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),_e=m("thumbs-up",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]),we=m("ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),ve=m("toggle-left",[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]]),je=m("toggle-right",[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]]),Ne=m("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),ke=m("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Se=m("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),Ce=m("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Le=m("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),Ae=m("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Te=m("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Ie=m("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),De={},Ee=function(e,t,a){let s=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),n=a?.nonce||a?.getAttribute("nonce");s=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in De)return;De[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,n&&s.setAttribute("nonce",n),document.head.appendChild(s),t?new Promise((t,a)=>{s.addEventListener("load",t),s.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})},Pe=e=>{if(e||(e=Je()),!e)return!1;if("object"==typeof e&&!Array.isArray(e)&&0===Object.keys(e).length)return!1;if(Array.isArray(e)&&0===e.length)return!1;if(Array.isArray(e)&&("*"===e||e&&e.includes&&e.includes("*")||e.some(e=>"*"===e.page&&"*"===e.actions||"*"===e.page&&Array.isArray(e.actions)&&e.actions.includes("*"))))return!0;if("object"==typeof e&&!Array.isArray(e)){if("*"===e?.["*"])return!0;if("*"===e?.pages&&"*"===e?.actions)return!0;if("*"===e?.Global||"*"===e?.global)return!0;if(["Feeds","Leads","Tasks","Tickets","Settings"].every(t=>"*"===e?.[t]||"*"===e?.[t.toLowerCase()]))return!0}return!1},Me=(e,t=null)=>{if(t||(t=Je()),Pe(t))return"all";if("object"==typeof t&&!Array.isArray(t)){const a=t[e];return a?!0===a.all?"all":!0===a.junior?"junior":(a.own,"own"):"own"}if(Array.isArray(t)){const a=t.find(t=>t.page===e);if(!a)return"own";const s=a.actions;if("all"===s||"*"===s||Array.isArray(s)&&(s.includes("all")||s.includes("*")))return"all";if("junior"===s||Array.isArray(s)&&s.includes("junior"))return"junior"}return"own"},$e=(e,t=null)=>"all"===Me(e,t),Re=(e,t=null)=>{const a=Me(e,t);return"junior"===a||"all"===a},Be=(e,t=null)=>"own"===Me(e,t),Oe=(e,t=null)=>{const a=Me(e,t);return"junior"===a||"all"===a},Fe=(e,t=null,a=null)=>{const s=Me(e,a),n=Ue();return"all"===s||"junior"===s||"own"===s&&t===n},qe=(e,t=null,a=null)=>Fe(e,t,a),Ue=()=>{try{const e=JSON.parse(localStorage.getItem("userData")||"{}");return e.user_id||e._id||e.id}catch(e){return null}},ze=(e,t,a)=>{if(!e)return!1;if("object"==typeof e&&!Array.isArray(e)&&0===Object.keys(e).length)return!1;if(Array.isArray(e))return((e,t,a)=>{if(!e)return!1;if(Array.isArray(e))for(const s of e)if(s&&s.page){if(("*"===s.page||"any"===s.page||"Global"===s.page)&&("*"===s.actions||Array.isArray(s.actions)&&s.actions.includes("*")))return!0;if(s.page.toLowerCase()===t.toLowerCase()){if("*"===s.actions)return!0;if("all"===s.actions)return!0;if(Array.isArray(s.actions)){if(s.actions.includes("*"))return!0;if(s.actions.includes("all"))return!0;if(s.actions.includes(a))return!0}if("string"==typeof s.actions&&s.actions===a)return!0}}return ze(e,t,a)})(e,t,a);if("*"===e?.["*"])return!0;if("*"===e?.pages&&"*"===e?.actions)return!0;if("*"===e?.Global||"*"===e?.global)return!0;const s=t.toLowerCase(),n=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase(),i=[t,s,n];for(const r of i){if("*"===e?.[r])return!0;if(e?.[r]){if("object"==typeof e[r]&&!Array.isArray(e[r])){if(!0===e[r][a])return!0;if(!0===e[r]["*"]||!0===e[r].all)return!0}if(Array.isArray(e[r])&&(e[r].includes(a)||e[r].includes("*")||e[r].includes("all")))return!0}}return!1},Ve=e=>(e||(e=Je()),"*"===e?.pages&&"*"===e?.actions||!!("*"===e?.login||e?.login&&"object"==typeof e.login&&!0===e.login["*"])||ze(e,"login","show")),He=()=>{try{return localStorage.getItem("userId")}catch(e){return null}},Je=()=>{try{const e=localStorage.getItem("userPermissions");return e?JSON.parse(e):{}}catch(e){return{}}},Ye=e=>{if(!e)return!1;const t=Je(),a=He();return"*"===t?.pages&&"*"===t?.actions||!!("*"===t?.feeds||t?.feeds&&"object"==typeof t.feeds&&!0===t.feeds["*"])||e.created_by===a||ze(t,"feeds","edit")},We=(e,t,a)=>!!(t&&e&&("*"===e?.pages&&"*"===e?.actions||"*"===e?.feeds||e?.feeds&&"object"==typeof e.feeds&&!0===e.feeds["*"]||ze(e,"feeds","post")||a&&(t.created_by===a||t.authorId===a||t.creator_id===a||t.userId===a))),Ge=(e,t,a)=>!!(t&&e&&("*"===e?.pages&&"*"===e?.actions||"*"===e?.feeds||e?.feeds&&"object"==typeof e.feeds&&!0===e.feeds["*"]||ze(e,"feeds","delete")||a&&(t.created_by===a||t.authorId===a||t.creator_id===a||t.userId===a||t.user_id===a))),Ke=e=>!(!e||!Pe(e)&&"*"!==e?.Leads&&"*"!==e?.leads&&!ze(e,"leads","assign")&&!(!0===e?.leads?.allow_reassign||Array.isArray(e?.Leads)&&e.Leads.includes("allow_reassign")||Array.isArray(e?.leads)&&e.leads.includes("allow_reassign"))),Qe=e=>(e||(e=Je()),!!Pe(e)||ze(e,"interview","show")),Ze=e=>(e||(e=Je()),!!Pe(e)||ze(e,"reports","show")),Xe=e=>(e||(e=Je()),!!Pe(e)||ze(e,"notification","show")),et="/api",tt=async(e,t=null)=>{try{const s=localStorage.getItem("token");if(!s)throw new Error("No authentication token found");const n=localStorage.getItem("userData");if(!n)throw new Error("No user data found in localStorage");const{user_id:i}=JSON.parse(n),r=t?`${et}/roles/${t}?user_id=${i}`:`${et}/roles?user_id=${i}`,o=t?"PUT":"POST",l=await fetch(r,{method:o,headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(e)});let d;try{d=await l.json()}catch(a){const e=await l.text();throw new Error(`Backend response was not valid JSON: ${e}`)}if(!l.ok)throw new Error(`Failed to update role: ${l.status} ${l.statusText} - ${JSON.stringify(d)}`);const{role_id:c}=JSON.parse(n);return c!==(t||d.id||d._id)&&c!==t||(await new Promise(e=>setTimeout(e,500)),await(async()=>{try{const e=localStorage.getItem("userData");if(!e)throw new Error("No user data found in localStorage");const{user_id:t}=JSON.parse(e);if(!t)throw new Error("No user ID found in user data");localStorage.removeItem("userPermissions"),localStorage.removeItem("cachedSidebarMenuData_v1"),Object.keys(localStorage).filter(e=>e.includes("user_permissions_")||e.includes("permissions")||e.includes("sidebar")).forEach(e=>{localStorage.removeItem(e)});const a=await(async e=>{try{const t=localStorage.getItem("token");if(!t)throw new Error("No authentication token found");const a=await fetch(`${et}/users/${e}/permissions`,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!a.ok)throw new Error(`Failed to fetch permissions: ${a.status} ${a.statusText}`);return await a.json()}catch(t){throw t}})(t);localStorage.setItem("userPermissions",JSON.stringify(a)),(e=>{try{localStorage.setItem("userPermissions",JSON.stringify(e))}catch(t){}})(a);const s={...JSON.parse(localStorage.getItem("userData")),permissions:a};return localStorage.setItem("userData",JSON.stringify(s)),window.dispatchEvent(new CustomEvent("permissionsUpdated",{detail:{permissions:a,timestamp:Date.now(),immediate:!0}})),window.dispatchEvent(new CustomEvent("immediatePermissionRefresh",{detail:{permissions:a,userId:t,timestamp:Date.now()}})),window.dispatchEvent(new StorageEvent("storage",{key:"userPermissions",newValue:JSON.stringify(a),oldValue:null,storageArea:localStorage})),a}catch(e){throw e}})()),d}catch(s){throw s}},at=e=>{const t=t=>{e&&e(t.detail.permissions)};return window.addEventListener("permissionsUpdated",t),window.addEventListener("immediatePermissionRefresh",t),()=>{window.removeEventListener("permissionsUpdated",t),window.removeEventListener("immediatePermissionRefresh",t)}},st=async(e,t={})=>{const a={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,...t.body instanceof FormData?{}:{"Content-Type":"application/json"},Accept:"application/json",Origin:window.location.origin}},s={...a,...t,headers:{...a.headers,...t.headers||{}}};try{let t=3,a=500,i=null;for(;t>0;)try{const t=await fetch(e,s);if(t.ok||t.status<500)return t;throw new Error(`HTTP ${t.status}: ${t.statusText}`)}catch(n){if(i=n,t--,0===t)throw i;await new Promise(e=>setTimeout(e,a)),a*=2}}catch(n){throw n}},nt=()=>{try{const e=localStorage.getItem("userData");if(e){const{user_id:t}=JSON.parse(e);return t}return null}catch(e){return null}},it=()=>{try{const e=localStorage.getItem("userData");return e?JSON.parse(e):null}catch(e){return null}},rt=()=>{const e=localStorage.getItem("token"),t=localStorage.getItem("userData");return!(!e||!t)},ot=()=>{localStorage.removeItem("token"),localStorage.removeItem("userData"),localStorage.removeItem("isAuthenticated")},lt=async()=>{try{const e=it();if(!e||!e._id)return{valid:!1,shouldLogout:!0,reason:"No user data found"};const t=await st(`/api/users/${e._id}?user_id=${e._id}`,{method:"GET"});if(t.ok){const e=await t.json();if(!e)return ot(),{valid:!1,shouldLogout:!0,reason:"User not found in database"};const a=void 0===e.is_active||e.is_active,s=void 0!==e.login_enabled&&e.login_enabled;return a?s?{valid:!0,shouldLogout:!1}:(ot(),{valid:!1,shouldLogout:!0,reason:"Your login access has been disabled by administrator"}):(ot(),{valid:!1,shouldLogout:!0,reason:"User account has been deactivated"})}return 404===t.status?(ot(),{valid:!1,shouldLogout:!0,reason:"User not found"}):401===t.status||403===t.status?(ot(),{valid:!1,shouldLogout:!0,reason:"Session expired or unauthorized"}):{valid:!1,shouldLogout:!1,reason:`Server error: ${t.status}`}}catch(e){return{valid:!1,shouldLogout:!1,reason:`Network error: ${e.message}`}}},dt=(e="Session expired")=>{ot(),"undefined"!=typeof window&&(window.confirm?window.confirm(`${e}. Click OK to go to login page.`):window.alert&&window.alert(`${e}. Please log in again.`),window.location.href="/",window.location.reload())},ct=new class{constructor(){this.events={}}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(e=>e!==t))}emit(e,t){this.events[e]&&this.events[e].forEach(e=>e(t))}},mt=Object.freeze(Object.defineProperty({__proto__:null,clearAuthData:ot,fetchWithAuth:st,forceLogout:dt,getCurrentUser:it,getCurrentUserId:nt,isAuthenticated:rt,leadEvents:ct,verifySession:lt},Symbol.toStringTag,{value:"Module"}));
/**
 * @license lucide-react v0.515.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let ut=!1;const gt=e=>{if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:new Date(t.getTime()+198e5)},pt=e=>{const t=gt(e);return t?`${t.toLocaleDateString("en-IN",{day:"2-digit",month:"long",year:"numeric"})} at ${t.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",hour12:!0})}`:""},yt=e=>{const t=gt(e);return t?t.toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}):""},ht=()=>gt((new Date).toISOString()),ft=(e,t)=>a.lazy(()=>e().catch(t=>new Promise(t=>{setTimeout(()=>{t(e())},1e3)}))),bt=ft(()=>Ee(()=>import("./AboutSection-dhoQmkhr.js"),__vite__mapDeps([0,1,2,3,4]))),xt=ft(()=>Ee(()=>import("./HowToProcessSection-B4y7S0l5.js"),__vite__mapDeps([5,1,2,3,4]))),_t=ft(()=>Ee(()=>import("./ImportantQuestionsSection-Ipz1C9QW.js"),__vite__mapDeps([6,1,2,3,4]))),wt=ft(()=>Ee(()=>import("../assets/main-9KtUfBSi.js").then(e=>e.a),__vite__mapDeps([7,1,2,3,4,8,9,10,11,12,13]))),vt=ft(()=>Ee(()=>import("./ObligationSection-COad_a3R.js"),__vite__mapDeps([14,1,2,3,4,11,8,9,10,12,15]))),jt=ft(()=>Ee(()=>import("./Attachments-DU1bIGm9.js"),__vite__mapDeps([16,1,2,3,4,8,9,10]))),Nt=ft(()=>Ee(()=>import("./TaskSectionInLead-C2XyroAs.js"),__vite__mapDeps([17,1,2,3,4]))),kt=ft(()=>Ee(()=>import("./LeadActivity-BH0mdg5t.js"),__vite__mapDeps([18,1,2,3,4]))),St=ft(()=>Ee(()=>import("./CopyLeadSection-BXlzOuyy.js"),__vite__mapDeps([19,1,2,3,4]))),Ct=ft(()=>Ee(()=>import("./Remark-MXC4aR8c.js"),__vite__mapDeps([20,1,2,3,4]))),Lt=ft(()=>Ee(()=>import("./FileSentToLoginSection-NSkilrkc.js"),__vite__mapDeps([21,1,2,3,4])));ft(()=>Ee(()=>import("./ReassignmentPanel-DHQZISo8.js"),__vite__mapDeps([22,1,2,3,4,23]))),ft(()=>Ee(()=>import("./RequestReassignmentButton-CQtopnlf.js"),__vite__mapDeps([24,1,2,3,4,23]))),ft(()=>Ee(()=>import("./LeadDetails-0201Intp.js"),__vite__mapDeps([25,1,2,3,4,11,8,9,10,12,0,5,7,13,16,17,6,26,24,23])));const At=({height:e="200px",error:a=null,retry:s=null})=>a?t.jsxs("div",{style:{height:e,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#fff2f0",borderRadius:"8px",border:"1px solid #ffccc7",padding:"16px"},children:[t.jsx("div",{style:{color:"#ff4d4f",marginBottom:"8px"},children:"Failed to load section"}),s&&t.jsx("button",{onClick:s,style:{background:"#1890ff",color:"white",border:"none",padding:"4px 12px",borderRadius:"4px",cursor:"pointer"},children:"Retry"})]}):t.jsx("div",{style:{height:e,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",borderRadius:"8px",border:"1px solid #f0f0f0"},children:t.jsx(n,{size:"large",tip:"Loading section..."})});class Tt extends s.Component{constructor(t){var a;super(t),((t,a,s)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s})(this,"symbol"!=typeof(a="retry")?a+"":a,()=>{this.setState({hasError:!1,retryCount:this.state.retryCount+1})}),this.state={hasError:!1,retryCount:0}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){}render(){return this.state.hasError?t.jsx(At,{height:this.props.height,error:!0,retry:this.retry}):t.jsx(a.Suspense,{fallback:t.jsx(At,{height:this.props.height}),children:this.props.children},this.state.retryCount)}}function It(e,t){const[s,n]=a.useState(e);return a.useEffect(()=>{const a=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(a)}},[e,t]),s}(()=>{try{const t=new URLSearchParams(window.location.search).get("lead_id");if(t&&(sessionStorage.setItem("directViewLeadId",t),localStorage.setItem("lastViewedLeadId",t),window.isDirectLeadView=!0,window.history&&window.history.replaceState)){const e=window.location.pathname;window.history.replaceState({},document.title,e)}const a=document.referrer;if(a)try{if(a.includes("lead_id=")){const e=new URL(a),s=new URLSearchParams(e.search).get("lead_id");s&&!t&&(sessionStorage.setItem("directViewLeadId",s),localStorage.setItem("lastViewedLeadId",s),window.isDirectLeadView=!0)}}catch(e){}}catch(t){}})();const Dt=[{key:"Not a lead",label:"NOT A LEAD",icon:T,gradient:"from-gray-500 to-gray-400",shadowColor:"shadow-gray-500/25"},{key:"Active Leads",label:"ACTIVE LEADS",icon:Te,gradient:"from-blue-500 to-cyan-400",shadowColor:"shadow-blue-500/25"},{key:"File sent to login",label:"FILE SENT TO LOGIN",icon:V,gradient:"from-green-500 to-green-400",shadowColor:"shadow-indigo-500/25"},{key:"Lost By mistake",label:"LOST BY MISTAKE",icon:ke,gradient:"from-orange-500 to-amber-400",shadowColor:"shadow-orange-500/25"},{key:"Lost login",label:"LOST LEAD",icon:T,gradient:"from-red-500 to-pink-400",shadowColor:"shadow-red-500/25"}],Et=["Active Leads","Disbursed","Lost By Mistake","Lost Lead","Call Not Picked","Fresh Lead","Converted","Rejected","Follow Up","Interested","Not Interested","Callback","Eligible","Document Pending","Proposal Sent","Proposal Approved","Proposal Rejected","Proposal Under Review","Completed","Cancelled","On Hold","Verification Pending","Verification Completed","Verification Failed","Application Submitted","Application Approved","Application Rejected","Application Under Review"],Pt=a.memo(function({user:e,selectedLoanType:n,department:r="leads"}){const o=(e,t=null)=>{if(!e&&t&&(e=t.AssignReprtsTo||t.assignReportTo||t.assigned_tl||t.team_leader||t.tl),!e)return[];if(Array.isArray(e))return e.map((e,t)=>{if("object"==typeof e&&null!==e){const t=["name","tl_name","team_leader_name","full_name","display_name","first_name","username","employee_name","user_name","team_leader","assigned_tl","assignedTL","assigned_team_leader","leader_name","tl","teamLeader","AssignReprtsTo"];for(const a of t)if(e[a])return e[a];return null}return"string"==typeof e&&e.trim()?e.trim():null}).filter(Boolean);if("string"==typeof e)try{const a=JSON.parse(e);return o(a,t)}catch(a){return e.includes(",")?e.split(",").map(e=>e.trim()).filter(Boolean):e.trim()?[e.trim()]:[]}if("object"==typeof e&&null!==e){const t=["name","tl_name","team_leader_name","full_name","display_name","first_name","username","employee_name","user_name","team_leader","assigned_tl","assignedTL","assigned_team_leader","leader_name","tl","teamLeader","AssignReprtsTo"];for(const a of t)if(e[a])return[e[a]]}return[]},l=e=>{const t=e||n||localStorage.getItem("leadCrmLoanTypeId")||"all";return{LEADS:`leads_cache_v2_${t}`,LOAN_TYPES:"loan_types_cache_v1",TIMESTAMP:`leads_cache_timestamp_${t}`}},d=(e=null)=>{try{const t=l(e),a=localStorage.getItem(t.TIMESTAMP),s=Date.now();if(a&&s-parseInt(a)<6e5){const e=localStorage.getItem(t.LEADS),a=localStorage.getItem(t.LOAN_TYPES);if(e)return{leads:JSON.parse(e),loanTypes:a?JSON.parse(a):[]}}}catch(t){}return null},c=d(),[m,u]=a.useState(c?.loanTypes||[]),[g,p]=a.useState(()=>n||localStorage.getItem("leadCrmLoanTypeId")||"all"),[y,h]=a.useState(c?.leads||[]),[b,x]=a.useState(c?.leads||[]),[_,w]=a.useState(!1),[v,k]=a.useState(!1),[S,C]=a.useState(0),[L,A]=a.useState(50),D=100,[P,M]=a.useState("all"),[R,B]=a.useState("all"),[O,F]=a.useState(""),q=It(O,300),[U,z]=a.useState(null),[H,J]=a.useState([]),[Y,W]=a.useState({}),[G,K]=a.useState(["HDFC","ICICI","SBI","Axis"]),[Q,Z]=a.useState(null),[X,ee]=a.useState({top:0,left:0,maxHeight:350}),[te,ae]=a.useState(""),[se,ne]=a.useState(null),[ie,re]=a.useState(!0),[oe,le]=a.useState(null),[de,ce]=a.useState({}),[me,ue]=a.useState(!0),[pe,ye]=a.useState(null),he=localStorage.getItem("userId"),fe=a.useRef(!1),be=a.useRef(""),xe=a.useRef(!1),_e=e=>{if(!de)return!1;if("show"===e&&me)return!0;if("view"===e)return _e("own")||_e("view_other")||_e("all")||_e("junior")||_e("show");if("*"===de.Global||"*"===de.global||"*"===de.pages&&"*"===de.actions||"*"===de["*"])return!0;if(Array.isArray(de))for(const o of de)if(o&&o.page){if("Leads"===o.page||"leads"===o.page){if("*"===o.actions)return!0;if(Array.isArray(o.actions)){if("show"===e&&o.actions.includes("show"))return!0;if(o.actions.includes("*"))return!0;if(o.actions.includes(e))return!0;if(("own"===e||"view_other"===e||"all"===e||"junior"===e)&&(o.actions.includes("own")||o.actions.includes("view_other")||o.actions.includes("all")||o.actions.includes("junior")))return!0}if("string"==typeof o.actions&&o.actions===e)return!0}if(("*"===o.page||"any"===o.page||"Global"===o.page)&&("*"===o.actions||Array.isArray(o.actions)&&(o.actions.includes("*")||o.actions.includes(e))))return!0}const t=de.Leads,a=de.leads;if("*"===t||"*"===a)return!0;const s=Array.isArray(t)&&(t.includes(e)||t.includes("*")),n=Array.isArray(a)&&(a.includes(e)||a.includes("*")),i="object"==typeof t&&!Array.isArray(t)&&(!0===t?.[e]||!0===t?.["*"]),r="object"==typeof a&&!Array.isArray(a)&&(!0===a?.[e]||!0===a?.["*"]);return s||n||i||r},we=()=>_e("delete"),ve=()=>{try{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);if(t.role?.name&&t.role.name.toLowerCase().includes("super admin"))return!0;if(t.role?.permissions&&Array.isArray(t.role.permissions)){const e=t.role.permissions.find(e=>"leads.pl_&_odd_leads"===e.page||"leads.pl_odd_leads"===e.page||"leads_pl_&_odd_leads"===e.page||"leads_pl_odd_leads"===e.page);if(e&&e.actions){const t=Array.isArray(e.actions)?e.actions:[e.actions];if(t.includes("status_update")||t.includes("status"))return!0}const a=t.role.permissions.find(e=>"leads"===e.page||"Leads"===e.page);if(a&&a.actions){const e=Array.isArray(a.actions)?a.actions:[a.actions];if(e.includes("status_update")||e.includes("status"))return!0}}}return!1}catch(e){return!1}},je=()=>{if("685292be8d7cdc3a71c4829b"===pe)return!0;if(Array.isArray(de)&&de.some(e=>"*"===e.page&&("*"===e.actions||Array.isArray(e.actions)&&e.actions.includes("*"))))return!0;if(de&&"object"==typeof de&&("*"===de["*"]||"*"===de.Global||"*"===de.global||"*"===de.pages&&"*"===de.actions))return!0;try{const e=localStorage.getItem("userData");if(e){const t=JSON.parse(e);if("685292be8d7cdc3a71c4829b"===t.role?._id||"685292be8d7cdc3a71c4829b"===t.role?.id)return!0;if(t.permissions&&Array.isArray(t.permissions)&&t.permissions.some(e=>"*"===e.page&&("*"===e.actions||Array.isArray(e.actions)&&e.actions.includes("*"))))return!0;if(t.permissions&&"object"==typeof t.permissions&&("*"===t.permissions["*"]||"*"===t.permissions.Global||"*"===t.permissions.global||"*"===t.permissions.pages&&"*"===t.permissions.actions))return!0}}catch(e){}return!1},Ne=()=>{aa(e=>e+1)},Se=async()=>{try{if(!he)throw new Error("User ID is required to load permissions");const a=localStorage.getItem("userPermissions"),s=localStorage.getItem("userRoleId");let n=null;try{const e=localStorage.getItem("userData");if(e){const t=JSON.parse(e);n=t.role?._id||t.role?.id}}catch(e){}if(a&&(s||n))try{const e=JSON.parse(a);ce(e);const t=s||n;return t&&(ye(t),!s&&n&&localStorage.setItem("userRoleId",n)),ue(!1),e}catch(t){localStorage.removeItem("userPermissions"),localStorage.removeItem("userRoleId")}const r=await fetch(`/api/users/permissions/${he}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Failed to fetch permissions: ${r.status} ${r.statusText}`);const o=await r.json();let l,d=null;return o.role&&o.role._id?d=o.role._id:o.role_id&&(d=o.role_id),Array.isArray(o)?l=o:Array.isArray(o.permissions)||o.permissions&&"object"==typeof o.permissions?l=o.permissions:o.role&&o.role.permissions?l=o.role.permissions:o.message&&!o.permissions?(l=[],i.warning(`Permission issue: ${o.message}`)):l=o,localStorage.setItem("userPermissions",JSON.stringify(l)),d&&(localStorage.setItem("userRoleId",d),ye(d)),ce(l),l}catch(e){return i.error(`Failed to load permissions: ${e.message}`),null}finally{ue(!1)}};a.useEffect(()=>{Se().then(()=>{}).catch(e=>{i.error("Failed to load user permissions")})},[he]),a.useEffect(()=>{const e=e=>{Se().then(()=>{})};return window.addEventListener("permissionsUpdated",e),()=>{window.removeEventListener("permissionsUpdated",e)}},[he]),a.useEffect(()=>{me||(_e("own")||_e("view_other")||_e("all")||_e("junior")||_e("show")?"You do not have permission to view leads"===Ee&&Pe(""):(i.error("You do not have permission to view leads"),Pe("You do not have permission to view leads")))},[de,me]),a.useEffect(()=>at(e=>{Hs()}),[]),a.useEffect(()=>{performance.now(),(async()=>{try{await Hs(),performance.now(),setTimeout(()=>{Promise.all([Js(),Ys(),pn()]).then(()=>{performance.now()})},100)}catch(e){}})()},[]),a.useEffect(()=>{const e=setTimeout(async()=>{try{const t=sessionStorage.getItem("directViewLeadId")||localStorage.getItem("lastViewedLeadId")||(window.isDirectLeadView?new URLSearchParams(window.location.search).get("lead_id"):null);if(t&&localStorage.getItem("token")){sessionStorage.removeItem("directViewLeadId"),localStorage.removeItem("lastViewedLeadId");try{const e=await Vs(t);e&&($e(e),pt([0]),dt(0))}catch(e){i.error(`Could not load the requested lead: ${e.message}`)}}}catch(e){}},500);return()=>clearTimeout(e)},[]),a.useEffect(()=>{!function(){try{if(ut)return null;const e=new URLSearchParams(window.location.search).get("lead_id"),t=sessionStorage.getItem("directViewLeadId")||localStorage.getItem("lastViewedLeadId"),a=e||t;if(a){if(sessionStorage.setItem("directViewLeadId",a),localStorage.setItem("lastViewedLeadId",a),window.isDirectLeadView=!0,window.directViewLeadId=a,ut=!0,e&&window.history&&window.history.replaceState){const e=window.location.pathname;window.history.replaceState({},document.title,e)}return a}}catch(Ee){}}();const e=setTimeout(()=>{!function(e){try{const t=window.directViewLeadId||sessionStorage.getItem("directViewLeadId")||localStorage.getItem("lastViewedLeadId");if(t&&e&&"function"==typeof e)return setTimeout(()=>{e(t),delete window.directViewLeadId,sessionStorage.removeItem("directViewLeadId"),localStorage.removeItem("lastViewedLeadId")},500),!0}catch(Ee){}}(Vs)},1e3);return()=>clearTimeout(e)},[]);const Ce=a.useCallback(e=>{const{loanTypeId:t,loanTypeName:a}=e.detail;g!==t&&(h([]),x([])),p(t),localStorage.setItem("leadCrmLoanTypeId",t),a&&localStorage.setItem("leadCrmLoanTypeName",a)},[g]);a.useEffect(()=>{window.addEventListener("leadCrmLoanTypeChanged",Ce);const e=localStorage.getItem("leadCrmLoanTypeId");return e&&p(e),()=>{window.removeEventListener("leadCrmLoanTypeChanged",Ce)}},[Ce]),a.useEffect(()=>{if(g&&xe.current){const e=d(g);e&&e.leads&&e.leads.length>0?(h(e.leads),x(e.leads)):Hs()}},[g]),a.useEffect(()=>{const e=e=>{null===Q||e.target.closest(".status-dropdown-container")||e.target.closest(".status-dropdown-menu")||nn()},t=e=>{null===Q||e.target.closest(".status-dropdown-menu")||e.target.closest(".status-dropdown-container")||nn()},a=e=>{"Escape"===e.key&&null!==Q&&nn()};return document.addEventListener("mousedown",e),document.addEventListener("scroll",t,{capture:!1,passive:!0}),document.addEventListener("keydown",a),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("scroll",t,{capture:!1,passive:!0}),document.removeEventListener("keydown",a)}},[Q]);const[Le,De]=a.useState(!1),[Ee,Pe]=a.useState(""),[Me,$e]=a.useState(null),[Re,Be]=a.useState(!1),[Oe,Fe]=a.useState(!1),[qe,Ue]=a.useState("all"),[ze,Ve]=a.useState("all"),[He,Je]=a.useState("all"),[Ye,We]=a.useState("all"),[Ge,Ke]=a.useState({min:"",max:""}),[Qe,Ze]=a.useState({min:"",max:""}),[Xe,et]=a.useState(null),[tt,st]=a.useState([]),[nt,it]=a.useState(!1),[rt,ot]=a.useState([]),[lt,dt]=a.useState(0),[mt,pt]=a.useState([]),ft=a.useRef({}),[At,Pt]=a.useState(!1),[Mt,$t]=a.useState(!1),[Rt,Bt]=a.useState("leadDate");(()=>{const e=ht(),t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,0);t.toISOString().split("T")[0],a.toISOString().split("T")[0]})();const[Ot,Ft]=a.useState({leadStatus:"",dateFrom:"",dateTo:"",leadDateFrom:"",leadDateTo:"",teamName:[],campaignName:"",createdBy:[],noActivityFrom:"",noActivityTo:"",leadParentStatus:[],leadAllStatus:[],assignedTL:[],noActivity:!1,noActivityDate:"",selectedStatuses:[],fileSentToLogin:!1,checkDuplicateLeads:!1,fileSentToLoginDateFrom:"",fileSentToLoginDateTo:"",totalIncomeSort:"",totalIncomeFrom:"",totalIncomeTo:""}),[qt,Ut]=a.useState(!1),[zt,Vt]=a.useState([]),[Ht,Jt]=a.useState(!1),[Yt,Wt]=a.useState(!1),[Gt,Kt]=a.useState(!1),[Qt,Zt]=a.useState(!1),[Xt,ea]=a.useState(!1),[ta,aa]=a.useState(0),[sa,na]=a.useState(""),[ia,ra]=a.useState(""),[oa,la]=a.useState(""),[da,ca]=a.useState(""),ma=It(sa,200),ua=It(ia,200),ga=It(oa,200),pa=It(da,200),[ya,ha]=a.useState(!1),[fa,ba]=a.useState(!1),[xa,_a]=a.useState(!1),[wa,va]=a.useState(!1),[ja,Na]=a.useState(!1);a.useRef(!1);const ka=a.useRef(null),[Sa,Ca]=a.useState(!1),[La,Aa]=a.useState(!1),[Ta,Ia]=a.useState(!1),[Da,Ea]=a.useState(!1),[Pa,Ma]=a.useState([]),[$a,Ra]=a.useState([]),[Ba,Oa]=a.useState({}),[Fa,qa]=a.useState({}),[Ua,za]=a.useState([]),[Va,Ha]=a.useState([]),[Ja,Ya]=a.useState([]),[Wa,Ga]=a.useState({"Not a lead":0,"Active Leads":0,"File sent to login":0,"FILE COMPLETED":0,"Lost By mistake":0,"Lost login":0}),[Ka,Qa]=a.useState([]),[Za,Xa]=a.useState({}),[es,ts]=a.useState([]),[as,ss]=a.useState(!1),[ns,is]=a.useState({customLeadId:"",newStatus:""}),[rs,os]=a.useState(!1),[ls,ds]=a.useState(!1),[cs,ms]=a.useState(null),[us,gs]=a.useState(null),ps="/api";a.useEffect(()=>{const e=e=>{if(rs){if(e.preventDefault(),!window.confirm("You have unsaved changes in the obligation section. Are you sure you want to leave?"))return void window.history.pushState(null,"",window.location.href);os(!1)}};return window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[rs]);const ys={};a.useEffect(()=>{const e=e=>{null===Q||e.target.closest(".status-dropdown-container")||e.target.closest(".status-dropdown-button")||e.target.closest(".status-dropdown-menu")||(Z(null),ae(""))},t=e=>{if(null!==Q){if(e.target.closest(".status-dropdown-menu"))return;Z(null),ae("")}},a=e=>{"Escape"===e.key&&null!==Q&&(Z(null),ae(""))};return null!==Q&&(document.addEventListener("mousedown",e),window.addEventListener("scroll",t,!0),document.addEventListener("keydown",a)),()=>{document.removeEventListener("mousedown",e),window.removeEventListener("scroll",t,!0),document.removeEventListener("keydown",a)}},[Q]),a.useEffect(()=>{zt.length===y.length&&y.length>0?Jt(!0):Jt(!1)},[zt,y]),a.useEffect(()=>{const e=e=>{const t=e.lead;if(!t||!t._id)return;const a={...t,_id:t._id||t.id,name:t.name||t.customer_name||`${t.first_name||""} ${t.last_name||""}`.trim()||"Unknown",customer_name:t.customer_name||t.name||"Unknown",mobile_number:t.mobile_number||t.phone||"",phone:t.phone||t.mobile_number||"",status:"object"==typeof t.status?t.status?.name:t.status||"Unknown",sub_status:"object"==typeof t.sub_status?t.sub_status?.name:t.sub_status||"",loan_type:t.loan_type||t.loan_type_name,loan_type_name:t.loan_type_name||t.loan_type||"Unknown",loan_type_id:t.loan_type_id||t.loan_type,created_at:t.created_at||(new Date).toISOString(),updated_at:t.updated_at||(new Date).toISOString(),email:t.email||"",campaign_name:t.campaign_name||"",created_by_name:t.created_by_name||t.created_by||"",department_name:t.department_name||"",custom_lead_id:t.custom_lead_id||t._id||"",loan_amount:t.loan_amount||0,file_sent_to_login:t.file_sent_to_login||!1,file_sent_to_login_date:t.file_sent_to_login_date||null,dynamic_fields:t.dynamic_fields||{}};!g||"all"===g||a.loan_type_id===g||a.loan_type===g||a.loan_type_name,h(e=>e.some(e=>e._id===a._id)?e:[a,...e]),C(e=>e+1);try{const e=l(g),t=localStorage.getItem(e.LEADS);if(t){const s=JSON.parse(t);if(!s.some(e=>e._id===a._id)){const t=[a,...s];localStorage.setItem(e.LEADS,JSON.stringify(t)),localStorage.setItem(e.TIMESTAMP,Date.now().toString())}}}catch(s){}};ct.on("leadCreated",e);const t=t=>{if("newLeadCreated"===t.key&&t.newValue)try{const a=JSON.parse(t.newValue);e(a),localStorage.removeItem("newLeadCreated")}catch(a){}};window.addEventListener("storage",t),(()=>{const t=localStorage.getItem("newLeadCreated");if(t)try{const a=JSON.parse(t);Date.now()-a.timestamp<5e3&&e(a),localStorage.removeItem("newLeadCreated")}catch(a){}})();const a=setInterval(()=>{},5e3);return()=>{clearInterval(a),window.removeEventListener("storage",t),ct.off("leadCreated",e)}},[g,l]);const hs=(e,t=null)=>{if(!e&&!t)return"Active Leads";const a={"Not A Lead":"Not a lead","Not a Lead":"Not a lead",Duplicate:"Not a lead","Wrong Number":"Not a lead",Spam:"Not a lead","Invalid Lead":"Not a lead","Active Leads":"Active Leads","Active Lead":"Active Leads","Fresh Lead":"Active Leads",Contacted:"Active Leads",Interested:"Active Leads","Follow Up":"Active Leads",Callback:"Active Leads",Eligible:"Active Leads","Document Pending":"Active Leads","Proposal Sent":"Active Leads","Verification Pending":"Active Leads","Application Submitted":"Active Leads",Completed:"Active Leads","FILE COMPLETED":"FILE COMPLETED","File Completed":"FILE COMPLETED","FILE COMPLETE":"FILE COMPLETED","File Complete":"FILE COMPLETED","Verification Completed":"Active Leads","Pending Assignment":"Active Leads","File sent to login":"File sent to login","File Sent to Login":"File sent to login","LOGIN FILE SENT":"File sent to login","File Sent":"File sent to login","Sent to Login":"File sent to login","Login Submitted":"File sent to login",Disbursed:"File sent to login",Converted:"File sent to login","Active Login":"File sent to login",Approved:"File sent to login","Loan Approved":"File sent to login",Sanctioned:"File sent to login","Login Approved":"File sent to login","Login Done":"File sent to login","Login Completed":"File sent to login","Lost By Mistake":"Lost By mistake","Lost by Mistake":"Lost By mistake","Technical Error":"Lost By mistake","System Error":"Lost By mistake","Accidental Reject":"Lost By mistake","Lost Lead":"Lost login","Lost Leads":"Lost login","Not Interested":"Lost login",Rejected:"Lost login","Call Not Picked":"Lost login","No Response":"Lost login",Cancelled:"Lost login","On Hold":"Lost login","Verification Failed":"Lost login","Application Rejected":"Lost login","Proposal Rejected":"Lost login",Unknown:"Active Leads","":"Active Leads",null:"Active Leads",undefined:"Active Leads"};if(t&&null!=t&&""!==t){const e=String(t);if(a[e])return a[e]}if(e&&null!=e&&""!==e){const t=String(e);if(a[t])return a[t]}const s=`${String(e||"").toLowerCase()} ${String(t||"").toLowerCase()}`.trim();return s.includes("not")&&s.includes("lead")?"Not a lead":s.includes("lost")&&s.includes("mistake")?"Lost By mistake":s.includes("lost")||s.includes("rejected")||s.includes("not interested")?"Lost login":s.includes("login")||s.includes("disbursed")||s.includes("approved")?"File sent to login":s.includes("completed")&&s.includes("file")?"FILE COMPLETED":"Active Leads"},fs=()=>{os(!1),null!==cs&&("back_to_table"===cs?$e(null):(dt(cs),pt(0===cs?[0]:[])),ms(null)),null!==us&&(pt(e=>e.includes(us)?e.filter(e=>e!==us):[...e,us]),gs(null)),ds(!1)},bs=()=>{ms(null),gs(null),ds(!1)};async function xs(e,t,a=!1){$e(a=>{const s={...a};if("co_applicant_form"===e)s.dynamic_fields||(s.dynamic_fields={}),s.dynamic_fields.co_applicant_form=t,s.coApplicantForm=t;else if("applicant_form"===e)s.dynamic_fields||(s.dynamic_fields={}),s.dynamic_fields.applicant_form=t,s.loginForm=t;else if("dynamic_fields"===e)s.dynamic_fields={...s.dynamic_fields,...t};else if(s[e]=t,"customerName"===e){const e=t.split(" ");s.first_name=e[0]||"",s.last_name=e.slice(1).join(" ")||"",s.name=t}else"mobileNumber"===e?(s.mobile_number=t,s.phone=t):"pinCode"===e||"pincode"===e?(s.pincode=t,s.dynamic_fields||(s.dynamic_fields={}),s.dynamic_fields.address||(s.dynamic_fields.address={}),s.dynamic_fields.address.pincode=t):"city"===e?(s.city=t,s.dynamic_fields||(s.dynamic_fields={}),s.dynamic_fields.address||(s.dynamic_fields.address={}),s.dynamic_fields.address.city=t):"alternateNumber"===e?s.alternative_phone=t:"dataCode"===e?s.data_code=t:"productName"===e&&(s.loan_type=t,s.loan_type_name=t);return s}),st(a=>a.map(a=>a._id===Me._id?{...a,[e]:t,..."co_applicant_form"===e&&{dynamic_fields:{...a.dynamic_fields,co_applicant_form:t},coApplicantForm:t},..."applicant_form"===e&&{dynamic_fields:{...a.dynamic_fields,applicant_form:t},loginForm:t},..."dynamic_fields"===e&&{dynamic_fields:{...a.dynamic_fields,...t}},..."customerName"===e&&{first_name:t.split(" ")[0]||"",last_name:t.split(" ").slice(1).join(" ")||"",name:t},..."mobileNumber"===e&&{mobile_number:t,phone:t},...("pinCode"===e||"pincode"===e)&&{pincode:t,dynamic_fields:{...a.dynamic_fields,address:{...a.dynamic_fields?.address,pincode:t}}},..."city"===e&&{city:t,dynamic_fields:{...a.dynamic_fields,address:{...a.dynamic_fields?.address,city:t}}},..."alternateNumber"===e&&{alternative_phone:t},..."dataCode"===e&&{data_code:t},..."productName"===e&&{loan_type:t,loan_type_name:t}}:a)),h(a=>a.map(a=>a._id===Me._id?{...a,[e]:t,..."customerName"===e&&{first_name:t.split(" ")[0]||"",last_name:t.split(" ").slice(1).join(" ")||"",name:t},..."mobileNumber"===e&&{mobile_number:t,phone:t},...("pinCode"===e||"pincode"===e)&&{pincode:t,dynamic_fields:{...a.dynamic_fields,address:{...a.dynamic_fields?.address,pincode:t}}},..."city"===e&&{city:t,dynamic_fields:{...a.dynamic_fields,address:{...a.dynamic_fields?.address,city:t}}},..."alternateNumber"===e&&{alternative_phone:t},..."dataCode"===e&&{data_code:t},..."productName"===e&&{loan_type:t,loan_type_name:t}}:a)),x(a=>a.map(a=>a._id===Me._id?{...a,[e]:t,..."customerName"===e&&{first_name:t.split(" ")[0]||"",last_name:t.split(" ").slice(1).join(" ")||"",name:t},..."mobileNumber"===e&&{mobile_number:t,phone:t},...("pinCode"===e||"pincode"===e)&&{pincode:t,dynamic_fields:{...a.dynamic_fields,address:{...a.dynamic_fields?.address,pincode:t}}},..."city"===e&&{city:t,dynamic_fields:{...a.dynamic_fields,address:{...a.dynamic_fields?.address,city:t}}},..."alternateNumber"===e&&{alternative_phone:t},..."dataCode"===e&&{data_code:t},..."productName"===e&&{loan_type:t,loan_type_name:t}}:a));try{const n=localStorage.getItem("userId"),r=`/api/leads/${Me._id}?user_id=${n}&_t=${Date.now()}`;let o={};if("co_applicant_form"===e||"applicant_form"===e)o={dynamic_fields:{...Me.dynamic_fields,[e]:t}};else if("dynamic_fields"===e)o={dynamic_fields:{...Me.dynamic_fields,...t}};else{const a={customerName:"name",mobileNumber:"mobile_number",pinCode:"pincode",alternateNumber:"alternative_phone",dataCode:"data_code",productName:"loan_type"}[e]||e;if(o={[a]:t},"customerName"===e){const e=t.split(" ");o.first_name=e[0]||"",o.last_name=e.slice(1).join(" ")||""}else if("productName"===e)o.loan_type_name=t;else if("mobileNumber"===e)o.phone=t;else if("pinCode"===e||"pincode"===e||"city"===e){const a="pinCode"===e||"pincode"===e?"pincode":"city";o={[a]:t}}}const l=await fetch(r,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"},body:JSON.stringify(o),cache:"no-store"});if(!l.ok){const e=await l.text();throw new Error(`HTTP error! status: ${l.status}, message: ${e}`)}const d=await l.json(),c=(e,t,a)=>{if("dynamic_fields"===e&&"object"==typeof a&&null!==a){const e=Object.keys(a).filter(e=>{const t=a[e];return null!=t&&""!==t});if(1===e.length){const t=e[0];return{financial_details:"Financial Details",personal_details:"Personal Details",check_eligibility:"Check Eligibility",eligibility_details:"Eligibility Details",obligations:"Obligations",processing_bank:"Processing Bank",processingBank:"Processing Bank",totalObligation:"Total Obligation",totalBtPos:"Total BT Position",cibilScore:"CIBIL Score",salary:"Salary",partnerSalary:"Partner Salary",yearlyBonus:"Yearly Bonus",companyName:"Company Name",companyType:"Company Type",companyCategory:"Company Category",loanRequired:"Loan Required"}[t]||t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}return e.length>1?`${e.length} fields updated`:"Updated"}if(null!=a)return"object"==typeof a&&null!==a?"Updated":"string"==typeof a&&a.length>50?a.substring(0,50)+"...":"number"==typeof a?a.toLocaleString():a||"Updated";if(!t)return"Updated";const s=t.dynamic_fields?.[e]||t[e];return"object"==typeof s&&null!==s?"Updated":"string"==typeof s&&s.length>50?s.substring(0,50)+"...":s||"Updated"},m={applicant_form:"Applicant Form",co_applicant_form:"Co-Applicant Form",important_questions:"Important Questions",how_to_process:"How to Process",about_section:"About Section",obligations:"Obligations",operations:"Operations",first_name:"First Name",last_name:"Last Name",mobile_number:"Mobile Number",email:"Email",city:"City",pincode:"Pincode",company_name:"Company Name",salary:"Salary",loan_type:"Loan Type",status:"Status",sub_status:"Sub Status",customerName:"Customer Name",mobileNumber:"Mobile Number",alternateNumber:"Alternate Number",dataCode:"Data Code",campaignName:"Campaign Name",productName:"Product Name",pinCode:"Pin Code",processingBank:"Processing Bank",totalObligation:"Total Obligation",totalBtPos:"Total BT Position",cibilScore:"CIBIL Score",partnerSalary:"Partner Salary",yearlyBonus:"Yearly Bonus",companyName:"Company Name",companyType:"Company Type",companyCategory:"Company Category",loanRequired:"Loan Required",dynamic_fields:"Lead Details"}[s=e]||s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),u=c(e,d,t);$e(e=>({...e,...d,dynamic_fields:{...e?.dynamic_fields,...d.dynamic_fields}})),a||i.success(`${m}: ${u}`)}catch(n){i.error(`Failed to save ${e}: ${n.message}`),$e(t=>{const a={...t};return"co_applicant_form"===e?(a.dynamic_fields&&delete a.dynamic_fields.co_applicant_form,delete a.coApplicantForm):"applicant_form"===e?(a.dynamic_fields&&delete a.dynamic_fields.applicant_form,delete a.loginForm):delete a[e],a})}var s}const _s=e=>async t=>{const a={};Object.keys(t).forEach(s=>{t[s]!==e[s]&&(a[s]=t[s])});for(const[e,s]of Object.entries(a))await xs(e,s,!0);return!0},ws=e=>async t=>{t.process&&await xs("process",t.process,!0);const a=["bank_name","product_need","required_amount","required_tenure","salary","company_category"];for(const s of a)void 0!==t[s]&&t[s]!==e[s]&&await xs(s,t[s],!0);return!0},vs=[{label:"LEAD DETAILS",getContent:(e,a)=>[{label:"About",content:t.jsx(Tt,{height:"300px",children:t.jsx(bt,{lead:e,onSave:_s(e)},`about-${e._id}`)})},{label:"How to Process",content:t.jsx(Tt,{height:"250px",children:t.jsx(xt,{process:e.process,onSave:ws(e),lead:e},`howtoprocess-${e._id}-${JSON.stringify(e.process)}`)})},{label:"APPLICANT FORM",content:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-bold text-[#03B0F5]",children:"Primary Applicant"}),t.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-bold text-lg",onClick:()=>{a("co_applicant_form",{first_name:"",last_name:"",mobile_number:"",email:"",date_of_birth:"",address:"",city:"",state:"",pincode:"",pan_number:"",aadhar_number:"",initialized:!0})},children:"+ Add Co-Applicant"})]}),void 0,void 0,void 0,void 0,void 0,t.jsx(wt,{data:e.dynamic_fields?.applicant_form||e.loginForm||{},onSave:e=>a("applicant_form",e),bankOptions:G,mobileNumber:e.mobile_number,bankName:e.salaryAccountBank||e.bank_name,isReadOnlyMobile:!0,leadId:e._id,leadCustomerName:`${e.first_name||""} ${e.last_name||""}`.trim()||e.customerName||e.name||"",leadData:e}),(e.dynamic_fields?.co_applicant_form||e.coApplicantForm)&&t.jsxs("div",{className:"mt-8 pt-6 border-t-2 border-cyan-400",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-bold text-[#03B0F5]",children:"Co-Applicant"}),t.jsx("button",{className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-bold text-lg",onClick:()=>a("co_applicant_form",null),children:"Remove Co-Applicant"})]}),t.jsx(wt,{data:e.dynamic_fields?.co_applicant_form||e.coApplicantForm||{},onSave:e=>a("co_applicant_form",e),bankOptions:G,mobileNumber:"",bankName:"",isCoApplicant:!0,leadId:e._id,leadCustomerName:`${`${e.first_name||""} ${e.last_name||""}`.trim()||e.customerName||e.name||""} - Co-Applicant`,leadData:e})]})]})},{label:"Important Questions",content:t.jsx(Tt,{height:"400px",children:t.jsx(_t,{leadData:e,onUpdate:e=>{a("importantquestion",e),e.question_responses&&a("question_responses",e.question_responses),void 0!==e.important_questions_validated&&a("important_questions_validated",e.important_questions_validated),W(e.question_responses||e.importantquestion||{})},currentUserRole:{permissions:[],_id:localStorage.getItem("userId"),department:localStorage.getItem("userDepartment")||"sales"}},`questions-${e._id}-${e.important_questions_validated}`)})}]},{label:"OBLIGATION",getContent:(e,a)=>[{content:t.jsx("div",{children:t.jsx(Tt,{height:"500px",children:t.jsx(vt,{leadData:e,handleChangeFunc:(e,t)=>{os(!0),a(e,t,!0)},onDataUpdate:async()=>{os(!1);const e=Me?._id;await Hs(),e&&setTimeout(()=>{h(t=>{const a=t.find(t=>t._id===e);return a&&($e(a),st(t=>t.map(t=>t._id===e?a:t)),x(t=>t.map(t=>t._id===e?a:t))),t})},100)},onUnsavedChangesUpdate:(e,t)=>{os(e),e&&(window.obligationShowUnsavedModal=t)}})})})}]},{label:"REMARK",getContent:(e,a)=>[{content:t.jsx("div",{className:"p-6 bg-white rounded-xl shadow-2xl text-[1rem] text-gray-100 border-l-4 border-cyan-500/60",children:t.jsx(Ct,{leadData:e})})}]},{label:"TASK",getContent:e=>[{label:"TASK",content:t.jsx("div",{className:"p-4 bg-gradient-to-r from-[#1b2736] to-[#23243a] rounded-xl shadow text-[1rem] text-[#03b0f5] border-l-4 border-cyan-400/40",children:t.jsx("div",{className:"font-bold text-cyan-400 mb-2",children:t.jsx(Tt,{height:"300px",children:t.jsx(Nt,{leadData:e})})})})}]},{label:"ATTACHEMENT",getContent:e=>[{content:t.jsx("div",{children:t.jsx(Tt,{height:"350px",children:t.jsx(jt,{leadId:e._id,userId:"object"==typeof e.created_by?e.created_by?.user_id||e.created_by?.id||e.created_by?._id:e.created_by})})})}]},{label:"LEADS ACTIVITY",getContent:e=>[{label:"LEADS ACTIVITY",content:t.jsx("div",{className:"p-4 bg-white rounded-xl shadow text-[1rem] text-[#03b0f5] border-l-4 border-cyan-400/40",children:t.jsx("div",{className:"font-bold text-cyan-400 mb-2",children:t.jsx(Tt,{height:"400px",children:t.jsx(kt,{leadId:String(e._id||e.id),userId:String(e.assigned_to||localStorage.getItem("userId")||localStorage.getItem("user_id")),leadData:e})})})})}]}],js=a.useMemo(()=>{const e={"Not a lead":0,"Active Leads":0,"File sent to login":0,"FILE COMPLETED":0,"Lost By mistake":0,"Lost login":0};let t=Array.isArray(y)?[...y]:[];if(q){const e=q.trim().split(/\s+/).filter(e=>e.length>0);t=t.filter(t=>e.some(e=>{const a=e.toLowerCase();return"string"==typeof t.name&&t.name.toLowerCase().includes(a)||"string"==typeof t.first_name&&t.first_name.toLowerCase().includes(a)||"string"==typeof t.last_name&&t.last_name.toLowerCase().includes(a)||void 0!==t.mobile_number&&null!==t.mobile_number&&t.mobile_number.toString().includes(a)||void 0!==t.phone&&null!==t.phone&&t.phone.toString().includes(a)||"string"==typeof t.email&&t.email.toLowerCase().includes(a)||"string"==typeof t.campaign_name&&t.campaign_name.toLowerCase().includes(a)||"string"==typeof t.department_name&&t.department_name.toLowerCase().includes(a)||"object"==typeof t.department_name&&t.department_name?.name&&t.department_name.name.toLowerCase().includes(a)||"string"==typeof t.department_name&&t.department_name.toLowerCase().includes(a)||"string"==typeof t.created_by&&t.created_by.toLowerCase().includes(a)||"object"==typeof t.created_by&&t.created_by?.name&&t.created_by.name.toLowerCase().includes(a)||"string"==typeof t.created_by_name&&t.created_by_name.toLowerCase().includes(a)||"string"==typeof t.status&&t.status.toLowerCase().includes(a)||"object"==typeof t.status&&t.status.name&&t.status.name.toLowerCase().includes(a)||"string"==typeof t.sub_status&&t.sub_status.toLowerCase().includes(a)||"object"==typeof t.sub_status&&t.sub_status?.name&&t.sub_status.name.toLowerCase().includes(a)||"string"==typeof t.custom_lead_id&&t.custom_lead_id.toLowerCase().includes(a)}))}const a=Ot.fileSentToLogin,s=Ot.selectedStatuses&&Ot.selectedStatuses.length>0;if((a||s)&&(t=t.filter(e=>{let t=!1;if(a&&!0===e.file_sent_to_login&&(t=!0),s){const a="object"==typeof e.status?e.status.name||"Unknown":e.status||"Unknown",s="object"==typeof e.sub_status?e.sub_status.name||"":e.sub_status||"";Ot.selectedStatuses.some(t=>"File sent to login"===t?!0===e.file_sent_to_login:t===a||t===s)&&(t=!0)}return t})),Ot.leadAllStatus&&Ot.leadAllStatus.length>0&&(t=t.filter(e=>{const t="object"==typeof e.status?e.status.name||"Unknown":e.status||"Unknown",a="object"==typeof e.sub_status?e.sub_status.name||"":e.sub_status||"";return Ot.leadAllStatus.includes(t)||a&&Ot.leadAllStatus.includes(a)})),Ot.teamName&&Ot.teamName.length>0&&(t=t.filter(e=>{const t=e.department_name||e.team_name,a="object"==typeof t?t?.name:t;return Ot.teamName.includes(a)})),Ot.assignedTL&&Ot.assignedTL.length>0&&(t.length,t=t.filter(e=>{const t=e.assign_report_to||e.assignReportTo;let a=[];if(null!=t&&""!==t)if("string"==typeof t)try{const e=JSON.parse(t);Array.isArray(e)&&(a=e.map(e=>"object"==typeof e&&e.name?e.name:"string"==typeof e?e.trim():null).filter(Boolean))}catch{a=t.split(",").map(e=>e.trim()).filter(Boolean)}else a=Array.isArray(t)?t.map(e=>"object"==typeof e&&e.name?e.name:"string"==typeof e?e.trim():null).filter(Boolean):o(t,e);let s=!1;return s=0===a.length?!!Ot.assignedTL.includes("Not Assigned"):a.some(e=>Ot.assignedTL.includes(e)),s}),t.length),Ot.createdBy&&Ot.createdBy.length>0&&(t=t.filter(e=>{const t=e.created_by_name||("object"==typeof e.created_by?e.created_by?.name:e.created_by);return Ot.createdBy.includes(t)})),Ot.loanTypeFilter&&Ot.loanTypeFilter.length>0&&(t=t.filter(e=>Ot.loanTypeFilter.includes(e.loan_type_name))),Ot.dateRange&&2===Ot.dateRange.length){const[e,a]=Ot.dateRange;t=t.filter(t=>moment(t.created_at).isBetween(e,a,"day","[]"))}(Ot.leadDateFrom||Ot.leadDateTo)&&(t=t.filter(e=>{const t=new Date(e.created_at||e.date_created||e.created||e.date);if(isNaN(t.getTime()))return!1;let a=!0;if(Ot.leadDateFrom&&a){const e=new Date(Ot.leadDateFrom);if(!isNaN(e.getTime())){e.setHours(0,0,0,0);const s=new Date(t);s.setHours(0,0,0,0),s<e&&(a=!1)}}if(Ot.leadDateTo&&a){const e=new Date(Ot.leadDateTo);isNaN(e.getTime())||(e.setHours(23,59,59,999),new Date(t)>e&&(a=!1))}return a}));const n=_e("all");if(g&&"all"!==g&&!n&&(t=t.filter(e=>e.loan_type_id===g||e.loan_type===g||e.loan_type_name===g||"68595a524cec3069a38501e6"===g&&("PL & OD"===e.loan_type||"PL & OD"===e.loan_type_name)||"68595a524cec3069a38501e5"===g&&("Home Loan"===e.loan_type||"Home Loan"===e.loan_type_name))),Ot.checkDuplicateLeads){const e=e=>{if(!e)return null;const t=e.toString().replace(/\D/g,"");return t.length<10?null:t.slice(-10)},a=new Map;t.forEach((t,s)=>{const n=[e(t.mobile_number),e(t.phone),e(t.alt_phone_number)].filter(e=>null!==e);[...new Set(n)].forEach(e=>{a.has(e)||a.set(e,[]),a.get(e).push(t)})});const s=new Set;a.forEach((e,t)=>{e.length>1&&(s.add(t),e.forEach((e,t)=>{}))}),0===s.size?t=[]:(t.length,t=t.filter(t=>[...new Set([e(t.mobile_number),e(t.phone),e(t.alt_phone_number)].filter(e=>null!==e))].some(e=>s.has(e))))}if(Ot.totalIncomeFrom||Ot.totalIncomeTo){const e=Ot.totalIncomeFrom?parseFloat(Ot.totalIncomeFrom):null,a=Ot.totalIncomeTo?parseFloat(Ot.totalIncomeTo):null;t.length,t=t.filter(t=>{const s=extractTotalIncome(t);let n=!0;return null!==e&&!isNaN(e)&&n&&(null===s||isNaN(s)||s<e)&&(n=!1),null!==a&&!isNaN(a)&&n&&(null===s||isNaN(s)||s>a)&&(n=!1),n})}return t.forEach(t=>{let a=t.parent_status;if(!a){const e="object"==typeof t.status?t.status?.name||"Unknown":t.status||"Unknown",s="object"==typeof t.sub_status?t.sub_status?.name||null:t.sub_status||null;a=hs(e,s)}!0===t.file_sent_to_login&&"File sent to login"!==a&&(a="File sent to login"),a&&"Unknown"!==a||(a="Active Leads"),e.hasOwnProperty(a)?e[a]++:e["Active Leads"]++}),Object.values(e).reduce((e,t)=>e+t,0),e},[y,g,q,Ot,ta]),Ns=a.useMemo(()=>{let e=Array.isArray(y)?[...y]:[];if(q){const t=q.trim().split(/\s+/).filter(e=>e.length>0);e=e.filter(e=>t.some(t=>{const a=t.toLowerCase();return"string"==typeof e.name&&e.name.toLowerCase().includes(a)||"string"==typeof e.first_name&&e.first_name.toLowerCase().includes(a)||"string"==typeof e.last_name&&e.last_name.toLowerCase().includes(a)||void 0!==e.mobile_number&&null!==e.mobile_number&&e.mobile_number.toString().includes(a)||void 0!==e.phone&&null!==e.phone&&e.phone.toString().includes(a)||"string"==typeof e.email&&e.email.toLowerCase().includes(a)||"string"==typeof e.campaign_name&&e.campaign_name.toLowerCase().includes(a)||"string"==typeof e.department_name&&e.department_name.toLowerCase().includes(a)||"object"==typeof e.department_name&&e.department_name?.name&&e.department_name.name.toLowerCase().includes(a)||"string"==typeof e.department_name&&e.department_name.toLowerCase().includes(a)||"string"==typeof e.created_by&&e.created_by.toLowerCase().includes(a)||"object"==typeof e.created_by&&e.created_by?.name&&e.created_by.name.toLowerCase().includes(a)||"string"==typeof e.created_by_name&&e.created_by_name.toLowerCase().includes(a)||"string"==typeof e.status&&e.status.toLowerCase().includes(a)||"object"==typeof e.status&&e.status.name&&e.status.name.toLowerCase().includes(a)||"string"==typeof e.sub_status&&e.sub_status.toLowerCase().includes(a)||"object"==typeof e.sub_status&&e.sub_status?.name&&e.sub_status.name.toLowerCase().includes(a)||"string"==typeof e.custom_lead_id&&e.custom_lead_id.toLowerCase().includes(a)}))}const t=Ot.fileSentToLogin,a=Ot.selectedStatuses&&Ot.selectedStatuses.length>0;if((t||a)&&(e=e.filter(e=>{let s=!1;if(t&&!0===e.file_sent_to_login&&(s=!0),a){const t="object"==typeof e.status?e.status.name||"Unknown":e.status||"Unknown",a="object"==typeof e.sub_status?e.sub_status.name||"":e.sub_status||"";Ot.selectedStatuses.some(s=>"File sent to login"===s?!0===e.file_sent_to_login:s===t||s===a)&&(s=!0)}return s})),(Ot.fileSentToLoginDateFrom||Ot.fileSentToLoginDateTo)&&(e=e.filter(e=>{if(!(!0===e.file_sent_to_login||"true"===e.file_sent_to_login||1===e.file_sent_to_login||"object"==typeof e.status&&"File sent to login"===e.status?.name||"string"==typeof e.status&&"File sent to login"===e.status||"object"==typeof e.sub_status&&"File sent to login"===e.sub_status?.name||"string"==typeof e.sub_status&&"File sent to login"===e.sub_status))return!1;const t=e.file_sent_to_login_date||e.file_sent_date||e.fileSentToLoginDate||e.file_sent_to_login_at||e.sent_to_login_date||e.login_file_sent_date||e.file_sent_to_login_time||e.login_sent_date||e.updated_at||e.created_at;if(!t)return!0;const a=new Date(t);if(isNaN(a.getTime()))return!0;let s=!0;if(Ot.fileSentToLoginDateFrom){const e=new Date(Ot.fileSentToLoginDateFrom);if(!isNaN(e.getTime())){e.setHours(0,0,0,0);const t=new Date(a);t.setHours(0,0,0,0),t<e&&(s=!1)}}if(Ot.fileSentToLoginDateTo&&s){const e=new Date(Ot.fileSentToLoginDateTo);isNaN(e.getTime())||(e.setHours(23,59,59,999),a>e&&(s=!1))}return s})),Ot.checkDuplicateLeads){const t=e=>{if(!e)return null;const t=e.toString().replace(/\D/g,"");return t.length<10?null:t.slice(-10)},a=new Map;e.forEach((e,s)=>{const n=[t(e.mobile_number),t(e.phone),t(e.alt_phone_number)].filter(e=>null!==e);[...new Set(n)].forEach(t=>{a.has(t)||a.set(t,[]),a.get(t).push(e)})});const s=new Set;a.forEach((e,t)=>{e.length>1&&s.add(t)}),0===s.size?e=[]:(e.length,e=e.filter(e=>[t(e.mobile_number),t(e.phone),t(e.alt_phone_number)].filter(e=>null!==e).some(e=>s.has(e))))}if(Ot.leadAllStatus&&Ot.leadAllStatus.length>0&&(e=e.filter(e=>{const t="object"==typeof e.status?e.status.name||"Unknown":e.status||"Unknown",a="object"==typeof e.sub_status?e.sub_status.name||"":e.sub_status||"";return Ot.leadAllStatus.includes(t)||a&&Ot.leadAllStatus.includes(a)})),Ot.teamName&&Ot.teamName.length>0&&(e=e.filter(e=>{const t=e.department_name||e.team_name,a="object"==typeof t?t?.name:t;return Ot.teamName.includes(a)})),Ot.createdBy&&Ot.createdBy.length>0&&(e=e.filter(e=>{const t=e.created_by_name||("object"==typeof e.created_by?e.created_by?.name:e.created_by);return Ot.createdBy.includes(t)})),Ot.loanTypeFilter&&Ot.loanTypeFilter.length>0&&(e=e.filter(e=>Ot.loanTypeFilter.includes(e.loan_type_name))),Ot.dateRange&&2===Ot.dateRange.length){const[t,a]=Ot.dateRange;e=e.filter(e=>moment(e.created_at).isBetween(t,a,"day","[]"))}if((Ot.leadDateFrom||Ot.leadDateTo)&&(e=e.filter(e=>{const t=new Date(e.created_at||e.date_created||e.created||e.date);if(isNaN(t.getTime()))return!1;let a=!0;if(Ot.leadDateFrom&&a){const e=new Date(Ot.leadDateFrom);if(!isNaN(e.getTime())){e.setHours(0,0,0,0);const s=new Date(t);s.setHours(0,0,0,0),s<e&&(a=!1)}}if(Ot.leadDateTo&&a){const e=new Date(Ot.leadDateTo);isNaN(e.getTime())||(e.setHours(23,59,59,999),new Date(t)>e&&(a=!1))}return a})),(Ot.leadAgeFrom||Ot.leadAgeTo)&&(e=e.filter(e=>{const t=new Date(e.created_at||e.date_created||e.created||e.date);if(isNaN(t.getTime()))return!1;const a=new Date,s=Math.floor((a-t)/864e5);let n=!0;if(Ot.leadAgeFrom&&n){const e=parseInt(Ot.leadAgeFrom);!isNaN(e)&&s<e&&(n=!1)}if(Ot.leadAgeTo&&n){const e=parseInt(Ot.leadAgeTo);!isNaN(e)&&s>e&&(n=!1)}return n})),Ot.totalIncomeFrom||Ot.totalIncomeTo){const t=Ot.totalIncomeFrom?parseFloat(Ot.totalIncomeFrom):null,a=Ot.totalIncomeTo?parseFloat(Ot.totalIncomeTo):null;e.length;let s=0,n=0,i=0,r=0,o=0;e=e.filter(e=>{s++;const l=(e=>{let t=0,a=null;const s=[{value:e.totalIncome,field:"totalIncome"},{value:e.eligibility_details?.totalIncome,field:"eligibility_details.totalIncome"},{value:e.eligibility?.totalIncome,field:"eligibility.totalIncome"},{value:e.dynamic_fields?.eligibility_details?.totalIncome,field:"dynamic_fields.eligibility_details.totalIncome"},{value:e.dynamic_fields?.obligation_data?.eligibility?.totalIncome,field:"dynamic_fields.obligation_data.eligibility.totalIncome"},{value:e.obligation_data?.eligibility?.totalIncome,field:"obligation_data.eligibility.totalIncome"},{value:e.dynamic_fields?.financial_details?.monthly_income,field:"dynamic_fields.financial_details.monthly_income"},{value:e.financial_details?.monthly_income,field:"financial_details.monthly_income"},{value:e.salary,field:"salary"},{value:e.monthly_income,field:"monthly_income"},{value:e.dynamic_fields?.total_income,field:"dynamic_fields.total_income"},{value:e.dynamic_fields?.totalIncome,field:"dynamic_fields.totalIncome"},{value:e.dynamic_fields?.income,field:"dynamic_fields.income"},{value:e.dynamic_fields?.monthly_income,field:"dynamic_fields.monthly_income"},{value:e.total_income,field:"total_income"},{value:e.income,field:"income"}].find(e=>void 0!==e.value&&null!==e.value&&""!==e.value);s&&(t=s.value,a=s.field,t&&"object"==typeof t&&(void 0!==t.totalIncome?(t=t.totalIncome,a=`${a}.totalIncome`):void 0!==t.amount?(t=t.amount,a=`${a}.amount`):(t=0,a=null)));const n="string"==typeof t?parseFloat(t.replace(/[^\d.-]/g,"")):parseFloat(t),i=isNaN(n)?0:n;return 0===i?r++:o++,i})(e);let d=!0;return null===t||isNaN(t)||l<t&&(d=!1),null!==a&&!isNaN(a)&&d&&l>a&&(d=!1),d?n++:i++,d}),e.length}if(Ot.totalIncomeSort?(e.sort((e,t)=>{const a=e=>{let t=0,a=null;const s=[{value:e.totalIncome,field:"totalIncome"},{value:e.eligibility_details?.totalIncome,field:"eligibility_details.totalIncome"},{value:e.eligibility?.totalIncome,field:"eligibility.totalIncome"},{value:e.dynamic_fields?.eligibility_details?.totalIncome,field:"dynamic_fields.eligibility_details.totalIncome"},{value:e.dynamic_fields?.obligation_data?.eligibility?.totalIncome,field:"dynamic_fields.obligation_data.eligibility.totalIncome"},{value:e.obligation_data?.eligibility?.totalIncome,field:"obligation_data.eligibility.totalIncome"},{value:e.dynamic_fields?.financial_details?.monthly_income,field:"dynamic_fields.financial_details.monthly_income"},{value:e.financial_details?.monthly_income,field:"financial_details.monthly_income"},{value:e.salary,field:"salary"},{value:e.monthly_income,field:"monthly_income"},{value:e.dynamic_fields?.total_income,field:"dynamic_fields.total_income"},{value:e.dynamic_fields?.totalIncome,field:"dynamic_fields.totalIncome"},{value:e.dynamic_fields?.income,field:"dynamic_fields.income"},{value:e.dynamic_fields?.monthly_income,field:"dynamic_fields.monthly_income"},{value:e.total_income,field:"total_income"},{value:e.income,field:"income"}].find(e=>void 0!==e.value&&null!==e.value&&""!==e.value);s&&(t=s.value,a=s.field,t&&"object"==typeof t&&(void 0!==t.totalIncome?(t=t.totalIncome,a=`${a}.totalIncome`):void 0!==t.amount?(t=t.amount,a=`${a}.amount`):(t=0,a=null)));const n="string"==typeof t?parseFloat(t.replace(/[^\d.-]/g,"")):parseFloat(t);return isNaN(n)?0:n},s=a(e),n=a(t);let i=0;return"highest"===Ot.totalIncomeSort?i=n-s:"lowest"===Ot.totalIncomeSort&&(i=s-n),i}),e.slice(0,5).forEach((e,t)=>{})):e.sort((e,t)=>{const a=new Date(e.created_at||e.date_created||0);return new Date(t.created_at||t.date_created||0)-a}),(Ot.totalIncomeFrom||Ot.totalIncomeTo)&&e.length>0){const t=e[0];(()=>{const e=[{value:t.totalIncome,field:"totalIncome"},{value:t.eligibility_details?.totalIncome,field:"eligibility_details.totalIncome"},{value:t.eligibility?.totalIncome,field:"eligibility.totalIncome"},{value:t.dynamic_fields?.eligibility_details?.totalIncome,field:"dynamic_fields.eligibility_details.totalIncome"},{value:t.dynamic_fields?.obligation_data?.eligibility?.totalIncome,field:"dynamic_fields.obligation_data.eligibility.totalIncome"},{value:t.obligation_data?.eligibility?.totalIncome,field:"obligation_data.eligibility.totalIncome"},{value:t.dynamic_fields?.financial_details?.monthly_income,field:"dynamic_fields.financial_details.monthly_income"},{value:t.financial_details?.monthly_income,field:"financial_details.monthly_income"},{value:t.salary,field:"salary"},{value:t.monthly_income,field:"monthly_income"}].find(e=>void 0!==e.value&&null!==e.value&&""!==e.value);e&&(e.value,e.field)})()}if(Ot.noActivityDate&&""!==Ot.noActivityDate.trim()){const t=new Date(Ot.noActivityDate);t.setHours(0,0,0,0),e=e.filter(e=>{const a=e.last_activity_date||e.updated_at||e.created_at;if(!a)return!0;const s=new Date(a);return s.setHours(0,0,0,0),s<t})}return e},[y,q,Ot,g,ta]);a.useEffect(()=>{if(Ot.assignedTL&&Ot.assignedTL.length>0&&Ns&&Ns.length>0&&Ns.slice(0,3).forEach((e,t)=>{const a=e.assign_report_to||e.assignReportTo;let s=[];if(a)if("string"==typeof a)try{const e=JSON.parse(a);Array.isArray(e)&&(s=e.map(e=>"object"==typeof e&&e.name?e.name:"string"==typeof e?e.trim():null).filter(Boolean))}catch{s=a.split(",").map(e=>e.trim()).filter(Boolean)}else Array.isArray(a)&&(s=a.map(e=>"object"==typeof e&&e.name?e.name:"string"==typeof e?e.trim():null).filter(Boolean));s.some(e=>Ot.assignedTL.includes(e))}),y.length>0){const e=setTimeout(()=>{Ga(js)},50);return()=>clearTimeout(e)}},[js,y.length]);const ks=a.useMemo(()=>Ns&&0!==Ns.length?Ns.slice(0,L):[],[Ns,L]),Ss=a.useMemo(()=>Ns&&Ns.length>L,[Ns,L]),Cs=a.useRef(Ns);a.useEffect(()=>{Cs.current=Ns},[Ns]);const Ls=a.useCallback(e=>Cs.current[e],[]),As=a.useCallback(e=>Cs.current.find(t=>t._id===e)||y.find(t=>t._id===e),[y]),Ts=a.useCallback(()=>Cs.current.length,[]);a.useEffect(()=>{},[b,Ot.totalIncomeFrom,Ot.totalIncomeTo]);const Is=a.useMemo(()=>Array.isArray(y)?[...new Set(y.map(e=>{const t=e.department_name||e.team_name;return"object"==typeof t?t?.name:t}).filter(Boolean))].sort():[],[y]),Ds=a.useMemo(()=>Array.isArray(y)?[...new Set(y.map(e=>e.created_by_name||("object"==typeof e.created_by?e.created_by?.name:e.created_by)).filter(Boolean))].sort():[],[y]);a.useMemo(()=>Array.isArray(y)?[...new Set(y.map(e=>e.campaign_name).filter(Boolean))].sort():[],[y]);const Es=a.useMemo(()=>Ds.filter(e=>e.toLowerCase().includes(ma.toLowerCase())),[Ds,ma]),Ps=a.useMemo(()=>Is.filter(e=>e.toLowerCase().includes(ga.toLowerCase())),[Is,ga]),Ms=()=>{const e=new Set;Array.isArray(y)&&y.forEach((t,a)=>{a<10&&t.assignReportTo&&t.assignReportTo;const s=o(t.assignReportTo,t);s.forEach(t=>{t&&t.trim()&&e.add(t.trim())}),0===s.length&&o(t.assignReportTo||t.assigned_tl||t.team_leader||t.tl,t).forEach(t=>{t&&t.trim()&&e.add(t.trim())})});let t,a=Array.from(e).sort();return 0===a.length&&Array.isArray(Ja)&&Ja.length>0&&(Ja.forEach(t=>{const a=t.name||`${t.first_name||""} ${t.last_name||""}`.trim();a&&e.add(a)}),a=Array.from(e).sort()),t=a.length>0?["Not Assigned",...a]:["Not Assigned","No TLs Available"],t.filter(e=>e.toLowerCase().includes(pa.toLowerCase()))},$s=()=>{if(!ua.trim())return Ba;const e={};return Object.entries(Ba).forEach(([t,a])=>{const s=t.toLowerCase().includes(ua.toLowerCase()),n=a?a.filter(e=>{const t="object"==typeof e?e.name:e;return t&&t.toLowerCase().includes(ua.toLowerCase())}):[];(s||n.length>0)&&(e[t]=s?a:n)}),e},Rs=()=>{na(""),ra(""),la(""),ca("")},Bs=()=>{let e=0;return(Ot.leadDateFrom||Ot.leadDateTo)&&e++,(Ot.fileSentToLoginDateFrom||Ot.fileSentToLoginDateTo)&&e++,(Ot.leadAgeFrom||Ot.leadAgeTo)&&e++,Array.isArray(Ot.teamName)&&Ot.teamName.length>0&&e++,Array.isArray(Ot.createdBy)&&Ot.createdBy.length>0&&e++,Array.isArray(Ot.leadParentStatus)&&Ot.leadParentStatus.length>0&&e++,Array.isArray(Ot.leadAllStatus)&&Ot.leadAllStatus.length>0&&e++,Array.isArray(Ot.assignedTL)&&Ot.assignedTL.length>0&&e++,Array.isArray(Ot.selectedStatuses)&&Ot.selectedStatuses.length>0&&e++,Ot.leadStatus&&""!==Ot.leadStatus&&e++,Ot.campaignName&&""!==Ot.campaignName&&e++,Ot.fileSentToLogin&&e++,Ot.checkDuplicateLeads&&e++,(Ot.dateFrom||Ot.dateTo)&&e++,Ot.noActivityDate&&""!==Ot.noActivityDate.trim()&&e++,(Ot.totalIncomeFrom||Ot.totalIncomeTo)&&e++,Ot.totalIncomeSort&&""!==Ot.totalIncomeSort&&e++,e},Os=a.useMemo(()=>e=>{switch(e){case"leadDate":let e=0;return(Ot.leadDateFrom||Ot.leadDateTo)&&e++,(Ot.fileSentToLoginDateFrom||Ot.fileSentToLoginDateTo)&&e++,Ot.noActivityDate&&""!==Ot.noActivityDate.trim()&&e++,e;case"leadAge":return Ot.leadAgeFrom||Ot.leadAgeTo?1:0;case"createdBy":return Ot.createdBy&&Array.isArray(Ot.createdBy)&&Ot.createdBy.length>0?Ot.createdBy.length:0;case"status":let t=0;return Ot.selectedStatuses&&Array.isArray(Ot.selectedStatuses)&&Ot.selectedStatuses.length>0&&(t+=Ot.selectedStatuses.length),Ot.fileSentToLogin&&t++,t;case"teamName":return Ot.teamName&&Array.isArray(Ot.teamName)&&Ot.teamName.length>0?Ot.teamName.length:0;case"assignedTL":return Ot.assignedTL&&Array.isArray(Ot.assignedTL)&&Ot.assignedTL.length>0?Ot.assignedTL.length:0;case"leadActivity":let a=0;return Ot.checkDuplicateLeads&&a++,a;case"totalIncome":let s=0;return Ot.totalIncomeSort&&""!==Ot.totalIncomeSort&&s++,(Ot.totalIncomeFrom||Ot.totalIncomeTo)&&s++,s;default:return 0}},[Ot]),Fs=e=>{if(ka.current){const t=300,a=ka.current.scrollLeft,s="left"===e?a-t:a+t;ka.current.scrollTo({left:s,behavior:"smooth"})}},qs=()=>{if(ka.current){const{scrollLeft:e,scrollWidth:t,clientWidth:a}=ka.current;Ca(e>0),Aa(e<t-a-1)}};a.useEffect(()=>{qs()},[b]);const Us=()=>{Ia(!Ta),Ea(!1)},zs=()=>{Ia(!1),Ea(!1)};a.useEffect(()=>{const e=e=>{"Escape"===e.key&&Ta&&zs()};if(Ta)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[Ta]);const Vs=async e=>{if(e)try{const t=localStorage.getItem("userId"),a=localStorage.getItem("token");if(!t||!a)return i.error("Authentication required to view lead details"),sessionStorage.setItem("directViewLeadId",e),localStorage.setItem("lastViewedLeadId",e),null;const s=await fetch(`${ps}/leads/${e}?user_id=${t}&include_all=true`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch lead with ID ${e}`);const n=await s.json(),r={...n,name:`${n.first_name||""} ${n.last_name||""}`.trim()||n.name||"Unknown",customerName:`${n.first_name||""} ${n.last_name||""}`.trim()||n.name||n.customerName||"Unknown",mobile_number:n.mobile_number||n.phone||n.mobileNumber,status:"object"==typeof n.status?n.status?.name:n.status,sub_status:"object"==typeof n.sub_status?n.sub_status?.name:n.sub_status,loan_type_name:n.loan_type_name||n.loan_type||n.productName||"Unknown"};return $e(r),pt([0]),dt(0),x(t=>t.some(t=>t._id===e)?t.map(t=>t._id===e?r:t):[r,...t]),h(t=>t.some(t=>t._id===e)?t.map(t=>t._id===e?r:t):[r,...t]),setTimeout(()=>{$e(r),pt([0]),dt(0),De(!1)},100),r}catch(t){throw i.error(`Could not load lead details: ${t.message}`),t}},Hs=a.useCallback(async(e=!1)=>{performance.now();if(!e){const e=sessionStorage.getItem("directViewLeadId")||localStorage.getItem("lastViewedLeadId");if(e)if(sessionStorage.removeItem("directViewLeadId"),localStorage.removeItem("lastViewedLeadId"),localStorage.getItem("token"))try{const t=await Vs(e);t&&setTimeout(()=>{t&&t._id&&($e(t),pt([0]),dt(0),os(!1))},100)}catch(a){i.error(`Could not load lead details: ${a.message}`)}else sessionStorage.setItem("directViewLeadId",e)}if(!he)return void Pe("User authentication required");const t=JSON.stringify({userId:he,filterOptions:Ot,initialLoadCompleteRef:xe.current});if(!fe.current||t!==be.current){fe.current=!0,be.current=t,e?k(!0):(xe.current&&!c&&ha(!0),w(!1)),Pe("");try{let e=`${ps}/leads/?user_id=${he}`;xe.current||(e+="&limit=30&sort_by=created_at&sort_order=-1"),Ot.noActivityDate&&""!==Ot.noActivityDate.trim()&&(e+=`&no_activity_date=${encodeURIComponent(Ot.noActivityDate)}`);const t=await fetch(e,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json","Accept-Encoding":"gzip, deflate"}});if(!t.ok)throw new Error(`API error: ${t.status}`);const a=await t.json(),n=a.items||a||[];void 0!==a.total&&C(a.total);const i=n.map(e=>!0===e.is_deleted?null:{...e,name:e.name||`${e.first_name||""} ${e.last_name||""}`.trim()||"Unknown",mobile_number:e.mobile_number||e.phone,status:"object"==typeof e.status?e.status?.name:e.status,sub_status:"object"==typeof e.sub_status?e.sub_status?.name:e.sub_status,loan_type_name:e.loan_type_name||"Unknown"}).filter(Boolean);let r=i;const o=_e("all"),d=localStorage.getItem("userDesignation")?.toLowerCase()||"";if((d.includes("team leader")||d.includes("tl"))&&!o){const e=localStorage.getItem("employee_id")||localStorage.getItem("employeeId");let t=0,a=0;r=i.filter(s=>{const n=s.created_by===he||s.creator_id===he||s.user_id===he;n&&t++;const i=s.assign_report_to||s.AssignReprtsTo||s.assignReportTo||s.assigned_tl||s.team_leader||s.tl;let r=!1;if(i){if(Array.isArray(i))r=i.some(t=>"string"==typeof t?t===he||t===e:"object"==typeof t&&null!==t&&(t.user_id===he||t._id===he||t.id===he||t.employee_id===e||t.employeeId===e));else if("string"==typeof i)try{const t=JSON.parse(i);Array.isArray(t)?r=t.some(t=>"object"==typeof t&&(t.user_id===he||t._id===he||t.id===he||t.employee_id===e||t.employeeId===e)||t===he||t===e):"object"==typeof t&&(r=t.user_id===he||t._id===he||t.id===he||t.employee_id===e||t.employeeId===e)}catch(o){r=i===he||i===e}else"object"==typeof i&&null!==i&&(r=i.user_id===he||i._id===he||i.id===he||i.employee_id===e||i.employeeId===e);r&&a++}return n||r})}w(!1),h(r),x(r);try{const e=l(g);localStorage.setItem(e.LEADS,JSON.stringify(r)),localStorage.setItem(e.TIMESTAMP,Date.now().toString())}catch(s){}xe.current||(xe.current=!0),k(!1),ha(!1),De(!1),performance.now()}catch(a){Pe(a.message),De(!1),ha(!1),k(!1)}finally{fe.current=!1}}},[he,Pe,ha,De,h,x,Ot.noActivityDate]);a.useCallback(async()=>{},[]),a.useEffect(()=>{(y.length>0||Ot.noActivityDate)&&Hs()},[Ot.noActivityDate,Hs]),a.useEffect(()=>{A(50)},[q,g,P,R,Ot.totalIncomeFrom,Ot.totalIncomeTo,Ot.totalIncomeSort,Ot.assignedTL,Ot.noActivityDate,Ot.showDuplicateLeads,Ot.leadType]);const Js=async()=>{_a(!0);try{const t=l("all"),a=localStorage.getItem(t.LOAN_TYPES);if(a){const e=JSON.parse(a);if(e&&e.length>0)return u(e),void _a(!1)}const s=await fetch(`${ps}/loan-types/?user_id=${he}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json","Accept-Encoding":"gzip, deflate"}});if(s.ok){const t=await s.json(),a=t.items||t.loan_types||t||[],n=[{_id:"all",name:"All Leads",description:"Show all leads"},...a];u(n);try{const e=l("all");localStorage.setItem(e.LOAN_TYPES,JSON.stringify(n))}catch(e){}const i={};a.forEach(e=>{e._id&&e.name&&(i[e.name.toLowerCase()]=e._id,("personal"===e._id||e.name.includes("Personal"))&&(i["pl & odd"]=e._id))}),window.loanTypeNameToId=i}}catch(t){u([{_id:"all",name:"All Leads",description:"Show all leads"},{_id:"personal",name:"Personal Loan",description:"Personal loans"},{_id:"home",name:"Home Loan",description:"Home loans"}]),window.loanTypeNameToId={"personal loan":"personal","pl & odd":"personal","home loan":"home"}}finally{_a(!1)}},Ys=async()=>{ba(!0);try{const e=await fetch(`${ps}/leads/admin/statuses?user_id=${he}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(e.ok){const t=await e.json();let a=[];a=Array.isArray(t)?t:t&&Array.isArray(t.statuses)?t.statuses:t&&Array.isArray(t.data)?t.data:[];const s=a.filter(e=>e.department?e.department===r:!e.department_ids||(Array.isArray(e.department_ids)?e.department_ids.includes(r):e.department_ids===r)),n=[],i=[],o={},l={};s.forEach((e,t)=>{const a=e.name;n.push(a);const s=e.sub_statuses||[],r=s.map(e=>"object"==typeof e&&(e.name||e.status_name)||e);l[a]=r,s.forEach(e=>{const t="object"==typeof e&&(e.name||e.status_name)||e;i.push(t),o[t]=a})}),Ma(n),Ra(i),qa(o),Oa(l)}else{Ma(Et),Ra(Object.keys(ys)),qa(ys);const e={};Object.entries(ys).forEach(([t,a])=>{e[a]||(e[a]=[]),e[a].push(t)}),Oa(e)}}catch(e){Ma(Et),Ra(Object.keys(ys)),qa(ys);const t={};Object.entries(ys).forEach(([e,a])=>{t[a]||(t[a]=[]),t[a].push(e)}),Oa(t)}finally{ba(!1)}},Ws=()=>{ot(on?[]:Array.from({length:Ts()},(e,t)=>t))};a.useEffect(()=>{zt.length===y.length&&y.length>0?Jt(!0):Jt(!1)},[zt,y]);const Gs=()=>{Vt([]),Jt(!1),Wt(!1),it(!1),ot([])},Ks=async e=>{try{if(!he)throw new Error("User ID is missing. Please log in again.");if(!localStorage.getItem("token"))throw new Error("Authentication token is missing. Please log in again.");JSON.parse(localStorage.getItem("userData")||"{}");const n=y.find(t=>t._id===e),r=n?.created_by===he||n?.created_by_id===he,o=n?.name||n?.customer_name||n?.first_name+" "+n?.last_name||"Unknown Lead";if(!window.confirm(`Are you sure you want to delete the lead for "${o}"?\n\nLead ID: ${e}\nThis action cannot be undone.`))return{success:!1,cancelled:!0};try{const e=await fetch(`${ps}/users/permissions/${he}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(e.ok){const t=(await e.json()).find(e=>"Leads"===e.page||"leads"===e.page||"Lead"===e.page||"lead"===e.page);if(t&&!("*"===t.actions||Array.isArray(t.actions)&&(t.actions.includes("delete")||t.actions.includes("*"))||"delete"===t.actions||r))return i.error("Permission denied: You do not have permission to delete leads. Please contact your administrator."),{success:!1,error:"Permission denied"}}}catch(t){}const l=localStorage.getItem("token"),d=await fetch(`${ps}/leads/${e}?user_id=${he}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json","X-User-ID":he}});if(d.ok)return i.success(`Lead "${o}" has been deleted successfully.`),h(t=>t.filter(t=>t._id!==e)),x(t=>t.filter(t=>t._id!==e)),setTimeout(()=>{Hs()},500),{success:!0};{let e=`Failed to delete lead: ${d.status} ${d.statusText}`,t="";try{const e=await d.json();t=e.detail||e.message||""}catch(a){try{t=await d.text()}catch(s){}}return 403===d.status?e=t.includes("don't have permission")?"Permission denied: You do not have permission to delete this lead. Only the lead creator, leads admin, or login admin can delete leads.":"Permission denied: You do not have permission to delete this lead.":404===d.status?e="Lead not found or already deleted.":401===d.status?e="Authentication failed. Please log in again.":t&&(e+=` - ${t}`),i.error(e,5),{success:!1,error:e}}}catch(n){return i.error(`Error deleting lead: ${n.message}`,5),{success:!1,error:n.message}}},Qs=(e,t)=>{if(t.stopPropagation(),Q===e)return void nn();const a=t.currentTarget.getBoundingClientRect();let s=0;"leads"===r?ie||!se?s=Object.keys(Ba).length:se&&Ba[se]&&(s=Ba[se].length):s=statusOptions.length;const n=40*s,i=80+Math.min(n,300);let o=a.bottom+5,l=Math.max(10,a.left),d=Math.min(i,window.innerHeight-a.bottom-50);const c=window.innerHeight-a.bottom-20,m=a.top-20;if(c<Math.min(250,i)&&m>=200&&(d=Math.min(i,m),o=a.top-5,o-=d),l+280>window.innerWidth&&(l=window.innerWidth-280-20),o<10){const e=10-o;o=10,d=Math.max(200,d-e)}const u={top:o,left:l,maxHeight:Math.max(200,d)};ee(u),Z(e),ne(null),re(!0),ae("")},Zs=async(e,t,a=!1)=>{const s="header"===e?Me:Ns[e];if(!s)return void i.error("Lead not found");const n="object"==typeof t?t.name:t;if("leads"===r&&a)return an(n),void setTimeout(()=>le(null),200);if("leads"===r&&!a){if(Ba[n]&&Ba[n].length>0&&!te)return void i.warning(`"${n}" is a category. Please select a specific sub-status.`);let t=ys[n]||Fa[n];if(!t&&n.toLowerCase().includes("not")&&n.toLowerCase().includes("lead")&&(t="Not a lead"),!t)return["FILE COMPLETED","File Completed","FILE COMPLETE","File Complete","DISBURSED","Disbursed","CONVERTED","Converted","APPROVED","Approved","SANCTIONED","Sanctioned","LOGIN APPROVED","Login Approved","LOGIN DONE","Login Done","LOGIN COMPLETED","Login Completed"].some(e=>e.toLowerCase()===n.toLowerCase())?void(await Xs(s._id,n,n)):void(await Xs(s._id,n,null));{const a="object"==typeof t?t.name:t;try{const t=en(s.status,s.sub_status),r=en(a,n),o=hs(a,n),l=["File sent to login","File Sent to Login","LOGIN FILE SENT","File Sent","Sent to Login","Login Submitted","Disbursed","Converted","Active Login","Approved","Loan Approved","Sanctioned","Login Approved","Login Done","Login Completed"].some(e=>e.toLowerCase()===a.toLowerCase()||e.toLowerCase()===n.toLowerCase()),d={status:a,sub_status:n,parent_status:o};if(l&&(d.file_sent_to_login=!0),t&&!r){const e=ht();d.created_at=e.toISOString()}const c=await fetch(`${ps}/leads/${s._id}?user_id=${he}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(d)});if(c.ok){const c=[...b],m=t&&!r,u={...c["header"===e?b.findIndex(e=>e._id===s._id):e],status:a,sub_status:n,parent_status:o,...l&&{file_sent_to_login:!0},...m&&d.created_at&&{created_at:d.created_at}};if("header"===e){const e=b.findIndex(e=>e._id===s._id);-1!==e&&(c[e]=u)}else c[e]=u;x(c);const g=y.map(e=>e._id===s._id?{...e,status:a,sub_status:n,parent_status:o,...l&&{file_sent_to_login:!0},...m&&d.created_at&&{created_at:d.created_at}}:e);h(g),st(g),x(g),"header"===e&&Me&&Me._id===s._id&&($e({...Me,status:a,sub_status:n,parent_status:o,...l&&{file_sent_to_login:!0},...m&&d.created_at&&{created_at:d.created_at}}),setFilteredLeadsData(e=>e.map(e=>e._id===s._id?{...e,status:a,sub_status:n,parent_status:o,...l&&{file_sent_to_login:!0},...m&&d.created_at&&{created_at:d.created_at}}:e)));const p=m?`Status updated to ${n} (Main: ${a}) - Lead creation date updated`:`Status updated to ${n} (Main: ${a})`;return i.success(p),void nn()}throw await c.json(),new Error(`API Error: ${c.status}`)}catch(o){i.error("Failed to update status. Please try again."),nn()}}}if("leads"===r&&Ba[n]&&Ba[n].length>0&&ie&&!te)return i.warning(`"${n}" is a category. Please navigate to it first and select a specific sub-status.`),void nn();await Xs(s._id,n,null)},Xs=async(e,t,a=null)=>{try{const s=As(e),n=!!s&&en(s.status,s.sub_status),r=en(t,a),o=hs(t,a),l=["File sent to login","File Sent to Login","LOGIN FILE SENT","File Sent","Sent to Login","Login Submitted","Disbursed","Converted","Active Login","Approved","Loan Approved","Sanctioned","Login Approved","Login Done","Login Completed"].some(e=>e.toLowerCase()===t.toLowerCase()||a&&e.toLowerCase()===a.toLowerCase()),d={status:t,parent_status:o};if(a&&(d.sub_status=a),l&&(d.file_sent_to_login=!0),n&&!r&&(d.created_at=(new Date).toISOString()),l&&(d.file_sent_to_login=!0),!(await fetch(`${ps}/leads/${e}?user_id=${he}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(d)})).ok)throw new Error("Failed to update status");{const s=[...b],r=s.findIndex(t=>t._id===e);-1!==r&&(s[r]={...s[r],status:t,parent_status:o,...a&&{sub_status:a},...l&&{file_sent_to_login:!0},...n&&!en(t,a)&&{created_at:d.created_at}},x(s));const c=y.map(s=>s._id===e?{...s,status:t,parent_status:o,...a&&{sub_status:a},...l&&{file_sent_to_login:!0},...n&&!en(t,a)&&{created_at:d.created_at}}:s);h(c),st(c),x(c),nn();const m=n&&!en(t,a)?"Status updated successfully - Lead creation date updated":"Status updated successfully";i.success(m)}}catch(s){i.error("Failed to update status"),nn()}},en=(e,t=null)=>{const a="object"==typeof e&&e?.name||e,s="object"==typeof t&&t?.name||t,n=(a||"").toLowerCase(),i=(s||"").toLowerCase(),r=n.includes("not a lead")||"not a lead"===n||"duplicate"===n||"wrong number"===n||"spam"===n||"invalid lead"===n,o=s&&(i.includes("not a lead")||"not a lead"===i||"duplicate"===i||"wrong number"===i||"spam"===i||"invalid lead"===i);let l=null;a&&(l=hs(a,s));const d=l&&l.toLowerCase().includes("not a lead");return r||o||d},tn=()=>{const e=e=>e.filter(e=>{const t=("object"==typeof e?e.name:e).toLowerCase();return!(t.includes("not a lead")||t.includes("not")&&t.includes("lead")||"duplicate"===t||"wrong number"===t||"spam"===t||"invalid lead"===t)});if("leads"===r){if(te){const t=[];Object.entries(Ba).forEach(([e,a])=>{a.forEach(e=>{t.push(e)})});const a=e([...t.filter(e=>("object"==typeof e?e.name:e).toLowerCase()===te.toLowerCase()),...t.filter(e=>{const t="object"==typeof e?e.name:e;return t.toLowerCase().includes(te.toLowerCase())&&t.toLowerCase()!==te.toLowerCase()})]);if(a.length>0)return a}if(ie||te){const t=Object.keys(Ba);return e(te?t.filter(e=>{const t="object"==typeof e?e.name:e,a=t.toLowerCase().includes(te.toLowerCase()),s=(Ba[t]||[]).some(e=>("object"==typeof e?e.name:e).toLowerCase().includes(te.toLowerCase()));return a||s}):t)}if(se&&!ie)return e(Ba[se]||[])}const t=Pa.length>0?Pa:["Active Login","Approve","Disbursed","Rejected","Customer Not Responding","Customer Cancelled","Lost by Mistake","Lost Login"];return e(te?t.filter(e=>("object"==typeof e?e.name:e).toLowerCase().includes(te.toLowerCase())):t)},an=e=>{ne(e),re(!1),ae(""),setTimeout(()=>{},100)},sn=()=>{ne(null),re(!0),ae("")},nn=()=>{Z(null),ne(null),re(!0),ae(""),le(null)},rn=e=>{const t=Fa[e]||"";return t&&"object"==typeof t&&t.name?t.name:t},on=a.useMemo(()=>{const e=Ts();return rt.length===e&&e>0},[rt.length,Ts]),ln=()=>{if(rs)return ds(!0),void ms("back_to_table");os(!1),$e(null)},dn=[{key:"index",label:"#",className:"text-left whitespace-nowrap"},{key:"created_at",label:"LEAD DATE & AGE",className:"text-left whitespace-nowrap"},{key:"created_by",label:"CREATED BY",className:"text-left whitespace-nowrap"},{key:"department_name",label:"TEAM NAME",className:"text-left whitespace-nowrap"},{key:"name",label:"CUSTOMER NAME",className:"text-left whitespace-nowrap"},{key:"status",label:"STATUS",className:"text-left whitespace-nowrap"},{key:"totalIncome",label:"TOTAL INCOME",className:"text-left whitespace-nowrap"},{key:"eligibility_details.foir",label:"FOIR ELIGIBILITY",className:"text-left whitespace-nowrap"},{key:"financial_details.total_bt_pos",label:"TOTAL BT POS",className:"text-left whitespace-nowrap"},{key:"financial_details.cibil_score",label:"CIBIL SCORE",className:"text-left whitespace-nowrap"},{key:"company_name",label:"COMPANY NAME",className:"text-left whitespace-nowrap"}],cn=e=>{if(null==e)return"-";if("N/A"===e||"n/a"===e||"NA"===e)return"N/A";try{if("object"==typeof e){const t=["totalIncome","amount","eligibility_amount","eligible_amount","loan_amount","eligibility","value","income","salary"];for(const a of t)if(void 0!==e[a])return cn(e[a]);return"-"}if("string"==typeof e&&e.includes(",")&&e.includes(""))return e;let t=e;return"string"==typeof e&&(t=e.replace(/[^\d.-]/g,""),t=parseFloat(t)),isNaN(t)?"-":new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(t)}catch(t){return e}},mn=e=>{if(!e)return"-";const a=(e=>e?((e,t={})=>{const a=gt(e);if(!a)return"";const s={day:"2-digit",month:"long",year:"numeric",...t};return a.toLocaleDateString("en-IN",s)})(e):"-")(e),s=(e=>{if(!e)return 0;const t=ht(),a=gt(e),s=t.getTime()-a.getTime();return Math.floor(s/864e5)})(e);return t.jsxs("div",{className:"text-left",children:[t.jsx("div",{children:a}),t.jsx("div",{className:"text-sm text-gray-400",children:0===s?"Today":1===s?"1 day old":`${s} days old`})]})},[un,gn]=a.useState(!1),pn=async()=>{Na(!0);try{const t=[`${ps}/users?user_id=${he}&designation=team leader`,`${ps}/users?user_id=${he}`,`${ps}/hrms/employees?user_id=${he}&designation=team leader`,`${ps}/employees?user_id=${he}&designation=team leader`];let a=null,s=null;for(const n of t)try{const e=await fetch(n,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(e.ok){a=await e.json(),s=n;break}}catch(e){}if(a){let e=[];Array.isArray(a)?e=a:a.items&&Array.isArray(a.items)?e=a.items:a.users&&Array.isArray(a.users)?e=a.users:a.employees&&Array.isArray(a.employees)&&(e=a.employees);const t=e.filter(e=>{const t=e.designation||e.role||e.position||e.job_title;return t&&t.toLowerCase().includes("team leader")});Ya(t)}else Ya([])}catch(t){Ya([])}finally{Na(!1)}};if(Me){const e=vs[lt].getContent(Me,xs);return t.jsxs("div",{className:"min-h-screen bg-black text-white text-base",children:[t.jsxs("div",{className:"flex items-center gap-3 px-2 sm:px-4 lg:px-6 py-6 bg-[#0c1019] border-b-4 border-cyan-400/70 shadow-lg w-full",children:[t.jsx("button",{onClick:ln,className:"text-cyan-300 mr-2 px-2 py-1 text-xl font-bold rounded hover:bg-cyan-900/20 transition","aria-label":"Back",children:""}),t.jsx(Ae,{className:"text-cyan-300 w-8 h-6 sm:w-10 sm:h-8 drop-shadow"}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsx("h1",{className:"text-lg sm:text-xl lg:text-2xl font-extrabold text-cyan-300 tracking-wide drop-shadow",children:`${Me.first_name||""} ${Me.last_name||""}`.trim()||Me.customer_name||Me.name||"Lead Details"}),ve()&&t.jsx("div",{className:"relative status-dropdown-container",onClick:e=>e.stopPropagation(),children:t.jsxs("button",{className:"bg-gray-800 text-white py-2 px-3 rounded-md border border-gray-600 hover:bg-gray-700 transition-colors min-w-[180px] max-w-[280px] flex justify-between items-center gap-2 status-dropdown-button",onClick:e=>{e.stopPropagation(),Qs("header",e)},children:[t.jsx("div",{className:"font-medium text-white text-sm text-left flex-1 overflow-hidden",children:(()=>{if(Me.sub_status){const e="object"==typeof Me.sub_status?Me.sub_status.name||"Unknown Sub-Status":Me.sub_status||"Unknown Sub-Status",a="object"==typeof Me.status?Me.status.name||"Unknown Status":Me.status||"Unknown Status";return t.jsxs("div",{className:"leading-tight",children:[t.jsx("div",{className:"font-semibold text-white whitespace-nowrap overflow-hidden text-ellipsis",children:e}),t.jsx("div",{className:"text-xs text-gray-400 whitespace-nowrap overflow-hidden text-ellipsis",children:a})]})}{const e="object"==typeof Me.status?Me.status.name||"Select Status":Me.status||"Select Status";return t.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:e})}})()}),t.jsx("svg",{className:"w-5 h-5 flex-shrink-0 transition-transform "+("header"===Q?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),Me?.file_sent_to_login&&t.jsxs("span",{className:"bg-green-500 text-white text-xs px-2 py-0.5 rounded-full flex items-center",children:[t.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Sent to Login"]})]}),t.jsx("div",{className:"flex-1"}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[void 0,!Me?.file_sent_to_login&&(()=>{const e=("string"==typeof Me?.status?Me.status:Me?.status?.name)||"",a=("string"==typeof Me?.sub_status?Me.sub_status:Me?.sub_status?.name)||"",s=e.toLowerCase(),n=a.toLowerCase();return(s.includes("file complete")||n.includes("file complete"))&&Me?.important_questions_validated?t.jsxs("button",{onClick:()=>Zt(!0),className:"bg-gradient-to-b from-cyan-400 to-blue-700 px-3 sm:px-5 py-1.5 rounded-lg text-white font-bold shadow-lg hover:from-blue-700 hover:to-cyan-400 uppercase tracking-wide transition text-sm sm:text-base flex items-center",children:[t.jsx(E,{className:"mr-2 h-4 w-4"})," COPY THIS LEAD"]}):null})(),Me?.file_sent_to_login?t.jsxs("button",{disabled:!0,className:"bg-gradient-to-b from-green-400 to-green-700 px-3 sm:px-5 py-1.5 rounded-lg text-white font-bold shadow-lg uppercase tracking-wide transition text-sm sm:text-base opacity-70 cursor-not-allowed flex items-center",children:[t.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),t.jsx("span",{className:"hidden sm:inline",children:"ALREADY SENT"}),t.jsx("span",{className:"sm:hidden",children:"SENT"})]}):(()=>{const e=("string"==typeof Me?.status?Me.status:Me?.status?.name)||"",a=("string"==typeof Me?.sub_status?Me.sub_status:Me?.sub_status?.name)||"",s=e.toLowerCase(),n=a.toLowerCase();return(s.includes("file complete")||n.includes("file complete"))&&Me?.important_questions_validated?t.jsxs("button",{onClick:()=>ea(!0),className:"bg-gradient-to-b from-cyan-400 to-blue-700 px-3 sm:px-5 py-1.5 rounded-lg text-white font-bold shadow-lg hover:from-blue-700 hover:to-cyan-400 uppercase tracking-wide transition text-sm sm:text-base",children:[t.jsx("span",{className:"hidden sm:inline",children:"FILE SENT TO LOGIN"}),t.jsx("span",{className:"sm:hidden",children:"SEND TO LOGIN"})]}):null})(),Me?.file_sent_to_login&&t.jsx("div",{className:"flex items-center gap-1 bg-green-500/20 border border-green-500 text-green-400 px-3 py-1 rounded-full text-sm",children:t.jsxs("span",{children:["Sent on ",Me?.login_department_sent_date?yt(Me.login_department_sent_date):"unknown date"]})})]})]}),"header"===Q&&Me&&t.jsxs("div",{className:"fixed bg-white border border-gray-300 rounded-lg shadow-xl z-[9999] status-dropdown-menu flex flex-col",style:{top:`${X.top}px`,left:`${X.left}px`,minWidth:"280px",maxWidth:"400px",maxHeight:`${X.maxHeight}px`,backgroundColor:"white",zIndex:9999,overflowY:"hidden"},onClick:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},children:[t.jsxs("div",{className:"p-3 border-b border-gray-200 bg-white z-10 rounded-t-lg",children:["leads"===r&&!ie&&se&&t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("button",{onClick:e=>{e.stopPropagation(),sn()},className:"flex items-center text-blue-600 hover:text-blue-800 text-sm font-medium",children:[t.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),"Back to Main Statuses"]}),t.jsx("span",{className:"text-xs text-gray-600 font-medium",children:se})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:t.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("input",{type:"text",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-black focus:outline-none focus:border-sky-400",placeholder:"leads"===r?ie?"Search statuses...":"Search sub-statuses...":"Search status options...",value:te,onChange:e=>ae(e.target.value),onClick:e=>e.stopPropagation(),autoFocus:!0})]})]}),t.jsx("div",{className:"overflow-y-auto bg-white rounded-b-lg flex-1",style:{overflowY:"auto",maxHeight:"calc(100% - 80px)"},children:tn().length>0?tn().map((e,a)=>{const s="object"==typeof e?e.name:e,n="leads"===r&&ie&&!te,i=Ba[s]&&Ba[s].length>0,o=n&&i,l=("object"==typeof Me.sub_status?(Me.sub_status?.name||"")===s:Me.sub_status===s)||("object"==typeof Me.status?(Me.status?.name||"")===s:Me.status===s);return t.jsx("div",{className:"px-4 py-3 cursor-pointer text-black hover:bg-blue-200 transition-colors border-b border-gray-100 last:border-b-0",style:{backgroundColor:l?"#FFFF00":"",fontWeight:l?"bold":"normal"},onClick:t=>{t.stopPropagation(),le(s),setTimeout(()=>{Zs("header",e,o),setTimeout(()=>le(null),100)},150)},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm font-medium text-left select-none",children:[s,te&&rn(s)&&t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Main Status: ",rn(s)]})]}),o&&t.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]})},`header-status-${a}-${s}`)}):t.jsx("div",{className:"px-4 py-3 text-center text-gray-500",children:"No matching statuses found"})})]}),Xt&&Me&&t.jsx(Lt,{lead:Me,onClose:()=>{ea(!1),Hs()},onUpdate:e=>{$e(e),h(t=>t.map(t=>t._id===e._id?{...t,file_sent_to_login:!0}:t)),x(t=>t.map(t=>t._id===e._id?{...t,file_sent_to_login:!0}:t))}}),Qt&&Me&&t.jsx(St,{leadData:Me,onClose:()=>{Zt(!1),Hs()}}),t.jsx("div",{className:"flex flex-wrap items-center gap-2 px-2 sm:px-4 lg:px-7 py-3 bg-black border-b border-[#232c3a] w-full overflow-x-auto",children:vs.map((e,a)=>t.jsxs("button",{className:`\n                                flex items-center px-3 sm:px-4 lg:px-6 py-2 sm:py-3 rounded-3xl font-extrabold border shadow-md text-sm sm:text-base lg:text-[1.05rem] transition whitespace-nowrap\n                                ${a===lt?"bg-[#03B0F5] via-blue-700 to-cyan-500 text-white border-cyan-400 shadow-lg scale-105":"bg-white text-[#03B0F5] border-[#2D3C56] hover:bg-cyan-400/10 hover:text-cyan-400"}\n                                focus:outline-none\n                            `,style:{boxShadow:a===lt?"0 4px 16px 0 #1cb5e080":void 0,cursor:"pointer",letterSpacing:"0.01em"},onClick:()=>{var e;e=a,rs?(ms(e),ds(!0)):dt(e),rs&&a!==lt||pt(0===a?[0]:[])},children:[e.icon||null,e.label]},e.label))}),t.jsx("div",{className:"px-2 sm:px-4 lg:px-6 py-6 w-full",children:t.jsx("div",{className:"w-full",children:e.map((e,a)=>t.jsxs("div",{className:"mb-6 w-full",children:[e.label&&t.jsx(t.Fragment,{children:0===lt?t.jsxs("button",{className:"w-full px-2 sm:px-5 py-3 font-extrabold text-base sm:text-lg lg:text-[1.05rem] text-[#03B0F5] bg-gray-200 hover:bg-gray-300 border-2 border-gray-400 rounded-lg flex items-center justify-between transition-colors duration-200 shadow-md",onClick:()=>{var e;e=a,rs?(gs(e),ds(!0)):pt(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},children:[t.jsx("span",{children:e.label}),t.jsx("svg",{className:"w-5 h-5 transform transition-transform duration-200 "+(mt.includes(a)?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}):t.jsx("div",{className:"px-2 sm:px-5 py-2 font-extrabold text-base sm:text-lg lg:text-[1.05rem] text-[#03B0F5]",children:e.label})}),0===lt?mt.includes(a)&&t.jsx("div",{className:"w-full mt-2",children:e.content}):t.jsx("div",{className:"w-full",children:e.content})]},a))})}),ls&&t.jsx("div",{className:"fixed inset-0 bg-transparent bg-opacity-75 flex items-center justify-center z-50",children:t.jsx("div",{className:"bg-gray-800 border border-gray-600 rounded-lg shadow-xl max-w-md w-full mx-4",children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("svg",{className:"w-8 h-8 text-yellow-500 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),t.jsx("h3",{className:"text-lg font-bold text-white",children:"Unsaved Changes"})]}),t.jsx("p",{className:"text-gray-300 mb-6",children:"Please Save the Changes??"}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{onClick:bs,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Save"}),t.jsx("button",{onClick:fs,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"Don't Save?"})]})]})})})]})}return me?t.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mb-4"}),t.jsx("p",{children:"Loading permissions..."})]})}):Ee&&Ee.includes("permission")?t.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:t.jsxs("div",{className:"text-center bg-red-900/30 border border-red-500 p-8 rounded-lg max-w-lg",children:[t.jsx("div",{className:"flex items-center justify-center mb-6",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),t.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-400",children:"Permission Denied"}),t.jsx("p",{className:"text-gray-300 mb-6",children:"Your user role does not have permission to view leads."}),t.jsxs("div",{className:"bg-black/50 p-4 rounded-md text-left mb-6",children:[t.jsx("h3",{className:"font-bold mb-2 text-white",children:"Required Permissions:"}),t.jsxs("ul",{className:"list-disc pl-5 text-gray-300 space-y-1",children:[t.jsx("li",{children:"show"}),t.jsx("li",{children:"own"}),t.jsx("li",{children:"view_other"}),t.jsx("li",{children:"all"}),t.jsx("li",{children:"junior"})]})]}),t.jsx("p",{className:"text-gray-400 text-sm",children:"Please contact your administrator to update your role permissions."})]})}):Ee&&!Ee.includes("permission")?t.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:t.jsxs("div",{className:"text-center bg-gray-900/50 border border-gray-700 p-8 rounded-lg max-w-lg",children:[t.jsx("div",{className:"flex items-center justify-center mb-6",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error"}),t.jsx("p",{className:"text-gray-300 mb-6",children:Ee}),t.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})}):me&&!he?t.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500 mx-auto mb-8"}),t.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading"}),t.jsx("p",{className:"text-gray-400",children:"Initializing..."})]})}):t.jsx("div",{className:"min-h-screen bg-black text-white font-sans",children:t.jsxs("div",{className:"relative z-10 px-6 py-8 space-y-10 bg-black",children:[Ee&&t.jsxs("div",{className:"bg-red-600 text-white p-4 mb-6 rounded-xl shadow-lg flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(T,{className:"w-6 h-6 mr-2"}),t.jsx("p",{className:"font-bold",children:Ee}),Ee.includes("permission")&&t.jsx("button",{onClick:()=>{localStorage.removeItem("userPermissions"),localStorage.removeItem("userRoleId"),Pe(""),ce({}),ue(!0),Se().then(e=>{e&&_e("show")&&Hs()})},className:"ml-4 px-4 py-2 bg-white text-red-600 rounded hover:bg-gray-200 transition",children:"Retry"})]}),t.jsx("button",{onClick:()=>Pe(""),className:"text-white hover:text-red-200",children:t.jsx(Ie,{className:"w-5 h-5"})})]}),me&&t.jsxs("div",{className:"bg-blue-600 text-white p-4 mb-6 rounded-xl shadow-lg flex items-center",children:[t.jsx("div",{className:"animate-spin mr-2 h-5 w-5 border-2 border-white rounded-full border-t-transparent"}),t.jsx("p",{className:"font-bold",children:"Loading permissions..."})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 xl:grid-cols-5 gap-6 mb-8",children:Dt.map(({key:e,label:a,icon:s,gradient:n,shadowColor:i},r)=>t.jsxs("div",{className:`p-4 rounded-xl bg-gradient-to-r ${n} shadow-lg ${i||"shadow-lg"} flex-1`,children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx(s,{className:"w-6 h-6 text-white"}),ya?t.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-white rounded-full border-t-transparent"}):t.jsx("span",{className:"text-xl font-bold text-white",children:Wa[e]||0})]}),t.jsx("p",{className:"mt-4 text-md text-white font-medium uppercase tracking-wide",children:a})]},r))}),ya&&t.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white p-3 mb-6 rounded-xl shadow-lg flex items-center",children:[t.jsx("div",{className:"animate-spin mr-3 h-4 w-4 border-2 border-white rounded-full border-t-transparent"}),t.jsx("p",{className:"font-medium",children:"Loading leads and preparing sections..."})]}),t.jsxs("div",{className:"overflow-auto rounded-xl sticky-table-container",children:[t.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4 mt-5",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[!we()&&!je()||nt?(we()||je())&&nt?t.jsxs("div",{className:"flex items-center gap-6 bg-gray-900 rounded-lg p-3",children:[t.jsxs("label",{className:"flex items-center cursor-pointer text-[#03B0F5] font-bold",children:[t.jsx("input",{type:"checkbox",className:"accent-blue-500 mr-2 cursor-pointer",checked:on,onChange:Ws,style:{width:18,height:18}}),"Select All"]}),t.jsxs("span",{className:"text-white font-semibold",children:[rt.length," row",1!==rt.length?"s":""," selected"]}),t.jsxs("button",{className:"px-3 py-1 bg-red-600 text-white rounded font-bold hover:bg-red-700 transition",onClick:async()=>{const e=nt?rt:zt,t=nt?e.map(e=>Ls(e)._id):e;if(0===t.length)return;if(!window.confirm(`Are you sure you want to delete ${t.length} selected lead(s)?`))return;let a=0,s=0;const n=[];for(const i of t)try{"rm030"===localStorage.getItem("username")||localStorage.getItem("emp_id");const e=await Ks(i);e.success?a++:(s++,n.push(`Lead ${i}: ${e.error}`))}catch(r){s++,n.push(`Lead ${i}: ${r.message||"Network error"}`)}a>0&&0===s?i.success(`Successfully deleted ${a} lead(s)`):a>0&&s>0?i.warning(`Deleted ${a} lead(s), but ${s} failed. Errors: ${n.join(", ")}`):s>0&&i.error(`Failed to delete leads. Errors: ${n.join(", ")}`),Gs(),Hs()},disabled:0===rt.length,children:["Delete (",rt.length,")"]}),t.jsx("button",{className:"px-3 py-1 bg-gray-600 text-white rounded font-bold hover:bg-gray-700 transition",onClick:Gs,children:"Cancel"})]}):null:t.jsx("button",{className:"bg-[#03B0F5] text-white px-5 py-3 rounded-lg font-bold shadow hover:bg-[#0280b5] transition text-base",onClick:()=>{it(!0),ot([]),et(null)},children:rt.length>0?`Select (${rt.length})`:"Select"}),(O||Bs()>0)&&t.jsxs("div",{className:"text-base text-gray-300 bg-[#1b2230] px-4 py-3 rounded-lg border border-gray-600",children:[Ns.length," of ",y.length," leads",O&&t.jsxs("span",{className:"ml-2",children:['matching "',t.jsx("span",{className:"text-cyan-400 font-semibold",children:O}),'"']})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[(xa||wa)&&t.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[t.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-gray-400 rounded-full border-t-transparent"}),t.jsx("span",{children:"Loading filters..."})]}),t.jsxs("button",{className:"px-5 py-3 rounded-lg font-bold shadow-lg transition-all duration-200 ease-in-out relative flex items-center gap-3 text-base transform hover:scale-105 active:scale-95 "+(Bs()>0?"bg-orange-500 text-white hover:bg-orange-600 hover:shadow-orange-500/50":"bg-gray-600 text-white hover:bg-gray-700 hover:shadow-gray-600/50"),onClick:()=>Pt(!0),style:{willChange:"transform, background-color, box-shadow"},children:[t.jsx("svg",{className:"w-5 h-5 transition-transform duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filter",Bs()>0&&t.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-sm rounded-full h-6 w-6 flex items-center justify-center transition-all duration-200 animate-pulse",style:{willChange:"transform"},children:Bs()})]}),t.jsxs("div",{className:"relative w-[320px]",children:[t.jsx("input",{type:"text",placeholder:"Search leads (use spaces for multiple terms)...",value:O,onChange:e=>F(e.target.value),className:"w-full py-3 pl-10 pr-10 bg-[#1b2230] text-gray-300 rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 text-base placeholder-gray-500 transition-all duration-200 ease-in-out",style:{willChange:"border-color, box-shadow"}}),t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"w-5 h-5 text-gray-500 transition-colors duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),O&&t.jsx("button",{onClick:()=>F(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-200 transition-all duration-150 hover:scale-110",style:{willChange:"transform"},children:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]})]}),t.jsx("div",{className:"w-full bg-black",style:{marginLeft:0},children:t.jsxs("div",{className:"relative",children:[Sa&&t.jsx("button",{onClick:()=>Fs("left"),className:"absolute left-2 top-1/2 transform -translate-y-1/2 z-50 text-white p-4 rounded-full shadow-lg transition-all duration-200 opacity-20 hover:opacity-100",style:{backgroundColor:"rgba(37, 99, 235, 1)"},onMouseEnter:e=>e.target.style.backgroundColor="rgba(29, 78, 216, 1)",onMouseLeave:e=>e.target.style.backgroundColor="rgba(37, 99, 235, 1)","aria-label":"Scroll left",children:t.jsx(j,{className:"w-9 h-9"})}),La&&t.jsx("button",{onClick:()=>Fs("right"),className:"absolute right-2 top-1/2 transform -translate-y-1/2 z-50 text-white p-4 rounded-full shadow-lg transition-all duration-200 opacity-20 hover:opacity-100",style:{backgroundColor:"rgba(37, 99, 235, 1)"},onMouseEnter:e=>e.target.style.backgroundColor="rgba(29, 78, 216, 1)",onMouseLeave:e=>e.target.style.backgroundColor="rgba(37, 99, 235, 1)","aria-label":"Scroll right",children:t.jsx(N,{className:"w-9 h-9"})}),t.jsx("div",{ref:ka,className:"bg-black rounded-lg overflow-x-auto max-h-[calc(100vh-200px)] overflow-y-auto",onScroll:qs,children:t.jsxs("table",{className:"min-w-[1600px] w-full bg-black relative",children:[t.jsx("thead",{className:"bg-white sticky top-0 z-50 shadow-lg border-b-2 border-gray-200 cursor-pointer select-none",onDoubleClick:Us,title:"Double-click to toggle fullscreen",children:t.jsxs("tr",{children:[(we()||je())&&nt&&t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200",children:t.jsx("input",{type:"checkbox",className:"accent-blue-500 cursor-pointer",checked:on,onChange:Ws})}),dn.map((e,a)=>t.jsx("th",{className:`bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider sticky top-0 z-50 shadow-sm border-b border-gray-200 ${0!==a||we()||je(),""} ${a!==dn.length-1||we()||je(),""} ${e.className||""}`,children:"created_by"===e.key?t.jsx("div",{className:"flex items-left justify-left  gap-2",children:t.jsx("span",{children:e.label})}):e.label},a))]})}),t.jsxs("tbody",{className:"bg-black",children:[ya?t.jsx("tr",{children:t.jsx("td",{colSpan:(we()||je())&&nt?dn.length+1:dn.length,className:"py-20 text-center text-gray-400 text-lg bg-black",children:t.jsxs("div",{className:"flex items-center justify-center gap-3",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),t.jsx("span",{className:"text-xl font-semibold",children:"Loading Leads..."})]})})}):0===ks.length?t.jsx("tr",{children:t.jsx("td",{colSpan:(we()||je())&&nt?dn.length+1:dn.length,className:"py-20 text-center text-gray-400 text-lg bg-black",children:O||Bs()>0?"No leads match your search or filter criteria.":"No leads available."})}):ks.map((e,a)=>(a>0&&e.file_sent_to_login&&ks[a-1].file_sent_to_login,t.jsx(s.Fragment,{children:t.jsxs("tr",{ref:e=>ft.current[a]=e,className:`\n                                                        border-b border-gray-800 hover:bg-gray-900/50 transition\n                                                        ${e.file_sent_to_login?"bg-gray-900/30":"bg-black"}\n                                                        ${rt.includes(a)?"bg-blue-900/20":""}\n                                                    `,onClick:()=>!((we()||je())&&nt)&&(async e=>{os(!1);const t=Ls(e);if($e(t),dt(0),pt([0]),t?._id)try{const e=`/api/leads/${t._id}?user_id=${he}`,a=await fetch(e,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(a.ok){const e=await a.json();$e(e)}}catch(a){}})(a),style:{cursor:(we()||je())&&nt?"default":"pointer"},children:[(we()||je())&&nt&&t.jsx("td",{className:"py-2 px-4 whitespace-nowrap",children:t.jsx("input",{type:"checkbox",className:"accent-blue-500 cursor-pointer",checked:rt.includes(a),onChange:()=>(e=>{const t=rt.includes(e)?rt.filter(t=>t!==e):[...rt,e];ot(t)})(a)})}),t.jsx("td",{className:"text-sm font-semibold py-2 px-4 whitespace-nowrap text-white",children:a+1}),t.jsx("td",{className:"text-sm font-semibold py-2 px-4 whitespace-nowrap text-white",children:mn(e.created_at)}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:t.jsx("div",{className:"flex items-center gap-3",children:t.jsx("span",{className:"text-sm text-wrap",children:"object"==typeof e.created_by_name?e.created_by_name?.name||"-":e.created_by_name||"-"})})}),t.jsx("td",{className:"text-sm font-semibold py-2 px-4 whitespace-nowrap text-white",children:"object"==typeof e.department_name?e.department_name?.name||"-":e.department_name||"-"}),t.jsx("td",{className:"text-sm font-semibold py-2 px-4 whitespace-nowrap text-white",children:t.jsx("div",{className:"flex items-center gap-3",children:t.jsx("span",{className:"text-wrap",children:e.name||"-"})})}),t.jsxs("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white relative",onClick:e=>e.stopPropagation(),children:[(()=>{const s="object"==typeof e.status?e.status?.name||"":e.status||"",n="object"==typeof e.sub_status?e.sub_status?.name||"":e.sub_status||"";return e.file_sent_to_login||["file sent to login","file sent","sent to login","login submitted","active login","new login","disbursed","converted","approved","loan approved","login file sent"].some(e=>s.toLowerCase().includes(e)||n.toLowerCase().includes(e))?t.jsx("div",{className:"flex items-center justify-center",children:t.jsxs("span",{className:"bg-green-500 text-white text-sm px-3 py-2 rounded-full font-bold flex items-center",children:[t.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Login"]})}):ve()?t.jsx("div",{className:"relative status-dropdown-container",children:t.jsxs("button",{className:"bg-gray-800 text-white py-2 px-3 rounded-md border border-gray-600 hover:bg-gray-700 transition-colors w-full min-w-[150px] flex justify-between items-center status-dropdown-button",onClick:e=>Qs(a,e),children:[t.jsx("div",{className:"font-medium text-white truncate w-full text-sm text-left",children:e.sub_status?t.jsxs("div",{children:[t.jsx("div",{children:"object"==typeof e.sub_status?e.sub_status.name||"Unknown Sub-Status":e.sub_status||"Unknown Sub-Status"}),t.jsx("div",{className:"text-xs text-gray-400",children:"object"==typeof e.status?e.status.name||"Unknown Status":e.status||"Unknown Status"})]}):"object"==typeof e.status?e.status.name||"Select Status":e.status||"Select Status"}),t.jsx("svg",{className:"w-5 h-5 transition-transform "+(Q===a?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}):t.jsx("div",{className:"bg-gray-800 text-gray-400 py-2 px-3 rounded-md border border-gray-600 w-full min-w-[150px] opacity-75 cursor-not-allowed",children:t.jsx("div",{className:"font-medium text-sm text-left",children:e.sub_status?t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-300",children:"object"==typeof e.sub_status?e.sub_status.name||"Unknown Sub-Status":e.sub_status||"Unknown Sub-Status"}),t.jsx("div",{className:"text-xs text-gray-500",children:"object"==typeof e.status?e.status.name||"Unknown Status":e.status||"Unknown Status"})]}):"object"==typeof e.status?e.status.name||"Select Status":e.status||"Select Status"})})})(),Q===a&&t.jsxs("div",{className:"fixed bg-white border border-gray-300 rounded-lg shadow-xl z-[9999] status-dropdown-menu flex flex-col",style:{top:`${X.top}px`,left:`${X.left}px`,minWidth:"280px",maxWidth:"400px",maxHeight:`${X.maxHeight}px`,backgroundColor:"white",zIndex:9999,overflowY:"hidden"},onClick:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},onScroll:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},onWheel:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},children:[t.jsxs("div",{className:"p-3 border-b border-gray-200 bg-white z-10 rounded-t-lg",children:["leads"===r&&!ie&&se&&t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("button",{onClick:e=>{e.stopPropagation(),sn()},className:"flex items-center text-blue-600 hover:text-blue-800 text-sm font-medium",children:[t.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),"Back to Main Statuses"]}),t.jsx("span",{className:"text-xs text-gray-600 font-medium",children:se})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:t.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("input",{type:"text",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-black focus:outline-none focus:border-sky-400",placeholder:"leads"===r?ie?"Search statuses and sub-statuses...":"Search sub-statuses...":"Search status options...",value:te,onChange:e=>{ae(e.target.value)},onClick:e=>e.stopPropagation(),autoFocus:!0})]})]}),t.jsx("div",{className:"overflow-y-auto bg-white rounded-b-lg flex-1",style:{overflowY:"auto",maxHeight:"calc(100% - 80px)",scrollbarWidth:"thin",scrollbarColor:"#888 transparent"},onClick:e=>e.stopPropagation(),onScroll:e=>e.stopPropagation(),children:tn().length>0?tn().map((s,n)=>{const i="object"==typeof s?s.name:s,o="leads"===r&&ie&&!te,l="leads"===r&&(!ie||te),d=te&&"leads"===r,c=Ba[i]&&Ba[i].length>0,m=("object"==typeof e.sub_status?(e.sub_status?.name||"Unknown")===i:e.sub_status===i)||("object"==typeof e.status?(e.status?.name||"Unknown")===i:e.status===i),u=o&&!d&&c;return t.jsxs("div",{className:"px-4 py-3 cursor-pointer text-black hover:bg-blue-200 transition-colors border-b border-gray-100 last:border-b-0 text-left "+(oe===i?"font-bold shadow-lg":""),style:{backgroundColor:oe===i||m?"#FFFF00":"",color:"#000000",fontWeight:m?"bold":"normal"},onClick:e=>{e.stopPropagation(),e.preventDefault(),e.nativeEvent.stopImmediatePropagation(),le(i),setTimeout(()=>{Zs(a,s,u),setTimeout(()=>{le(null)},100)},150)},onMouseDown:e=>e.preventDefault(),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm font-medium text-left select-none",children:[i,(l||d)&&rn(i)&&t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Main Status: ",rn(i)]})]}),u&&t.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]}),u&&Ba[i]&&Ba[i].length>0&&t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Ba[i].length," sub-status",1!==Ba[i].length?"es":""]})]},`status-${n}-${i}`)}):t.jsx("div",{className:"px-4 py-6 text-gray-500 text-center text-sm",children:te?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-2",children:['No results found for "',t.jsx("span",{className:"font-semibold text-gray-700",children:te}),'"']}),t.jsx("div",{className:"text-xs text-gray-400",children:"Try searching with different terms or clear the search"})]}):t.jsxs("div",{children:[t.jsx("div",{className:"mb-2",children:"leads"!==r||ie?"No statuses available":"No sub-statuses available"}),t.jsx("div",{className:"text-xs text-gray-400",children:"Status data may still be loading..."})]})})})]})]}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:(()=>{let t=[(a=e).totalIncome,a.eligibility_details?.totalIncome,a.eligibility?.totalIncome,a.dynamic_fields?.eligibility_details?.totalIncome,a.dynamic_fields?.obligation_data?.eligibility?.totalIncome,a.obligation_data?.eligibility?.totalIncome,a.dynamic_fields?.financial_details?.monthly_income,a.financial_details?.monthly_income,a.salary,a.monthly_income].find(e=>null!=e&&""!==e);var a;return t&&"object"==typeof t&&(t=void 0!==t.totalIncome?t.totalIncome:void 0!==t.amount?t.amount:null),null!=t&&""!==t?"string"==typeof t&&(t.includes("")||t.includes(","))?t:cn(t):"-"})()}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:(()=>{let t=(e=>{const t=[e.dynamic_fields?.eligibility_details?.finalEligibility,e.eligibility_details?.finalEligibility,e.dynamic_fields?.obligation_data?.eligibility?.finalEligibility,e.dynamic_fields?.eligibility_details?.foir_eligibility,e.eligibility_details?.foir_eligibility,e.dynamic_fields?.obligation_data?.eligibility?.foir_eligibility,e.dynamic_fields?.check_eligibility?.foir_eligibility,e.dynamic_fields?.check_eligibility?.final_eligibility,e.dynamic_fields?.check_eligibility?.loan_eligibility,e.dynamic_fields?.eligibility_details?.final_eligibility,e.eligibility_details?.final_eligibility,e.dynamic_fields?.obligation_data?.eligibility?.final_eligibility,e.dynamic_fields?.eligibility_details?.loanEligibility,e.eligibility_details?.loanEligibility,e.dynamic_fields?.obligation_data?.eligibility?.loanEligibility,e.dynamic_fields?.eligibility_details?.loan_eligibility,e.eligibility_details?.loan_eligibility,e.dynamic_fields?.obligation_data?.eligibility?.loan_eligibility,e.dynamic_fields?.obligation_data?.calculatedEligibility,e.dynamic_fields?.eligibility_details?.calculatedEligibility,e.calculated_eligibility,e.eligibility?.finalEligibility,e.dynamic_fields?.eligibility?.finalEligibility,e.eligibility?.foir_eligibility,e.dynamic_fields?.eligibility?.foir_eligibility].find(e=>null!=e&&""!==e);return void 0!==t?t:[e.dynamic_fields?.eligibility_details?.foirAmount,e.eligibility_details?.foirAmount,e.dynamic_fields?.obligation_data?.eligibility?.foirAmount,e.eligibility_details?.foir,e.dynamic_fields?.eligibility_details?.foir,e.dynamic_fields?.obligation_data?.eligibility_details?.foir,e.obligation_data?.eligibility_details?.foir,e.dynamic_fields?.obligation_data?.foir,e.obligation_data?.foir,e.dynamic_fields?.foir,e.foir,e.financial_details?.foir,e.dynamic_fields?.financial_details?.foir,e.obligation_data?.financial_details?.foir,e.eligibility?.foir,e.dynamic_fields?.eligibility?.foir,e.obligation_data?.eligibility?.foir,e.eligibility_details?.foir_eligibility,e.dynamic_fields?.eligibility_details?.foir_eligibility,e.obligation_data?.eligibility_details?.foir_eligibility,e.dynamic_fields?.obligation_data?.eligibility?.foir_eligibility,e.obligation_data?.eligibility?.foir_eligibility].find(e=>null!=e&&""!==e&&"0"!==e&&0!==e)})(e);return t&&"object"==typeof t&&(t=void 0!==t.finalEligibility?t.finalEligibility:void 0!==t.foir_eligibility?t.foir_eligibility:void 0!==t.loan_eligibility?t.loan_eligibility:void 0!==t.foirAmount?t.foirAmount:void 0!==t.foir?t.foir:void 0!==t.amount?t.amount:void 0!==t.value?t.value:void 0!==t.eligibility?t.eligibility:null),null!=t&&""!==t?0===t||"0"===t?" 0 (Not Eligible)":"string"==typeof t&&(t.includes("")||t.includes(",")||t.includes("Rs"))||isNaN(t)||""===t?t:cn(t):"-"})()}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:(()=>{let t=[(a=e).total_bt_pos,a.totalBtPos,a.financial_details?.total_bt_pos,a.financial_details?.totalBtPos,a.dynamic_fields?.financial_details?.total_bt_pos,a.dynamic_fields?.financial_details?.totalBtPos,a.obligation_data?.total_bt_pos,a.obligation_data?.totalBtPos,a.obligation_data?.financial_details?.total_bt_pos,a.obligation_data?.financial_details?.totalBtPos,a.dynamic_fields?.obligation_data?.total_bt_pos,a.dynamic_fields?.obligation_data?.totalBtPos,a.eligibility_details?.total_bt_pos,a.eligibility_details?.totalBtPos,a.dynamic_fields?.eligibility_details?.total_bt_pos,a.dynamic_fields?.eligibility_details?.totalBtPos,a.bt_position,a.btPosition,a.total_balance_transfer,a.totalBalanceTransfer].find(e=>null!=e&&""!==e);var a;return t&&"object"==typeof t&&(t=void 0!==t.total_bt_pos?t.total_bt_pos:void 0!==t.totalBtPos?t.totalBtPos:void 0!==t.amount?t.amount:void 0!==t.value?t.value:void 0!==t.balance?t.balance:null),null!=t&&""!==t?"string"==typeof t&&(t.includes("")||t.includes(","))?t:cn(t):"-"})()}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:(()=>{const t=e.financial_details?.cibil_score||e.dynamic_fields?.financial_details?.cibil_score||e.obligation_data?.cibil_score||e.obligation_data?.financial_details?.cibil_score||e.dynamic_fields?.obligation_data?.cibil_score;return t&&"object"==typeof t?t.cibil_score||t.score||"-":t||"-"})()}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{children:(()=>{const t=e.dynamic_fields?.personal_details?.company_name;return t&&"object"==typeof t?t.name||t.value||"-":t||"-"})()})})})]})},e._id||`lead-${a}`))),Ss&&ks.length>0&&t.jsx("tr",{children:t.jsxs("td",{colSpan:(we()||je())&&nt?dn.length+1:dn.length,className:"py-6 text-center bg-black",children:[t.jsxs("button",{onClick:()=>A(e=>e+D),className:"px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg",children:["Show More (",Math.min(D,Ns.length-L)," more leads)"]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Showing ",ks.length," of ",Ns.length," leads"]})]})}),!Ss&&ks.length>0&&t.jsx("tr",{children:t.jsx("td",{colSpan:(we()||je())&&nt?dn.length+1:dn.length,className:"py-6 text-center bg-black text-gray-400",children:t.jsxs("p",{className:"text-sm",children:[" End of leads (",Ns.length," total) "]})})})]})]})})]})})]}),Ta&&t.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] flex flex-col",children:[t.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-40 h-20 z-[10000] flex items-center justify-center",onMouseEnter:()=>Ea(!0),onMouseLeave:()=>Ea(!1),children:t.jsx("button",{onClick:zs,className:`bg-red-600 hover:bg-red-700 text-white p-4 rounded-full shadow-2xl transition-all duration-300 ease-in-out transform hover:scale-110 ${Da?"opacity-100 translate-y-2":"opacity-0 -translate-y-2"} z-[10001] border-2 border-white/20`,"aria-label":"Exit fullscreen",style:{backdropFilter:"blur(10px)",boxShadow:"0 8px 32px rgba(239, 68, 68, 0.4)"},children:t.jsx(Ie,{className:"w-7 h-7"})})}),t.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:t.jsxs("div",{className:"relative h-full",children:[Sa&&t.jsx("button",{onClick:()=>Fs("left"),className:"absolute left-4 top-1/2 transform -translate-y-1/2 z-50 text-white p-4 rounded-full shadow-lg transition-all duration-200 opacity-20 hover:opacity-100",style:{backgroundColor:"rgba(37, 99, 235, 1)"},onMouseEnter:e=>e.target.style.backgroundColor="rgba(29, 78, 216, 1)",onMouseLeave:e=>e.target.style.backgroundColor="rgba(37, 99, 235, 1)","aria-label":"Scroll left",children:t.jsx(j,{className:"w-9 h-9"})}),La&&t.jsx("button",{onClick:()=>Fs("right"),className:"absolute right-4 top-1/2 transform -translate-y-1/2 z-50 text-white p-4 rounded-full shadow-lg transition-all duration-200 opacity-20 hover:opacity-100",style:{backgroundColor:"rgba(37, 99, 235, 1)"},onMouseEnter:e=>e.target.style.backgroundColor="rgba(29, 78, 216, 1)",onMouseLeave:e=>e.target.style.backgroundColor="rgba(37, 99, 235, 1)","aria-label":"Scroll right",children:t.jsx(N,{className:"w-9 h-9"})}),t.jsx("div",{ref:ka,className:"bg-black rounded-lg overflow-x-auto h-full overflow-y-auto",onScroll:qs,children:t.jsxs("table",{className:"min-w-[1600px] w-full bg-black relative table-fixed",children:[t.jsx("thead",{className:"bg-white sticky top-0 z-50 shadow-lg border-b-2 border-gray-200 cursor-pointer select-none",onDoubleClick:Us,title:"Double-click to exit fullscreen",children:t.jsxs("tr",{children:[je()&&nt&&t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200",children:t.jsx("input",{type:"checkbox",className:"accent-blue-500 cursor-pointer",checked:on,onChange:Ws})}),t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200 whitespace-nowrap w-16",children:"#"}),t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200 whitespace-nowrap w-40",children:"LEAD DATE & AGE"}),t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200 whitespace-nowrap w-36",children:"CREATED BY"}),t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200 whitespace-nowrap w-32",children:"TEAM NAME"}),t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200 whitespace-nowrap w-40",children:"CUSTOMER NAME"}),t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200 whitespace-nowrap w-44",children:"STATUS"}),t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200 whitespace-nowrap w-36",children:"TOTAL INCOME"}),t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200 whitespace-nowrap w-36",children:"FOIR ELIGIBILITY"}),t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200 whitespace-nowrap w-36",children:"TOTAL BT POS"}),t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200 whitespace-nowrap w-32",children:"CIBIL SCORE"}),t.jsx("th",{className:"bg-white py-3 px-4 text-blue-600 font-bold sticky top-0 z-50 shadow-sm border-b border-gray-200 whitespace-nowrap w-52",children:"COMPANY NAME"})]})}),t.jsxs("tbody",{children:[0===ks.length?t.jsx("tr",{children:t.jsx("td",{colSpan:dn.length+((we()||je())&&nt?1:0),className:"py-8 text-center text-gray-400",children:"No leads found"})}):ks.map((e,a)=>t.jsx(s.Fragment,{children:t.jsxs("tr",{className:`border-b border-gray-800 hover:bg-gray-900/50 transition ${zt.includes(e._id)?"ring-2 ring-blue-500":""} ${e.file_sent_to_login?"bg-gray-900/30":"bg-black"}`,children:[je()&&nt&&t.jsx("td",{className:"py-2 px-4 whitespace-nowrap",children:t.jsx("input",{type:"checkbox",className:"accent-blue-500 cursor-pointer",checked:zt.includes(e._id),onChange:t=>{return a=e._id,t.target.checked,void Vt(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a]);var a}})}),t.jsx("td",{className:"text-sm font-semibold py-2 px-4 whitespace-nowrap text-white",children:a+1}),t.jsx("td",{className:"text-sm font-semibold py-2 px-4 whitespace-nowrap text-white",children:mn(e.created_at)}),t.jsx("td",{className:"text-sm font-semibold py-2 px-4 whitespace-nowrap text-white",children:t.jsx("div",{className:"flex items-center gap-3",children:t.jsx("span",{className:"text-sm text-wrap",children:"object"==typeof e.created_by_name?e.created_by_name?.name||"-":e.created_by_name||"-"})})}),t.jsx("td",{className:"text-xl font-semibold py-2 px-4 whitespace-nowrap text-white",children:"object"==typeof e.department_name?e.department_name?.name||"-":e.department_name||"-"}),t.jsx("td",{className:"text-sm font-semibold py-2 px-4 whitespace-nowrap text-white",children:t.jsx("div",{className:"flex items-center gap-3",children:t.jsx("span",{className:"text-wrap",children:e.name||"-"})})}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white relative",children:e.file_sent_to_login?t.jsx("div",{className:"flex items-center justify-center",children:t.jsxs("span",{className:"bg-green-500 text-white text-sm px-3 py-2 rounded-full font-bold flex items-center",children:[t.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Login"]})}):t.jsx("div",{className:"font-medium text-white truncate w-full text-sm text-left",children:e.sub_status?t.jsxs("div",{children:[t.jsx("div",{children:"object"==typeof e.sub_status?e.sub_status.name||"Unknown Sub-Status":e.sub_status||"Unknown Sub-Status"}),t.jsx("div",{className:"text-xs text-gray-400",children:"object"==typeof e.status?e.status.name||"Unknown Status":e.status||"Unknown Status"})]}):"object"==typeof e.status?e.status.name||"Unknown Status":e.status||"Unknown Status"})}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:(()=>{let t=(a=e,[a.dynamic_fields?.eligibility_details?.totalIncome,a.eligibility_details?.totalIncome,a.dynamic_fields?.obligation_data?.eligibility?.totalIncome,a.obligation_data?.eligibility?.totalIncome,a.dynamic_fields?.financial_details?.monthly_income,a.financial_details?.monthly_income,a.salary,a.monthly_income].find(e=>null!=e&&""!==e));var a;return t&&"object"==typeof t&&(t=void 0!==t.totalIncome?t.totalIncome:void 0!==t.amount?t.amount:null),null!=t&&""!==t?"string"==typeof t&&(t.includes("")||t.includes(","))?t:cn(t):"-"})()}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:(()=>{let t=(a=e,[a.dynamic_fields?.eligibility_details?.finalEligibility,a.eligibility_details?.finalEligibility,a.dynamic_fields?.obligation_data?.eligibility?.finalEligibility,a.dynamic_fields?.eligibility_details?.foir_eligibility,a.eligibility_details?.foir_eligibility,a.dynamic_fields?.obligation_data?.eligibility?.foir_eligibility,a.dynamic_fields?.check_eligibility?.foir_eligibility,a.dynamic_fields?.check_eligibility?.final_eligibility,a.dynamic_fields?.check_eligibility?.loan_eligibility,a.dynamic_fields?.eligibility_details?.final_eligibility,a.eligibility_details?.final_eligibility,a.dynamic_fields?.obligation_data?.eligibility?.final_eligibility,a.dynamic_fields?.eligibility_details?.loanEligibility,a.eligibility_details?.loanEligibility,a.dynamic_fields?.obligation_data?.eligibility?.loanEligibility,a.dynamic_fields?.eligibility_details?.loan_eligibility,a.eligibility_details?.loan_eligibility,a.dynamic_fields?.obligation_data?.eligibility?.loan_eligibility,a.dynamic_fields?.obligation_data?.calculatedEligibility,a.dynamic_fields?.eligibility_details?.calculatedEligibility,a.calculated_eligibility,a.eligibility?.finalEligibility,a.dynamic_fields?.eligibility?.finalEligibility,a.eligibility?.foir_eligibility,a.dynamic_fields?.eligibility?.foir_eligibility].find(e=>null!=e&&""!==e));var a;return t&&"object"==typeof t&&(t=void 0!==t.finalEligibility?t.finalEligibility:void 0!==t.amount?t.amount:void 0!==t.eligibility?t.eligibility:null),null!=t&&""!==t?"string"==typeof t&&(t.includes("")||t.includes(","))?t:cn(t):"-"})()}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:(()=>{let t=[(a=e).total_bt_pos,a.totalBtPos,a.financial_details?.total_bt_pos,a.financial_details?.totalBtPos,a.dynamic_fields?.financial_details?.total_bt_pos,a.dynamic_fields?.financial_details?.totalBtPos,a.obligation_data?.total_bt_pos,a.obligation_data?.totalBtPos,a.obligation_data?.financial_details?.total_bt_pos,a.obligation_data?.financial_details?.totalBtPos,a.dynamic_fields?.obligation_data?.total_bt_pos,a.dynamic_fields?.obligation_data?.totalBtPos,a.eligibility_details?.total_bt_pos,a.eligibility_details?.totalBtPos,a.dynamic_fields?.eligibility_details?.total_bt_pos,a.dynamic_fields?.eligibility_details?.totalBtPos,a.bt_position,a.btPosition,a.total_balance_transfer,a.totalBalanceTransfer].find(e=>null!=e&&""!==e);var a;return t&&"object"==typeof t&&(t=void 0!==t.total_bt_pos?t.total_bt_pos:void 0!==t.totalBtPos?t.totalBtPos:void 0!==t.amount?t.amount:void 0!==t.value?t.value:void 0!==t.balance?t.balance:null),null!=t&&""!==t?"string"==typeof t&&(t.includes("")||t.includes(","))?t:cn(t):"-"})()}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:(()=>{let t=e.financial_details?.cibil_score||e.dynamic_fields?.financial_details?.cibil_score||e.obligation_data?.cibil_score||e.obligation_data?.financial_details?.cibil_score||e.dynamic_fields?.obligation_data?.cibil_score||e.dynamic_fields?.obligation_data?.financial_details?.cibil_score||e.cibil_score||e.credit_score||e.dynamic_fields?.financial_details?.credit_score||e.financial_details?.credit_score||e.dynamic_fields?.personal_details?.cibil_score||e.personal_details?.cibil_score||e.obligation_data?.cibil||e.dynamic_fields?.obligation_data?.cibil||e.dynamic_fields?.credit_details?.cibil_score||e.credit_details?.cibil_score||e.dynamic_fields?.bank_details?.cibil_score||e.bank_details?.cibil_score||e.dynamic_fields?.loan_details?.cibil_score||e.loan_details?.cibil_score;if(!t&&e.financial_details&&Object.keys(e.financial_details).forEach(a=>{(a.toLowerCase().includes("cibil")||a.toLowerCase().includes("credit"))&&(t=t||e.financial_details[a])}),!t&&e.dynamic_fields?.financial_details&&Object.keys(e.dynamic_fields.financial_details).forEach(a=>{(a.toLowerCase().includes("cibil")||a.toLowerCase().includes("credit"))&&(t=t||e.dynamic_fields.financial_details[a])}),t&&"object"==typeof t){const e=t.cibil_score||t.score||t.credit_score||t.value||t.cibil||t.rating||t.credit_rating;if(e)return e}return null!=t&&""!==t&&0!==t?t:"-"})()}),t.jsx("td",{className:"text-md font-semibold py-2 px-4 text-white w-52 max-w-52",children:t.jsx("div",{className:"truncate",title:(()=>{const t=e.dynamic_fields?.personal_details?.company_name;return t&&"object"==typeof t?t.name||t.value||"-":t||"-"})(),children:(()=>{const t=e.dynamic_fields?.personal_details?.company_name;return t&&"object"==typeof t?t.name||t.value||"-":t||"-"})()})})]})},e._id||a)),v&&t.jsx("tr",{children:t.jsx("td",{colSpan:(we()||je())&&nt?dn.length+1:dn.length,className:"py-8 text-center bg-black",children:t.jsxs("div",{className:"flex items-center justify-center gap-3 text-[#03B0F5]",children:[t.jsx("div",{className:"animate-spin h-6 w-6 border-3 border-[#03B0F5] rounded-full border-t-transparent"}),t.jsx("p",{className:"font-medium text-lg",children:"Loading more leads..."})]})})}),Ss&&ks.length>0&&t.jsx("tr",{children:t.jsxs("td",{colSpan:(we()||je())&&nt?dn.length+1:dn.length,className:"py-6 text-center bg-black",children:[t.jsxs("button",{onClick:()=>A(e=>e+D),className:"px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg",children:["Show More (",Math.min(D,Ns.length-L)," more leads)"]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Showing ",ks.length," of ",Ns.length," leads"]})]})}),!Ss&&ks.length>0&&t.jsx("tr",{children:t.jsx("td",{colSpan:(we()||je())&&nt?dn.length+1:dn.length,className:"py-6 text-center bg-black text-gray-400",children:t.jsxs("p",{className:"text-sm",children:[" End of leads (",Ns.length," total) "]})})})]})]})})]})})]}),At&&t.jsxs("div",{className:"fixed inset-0 bg-transparent bg-opacity-50 flex items-center justify-center z-[9999] transition-opacity duration-200 ease-out",style:{animation:"fadeIn 0.2s ease-out",willChange:"opacity"},onClick:e=>{e.target===e.currentTarget&&(Pt(!1),Rs())},children:[t.jsx("style",{children:"\n                            @keyframes fadeIn {\n                                from { opacity: 0; }\n                                to { opacity: 1; }\n                            }\n                            @keyframes slideUp {\n                                from { \n                                    opacity: 0;\n                                    transform: translate3d(-50%, -45%, 0) scale(0.95);\n                                }\n                                to { \n                                    opacity: 1;\n                                    transform: translate3d(-50%, -50%, 0) scale(1);\n                                }\n                            }\n                        "}),t.jsxs("div",{className:"bg-[#1b2230] border border-gray-600 rounded-lg p-4 w-[700px] max-w-[80vw] h-[600px] flex flex-col relative z-[9999]",style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"slideUp 0.2s ease-out",willChange:"transform, opacity"},children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-white",children:"Filter Lead"}),t.jsx("button",{onClick:()=>{Pt(!1),Rs()},className:"text-gray-400 hover:text-white text-2xl transition-colors duration-150",children:""})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-6 flex-1 overflow-hidden",children:[t.jsxs("div",{className:"col-span-1 border-r border-gray-600 pr-4",children:[t.jsx("h3",{className:"text-base font-medium text-gray-300 mb-4",children:"Filter Categories"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("button",{onClick:()=>{Bt("leadDate"),Rs()},className:"w-full text-left px-4 py-3 rounded-lg transition-all duration-200 ease-in-out transform hover:scale-105 "+("leadDate"===Rt?"bg-blue-600 text-white shadow-lg shadow-blue-600/50":"text-gray-300 hover:bg-[#2a3441]"),style:{willChange:"transform, background-color"},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(f,{className:"w-5 h-5 transition-transform duration-200"}),t.jsx("span",{className:"text-base",children:"Date Filters"})]}),Os("leadDate")>0&&t.jsx("span",{className:"bg-red-500 text-white text-sm rounded-full h-6 w-6 flex items-center justify-center animate-pulse",children:Os("leadDate")})]})}),t.jsx("button",{onClick:()=>{Bt("leadAge"),Rs()},className:"w-full text-left px-3 py-2 rounded-lg transition-all duration-200 ease-in-out transform hover:scale-105 "+("leadAge"===Rt?"bg-blue-600 text-white shadow-lg shadow-blue-600/50":"text-gray-300 hover:bg-[#2a3441]"),style:{willChange:"transform, background-color"},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(I,{className:"w-4 h-4 transition-transform duration-200"}),"Lead Age"]}),Os("leadAge")>0&&t.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse",children:Os("leadAge")})]})}),t.jsx("button",{onClick:()=>{Bt("createdBy"),Rs()},className:"w-full text-left px-3 py-2 rounded-lg transition-all duration-200 ease-in-out transform hover:scale-105 "+("createdBy"===Rt?"bg-blue-600 text-white shadow-lg shadow-blue-600/50":"text-gray-300 hover:bg-[#2a3441]"),style:{willChange:"transform, background-color"},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ae,{className:"w-4 h-4 transition-transform duration-200"}),"Created By"]}),Os("createdBy")>0&&t.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse",children:Os("createdBy")})]})}),t.jsx("button",{onClick:()=>{Bt("status"),Rs()},className:"w-full text-left px-3 py-2 rounded-lg transition-all duration-200 ease-in-out transform hover:scale-105 "+("status"===Rt?"bg-blue-600 text-white shadow-lg shadow-blue-600/50":"text-gray-300 hover:bg-[#2a3441]"),style:{willChange:"transform, background-color"},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ke,{className:"w-4 h-4 transition-transform duration-200"}),"Status"]}),Os("status")>0&&t.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse",children:Os("status")})]})}),t.jsx("button",{onClick:()=>{Bt("teamName"),Rs()},className:"w-full text-left px-3 py-2 rounded-lg transition-colors "+("teamName"===Rt?"bg-blue-600 text-white":"text-gray-300 hover:bg-[#2a3441]"),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Te,{className:"w-4 h-4"}),"Team Name"]}),Os("teamName")>0&&t.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:Os("teamName")})]})}),t.jsx("button",{onClick:()=>{Bt("assignedTL"),Rs(),0!==Ja.length||ja||pn()},className:"w-full text-left px-3 py-2 rounded-lg transition-colors "+("assignedTL"===Rt?"bg-blue-600 text-white":"text-gray-300 hover:bg-[#2a3441]"),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ae,{className:"w-4 h-4"}),"Assigned TL"]}),Os("assignedTL")>0&&t.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:Os("assignedTL")})]})}),t.jsx("button",{onClick:()=>{Bt("leadActivity"),Rs()},className:"w-full text-left px-3 py-2 rounded-lg transition-colors "+("leadActivity"===Rt?"bg-blue-600 text-white":"text-gray-300 hover:bg-[#2a3441]"),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(V,{className:"w-4 h-4"}),"Quick Filters"]}),Os("leadActivity")>0&&t.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:Os("leadActivity")})]})}),t.jsx("button",{onClick:()=>{Bt("totalIncome"),Rs()},className:"w-full text-left px-3 py-2 rounded-lg transition-colors "+("totalIncome"===Rt?"bg-blue-600 text-white":"text-gray-300 hover:bg-[#2a3441]"),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx($,{className:"w-4 h-4"}),"Total Income"]}),Os("totalIncome")>0&&t.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:Os("totalIncome")})]})})]})]}),t.jsx("div",{className:"col-span-2 overflow-y-auto",children:t.jsxs("div",{className:"h-full",children:["leadDate"===Rt&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-medium text-gray-300 mb-4",children:"Lead Date Range"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"cursor-pointer",onClick:e=>{const t=e.currentTarget.querySelector('input[type="date"]');t&&(t.showPicker?t.showPicker():(t.focus(),t.click()))},children:[t.jsx("label",{className:"block text-gray-400 text-xs mb-1 cursor-pointer",children:"From Date"}),t.jsx("input",{type:"date",value:Ot.leadDateFrom,onChange:e=>{Ft({...Ot,leadDateFrom:e.target.value}),setTimeout(()=>Ne(),0)},onClick:e=>{e.stopPropagation(),e.target.showPicker&&e.target.showPicker()},className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 text-gray-300 focus:outline-none focus:border-blue-500 cursor-pointer"})]}),t.jsxs("div",{className:"cursor-pointer",onClick:e=>{const t=e.currentTarget.querySelector('input[type="date"]');t&&(t.showPicker?t.showPicker():(t.focus(),t.click()))},children:[t.jsx("label",{className:"block text-gray-400 text-xs mb-1 cursor-pointer",children:"To Date"}),t.jsx("input",{type:"date",value:Ot.leadDateTo,onChange:e=>{Ft({...Ot,leadDateTo:e.target.value}),setTimeout(()=>Ne(),0)},onClick:e=>{e.stopPropagation(),e.target.showPicker&&e.target.showPicker()},className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 text-gray-300 focus:outline-none focus:border-blue-500 cursor-pointer"})]})]}),t.jsxs("div",{className:"mt-6",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"File Sent to Login Date Range"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"cursor-pointer",onClick:e=>{const t=e.currentTarget.querySelector('input[type="date"]');t&&(t.showPicker?t.showPicker():(t.focus(),t.click()))},children:[t.jsx("label",{className:"block text-gray-400 text-xs mb-1 cursor-pointer",children:"From Date"}),t.jsx("input",{type:"date",value:Ot.fileSentToLoginDateFrom,onChange:e=>{Ft({...Ot,fileSentToLoginDateFrom:e.target.value}),setTimeout(()=>Ne(),0)},onClick:e=>{e.stopPropagation(),e.target.showPicker&&e.target.showPicker()},className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 text-gray-300 focus:outline-none focus:border-blue-500 cursor-pointer"})]}),t.jsxs("div",{className:"cursor-pointer",onClick:e=>{const t=e.currentTarget.querySelector('input[type="date"]');t&&(t.showPicker?t.showPicker():(t.focus(),t.click()))},children:[t.jsx("label",{className:"block text-gray-400 text-xs mb-1 cursor-pointer",children:"To Date"}),t.jsx("input",{type:"date",value:Ot.fileSentToLoginDateTo,onChange:e=>{Ft({...Ot,fileSentToLoginDateTo:e.target.value}),setTimeout(()=>Ne(),0)},onClick:e=>{e.stopPropagation(),e.target.showPicker&&e.target.showPicker()},className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 text-gray-300 focus:outline-none focus:border-blue-500 cursor-pointer"})]})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Filter leads by when file was sent to login team"})]}),t.jsxs("div",{className:"mt-6",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"No Activity Since"}),t.jsxs("div",{className:"cursor-pointer",onClick:e=>{const t=e.currentTarget.querySelector('input[type="date"]');t&&(t.showPicker?t.showPicker():(t.focus(),t.click()))},children:[t.jsx("label",{className:"block text-gray-400 text-xs mb-1 cursor-pointer",children:"No Activity Date"}),t.jsx("input",{type:"date",value:Ot.noActivityDate,onChange:e=>{Ft({...Ot,noActivityDate:e.target.value}),setTimeout(()=>{Hs(),Ne()},0)},onClick:e=>{e.stopPropagation(),e.target.showPicker&&e.target.showPicker()},className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 text-gray-300 focus:outline-none focus:border-blue-500 cursor-pointer"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Show leads with no activity since this date"})]})]}),t.jsx("button",{onClick:()=>{Ft({...Ot,leadDateFrom:"",leadDateTo:"",noActivityDate:"",fileSentToLoginDateFrom:"",fileSentToLoginDateTo:""}),setTimeout(()=>Ne(),0)},className:"mt-4 text-xs text-blue-400 hover:text-blue-300",children:"Clear Date Filters"})]}),"leadAge"===Rt&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-medium text-gray-300 mb-4",children:"Lead Age Range (Days)"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-gray-400 text-xs mb-1",children:"From Age (Days)"}),t.jsx("input",{type:"number",value:Ot.leadAgeFrom,onChange:e=>{Ft({...Ot,leadAgeFrom:e.target.value}),setTimeout(()=>Ne(),0)},className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 text-gray-300 focus:outline-none focus:border-blue-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-gray-400 text-xs mb-1",children:"To Age (Days)"}),t.jsx("input",{type:"number",value:Ot.leadAgeTo,onChange:e=>{Ft({...Ot,leadAgeTo:e.target.value}),setTimeout(()=>Ne(),0)},className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 text-gray-300 focus:outline-none focus:border-blue-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"365"})]})]}),t.jsx("button",{onClick:()=>{Ft({...Ot,leadAgeFrom:"",leadAgeTo:""}),setTimeout(()=>Ne(),0)},className:"text-xs text-blue-400 hover:text-blue-300",children:"Clear Age Range"})]}),"createdBy"===Rt&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-medium text-gray-300 mb-4",children:"Created By"}),t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",placeholder:"Search creators...",value:sa,onChange:e=>na(e.target.value),className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 pl-10 text-gray-300 focus:outline-none focus:border-blue-500"}),t.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),sa&&t.jsx("button",{onClick:()=>na(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-300",children:t.jsx(Ie,{className:"w-4 h-4"})})]})}),t.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[Es.map(e=>t.jsxs("label",{className:"flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",name:"createdBy",value:e,checked:Ot.createdBy?.includes(e)||!1,onChange:e=>{const t=Ot.createdBy||[];let a;a=e.target.checked?[...t,e.target.value]:t.filter(t=>t!==e.target.value),Ft({...Ot,createdBy:a}),setTimeout(()=>{Ne()},0)},className:"accent-blue-500 mr-2 cursor-pointer"}),t.jsx("span",{className:"text-gray-300",children:e})]},e)),0===Es.length&&sa&&t.jsxs("div",{className:"text-gray-500 text-sm py-2",children:['No creators found matching "',sa,'"']})]})]}),"status"===Rt&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-medium text-gray-300 mb-4",children:"Status"}),t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",placeholder:"Search statuses...",value:ia,onChange:e=>ra(e.target.value),className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 pl-10 text-gray-300 focus:outline-none focus:border-blue-500"}),t.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),ia&&t.jsx("button",{onClick:()=>ra(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-300",children:t.jsx(Ie,{className:"w-4 h-4"})})]})}),t.jsxs("div",{className:"flex gap-2 mb-4",children:[t.jsx("button",{onClick:()=>{Ft({...Ot,selectedStatuses:[]}),setTimeout(()=>{Ne()},0)},className:"px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"Clear All"}),t.jsx("button",{onClick:()=>{const e=[];Object.entries($s()).forEach(([t,a])=>{e.push(t),Array.isArray(a)&&a.forEach(a=>{const s="object"==typeof a?a.name:a;s&&s!==t&&e.push(s)})}),Ft({...Ot,selectedStatuses:[...new Set(e)]}),setTimeout(()=>{Ne()},0)},className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:"Select All Visible"})]}),t.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[(!Ot.selectedStatuses||0===Ot.selectedStatuses.length)&&!Ot.fileSentToLogin&&t.jsx("div",{className:"mb-3 p-2 bg-green-900/20 border border-green-700/30 rounded text-green-300 text-sm",children:" Showing all statuses (no filter applied)"}),(Ot.selectedStatuses&&Ot.selectedStatuses.length>0||Ot.fileSentToLogin)&&t.jsxs("div",{className:"mb-3 p-2 bg-blue-900/20 border border-blue-700/30 rounded text-blue-300 text-sm",children:[" Filtering by ",(Ot.selectedStatuses?.length||0)+(Ot.fileSentToLogin?1:0)," selected status(es)"]}),t.jsx("div",{className:"mb-4 p-3 border border-green-700/30 bg-green-900/10 rounded-lg",children:t.jsxs("label",{className:"flex items-center cursor-pointer font-medium",children:[t.jsx("input",{type:"checkbox",className:"accent-green-500 mr-2 h-4 w-4 cursor-pointer",checked:Ot.fileSentToLogin,onChange:e=>{Ft({...Ot,fileSentToLogin:e.target.checked}),setTimeout(()=>{Ne()},0)}}),t.jsx("div",{children:t.jsx("span",{className:"text-green-400",children:"FILE SENT TO LOGIN"})})]})}),Object.keys($s()).length>0?Object.keys($s()).map(e=>t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"flex items-center cursor-pointer font-medium text-blue-300 mb-2",children:[t.jsx("input",{type:"checkbox",className:"accent-blue-500 mr-2 cursor-pointer",checked:Ot.selectedStatuses?.includes(e)||!1,onChange:t=>{const a=Ot.selectedStatuses||[],s=t.target.checked?[...a,e]:a.filter(t=>t!==e),n={...Ot,selectedStatuses:s};Ft(n),setTimeout(()=>{Ne()},0)}}),t.jsx("span",{className:"text-blue-300",children:e})]}),$s()[e]&&$s()[e].length>0&&t.jsx("div",{className:"ml-6 space-y-1",children:$s()[e].map(a=>{const s="object"==typeof a?a.name:a;return s&&s!==e?t.jsxs("label",{className:"flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",className:"accent-blue-500 mr-2 cursor-pointer",checked:Ot.selectedStatuses?.includes(s)||!1,onChange:e=>{const t=Ot.selectedStatuses||[],a=e.target.checked?[...t,s]:t.filter(e=>e!==s),n={...Ot,selectedStatuses:a};Ft(n),setTimeout(()=>{Ne()},0)}}),t.jsx("span",{className:"text-gray-300 text-sm",children:s})]},s):null})})]},e)):ia?t.jsxs("div",{className:"text-gray-500 text-sm py-4 text-center",children:['No statuses found matching "',ia,'"']}):t.jsxs("div",{className:"text-center py-4",children:[t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500 mx-auto mb-2"}),t.jsx("span",{className:"text-gray-400 text-sm",children:"Loading status options..."})]})]})]}),"teamName"===Rt&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"Team Name"}),t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",placeholder:"Search teams...",value:oa,onChange:e=>la(e.target.value),className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 pl-10 text-gray-300 focus:outline-none focus:border-blue-500"}),t.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),oa&&t.jsx("button",{onClick:()=>la(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-300",children:t.jsx(Ie,{className:"w-4 h-4"})})]})}),t.jsxs("div",{className:"space-y-2",children:[Ps.map(e=>t.jsxs("label",{className:"flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",name:"teamName",value:e,checked:Ot.teamName?.includes(e)||!1,onChange:e=>{const t=Ot.teamName||[];let a;a=e.target.checked?[...t,e.target.value]:t.filter(t=>t!==e.target.value),Ft({...Ot,teamName:a}),setTimeout(()=>{Ne()},0)},className:"accent-blue-500 mr-2 cursor-pointer"}),t.jsx("span",{className:"text-gray-300",children:e})]},e)),0===Ps.length&&oa&&t.jsxs("div",{className:"text-gray-500 text-sm py-2",children:['No teams found matching "',oa,'"']})]})]}),"assignedTL"===Rt&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"Assigned"}),t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",placeholder:"Search TLs...",value:da,onChange:e=>ca(e.target.value),className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 pl-10 text-gray-300 focus:outline-none focus:border-blue-500"}),t.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),da&&t.jsx("button",{onClick:()=>ca(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-300",children:t.jsx(Ie,{className:"w-4 h-4"})})]})}),t.jsxs("div",{className:"space-y-2",children:[ja?t.jsxs("div",{className:"text-gray-500 text-sm py-2 flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),"Loading team leaders..."]}):Ms().map(e=>t.jsxs("label",{className:"flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",name:"assignedTL",value:e,checked:Ot.assignedTL?.includes(e)||!1,onChange:e=>{const t=Ot.assignedTL||[];let a;a=e.target.checked?[...t,e.target.value]:t.filter(t=>t!==e.target.value),Ft({...Ot,assignedTL:a}),setTimeout(()=>{Ne()},0)},className:"accent-blue-500 mr-2 cursor-pointer"}),t.jsx("span",{className:"text-gray-300",children:e})]},e)),!ja&&0===Ms().length&&da&&t.jsxs("div",{className:"text-gray-500 text-sm py-2",children:['No team leaders found matching "',da,'"']}),!ja&&0===Ms().length&&!da&&t.jsx("div",{className:"text-gray-500 text-sm py-2",children:"No team leaders available"})]})]}),"leadActivity"===Rt&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"Quick Filters"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("label",{className:"flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:Ot.checkDuplicateLeads||!1,onChange:e=>{const t={...Ot,checkDuplicateLeads:e.target.checked};Ft(t),setTimeout(()=>{Ne()},0)},className:"accent-blue-500 mr-2 cursor-pointer"}),t.jsx("span",{className:"text-gray-300",children:"Check Duplicate Leads"})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1 ml-6",children:"Show leads with same phone number or alternative phone number"})]})]}),"totalIncome"===Rt&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"Total Income Filter"}),t.jsxs("div",{className:"mb-6",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Income Range"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-gray-400 text-xs mb-1",children:"Minimum Income"}),t.jsx("input",{type:"number",placeholder:"e.g. 25000",value:Ot.totalIncomeFrom,onChange:e=>{const t=e.target.value,a={...Ot,totalIncomeFrom:t};Ft(a),setTimeout(()=>{Ne()},100)},className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 text-gray-300 focus:outline-none focus:border-blue-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-gray-400 text-xs mb-1",children:"Maximum Income"}),t.jsx("input",{type:"number",placeholder:"e.g. 100000",value:Ot.totalIncomeTo,onChange:e=>{const t=e.target.value,a={...Ot,totalIncomeTo:t};Ft(a),setTimeout(()=>{Ne()},100)},className:"w-full bg-[#1b2230] border border-gray-600 rounded px-3 py-2 text-gray-300 focus:outline-none focus:border-blue-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"})]})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Filter leads within the specified income range"})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Income Sorting"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"flex items-center cursor-pointer",children:[t.jsx("input",{type:"radio",name:"totalIncomeSort",checked:"highest"===Ot.totalIncomeSort,onChange:()=>{const e={...Ot,totalIncomeSort:"highest"};Ft(e),setTimeout(()=>{Ne()},0)},className:"accent-blue-500 mr-2"}),t.jsx("span",{className:"text-gray-300",children:"Highest to Lowest"})]}),t.jsxs("label",{className:"flex items-center cursor-pointer",children:[t.jsx("input",{type:"radio",name:"totalIncomeSort",checked:"lowest"===Ot.totalIncomeSort,onChange:()=>{const e={...Ot,totalIncomeSort:"lowest"};Ft(e),setTimeout(()=>{Ne()},0)},className:"accent-blue-500 mr-2"}),t.jsx("span",{className:"text-gray-300",children:"Lowest to Highest"})]}),t.jsxs("label",{className:"flex items-center cursor-pointer",children:[t.jsx("input",{type:"radio",name:"totalIncomeSort",checked:""===Ot.totalIncomeSort,onChange:()=>{const e={...Ot,totalIncomeSort:""};Ft(e),setTimeout(()=>{Ne()},0)},className:"accent-blue-500 mr-2"}),t.jsx("span",{className:"text-gray-300",children:"No Sorting"})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Sort filtered leads by their total income amount"})]})]})]})]})})]}),t.jsxs("div",{className:"flex justify-between gap-[250px] items-center mt-6 pt-4 border-t border-gray-600",children:[t.jsx("button",{onClick:()=>{Ft({leadDateFrom:"",leadDateTo:"",leadAgeFrom:"",leadAgeTo:"",createdBy:[],leadParentStatus:[],leadAllStatus:[],teamName:[],assignedTL:[],noActivityFrom:"",noActivityTo:"",noActivity:!1,noActivityDate:"",selectedStatuses:[],loanTypeFilter:[],fileSentToLogin:!1,checkDuplicateLeads:!1,fileSentToLoginDateFrom:"",fileSentToLoginDateTo:"",totalIncomeSort:"",totalIncomeFrom:"",totalIncomeTo:""}),Rs(),aa(e=>e+1)},className:"px-6 py-2  bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition whitespace-nowrap",children:"Clear all filter"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>{Pt(!1),Rs()},className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition whitespace-nowrap",children:"Cancel"}),t.jsx("button",{onClick:()=>{Pt(!1),Rs(),aa(e=>e+1)},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition whitespace-nowrap",children:"Apply Filters"})]})]})]})]}),as&&t.jsx("div",{className:"fixed inset-0 bg-transparent bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-[#1b2230] border border-gray-600 rounded-lg p-6 w-[400px] max-w-[90vw]",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold text-white",children:"Status Updated"}),t.jsx("button",{onClick:()=>ss(!1),className:"text-gray-400 hover:text-white text-2xl",children:""})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"text-gray-300 mb-2",children:"Custom Lead ID:"}),t.jsx("p",{className:"text-cyan-400 font-bold text-lg",children:ns.customLeadId})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("p",{className:"text-gray-300 mb-2",children:"Status changed to:"}),t.jsx("p",{className:"text-green-400 font-bold text-lg",children:"object"==typeof ns.newStatus?ns.newStatus.name:ns.newStatus})]}),t.jsx("button",{onClick:()=>ss(!1),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"OK"})]})]})})]})})}),Mt=Object.freeze(Object.defineProperty({__proto__:null,default:Pt},Symbol.toStringTag,{value:"Module"})),$t=({options:e=[],value:s,onChange:n,placeholder:i="Select an option",searchPlaceholder:r="Search options...",disabled:o=!1,required:l=!1,className:d="",emptyMessage:c="No options available",variant:m="dark"})=>{const[u,g]=a.useState(!1),[p,y]=a.useState(""),[h,f]=a.useState(e),b=a.useRef(null);return a.useEffect(()=>{if(""===p.trim())f(e);else{const t=e.filter(e=>e.label.toLowerCase().includes(p.toLowerCase())||e.value.toLowerCase().includes(p.toLowerCase()));f(t)}},[p,e]),a.useEffect(()=>{const e=e=>{b.current&&!b.current.contains(e.target)&&(g(!1),y(""))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),t.jsxs("div",{className:`relative ${d}`,ref:b,children:[t.jsxs("div",{className:(()=>{const e="w-full px-3 py-2 border rounded-lg cursor-pointer flex items-center justify-between";return o?`${e} bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed`:"light"===m?`${e} bg-white text-black border-neutral-800 hover:border-sky-400 focus:border-sky-400 ${u?"border-sky-400":""}`:`${e} bg-neutral-800 text-white border-neutral-800 hover:border-sky-400 focus:border-sky-400 ${u?"border-sky-400":""}`})(),onClick:()=>{o||(g(!u),u||y(""))},children:[t.jsx("span",{className:"flex-1 "+(s?"":"text-gray-400"),children:s?(()=>{const t=e.find(e=>e.value===s);return t?t.label:""})():i}),t.jsx("svg",{className:"w-5 h-5 transition-transform "+(u?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&!o&&t.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg",children:[t.jsx("div",{className:"p-3 border-b border-gray-200",children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:t.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("input",{type:"text",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-black focus:outline-none focus:border-sky-400",placeholder:r,value:p,onChange:e=>y(e.target.value),autoFocus:!0})]})}),t.jsx("div",{className:"max-h-60 overflow-y-auto",children:h.length>0?h.map((e,a)=>t.jsx("div",{className:"px-3 py-2 cursor-pointer text-black hover:bg-gray-100 "+(s===e.value?"bg-sky-50 text-sky-700 font-medium":""),onClick:()=>(e=>{n(e.value),g(!1),y("")})(e),children:e.label},e.value||a)):t.jsx("div",{className:"px-3 py-2 text-gray-500 text-center",children:p?`No results found for "${p}"`:c})})]})]})};let Rt={};const Bt=e=>""!==(e=>null==e?"":String(e).trim())(e),Ot=e=>{try{return Rt={...Rt,obligation:{...e,lastUpdated:(new Date).toISOString()}},!0}catch(t){return!1}},Ft=()=>{try{return Rt||{}}catch(e){return{}}},qt=()=>{try{return Rt={},!0}catch(e){return!1}},Ut=e=>(e=>{try{return Rt={...Rt,leadInfo:{...e,lastUpdated:(new Date).toISOString()}},!0}catch(t){return!1}})({productType:e.productType,mobileNumber:e.mobileNumber,customerName:e.customerName,alternateNumber:e.alternateNumber,pincode:e.pincode,city:e.city,companyName:e.companyName,companyType:e.companyType,companyCategory:e.companyCategory,campaignName:e.campaignName,dataCode:e.dataCode,status:e.status,assignedTo:e.assignedTo,assignedToIds:e.assignedToIds,loanRequired:e.loanRequired,selectedLoanTypeId:e.selectedLoanTypeId,assignReportTo:e.assignReportTo,eligibility:e.eligibility,processingBank:e.processingBank||""}),zt=()=>Ft().obligation||{},Vt="/api";function Ht(e){const t=String(e).replace(/,/g,"").replace(/[^0-9.]/g,"");if(""===t)return"";let[a,s]=t.split(".");a.length>1&&a.startsWith("0")&&(a=a.replace(/^0+/,"")||"0");let n=a.slice(-3),i=a.slice(0,-3);i=i.replace(/\B(?=(\d{2})+(?!\d))/g,",");let r=i?i+","+n:n;return void 0!==s&&(r+="."+s.slice(0,2)),r}function Jt(e){"string"!=typeof e&&(e=String(e));const t=e.replace(/,/g,"").split(".")[0];return parseInt(t,10)||0}const Yt=()=>{try{const e=localStorage.getItem("userId");if(e)return e;const t=localStorage.getItem("user");if(t){const e=JSON.parse(t);return e.id||e._id||e.user_id}return null}catch(e){return null}},Wt={loanTypes:null,loanTypesTimestamp:0,settings:null,settingsTimestamp:0,bankNames:null,bankNamesTimestamp:0,companyCategories:null,companyCategoriesTimestamp:0},Gt=3e5,Kt=async(e,t=null)=>{try{const s=Yt();if(!s)return null;let n=`${Vt}/leads/check-phone/${encodeURIComponent(e)}?user_id=${s}`;t&&(n+=`&loan_type_name=${encodeURIComponent(t)}`);const i=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const r=await i.json();if(r&&r.found&&r.leads&&r.leads.length>0)try{const e=r.leads[0].id,t=`${Vt}/leads/${e}/reassignment-eligibility?user_id=${s}`,a=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(a.ok){const e=await a.json();r.can_reassign=e.can_reassign,r.reassignment_reason=e.reason,r.days_elapsed=e.days_elapsed,r.reassignment_period=e.reassignment_period,r.days_remaining=e.days_remaining,r.is_manager_permission_required=e.is_manager_permission_required,r.file_sent_to_login=e.file_sent_to_login,r.status=e.status,r.sub_status=e.sub_status,e.lead&&(r.leads[0]={...r.leads[0],...e.lead,file_sent_to_login:e.file_sent_to_login,status:e.status,sub_status:e.sub_status,login_department_sent_date:e.lead.login_department_sent_date})}}catch(a){}return r}catch(s){return null}};function Qt(){const[e,t]=a.useState([]),[s,n]=a.useState([]),[i,r]=a.useState([]),[o,l]=a.useState([]),[d,c]=a.useState([{value:"",label:"Select Type"},{value:"private",label:"Private"},{value:"pvt_ltd",label:"Pvt Ltd"},{value:"public",label:"Public"},{value:"public_ltd",label:"Public Ltd"},{value:"government",label:"Government"},{value:"psu",label:"PSU"},{value:"startup",label:"Startup"},{value:"mnc",label:"MNC"},{value:"llp",label:"LLP"}]),[m,u]=a.useState([]),[g,p]=a.useState([]),[y,h]=a.useState(!1),[f,b]=a.useState(!1),[x,_]=a.useState(null),[w,v]=a.useState(!1),[j,N]=a.useState(!1),[k,S]=a.useState(null),[C,L]=a.useState(!1),[A,T]=a.useState(!1),[I,D]=a.useState(""),[E,P]=a.useState(""),[M,$]=a.useState(""),[R,B]=a.useState(!1),[O,F]=a.useState(!1),[q,U]=a.useState(!1),[z,V]=a.useState(!1),[H,J]=a.useState(!1),[Y,W]=a.useState(!1),[G,K]=a.useState(!1),[Q,Z]=a.useState(!1),[X,ee]=a.useState(!1),[te,ae]=a.useState(!1),[se,ne]=a.useState(!1),[ie,re]=a.useState(!1),[oe,le]=a.useState(!1),[de,ce]=a.useState(!1),[me,ue]=a.useState({}),[ge,pe]=a.useState({}),[ye,he]=a.useState(!0),[fe,be]=a.useState(!0),xe=a.useCallback(e=>{pe(t=>({...t,[e]:!0})),setTimeout(()=>{pe(t=>({...t,[e]:!1}))},200)},[]);a.useEffect(()=>{const e=ta();he(e)},[]),a.useEffect(()=>{const e=aa();be(e)},[]),a.useEffect(()=>{(async()=>{try{h(!0);const e=await(async()=>{const e=Date.now();if(Wt.loanTypes&&e-Wt.loanTypesTimestamp<Gt)return Wt.loanTypes;try{const t=Yt();if(!t){const t=[{id:"personal_loan",name:"Personal Loan"},{id:"home_loan",name:"Home Loan"},{id:"business_loan",name:"Business Loan"},{id:"car_loan",name:"Car Loan"},{id:"education_loan",name:"Education Loan"}];return Wt.loanTypes=t,Wt.loanTypesTimestamp=e,t}const a=await fetch(`${Vt}/loan-types/?user_id=${t}`);if(!a.ok)return[{id:"personal_loan",name:"Personal Loan"},{id:"home_loan",name:"Home Loan"},{id:"business_loan",name:"Business Loan"},{id:"car_loan",name:"Car Loan"},{id:"education_loan",name:"Education Loan"}];const s=await a.json();let n=[];return Array.isArray(s)?n=s:s.loan_types&&Array.isArray(s.loan_types)?n=s.loan_types:s.data&&Array.isArray(s.data)&&(n=s.data),Wt.loanTypes=n,Wt.loanTypesTimestamp=e,n}catch(t){return[{id:"personal_loan",name:"Personal Loan"},{id:"home_loan",name:"Home Loan"},{id:"business_loan",name:"Business Loan"},{id:"car_loan",name:"Car Loan"},{id:"education_loan",name:"Education Loan"}]}})();t(e),h(!1),(async()=>{try{b(!0);const e=await(async()=>{const e=Date.now();if(Wt.settings&&e-Wt.settingsTimestamp<Gt)return Wt.settings;try{const t=Yt();if(!t)return{campaignNames:[{id:"default",name:"Default Campaign"},{id:"online",name:"Online Campaign"},{id:"offline",name:"Offline Campaign"}],dataCodes:[{id:"hot",code:"HOT"},{id:"warm",code:"WARM"},{id:"cold",code:"COLD"}]};const a=await fetch(`${Vt}/settings/overview?user_id=${t}`);if(!a.ok){const t={campaignNames:[{id:"default",name:"Default Campaign"},{id:"online",name:"Online Campaign"},{id:"offline",name:"Offline Campaign"}],dataCodes:[{id:"hot",code:"HOT"},{id:"warm",code:"WARM"},{id:"cold",code:"COLD"}]};return Wt.settings=t,Wt.settingsTimestamp=e,t}const s=await a.json(),n={campaignNames:s.campaign_names||[],dataCodes:s.data_codes||[]};return Wt.settings=n,Wt.settingsTimestamp=e,n}catch(t){return{campaignNames:[{id:"default",name:"Default Campaign"},{id:"online",name:"Online Campaign"},{id:"offline",name:"Offline Campaign"}],dataCodes:[{id:"hot",code:"HOT"},{id:"warm",code:"WARM"},{id:"cold",code:"COLD"}]}}})();n(e.campaignNames),r(e.dataCodes),b(!1);const t=[_e(),we(),ve()];Promise.all(t).then(()=>{re(!0)}).catch(e=>{re(!0)})}catch(e){b(!1)}})()}catch(e){h(!1)}})()},[]);const _e=async()=>{if(!X)try{W(!0);const e=await(async()=>{try{const e=Yt();if(!e)return[{id:"custom",name:"Custom"}];const t=await fetch(`${Vt}/settings/bank-names?user_id=${e}`);if(!t.ok)return[{id:"custom",name:"Custom"},{id:"sbi",name:"State Bank of India"},{id:"hdfc",name:"HDFC Bank"},{id:"icici",name:"ICICI Bank"},{id:"axis",name:"Axis Bank"},{id:"kotak",name:"Kotak Mahindra Bank"}];const a=await t.json();let s=[];return Array.isArray(a)?s=a:a.bank_names&&Array.isArray(a.bank_names)?s=a.bank_names:a.data&&Array.isArray(a.data)&&(s=a.data),[{id:"custom",name:"Custom"},...s.map(e=>({id:e.id||e._id||e.name,name:e.name||e}))]}catch(e){return[{id:"custom",name:"Custom"},{id:"sbi",name:"State Bank of India"},{id:"hdfc",name:"HDFC Bank"},{id:"icici",name:"ICICI Bank"},{id:"axis",name:"Axis Bank"},{id:"kotak",name:"Kotak Mahindra Bank"}]}})();u(e),ee(!0)}catch(e){}finally{W(!1)}},we=async()=>{if(!te)try{K(!0);const e=await(async(e="")=>{try{const t=Yt();if(!t)return[];const a={company_name:e&&e.trim()?e.trim():"default",similarity_threshold:.6},s=await fetch(`${Vt}/settings/search-companies?user_id=${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)return await s.text(),[];const n=await s.json();let i=[];return Array.isArray(n)?i=n:n.companies&&Array.isArray(n.companies)?i=n.companies:n.categories&&Array.isArray(n.categories)?i=n.categories:n.data&&Array.isArray(n.data)&&(i=n.data),i.map(e=>({value:e.id||e._id||e.name||e,label:e.name||e.label||e}))}catch(t){return[]}})();l(e),e&&e.length>0&&c([{value:"",label:"Select Type"},...e]),ae(!0)}catch(e){}finally{K(!1)}},ve=async()=>{if(!se)try{Z(!0);const e=await(async()=>{try{const e=Yt();if(!e)return[];const t=await fetch(`${Vt}/roles/users-one-level-above/${e}?requesting_user_id=${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return(Array.isArray(a)?a:[]).map(e=>({id:e._id||e.id,_id:e._id||e.id,name:e.name||`${e.first_name||""} ${e.last_name||""}`.trim()||e.username||"Unknown User",username:e.username,first_name:e.first_name,last_name:e.last_name,designation:e.designation,role_name:e.role_name,email:e.email,phone:e.phone,department_name:e.department_name}))}catch(e){return[]}})();p(e),ne(!0)}catch(e){}finally{Z(!1)}},[je,Ne]=a.useState("0"),[ke,Se]=a.useState("0"),[Ce,Le]=a.useState("");a.useEffect(()=>{setTimeout(()=>{Ne(""),Se(""),Le("")},800)},[]);const Ae=a.useMemo(()=>[{value:"pl",label:"PL (Personal Loan)"},{value:"od",label:"OD (Overdraft)"},{value:"cc",label:"CC (Credit Card)"},{value:"bl",label:"BL (Business Loan)"},{value:"hl",label:"HL (Home Loan)"},{value:"lap",label:"LAP (Loan Against Property)"},{value:"al",label:"AL (Auto Loan)"},{value:"el",label:"EL (Education Loan)"},{value:"gl",label:"GL (Gold Loan)"},{value:"loc",label:"LOC (Loan On Credit Card)"},{value:"cd",label:"CD (Consumer Durable Loan)"},{value:"app_loan",label:"App Loan"},{value:"insurance",label:"Insurance"}],[]),Te=a.useMemo(()=>[{value:"bt",label:"BT"},{value:"obligate",label:"Obligate"},{value:"co-pay",label:"CO-Pay"},{value:"no-pay",label:"No-Pay"},{value:"closed",label:"Closed"}],[]),[Ie,De]=a.useState((new Date).toISOString().replace("T"," ").slice(0,19)),[Ee,Pe]=a.useState(""),[Me,$e]=a.useState(""),[Re,Be]=a.useState(""),[Oe,Fe]=a.useState(!1),[qe,Ue]=a.useState(""),[ze,Ve]=a.useState(""),[He,Je]=a.useState(""),[Ye,We]=a.useState([]),[Ge,Ke]=a.useState(!1),[Qe,Ze]=a.useState("not_a_lead"),[Xe,et]=a.useState(""),[tt,at]=a.useState(""),[st,nt]=a.useState(""),[it,rt]=a.useState(""),[ot,lt]=a.useState(""),[dt,mt]=a.useState(""),[ut,gt]=a.useState(""),[pt,yt]=a.useState("12"),[ht,ft]=a.useState(""),[bt,xt]=a.useState("60"),[_t,wt]=a.useState(""),[vt,jt]=a.useState({productType:!1,mobileNumber:!1,customerName:!1,campaignName:!1,status:!1,assignedTo:!1}),[Nt,kt]=a.useState(!1),[St,Ct]=a.useState({totalIncome:0,foirAmount:0,totalObligations:0,totalBtPos:0,foirEligibility:0,multiplierEligibility:0,finalEligibility:0}),[Lt,At]=a.useState(""),[Tt,It]=a.useState(""),[Dt,Et]=a.useState(""),[Pt,Mt]=a.useState(""),[$t,Rt]=a.useState(""),[Ot,zt]=a.useState(""),[Qt,Zt]=a.useState(""),[ea,sa]=a.useState(""),[na,ia]=a.useState(""),[ra,oa]=a.useState([{product:"",bankName:"",tenure:"",roi:"",totalLoan:"",outstanding:"",emi:"",action:""}]),[la,da]=a.useState([!1]),[ca,ma]=a.useState([""]),[ua,ga]=a.useState([!1]),[pa,ya]=a.useState(""),[ha,fa]=a.useState(""),[ba,xa]=a.useState(""),[_a,wa]=a.useState(!1),[va,ja]=a.useState(!1),[Na,ka]=a.useState(!1),[Sa,Ca]=a.useState(""),[La,Aa]=a.useState([]),[Ta,Ia]=a.useState(!1),[Da,Ea]=a.useState(!1),Pa=a.useRef(null);a.useEffect(()=>{const e=Jt(ot)+Jt(dt)+Jt(ut)/(parseInt(pt)||12),t=e*((parseInt(bt)||60)/100);let a=0,s=0;for(const o of ra)a+=Jt(o.emi),s+=Jt(o.outstanding);Ne(Ht(s)),Se(Ht(a));const n=t-a,i=0*e;let r=0;r=s<n?Math.min(n,i):i-s,r=Math.max(r,0),Ct({totalIncome:e,foirAmount:t,totalObligations:a,totalBtPos:s,foirEligibility:n,multiplierEligibility:i,finalEligibility:r}),ia(r>0?"Eligible":"Not Eligible")},[ot,dt,ut,pt,bt,ra]);const Ma=(e,t,a)=>{oa(s=>{const n=[...s];let i=a;"bank"!==t&&"product"!==t&&"action"!==t||"string"==typeof a&&""!==a.trim()&&(i=a.toUpperCase()),n[e]={...n[e],[t]:i},"outstanding"===t&&a&&(n[e].action||(n[e].action="bt"));let r=0,o=0;for(const e of n)r+=Jt(e.outstanding),o+=Jt(e.emi);return Ne(Ht(r)),Se(Ht(o)),n}),Ua()},$a=a.useCallback((()=>{let e;return(...t)=>{clearTimeout(e),e=setTimeout(()=>(async e=>{if(!e||e.trim().length<2)return Aa([]),void Ia(!1);Ea(!0),Aa([]),Ia(!1);try{const t=await(async e=>{try{const t=Yt();if(!t)return[];const a=await fetch(`${Vt}/settings/company-names-from-vakilsearch?company_name=${encodeURIComponent(e)}&user_id=${t}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()||[]}catch(t){return[]}})(e.trim());Array.isArray(t)&&t.length>0?(Aa(t),Ia(!0)):(Aa([]),Ia(!1))}catch(t){Aa([]),Ia(!1)}finally{Ea(!1)}})(...t),300)}})(),[]),Ra=async e=>{$a(e)},Ba=a.useCallback(e=>{const t=e.target.value.toUpperCase();nt(t),Ca(t),Ia(!1),t&&t.trim().length>2&&we()},[we]),Oa=a.useCallback(()=>{we(),Sa.trim().length>0&&Ra(Sa.trim())},[we,Sa,Ra]),Fa=a.useCallback(e=>{const t=e.toUpperCase();nt(t),Ca(t),Ia(!1)},[]);e.filter(e=>(e.name||"").toLowerCase().includes(pa.toLowerCase())),s.filter(e=>(e.name||"").toLowerCase().includes(ha.toLowerCase())),i.filter(e=>(e.name||"").toLowerCase().includes(ba.toLowerCase()));let qa=null;a.useCallback((e,t,a)=>{qa&&clearTimeout(qa),qa=setTimeout(()=>{e&&10===e.length&&a(e,t)},500)},[]);const Ua=()=>{q||U(!0),H&&J(!1)},za=(e,t)=>{const a=e.file_sent_to_login||!1,s=(e.main_status||"").toUpperCase(),n=e.age_days||0,i=e.reassignment_status||"none",r=Xt(),o=!0===t?.can_reassign,l=t?.reassignment_reason||"",d=t?.days_elapsed||0,c=t?.reassignment_period||0,m=t?.days_remaining||0,u=!0===t?.is_manager_permission_required,g={id:e.id,name:e.name,phone:e.phone,email:e.email,status:e.status,sub_status:e.sub_status,loan_type:e.loan_type,created_date:e.created_at,assigned_to:e.assigned_to,assigned_to_name:e.assigned_to_name||e.assigned_to_user?.name||e.assigned_to,created_by:e.created_by,created_by_name:e.created_by_name||"Unknown User",assign_report_to:e.assign_report_to,age_days:n,main_status:s,file_sent_to_login:a,login_department_sent_date:e.login_department_sent_date,reassignment_status:i,has_assign_permission:r,can_reassign:o,reassignment_reason:l,days_elapsed:d,reassignment_period:c,days_remaining:m,is_manager_permission_required:u};if(S(g),!fe)return v(!1),N(!1),void _({exists:!0,message:` This mobile number already exists in the system and is assigned to ${g.assigned_to_name}.`});r?(N(!1),v(!0)):o?(v(!0),N(!1)):(v(!1),N(!0))},Va=async e=>{try{const a=Yt();if(!a)throw new Error("User not authenticated");const s=await fetch(`${Vt}/leads/?user_id=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const e=await s.json();if(e.detail&&Array.isArray(e.detail)){const t=e.detail.map(e=>`${e.loc.join(".")}: ${e.msg} (received: ${e.input})`).join("\n");throw new Error(`Validation errors:\n${t}`)}throw new Error(e.message||e.detail||`HTTP error! status: ${s.status}`)}const n=await s.json();ct.emit("leadCreated",{lead:n,timestamp:Date.now()});try{localStorage.setItem("newLeadCreated",JSON.stringify({lead:n,timestamp:Date.now()}))}catch(t){}return setTimeout(()=>{},100),n}catch(a){throw a}};return{currentDateTime:Ie,productType:Ee,setProductType:Pe,mobileNumber:Me,setMobileNumber:$e,mobileValidationError:Re,setMobileValidationError:Be,handleMobileNumberChange:e=>{const t=e.target.value.replace(/\D/g,"");$e(t),vt.mobileNumber&&jt(e=>({...e,mobileNumber:!1})),(w||j)&&(v(!1),N(!1),S(null),_(null),L(!1)),0===t.length?Be(""):t.length<10?Be("Mobile number must be exactly 10 digits"):t.length>10?Be("Mobile number cannot exceed 10 digits"):/^[6-9]/.test(t)?Be(""):Be("Mobile number must start with 6, 7, 8, or 9"),t&&tt&&t===tt&&at("")},showLeadForm:Oe,campaignName:qe,setCampaignName:Ue,dataCode:ze,setDataCode:Ve,companyCategory:He,setCompanyCategory:Je,assignedTo:Ye,setAssignedTo:We,handleRemoveAssignee:e=>{"object"==typeof e&&"none"===e.id||"string"==typeof e&&"None"===e?We([]):We(t=>t.filter(t=>("object"==typeof t?t.id:t)!==("object"==typeof e?e.id:e)))},handleAddAssignee:e=>{vt.assignedTo&&jt(e=>({...e,assignedTo:!1})),"none"!==e.id&&"None"!==e.name?We(t=>{if(t.some(e=>"object"==typeof e&&"none"===e.id||"string"==typeof e&&"None"===e))return[e];"object"==typeof e&&e.id;const a="object"==typeof e?e.name:e;return t.some(t=>"object"==typeof t&&"object"==typeof e?t.id===e.id:"string"==typeof t&&"string"==typeof e?t===e:("object"==typeof t?t.name:t)===a)?t:[...t,e]}):We([{id:"none",name:"None"}])},showAssignPopup:Ge,setShowAssignPopup:Ke,status:Qe,setStatus:Ze,customerName:Xe,setCustomerName:et,alternateNumber:tt,setAlternateNumber:at,handleAlternateNumberChange:e=>{const t=e.target.value.replace(/[^0-9]/g,"").slice(0,10);if(t&&Me&&t===Me)return e.target.style.borderColor="#ef4444",void setTimeout(()=>{e.target.style.borderColor=""},1e3);at(t)},companyName:st,setCompanyName:nt,companyType:it,setCompanyType:rt,salary:ot,handleSalaryChange:e=>{lt(e),Ua()},partnerSalary:dt,handlePartnerSalaryChange:e=>{mt(e),Ua()},yearlyBonus:ut,handleYearlyBonusChange:e=>{gt(e),Ua()},bonusDivision:pt,handleBonusDivisionChange:e=>{yt(e),Ua()},loanRequired:ht,setLoanRequired:ft,foirPercent:bt,handleFoirPercentChange:e=>{xt(e),Ua()},customFoirPercent:_t,setCustomFoirPercent:wt,eligibility:St,leadFormRef:Pa,handleCheckMobile:async()=>{if(Ee)if(Me&&10===Me.length&&/^\d+$/.test(Me)){le(!0),xe("checkMobileBtn");try{const e=await Kt(Me,Ee);let t=!1;if(e&&e.found){_(e),t=!0;const a=e.leads&&e.leads.length>0?e.leads[0]:null;a&&za(a,e)}else if(tt&&10===tt.length&&/^\d+$/.test(tt)){const e=await Kt(tt,Ee);if(e&&e.found){_(e),t=!0;const a=e.leads&&e.leads.length>0?e.leads[0]:null;a&&za(a,e)}}t||(Fe(!0),U(!1),V(!1),J(!1),setTimeout(()=>{Pa&&Pa.current&&Pa.current.scrollIntoView({behavior:"smooth"})},100))}catch(e){alert("Error checking mobile number. Please try again.")}finally{le(!1)}}else alert("Please enter a valid 10-digit Mobile Number");else alert("Please select a Product Type")},loanTypes:e,campaignNames:s,dataCodes:i,companyCategories:o,assignableUsers:g,loadingLoanTypes:y,loadingSettings:f,mobileCheckResult:x,showReassignmentOption:w,showLeadDetails:j,existingLeadData:k,setShowReassignmentOption:v,setShowLeadDetails:N,setExistingLeadData:S,handleReassignmentRequest:async(e="request")=>{try{const n="object"==typeof e?"request":String(e),i=Yt();if(!i||!k?.id)return void alert("Missing required data for reassignment");if("request"===n){if(k.created_by===i)return void alert("You can't reassign your own lead to yourself.");if(k.assign_report_to&&(k.assign_report_to===i||Array.isArray(k.assign_report_to)&&k.assign_report_to.includes(i)))return void alert("You're already TL of this lead.");if(k.assigned_to&&(k.assigned_to===i||Array.isArray(k.assigned_to)&&k.assigned_to.includes(i)))return void alert("You're already assigned to this lead.")}let r,o,l="POST",d={user_id:i,file_sent_to_login:k.file_sent_to_login||!1,main_status:k.main_status||"",age_days:k.age_days||0};if("request"===n){const e=prompt("Please provide a reason for reassignment:");if(!e)return;d.reason=e,k.is_manager_permission_required?(d.reassignment_status="pending",d.requires_manager_approval=!0,d.requested_at=(new Date).toISOString(),d.requested_by=i,d.activity_type="lead_reassignment_request"):(d.reassignment_status="approved",d.approved_at=(new Date).toISOString(),d.approved_by=i,d.activity_type="lead_reassigned"),d.log_activity=!0,k.is_manager_permission_required?d.activity_description=`Reassignment request submitted for manager approval. Reason: ${e}`:d.activity_description=`Lead directly reassigned to user ${i}. Reason: ${e}`,d.update_lead_fields=!0,d.fields_to_update=[],R&&E&&(d.data_code=E,d.new_data_code=E,d.update_data_code=!0,d.previous_data_code=k.data_code||k.dataCode,d.fields_to_update.push({field:"data_code",old_value:k.data_code||k.dataCode||"",new_value:E})),O&&M&&(d.campaign_name=M,d.new_campaign_name=M,d.update_campaign_name=!0,d.previous_campaign_name=k.campaign_name||k.campaignName,d.fields_to_update.push({field:"campaign_name",old_value:k.campaign_name||k.campaignName||"",new_value:M}))}if("request"===n&&!k.has_assign_permission){if(!k.can_reassign)return void alert(`Cannot request reassignment: ${k.reassignment_reason||"Not eligible"}`);k.is_manager_permission_required&&alert("This lead requires manager approval for reassignment. Your request will be sent to a manager.")}if(!k.has_assign_permission||"approve"!==n&&"reject"!==n)if("request"===n){const e=i;r=`${Vt}/reassignment/request?user_id=${i}&lead_id=${k.id}&target_user_id=${e}&reason=${encodeURIComponent(d.reason)}`,k.is_manager_permission_required?(r+="&reassignment_status=pending",r+="&requires_manager_approval=true",d.activity_description=`Reassignment request submitted for manager approval. Reason: ${d.reason}`):(r+="&reassignment_status=approved",r+=`&approved_at=${encodeURIComponent((new Date).toISOString())}`,r+=`&approved_by=${i}`,d.activity_description=`Lead directly reassigned to user ${i}. Reason: ${d.reason}`),r+="&log_activity=true",r+="&activity_type=lead_reassignment_request",r+=`&activity_description=${encodeURIComponent(d.activity_description)}`,r+="&update_lead_fields=true",r+=`&file_sent_to_login=${k.file_sent_to_login||!1}`,r+=`&main_status=${encodeURIComponent(k.main_status||"")}`,r+=`&age_days=${k.age_days||0}`,r+=`&approved_by=${i}`,R&&E&&(r+=`&data_code=${encodeURIComponent(E)}`),O&&M&&(r+=`&campaign_name=${encodeURIComponent(M)}`)}else{const e=prompt("Please provide a reason for reassignment:");if(!e)return;const t=i;r=`${Vt}/reassignment/request?user_id=${i}&lead_id=${k.id}&target_user_id=${t}&reason=${encodeURIComponent(e)}`}else if(r=`${Vt}/reassignment/${n}/${k.id}?user_id=${i}`,"reject"===n){const e=prompt("Please provide a reason for rejection:");if(!e)return;d.rejection_reason=e}try{if(o=await fetch(r,{method:l,headers:{"Content-Type":"application/json"},body:"POST"===l?JSON.stringify(d):void 0}),!o.ok)throw new Error(`Server returned ${o.status}`)}catch(t){let a=`${Vt}/leads/${k.id}`;!k.has_assign_permission||"approve"!==e&&"reject"!==e?(a+=`/reassign?user_id=${i}`,k.main_status&&(a+=`&main_status=${encodeURIComponent(k.main_status)}`)):a+=`/reassignment/${e}?user_id=${i}`,o=await fetch(a,{method:l,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})}if(200===o.status||201===o.status){if(await o.json(),"request"===n&&(R||O))try{const e={lead_id:k.id,user_id:i,updates:{}};R&&E&&(e.updates.data_code=E,e.updates.dataCode=E),O&&M&&(e.updates.campaign_name=M,e.updates.campaignName=M),(await fetch(`${Vt}/reassignment/leads/${k.id}/update-fields?user_id=${i}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.updates)})).ok}catch(a){}if("request"===n)try{const e={lead_id:k.id,user_id:i,activity_type:"lead_reassigned",activity_title:"Lead Reassigned",activity_description:`Lead reassigned to user ${i}`,details:{reason:d.reason||"Direct reassignment",previous_owner:k.created_by_name||k.assigned_to_name||"Unknown",new_owner:i,reassignment_status:"approved",timestamp:(new Date).toISOString()}};R&&E&&(e.details.data_code_changed={from:k.data_code||k.dataCode||"Unknown",to:E},e.activity_description+=` | Data Code changed from "${k.data_code||k.dataCode||"Unknown"}" to "${E}"`),O&&M&&(e.details.campaign_name_changed={from:k.campaign_name||k.campaignName||"Unknown",to:M},e.activity_description+=` | Campaign Name changed from "${k.campaign_name||k.campaignName||"Unknown"}" to "${M}"`),(await fetch(`${Vt}/reassignment/leads/${k.id}/activity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok}catch(s){}if("approve"===n?(alert("Lead reassignment approved successfully!"),window.location.reload()):"reject"===n?(alert("Lead reassignment rejected."),window.location.reload()):k.is_manager_permission_required?(alert("Reassignment request sent for manager approval successfully!"),window.location.reload()):(k.has_assign_permission?alert("Lead assigned to you successfully!"):alert("Lead reassigned successfully!"),window.location.reload()),v(!1),N(!1),_(null),k&&!k.is_manager_permission_required){$e(k.mobile_number||k.mobileNumber||""),et(k.name||k.customer_name||k.customerName||""),at(k.alternate_number||k.alternateNumber||""),nt(k.company_name||k.companyName||""),rt(k.company_type||k.companyType||""),Je(k.company_category||k.companyCategory||""),lt(k.salary?Ht(k.salary.toString()):""),mt(k.partner_salary||k.partnerSalary?Ht((k.partner_salary||k.partnerSalary).toString()):""),gt(k.yearly_bonus||k.yearlyBonus?Ht((k.yearly_bonus||k.yearlyBonus).toString()):""),yt(k.bonus_division||k.bonusDivision||"12"),ft(k.loan_required||k.loanRequired?Ht((k.loan_required||k.loanRequired).toString()):""),xt(k.foir_percent||k.foirPercent||"60"),Ue(k.campaign_name||k.campaignName||""),Ve(k.data_code||k.dataCode||""),Pe(k.product_type||k.productType||""),Ze(k.status||"not_a_lead"),k.obligations&&Array.isArray(k.obligations)&&oa(k.obligations.map(e=>({product:e.product||"",bankName:e.bank_name||e.bankName||"",currentPos:e.current_pos||e.currentPos||"",monthlyEmi:e.monthly_emi||e.monthlyEmi||"",btPercent:e.bt_percent||e.btPercent||"0",btPos:e.bt_pos||e.btPos||"",bounceHistory:e.bounce_history||e.bounceHistory||"no"}))),k.assigned_to&&(Array.isArray(k.assigned_to)?We(k.assigned_to):We([k.assigned_to]));const e={leadInfo:{mobile_number:k.mobile_number||k.mobileNumber||"",customer_name:k.name||k.customer_name||k.customerName||"",alternate_number:k.alternate_number||k.alternateNumber||"",company_name:k.company_name||k.companyName||"",company_type:k.company_type||k.companyType||"",company_category:k.company_category||k.companyCategory||"",salary:k.salary||"",partner_salary:k.partner_salary||k.partnerSalary||"",yearly_bonus:k.yearly_bonus||k.yearlyBonus||"",bonus_division:k.bonus_division||k.bonusDivision||"12",loan_required:k.loan_required||k.loanRequired||"",foir_percent:k.foir_percent||k.foirPercent||"60",campaign_name:k.campaign_name||k.campaignName||"",data_code:k.data_code||k.dataCode||"",product_type:k.product_type||k.productType||"",status:k.status||"not_a_lead",lastUpdated:(new Date).toISOString()}};Ut(e.leadInfo)}else k&&k.is_manager_permission_required;S(null),Fe(!0),B(!1),F(!1),P(""),$(""),D(""),U(!1),V(!1),J(!1)}else if(403===o.status){const e=await o.json();k.has_assign_permission?alert(e.message||`You don't have permission to ${n} this reassignment request.`):alert(e.message||"This lead is not eligible for reassignment yet. Please try again later.")}else if(404===o.status)alert("Lead not found. It may have been deleted or moved.");else{if(409!==o.status)throw new Error(`HTTP error! status: ${o.status}`);{const e=await o.json();alert(e.message||"This lead already has a pending reassignment request.")}}}catch(t){alert(`Error during reassignment ${actionString}: `+(t.message||"Please try again."))}},handleReassignmentCancel:()=>{alert("Warning: Your request reassignment got cancelled because you didn't enter a reason"),L(!0),v(!1),N(!1),S(null),_(null),B(!1),F(!1),P(""),$(""),D(""),$e(""),Be("")},handleCompanyCategoryChange:e=>{Je(e),At(e)},obligations:ra,handleObligationChange:Ma,handleAddObligation:()=>{oa(e=>[...e,{product:"",bankName:"",tenure:"",roi:"",totalLoan:"",outstanding:"",emi:"",action:""}]),da(e=>[...e,!1]),ma(e=>[...e,""]),ga(e=>[...e,!1]),Ua()},handleDeleteObligation:e=>{oa(t=>{const a=t.filter((t,a)=>a!==e),s=0===a.length?[{product:"",bankName:"",tenure:"",roi:"",totalLoan:"",outstanding:"",emi:"",action:""}]:a;let n=0,i=0;for(const e of s)n+=Jt(e.outstanding),i+=Jt(e.emi);return Ne(Ht(n)),Se(Ht(i)),s}),da(t=>t.filter((t,a)=>a!==e)),ma(t=>t.filter((t,a)=>a!==e)),ga(t=>t.filter((t,a)=>a!==e)),Ua()},bankList:m,bankDropdowns:la,setBankDropdowns:da,bankFilters:ca,handleBankDropdown:(e,t)=>{t&&_e(),da(a=>a.map((a,s)=>s===e&&t))},handleBankFilterChange:(e,t)=>{ma(a=>a.map((a,s)=>s===e?t:a)),Ma(e,"bankName",t)},handleBankSelect:(e,t)=>{Ma(e,"bankName",t),da(t=>t.map((t,a)=>a!==e&&t)),ma(a=>a.map((a,s)=>s===e?t:a))},productTypes:Ae,productDropdowns:ua,setProductDropdowns:ga,handleProductDropdown:(e,t)=>{ga(a=>a.map((a,s)=>s===e&&t))},handleProductSelect:(e,t)=>{Ma(e,"product",t),ga(t=>t.map((t,a)=>a!==e&&t))},totalBtPos:je,totalObligation:ke,cibilScore:Ce,setCibilScore:Le,actionTypes:Te,companySearch:Sa,companySuggestions:La,showCompanySuggestions:Ta,isCompanyLoading:Da,handleCompanyInputChange:Ba,handleCompanySearchClick:Oa,handleCompanySuggestionClick:Fa,setShowCompanySuggestions:Ia,setCompanySuggestions:Aa,companyTypes:d,statusOptions:[{value:"not_a_lead",label:"Not A Lead"},{value:"lead",label:"Lead"}],bonusDivisions:[{value:"3",label:"3"},{value:"6",label:"6"},{value:"12",label:"12"},{value:"24",label:"24"}],foirPercents:[{value:"50",label:"50%"},{value:"55",label:"55%"},{value:"60",label:"60%"},{value:"65",label:"65%"},{value:"70",label:"70%"}],ceCompanyCategory:Lt,handleCeCompanyCategoryChange:e=>At(e.target.value),ceFoirPercent:Tt,handleCeFoirPercentChange:e=>It(e.target.value),ceCustomFoirPercent:Dt,setCeCustomFoirPercent:Et,ceTenureMonths:Pt,handleCeTenureMonthsChange:e=>{Mt(e.target.value.replace(/[^0-9]/g,"")),Rt(e.target.value?(parseInt(e.target.value)/12).toFixed(2):"")},ceTenureYears:$t,handleCeTenureYearsChange:e=>{Rt(e.target.value.replace(/[^0-9.]/g,"")),Mt(e.target.value?Math.round(12*parseFloat(e.target.value)).toString():"")},ceRoi:Ot,handleCeRoiChange:e=>zt(e.target.value.replace(/[^0-9.]/g,"")),ceMonthlyEmiCanPay:Qt,handleCeMonthlyEmiCanPayChange:e=>Zt(e.target.value.replace(/[^0-9.]/g,"")),ceMultiplier:ea,handleCeMultiplierChange:e=>{let t=e.target.value.replace(/[^0-9]/g,"");""===t?t="":parseInt(t)>35&&(t="35"),sa(t)},loanEligibilityStatus:na,checkEligibilityCompanyCategories:[{value:"super_cat_a",label:"Super CAT A"},{value:"cat_a",label:"CAT A"},{value:"cat_b",label:"CAT B"},{value:"cat_c",label:"CAT C"},{value:"unlisted",label:"UNLISTED or MANNUAL FILE"}],formatINR:Ht,parseINR:Jt,obligationHasUnsavedChanges:q,obligationIsSaving:z,obligationDataSaved:H,handleObligationDataUpdate:e=>{e&&(U(e.hasUnsavedChanges||!1),V(e.isSaving||!1),!1===e.hasUnsavedChanges&&!1===e.isSaving&&J(!0))},handleSaveObligationData:()=>{V(!0);try{J(!0),U(!1),alert("Obligation data saved successfully!")}catch(e){alert("Error saving obligation data. Please try again.")}finally{V(!1)}},handleClearObligationChanges:()=>{U(!1),J(!1)},isPersonalSectionComplete:()=>Ee&&Me&&10===Me.length&&/^[6-9]/.test(Me)&&Xe&&Xe.trim()&&qe&&Qe,hasAnyObligationData:()=>{const e=Ft().obligation||{};return e.salary||e.partnerSalary||e.yearlyBonus||e.obligations?.length>0||e.processingBank||ot||dt||ut||ra?.length>0},isCreateLeadEnabled:()=>!0,showReassignmentModal:A,setShowReassignmentModal:T,reassignmentReason:I,setReassignmentReason:D,newDataCode:E,setNewDataCode:P,newCampaignName:M,setNewCampaignName:$,changeDataCode:R,setChangeDataCode:B,changeCampaignName:O,setChangeCampaignName:F,createLead:Va,handleSubmit:async()=>{if(!ta())return alert(" PERMISSION DENIED\n\nYou do not have permission to create leads.\n\nThe 'Add' permission is required in the 'Create LEAD' section.\n\nPlease contact your administrator to request access."),void ce(!1);if((()=>{const e={productType:!Ee,mobileNumber:!Me||10!==Me.length||!/^[6-9]/.test(Me),customerName:!Xe||!Xe.trim(),campaignName:!qe,status:!Qe,assignedTo:!Ye||0===Ye.length};return jt(e),kt(!0),!Object.values(e).some(e=>e)})()){ce(!0),xe("createLeadBtn");try{if(z)return alert(" Please wait for the obligation data to finish saving before creating the lead."),void ce(!1);if(tt&&tt===Me)return alert(" INVALID ALTERNATE NUMBER!\n\nThe alternate mobile number must be different from the main mobile number.\n\nPlease:\n1. Change the alternate number to a different number\n2. Or remove the alternate number if not needed\n3. Then create the lead again\n\nLead creation has been cancelled."),void ce(!1);(()=>{try{if("undefined"!=typeof window&&window.localStorage){const e=localStorage.getItem("userData");if(e){const t=JSON.parse(e);return!t.department_id||"undefined"!==t.department_id&&"null"!==t.department_id&&"default_department_id"!==t.department_id&&"68529a2e8d7cdc3a71c482a0"!==t.department_id&&""!==t.department_id.trim()||delete t.department_id,void(window.currentUserData=t)}const t=localStorage.getItem("user");if(t){const e=JSON.parse(t);return!e.department_id||"undefined"!==e.department_id&&"null"!==e.department_id&&"default_department_id"!==e.department_id&&"68529a2e8d7cdc3a71c482a0"!==e.department_id&&""!==e.department_id.trim()||delete e.department_id,void(window.currentUserData=e)}const a=localStorage.getItem("userId");if(a){const e=localStorage.getItem("department_id"),t=e&&"undefined"!==e&&"null"!==e&&"default_department_id"!==e&&""!==e.trim();return void(window.currentUserData={user_id:a,id:a,...t?{department_id:e}:{}})}}}catch(e){}window.currentUserData={user_id:"default_user",id:"default_user"}})();const n={productType:Ee,mobileNumber:Me,customerName:Xe,alternateNumber:tt,companyName:st,companyType:it,companyCategory:He,campaignName:qe,dataCode:ze,status:Qe,assignedTo:Ye,loanRequired:ht,selectedLoanTypeId:e.find(e=>e.name===Ee)?._id||e.find(e=>e.name===Ee)?.id||"",assignedToIds:Ye.map(e=>{if("object"==typeof e)return"none"===e.id?"none":e.id||e._id||e.user_id||"";{if("None"===e||"none"===e)return"none";const t=g.find(t=>t.name===e||t.full_name===e||`${t.first_name} ${t.last_name}`.trim()===e);return t?.id||t?._id||t?.user_id||""}}).filter(e=>e&&""!==e),assignReportTo:Ye.map(e=>{if("object"==typeof e&&"none"===e.id||"string"==typeof e&&("None"===e||"none"===e))return"";let t;return t="object"==typeof e?e:g.find(t=>t.name===e||t.full_name===e||`${t.first_name} ${t.last_name}`.trim()===e),t?.supervisor_id||t?.manager_id||t?.report_to||""}).filter(e=>e),eligibility:St};if(Ut(n),!(()=>{const e=Ft();return e.leadInfo&&e.leadInfo.productType&&e.leadInfo.mobileNumber&&e.leadInfo.customerName})()){const t={productType:Ee,mobileNumber:Me,customerName:Xe,alternateNumber:tt,companyName:st,companyType:it,companyCategory:He,campaignName:qe,dataCode:ze,status:Qe,assignedTo:Ye,loanRequired:ht,selectedLoanTypeId:e.find(e=>e.name===Ee)?._id||e.find(e=>e.name===Ee)?.id||"",assignedToIds:Ye.map(e=>"object"==typeof e?"none"===e.id?"none":e.id||e._id||e.user_id||"":"None"===e||"none"===e?"none":e).filter(e=>e&&""!==e),eligibility:St};Ut(t)}const i=Ft().obligation||{},r=((e,t=null)=>{const a=Ft(),s=a.leadInfo||{},n=a.obligation||{};let i=n;!t||n.salary&&n.obligations||(i={salary:t.salary||n.salary,partnerSalary:t.partnerSalary||n.partnerSalary,yearlyBonus:t.yearlyBonus||n.yearlyBonus,bonusDivision:t.bonusDivision||n.bonusDivision,foirPercent:t.foirPercent||n.foirPercent,customFoirPercent:t.customFoirPercent||n.customFoirPercent,obligations:t.obligations||n.obligations,loanRequired:t.loanRequired||n.loanRequired,companyName:t.companyName||n.companyName,companyType:t.companyType||n.companyType,companyCategory:t.companyCategory||n.companyCategory,cibilScore:t.cibilScore||n.cibilScore,totalBtPos:t.totalBtPos||n.totalBtPos,totalObligation:t.totalObligation||n.totalObligation,eligibility:t.eligibility||n.eligibility,ceCompanyCategory:t.ceCompanyCategory||n.ceCompanyCategory,ceFoirPercent:t.ceFoirPercent||n.ceFoirPercent,ceCustomFoirPercent:t.ceCustomFoirPercent||n.ceCustomFoirPercent,ceMonthlyEmiCanPay:t.ceMonthlyEmiCanPay||n.ceMonthlyEmiCanPay,ceTenureMonths:t.ceTenureMonths||n.ceTenureMonths,ceTenureYears:t.ceTenureYears||n.ceTenureYears,ceRoi:t.ceRoi||n.ceRoi,ceMultiplier:t.ceMultiplier||n.ceMultiplier,loanEligibilityStatus:t.loanEligibilityStatus||n.loanEligibilityStatus,processingBank:t.processingBank||n.processingBank});const r=window.currentUserData||null;let o=null;if(r)try{o="string"==typeof r?JSON.parse(r):r}catch(x){}const l=(s.customerName||"").trim().split(" "),d=l[0]||"",c=l.slice(1).join(" ")||"";let m=s.companyCategory||n.companyCategory||"";Array.isArray(m)&&(m=m.length>0?m[0]:"");let u=s.companyType||i.companyType||"";Array.isArray(u)?u=u.length>0?u[0].value||u[0].label||u[0]:"":"object"==typeof u&&null!==u&&(u=u.value||u.label||""),u=String(u);const g=Bt(i.loanRequired)?e(i.loanRequired):Bt(s.loanRequired)?e(s.loanRequired):0;let p=[],y=[];s.assignedToIds&&Array.isArray(s.assignedToIds)?p=s.assignedToIds.filter(Boolean).map(String):Array.isArray(s.assignedTo)?p=s.assignedTo.filter(Boolean).map(e=>String("object"==typeof e?e.id||e._id||e.user_id||"":e)).filter(e=>e):s.assignedTo&&(p=[String(s.assignedTo)]),Array.isArray(s.assignReportTo)?y=s.assignReportTo.filter(Boolean).map(String):s.assignReportTo&&(y=[String(s.assignReportTo)]);let h=0,f=0,b=0;if(s.eligibility&&"object"==typeof s.eligibility)h=s.eligibility.finalEligibility||0,f=s.eligibility.totalObligations||0,b=s.eligibility.totalBtPos||0;else if(i.eligibility&&"object"==typeof i.eligibility)h=e(i.eligibility.finalEligibility)||0,f=e(i.eligibility.totalObligations)||e(i.totalObligation)||0,b=e(i.eligibility.totalBtPos)||e(i.totalBtPos)||0;else if(i.totalBtPos||i.totalObligation){f=e(i.totalObligation)||0,b=e(i.totalBtPos)||0;const t=i.salary?e(i.salary):0,a=i.partnerSalary?e(i.partnerSalary):0,s=i.yearlyBonus?e(i.yearlyBonus):0,n=parseInt(i.bonusDivision)||12,r="custom"===i.foirPercent?parseInt(i.customFoirPercent||"60"):parseInt(i.foirPercent||"60");if(t>0||a>0){const e=t+a+s/n,i=e*(r/100)-f,o=0*e;h=b<i?Math.min(i,o):o-b,h=Math.max(h,0)}}else{const t=(i.salary?e(i.salary):0)+(i.partnerSalary?e(i.partnerSalary):0)+(i.yearlyBonus?e(i.yearlyBonus):0)/(parseInt(i.bonusDivision)||12),a=t*(("custom"===i.foirPercent?parseInt(i.customFoirPercent||"60"):parseInt(i.foirPercent||"60"))/100);if(f=0,b=0,i.obligations&&Array.isArray(i.obligations))for(const r of i.obligations)f+=r.emi?e(r.emi):0,b+=r.outstanding?e(r.outstanding):0;const s=a-f,n=0*t;h=b<s?Math.min(s,n):n-b,h=Math.max(h,0)}return{loan_type:s.productType||"",loan_type_name:s.productType||"",loan_type_id:s.selectedLoanTypeId||"",mobile_number:s.mobileNumber||"",alternative_phone:s.alternateNumber||"",first_name:d,last_name:c,status:"lead"===s.status?"ACTIVE LEADS":"not_a_lead"===s.status?"NOT A LEAD":(s.status||"").toUpperCase(),sub_status:"lead"===s.status?"NEW LEAD":"not_a_lead"===s.status?"NOT A LEAD":(s.status||"").toUpperCase(),campaign_name:s.campaignName||"",data_code:s.dataCode||"",processing_bank:s.processingBank||i.processingBank||(Array.isArray(i.companyType)&&i.companyType.length>0?i.companyType[i.companyType.length-1]:"")||i.decideBankForCase||"",assign_report_to:p,assigned_to:o?.user_id,created_by:o?.user_id||o?.id||"",department_id:o?.department_id||"",loan_amount:g,created_date:(new Date).toISOString(),dynamic_fields:{address:{pincode:String(s.pincode||""),city:String(s.city||"")},personal_details:{company_name:String(s.companyName||i.companyName||""),company_type:String(u),company_category:String(m)},financial_details:{monthly_income:Bt(i.salary)?e(i.salary):0,partner_salary:Bt(i.partnerSalary)?e(i.partnerSalary):0,yearly_bonus:Bt(i.yearlyBonus)?e(i.yearlyBonus):0,bonus_division:i.bonusDivision?parseInt(i.bonusDivision):12,foir_percent:"custom"===i.foirPercent?parseInt(i.customFoirPercent||"60"):parseInt(i.foirPercent||"60"),cibil_score:String(i.cibilScore||"")},obligations:(i.obligations||[]).map(t=>({product:String(t.product||""),bank_name:String(t.bankName||t.bank_name||""),bankName:String(t.bankName||t.bank_name||""),tenure:t.tenure?parseInt(t.tenure):0,roi:t.roi?parseFloat(t.roi):0,total_loan:Bt(t.totalLoan)?e(t.totalLoan):0,totalLoan:Bt(t.totalLoan)?e(t.totalLoan):0,outstanding:Bt(t.outstanding)?e(t.outstanding):0,emi:Bt(t.emi)?e(t.emi):0,action:String(t.action||"")})),important_questions:s.question_responses||s.importantquestion||a.question_responses||{},check_eligibility:{company_category:String(i.ceCompanyCategory||""),foir_percent:parseInt(i.ceFoirPercent||"60"),custom_foir_percent:String(i.ceCustomFoirPercent||""),monthly_emi_can_pay:parseFloat(i.ceMonthlyEmiCanPay||"0"),tenure_months:String(i.ceTenureMonths||""),tenure_years:String(i.ceTenureYears||""),roi:String(i.ceRoi||""),multiplier:parseInt(i.ceMultiplier||"0"),loan_eligibility_status:String(i.loanEligibilityStatus||"Not Eligible")},process:{how_to_process:"None",case_type:"Normal"},eligibility_details:i.eligibility?{totalIncome:String(i.eligibility.totalIncome||0),foirAmount:String(i.eligibility.foirAmount||0),totalObligations:String(i.eligibility.totalObligations||0),totalBtPos:String(i.eligibility.totalBtPos||0),finalEligibility:String(i.eligibility.finalEligibility||0),multiplierEligibility:String(i.eligibility.multiplierEligibility||0),foirEligibility:String(i.eligibility.foirEligibility||0)}:{totalIncome:"0",foirAmount:"0",totalObligations:"0",totalBtPos:"0",finalEligibility:"0",multiplierEligibility:"0",foirEligibility:"0"}}}})(Jt,{salary:ot,partnerSalary:dt,yearlyBonus:ut,bonusDivision:pt,foirPercent:bt,customFoirPercent:_t||void 0,obligations:ra,loanRequired:ht,companyName:st,companyType:String(it||""),companyCategory:He,cibilScore:Ce,totalBtPos:je||void 0,totalObligation:ke||void 0,eligibility:St||void 0,ceCompanyCategory:Lt||void 0,ceFoirPercent:Tt||void 0,ceCustomFoirPercent:Dt||void 0,ceMonthlyEmiCanPay:Qt||void 0,ceTenureMonths:Pt||void 0,ceTenureYears:$t||void 0,ceRoi:Ot||void 0,ceMultiplier:ea||void 0,loanEligibilityStatus:na||void 0,processingBank:i.processingBank||void 0});r.loan_type||(r.loan_type=Ee),r.loan_type_name||(r.loan_type_name=Ee);const o=[];if(r.first_name&&""!==r.first_name.trim()||o.push("Customer name is required"),r.mobile_number&&10===r.mobile_number.length||o.push("Valid 10-digit mobile number is required"),r.loan_type&&""!==r.loan_type.trim()||o.push("Product type is required"),r.campaign_name&&""!==r.campaign_name.trim()||o.push("Campaign name is required"),r.status&&""!==r.status.trim()||o.push("Status is required"),o.length>0)throw new Error("Validation failed:\n"+o.join("\n"));r.dynamic_fields?.personal_details?.company_type&&"string"!=typeof r.dynamic_fields.personal_details.company_type&&(r.dynamic_fields.personal_details.company_type=String(r.dynamic_fields.personal_details.company_type)),r.dynamic_fields?.personal_details?.company_category&&"string"!=typeof r.dynamic_fields.personal_details.company_category&&(r.dynamic_fields.personal_details.company_category=String(r.dynamic_fields.personal_details.company_category)),r.dynamic_fields.process||(r.dynamic_fields.process={how_to_process:"None",case_type:"Normal",year:(new Date).getFullYear().toString()}),r.loan_amount=parseInt(r.loan_amount)||0,r.dynamic_fields.financial_details.monthly_income=parseInt(r.dynamic_fields.financial_details.monthly_income)||0,r.dynamic_fields.financial_details.partner_salary=parseInt(r.dynamic_fields.financial_details.partner_salary)||0,r.dynamic_fields.financial_details.yearly_bonus=parseInt(r.dynamic_fields.financial_details.yearly_bonus)||0,r.dynamic_fields.obligations&&Array.isArray(r.dynamic_fields.obligations)&&(r.dynamic_fields.obligations=r.dynamic_fields.obligations.map(e=>({...e,tenure:parseInt(e.tenure)||0,roi:parseFloat(e.roi)||0,total_loan:parseInt(e.total_loan)||0,outstanding:parseInt(e.outstanding)||0,emi:parseInt(e.emi)||0}))),await Va(r);try{qt(),"undefined"!=typeof window&&["temp_lead_info","temp_lead_obligations","temp_lead_data","current_lead_info"].forEach(e=>{try{localStorage.removeItem(e)}catch(t){}})}catch(t){}alert("Lead created successfully!");try{const e={productType:"",mobileNumber:"",customerName:"",alternateNumber:"",companyName:"",companyType:"",campaignName:"",dataCode:"",status:"not_a_lead",assignedTo:[],salary:"",partnerSalary:"",yearlyBonus:"",bonusDivision:"12",loanRequired:"",foirPercent:"60",companyCategory:"",cibilScore:"",totalBtPos:"0",totalObligation:"0",companySearch:"",ceCompanyCategory:"",ceFoirPercent:"",ceTenureMonths:"",ceTenureYears:"",ceRoi:"",ceMonthlyEmiCanPay:"",ceMultiplier:"",obligations:[{product:"",bankName:"",tenure:"",roi:"",totalLoan:"",outstanding:"",emi:"",action:""}]};Pe(e.productType),$e(e.mobileNumber),Be(""),et(e.customerName),at(e.alternateNumber),nt(e.companyName),rt(e.companyType),Ue(e.campaignName),Ve(e.dataCode),Ze(e.status),We(e.assignedTo),lt(e.salary),mt(e.partnerSalary),gt(e.yearlyBonus),yt(e.bonusDivision),ft(e.loanRequired),xt(e.foirPercent),Je(e.companyCategory),Le(e.cibilScore),oa(e.obligations),da([!1]),ma([""]),ga([!1]),At(e.ceCompanyCategory),It(e.ceFoirPercent),Mt(e.ceTenureMonths),Rt(e.ceTenureYears),zt(e.ceRoi),Zt(e.ceMonthlyEmiCanPay),sa(e.ceMultiplier),Ne(e.totalBtPos),Se(e.totalObligation),Ca(e.companySearch),Aa([]),Ia(!1),U(!1),V(!1),J(!1),Fe(!1)}catch(a){try{Pe(""),$e(""),Be(""),et(""),Fe(!1)}catch(s){}}}catch(n){if(alert("Error creating lead: "+n.message),confirm("Error creating lead. Would you like to clear the form and start over?"))try{qt(),Pe(""),$e(""),Be(""),et(""),Fe(!1)}catch(i){alert("Could not reset the form. Please refresh the page to start over.")}}finally{ce(!1)}}else kt(!0)},formValidationErrors:vt,setFormValidationErrors:jt,showValidationErrors:Nt,setShowValidationErrors:kt,checkMobileLoading:oe,createLeadLoading:de,reassignmentActionLoading:me,setReassignmentActionLoading:ue,buttonAnimations:ge,animateButton:xe,backgroundDataLoaded:ie,bankListLoaded:X,companyDataLoaded:te,assignableUsersLoaded:se,hasAddLeadPermission:ye,hasReassignmentPopupPermission:fe}}const Zt=()=>{try{const t=localStorage.getItem("userPermissions");if(!t)return!1;let a;try{a=JSON.parse(t)}catch(e){a=t}if("object"==typeof a&&!Array.isArray(a)){if("*"===a.pages&&"*"===a.actions||"*"===a.Global||"*"===a.global||"*"===a["*"])return!0;if(!0===a.superadmin||!0===a.isSuperAdmin||!0===a.is_superadmin||!0===a.is_super_admin||!0===a.super_admin||"superadmin"===a.role||"super_admin"===a.role||"superadmin"===a.user_type||"super_admin"===a.user_type||"super"===a.admin_type)return!0;if("admin"===a.role&&!0===a.full_access||"admin"===a.user_type&&!0===a.full_access)return!0;const e=a["page.*"]||a["page *"],t=a["action.*"]||a["action *"];if(e&&t)return!0}if(Array.isArray(a)){if(a.includes("superadmin")||a.includes("super_admin")||a.includes("admin.super"))return!0;const e=a.some(e=>"string"==typeof e&&("page.*"===e||"page *"===e||"*"===e||"all"===e)),t=a.some(e=>"string"==typeof e&&("action.*"===e||"action *"===e||"*"===e||"all"===e));if(e&&t)return!0}if("string"==typeof a){const e=a.toLowerCase();return e.includes("superadmin")||e.includes("super admin")||e.includes("admin:super")||e.includes("admin:*")}return!1}catch(t){return!1}},Xt=()=>{try{if(Zt())return!0;const t=localStorage.getItem("user");if(t)try{const e=JSON.parse(t);if(e.role?.name&&e.role.name.toLowerCase().includes("super admin"))return!0;if(e.role?.permissions&&Array.isArray(e.role.permissions)){const t=e.role.permissions.find(e=>"leads"===e.page);if(t&&t.actions&&Array.isArray(t.actions))return t.actions.includes("assign")}}catch(e){}const a=localStorage.getItem("userPermissions");if(!a)return!1;let s;try{s=JSON.parse(a)}catch(e){s=a}if("object"==typeof s&&!Array.isArray(s)){if("*"===s.pages&&"*"===s.actions||"*"===s.Leads||"*"===s.leads||"*"===s.Global||"*"===s.global||"*"===s["*"])return!0;if("assign_manager"===s.role||"assign_admin"===s.role||"assign_manager"===s.user_type||!0===s.can_assign||!0===s.assign_permission)return!0;if(s.leads&&"object"==typeof s.leads&&!0===s.leads.assign)return!0;if(s.lead&&"object"==typeof s.lead&&!0===s.lead.assign)return!0;if(!0===s.assign_leads)return!0;if((Array.isArray(s.actions)||Array.isArray(s.permissions))&&(Array.isArray(s.actions)?s.actions:s.permissions).some(e=>"string"==typeof e&&e.includes("assign")&&(e.includes("lead")||"assign"===e)))return!0}if(Array.isArray(s))return s.some(e=>"string"==typeof e&&("leads.assign"===e||"lead.assign"===e||"assign_leads"===e||"leads:assign"===e||"lead:assign"===e||"assign"===e||e.includes("assign_lead")));if("string"==typeof s){const e=s.toLowerCase();return e.includes("assign_leads")||e.includes("leads.assign")||e.includes("lead.assign")||e.includes("assign:leads")}return!1}catch(t){return!1}},ea=e=>{try{if(!e)return!1;if("string"==typeof e){const t=e.toLowerCase();return!!(t.includes("page * and action *")||t.includes("page leads and action assign")||t.includes("page:* and action:*")||t.includes("page=* and action=*")||t.includes("page*action*")||t.includes("page:leads and action:assign")||t.includes("page=leads and action=assign")||t.includes("leads:assign")||t.includes("leads.assign")||t.includes("leads assign")||"*"===t||"all"===t||"admin"===t||"superadmin"===t||t.includes("reassignment")&&(t.includes("approve")||t.includes("*")))}let a;try{a="object"==typeof e?e:JSON.parse(e)}catch(t){return!1}if("*"===a.pages&&"*"===a.actions||"*"===a.Leads||"*"===a.leads||"*"===a.Global||"*"===a.global||"*"===a["*"])return!0;if("*"===a.page&&"*"===a.action||"*"===a.pages&&"*"===a.actions)return!0;if("leads"===a.page&&"assign"===a.action||"leads"===a.pages&&"assign"===a.actions||a.leads&&(!0===a.leads.assign||"*"===a.leads)||a.Leads&&(!0===a.Leads.assign||"*"===a.Leads)||a.reassignment&&(!0===a.reassignment.approve||"*"===a.reassignment))return!0;if(Array.isArray(a)){const e=a.some(e=>{if("string"==typeof e){const t=e.toLowerCase();return t.includes("*")||"page * and action *"===t||"all"===t||"admin"===t||"superadmin"===t}return"object"==typeof e&&("*"===e.page&&"*"===e.action||"*"===e.pages&&"*"===e.actions)}),t=a.some(e=>{if("string"==typeof e){const t=e.toLowerCase();return t.includes("page leads and action assign")||t.includes("leads")&&t.includes("assign")||"leads.assign"===t||"leads:assign"===t}return"object"==typeof e&&("leads"===e.page&&"assign"===e.action||"leads"===e.pages&&"assign"===e.actions)});if(e||t)return!0}return!1}catch(a){return!1}},ta=()=>{try{if(Zt())return!0;const t=localStorage.getItem("user");if(t)try{const e=JSON.parse(t);if(e.role?.name&&e.role.name.toLowerCase().includes("super admin"))return!0;if(e.role?.permissions&&Array.isArray(e.role.permissions)){const t=e.role.permissions.find(e=>"leads.create_lead"===e.page||"leads_create_lead"===e.page);if(t&&t.actions){if((Array.isArray(t.actions)?t.actions:[t.actions]).includes("add"))return!0}const a=e.role.permissions.find(e=>"leads"===e.page);if(a&&a.actions){if((Array.isArray(a.actions)?a.actions:[a.actions]).includes("add"))return!0}}}catch(e){}const a=localStorage.getItem("userPermissions");if(a)try{const e=JSON.parse(a);if("*"===e["*"]||"*"===e.leads||"*"===e.Leads)return!0;if(e.leads&&Array.isArray(e.leads)&&e.leads.includes("add"))return!0;if(e["leads.create_lead"]&&Array.isArray(e["leads.create_lead"])&&e["leads.create_lead"].includes("add"))return!0}catch(e){}return!1}catch(t){return!1}},aa=()=>{try{if(Zt())return!0;const t=localStorage.getItem("user");if(t)try{const e=JSON.parse(t);if(e.role?.name&&e.role.name.toLowerCase().includes("super admin"))return!0;if(e.role?.permissions&&Array.isArray(e.role.permissions)){const t=e.role.permissions.find(e=>"leads.create_lead"===e.page||"leads_create_lead"===e.page);if(t&&t.actions){if((Array.isArray(t.actions)?t.actions:[t.actions]).includes("reassignment_popup"))return!0}const a=e.role.permissions.find(e=>"leads"===e.page);if(a&&a.actions){if((Array.isArray(a.actions)?a.actions:[a.actions]).includes("reassignment_popup"))return!0}}}catch(e){}const a=localStorage.getItem("userPermissions");if(a)try{const e=JSON.parse(a);if("*"===e["*"]||"*"===e.leads||"*"===e.Leads)return!0;if(e.leads&&Array.isArray(e.leads)&&e.leads.includes("reassignment_popup"))return!0;if(e["leads.create_lead"]&&Array.isArray(e["leads.create_lead"])&&e["leads.create_lead"].includes("reassignment_popup"))return!0}catch(e){}return!1}catch(t){return!1}};function sa({reassignmentActionLoading:e,setReassignmentActionLoading:s,buttonAnimations:n,animateButton:i}){const[r,o]=a.useState([]),[l,d]=a.useState(!0),[c,m]=a.useState(null),[u,g]=a.useState(null),[p,y]=a.useState(!1),[h,f]=a.useState("all"),[b,x]=a.useState({assign:!1,superAdmin:!1});a.useEffect(()=>{try{const t=localStorage.getItem("userPermissions");try{JSON.parse(t)}catch(e){}const a=Zt(),s=Xt(),n=ea(t);x({assign:s||n,superAdmin:a});try{JSON.parse(localStorage.getItem("user")||"{}")}catch(e){}}catch(t){}},[]);const _=localStorage.getItem("userPermissions"),w=_&&(_.includes("page * and action *")||_.includes("page leads and action assign"))||b.assign||b.superAdmin||Zt()||Xt()||ea(_),v=(localStorage.getItem("userPermissions"),localStorage.getItem("user"));try{if(rawPermissions)try{JSON.parse(rawPermissions)}catch(A){}if(v)try{JSON.parse(v)}catch(A){}}catch(T){}a.useEffect(()=>{j()},[]);const j=async()=>{try{d(!0);const t=(()=>{try{const e=localStorage.getItem("userId");if(e)return e;const t=localStorage.getItem("user");if(t){const e=JSON.parse(t);return e.id||e._id||e.user_id}return null}catch(A){return null}})();if(!t)throw new Error("User not authenticated");const a=[`/reassignment/list?user_id=${t}`,`/api/reassignment-requests?user_id=${t}`,`/leads/reassignment?user_id=${t}`,`/leads/reassign/requests?user_id=${t}`,`/reassignment/requests?user_id=${t}`];let s=null,n=null;for(const o of a)try{const e=await fetch(`${Vt}${o}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){s=e;break}n=new Error(`HTTP error! status: ${e.status}`)}catch(e){n=e}if(!s)throw n||new Error("All endpoints failed to respond");const i=await s.json();let r=[];if(i)if(Array.isArray(i))r=i;else if(i.requests&&Array.isArray(i.requests))r=i.requests;else if(i.data&&Array.isArray(i.data))r=i.data;else if(i.results&&Array.isArray(i.results))r=i.results;else if(i.reassignments&&Array.isArray(i.reassignments))r=i.reassignments;else if(i.leads&&Array.isArray(i.leads))r=i.leads;else{const e=Object.values(i).filter(e=>Array.isArray(e));e.length>0&&(r=e[0])}o(r)}catch(T){m(T.message),o([])}finally{d(!1)}},N=async e=>{s(t=>({...t,[`approve_${e}`]:!0})),i(`approveBtn_${e}`);try{const t=(()=>{try{const e=localStorage.getItem("userId");if(e)return e;const t=localStorage.getItem("user");if(t){const e=JSON.parse(t);return e.id||e._id||e.user_id}return null}catch(A){return null}})();if(!t||!e)return void alert("Missing required data for reassignment approval");let a;try{if(a=await fetch(`${Vt}/reassignment/approve/${e}?user_id=${t}`,{method:"POST",headers:{"Content-Type":"application/json"}}),!a.ok)throw new Error(`Server returned ${a.status}`)}catch(T){a=await fetch(`${Vt}/leads/${e}/approve-reassign?user_id=${t}`,{method:"POST",headers:{"Content-Type":"application/json"}})}if(200!==a.status&&201!==a.status){const e=await a.json();throw new Error(e.message||`HTTP error! status: ${a.status}`)}await a.json(),alert("Lead reassignment approved successfully!"),window.location.reload(),o(t=>t.map(t=>t.id===e||t._id===e?{...t,reassignment_status:"approved",status:"approved",action_date:(new Date).toISOString(),action_by:"Current User"}:t))}catch(T){alert("Error approving reassignment: "+(T.message||"Please try again."))}finally{s(t=>({...t,[`approve_${e}`]:!1}))}},k=async(e,t="Request denied by admin")=>{s(t=>({...t,[`reject_${e}`]:!0})),i(`rejectBtn_${e}`);try{const a=(()=>{try{const e=localStorage.getItem("userId");if(e)return e;const t=localStorage.getItem("user");if(t){const e=JSON.parse(t);return e.id||e._id||e.user_id}return null}catch(A){return null}})();if(!a||!e)return void alert("Missing required data for reassignment rejection");let s;try{if(s=await fetch(`${Vt}/reassignment/reject/${e}?user_id=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rejection_reason:t})}),!s.ok)throw new Error(`Server returned ${s.status}`)}catch(T){s=await fetch(`${Vt}/reassignment/reject/${e}?user_id=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:t})})}if(200!==s.status&&201!==s.status){const e=await s.json();throw new Error(e.message||`HTTP error! status: ${s.status}`)}await s.json(),alert("Lead reassignment rejected successfully!"),window.location.reload(),o(a=>a.map(a=>a.id===e||a._id===e?{...a,reassignment_status:"rejected",status:"rejected",action_date:(new Date).toISOString(),action_by:"Current User",rejection_reason:t}:a))}catch(T){alert("Error rejecting reassignment: "+(T.message||"Please try again."))}finally{s(t=>({...t,[`reject_${e}`]:!1}))}},S=e=>{if(!e)return"-";try{const t=new Date(e);return isNaN(t.getTime())?"-":t.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(T){return"-"}},C=r.filter(e=>{if("all"!==h&&(e.reassignment_status||"unknown")!==h)return!1;if(!w){const t=(()=>{try{const e=localStorage.getItem("userId");if(e)return e;const t=localStorage.getItem("user");if(t){const e=JSON.parse(t);return e.id||e._id||e.user_id}return null}catch(A){return null}})();return e.reassignment_requested_by===t||e.requested_by===t||e.created_by===t}return!0}),L=e=>{switch((e||"").toLowerCase()){case"pending":case"waiting":case"in progress":return"bg-yellow-100 text-yellow-800";case"approved":case"complete":case"completed":case"success":case"done":return"bg-green-100 text-green-800";case"rejected":case"denied":case"cancelled":case"canceled":case"failed":return"bg-red-100 text-red-800";case"unknown":return"bg-gray-100 text-gray-800";default:return"bg-blue-100 text-blue-800"}};return t.jsxs("div",{className:"p-6 bg-gray-100 rounded-lg shadow-md",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-800",children:w?"ALL REASSIGNMENT REQUESTS":"YOUR REASSIGNMENT REQUESTS"}),t.jsx("div",{className:"px-3 py-1 rounded-full text-sm font-medium "+(w?"bg-green-100 text-green-700 border border-green-300":"bg-blue-100 text-blue-700 border border-blue-300"),children:w?" Can Approve/Reject All Requests":" Viewing Your Own Requests Only"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"mr-2 text-gray-700",children:"Filter:"}),t.jsxs("select",{className:"px-3 py-1 border rounded bg-white text-gray-700",value:h,onChange:e=>f(e.target.value),children:[t.jsx("option",{value:"all",children:"All Requests"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"approved",children:"Approved"}),t.jsx("option",{value:"rejected",children:"Rejected"})]}),t.jsxs("button",{className:"ml-4 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:j,children:[t.jsx("svg",{className:"w-4 h-4 inline-block mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]})]}),l?t.jsxs("div",{className:"text-center py-8 bg-white rounded-lg shadow",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),t.jsx("p",{className:"mt-2 text-gray-700",children:"Loading reassignment requests..."})]}):c?t.jsxs("div",{className:"text-center py-8 text-red-600 bg-white rounded-lg shadow p-4",children:[t.jsxs("p",{children:["Error loading reassignment requests: ",c]}),t.jsx("button",{className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:j,children:"Try Again"})]}):0===C.length?t.jsxs("div",{className:"text-center py-8 text-gray-600 bg-white rounded-lg shadow p-4",children:[t.jsx("p",{children:"No reassignment requests found for the selected filter."}),t.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Please make a request for reassignment from the lead details screen if needed."})]}):t.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:t.jsxs("table",{className:"w-full table-auto",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-200 border-b border-gray-300",children:[t.jsx("th",{className:"px-4 py-3 text-left text-gray-700 font-semibold",children:"Lead Name"}),t.jsx("th",{className:"px-4 py-3 text-left text-gray-700 font-semibold",children:"Mobile"}),t.jsx("th",{className:"px-4 py-3 text-left text-gray-700 font-semibold",children:"Product Type"}),t.jsx("th",{className:"px-4 py-3 text-left text-gray-700 font-semibold",children:"Current Owner"}),t.jsx("th",{className:"px-4 py-3 text-left text-gray-700 font-semibold",children:"Requested By"}),t.jsx("th",{className:"px-4 py-3 text-left text-gray-700 font-semibold",children:"Request Date"}),t.jsx("th",{className:"px-4 py-3 text-left text-gray-700 font-semibold",children:"Status"}),t.jsx("th",{className:"px-4 py-3 text-left text-gray-700 font-semibold",children:"Actions"})]})}),t.jsx("tbody",{children:C.map(a=>t.jsxs("tr",{className:"border-b hover:bg-gray-50 text-gray-700",children:[t.jsx("td",{className:"px-4 py-3",children:a.first_name&&a.last_name?`${a.first_name} ${a.last_name}`:a.name||(a.requestor?a.requestor.name:"-")}),t.jsx("td",{className:"px-4 py-3",children:a.mobile_number||a.phone||"-"}),t.jsx("td",{className:"px-4 py-3",children:a.loan_type_name||a.loan_type||"-"}),t.jsx("td",{className:"px-4 py-3",children:a.created_by_name||(a.current_assignee?a.current_assignee.name:Array.isArray(a.assigned_to)?"Multiple Assignees":a.assigned_to||"-")}),t.jsx("td",{className:"px-4 py-3",children:a.requestor?a.requestor.name:a.requestor_name||a.requested_by||"-"}),t.jsx("td",{className:"px-4 py-3",children:S(a.reassignment_requested_at||a.request_date)}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${L(a.status||a.reassignment_status||"unknown")}`,children:(a.status||a.reassignment_status||"unknown").toUpperCase()})}),t.jsxs("td",{className:"px-4 py-3",children:[t.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded text-xs mr-2 hover:bg-blue-700 shadow-sm transition-all duration-200 transform hover:scale-105 active:scale-95",onClick:()=>(g(a),void y(!0)),children:"Details"}),("pending"===a.status||"pending"===a.reassignment_status||!0===a.pending_reassignment)&&w&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:`px-3 py-1 text-white rounded text-xs mr-2 shadow-sm transition-all duration-200 transform ${e[`approve_${a._id||a.id}`]?"bg-gray-400 cursor-not-allowed scale-95":"bg-green-600 hover:bg-green-700 hover:scale-105 active:scale-95"} ${n[`approveBtn_${a._id||a.id}`]?"animate-pulse scale-95":""}`,onClick:()=>N(a._id||a.id),disabled:e[`approve_${a._id||a.id}`],children:e[`approve_${a._id||a.id}`]?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-spinner fa-spin mr-1"}),"Approving..."]}):"Approve"}),t.jsx("button",{className:`px-3 py-1 text-white rounded text-xs shadow-sm transition-all duration-200 transform ${e[`reject_${a._id||a.id}`]?"bg-gray-400 cursor-not-allowed scale-95":"bg-red-600 hover:bg-red-700 hover:scale-105 active:scale-95"} ${n[`rejectBtn_${a._id||a.id}`]?"animate-pulse scale-95":""}`,onClick:()=>{if(!e[`reject_${a._id||a.id}`]){const e=prompt("Enter reason for rejection:","Request denied by admin");null!==e&&k(a._id||a.id,e)}},disabled:e[`reject_${a._id||a.id}`],children:e[`reject_${a._id||a.id}`]?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-spinner fa-spin mr-1"}),"Rejecting..."]}):"Reject"})]})]})]},a._id||a.id))})]})}),p&&u&&t.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-99999999 bg-transparent bg-opacity-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center border-b pb-3 mb-4",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Lead Reassignment Details"}),t.jsx("button",{className:"text-gray-500 hover:text-gray-700",onClick:()=>y(!1),children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-2 mb-4",children:[t.jsx("h4",{className:"text-md font-semibold mb-2 border-b pb-1 text-gray-800",children:"Lead Information"}),t.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Name:"})," ",u.first_name&&u.last_name?`${u.first_name} ${u.last_name}`:u.name||"Unknown"]}),t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Mobile:"})," ",u.phone||u.mobile||"Not provided"]}),t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Product Type:"})," ",u.loan_type||u.product_type||"Unknown"]}),t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Status:"})," ",u.status||u.reassignment_status||"Unknown"]}),t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Lead Age:"})," ",u.age_days?`${u.age_days} days`:"Unknown"]}),t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"File Sent To Login:"})," ",!0===u.file_sent_to_login?"Yes":!1===u.file_sent_to_login?"No":"Unknown"]})]})]}),t.jsxs("div",{className:"col-span-2 mb-4",children:[t.jsx("h4",{className:"text-md font-semibold mb-2 border-b pb-1 text-gray-800",children:"Reassignment Information"}),t.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Current Owner:"})," ",u.created_by_name||(u.assigned_to?(()=>{const e=assignableUsers?.find(e=>e.id===u.assigned_to||e._id===u.assigned_to);return e?.name||u.assigned_to})():"Unknown")]}),t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Requested By:"})," ",u.requested_by_name||u.requested_by||u.requestor&&u.requestor.name||"Unknown"]}),t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Request Date:"})," ",S(u.reassignment_requested_at||u.request_date)]}),t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Request Status:"}),t.jsx("span",{className:`ml-1 px-2 py-0.5 rounded text-xs font-semibold ${L(u.status||u.reassignment_status||"unknown")}`,children:(u.status||u.reassignment_status||"unknown").toUpperCase()})]}),u.reason&&t.jsxs("div",{className:"col-span-2 text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Request Reason:"})," ",u.reason]}),u.action_date&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Action Date:"})," ",S(u.action_date)]}),t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Action By:"})," ",u.action_by||"Unknown"]})]}),u.rejection_reason&&t.jsxs("div",{className:"col-span-2 text-gray-800",children:[t.jsx("span",{className:"font-medium text-gray-600",children:"Rejection Reason:"})," ",u.rejection_reason]})]})]})]}),t.jsxs("div",{className:"flex justify-end mt-6 pt-4 border-t",children:[("pending"===u.reassignment_status||"pending"===u.status||!0===u.pending_reassignment)&&w&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:`px-4 py-2 text-white rounded mr-2 transition-all duration-200 transform ${e[`approve_${u._id||u.id}`]?"bg-gray-400 cursor-not-allowed scale-95":"bg-green-500 hover:bg-green-600 hover:scale-105 active:scale-95"} ${n[`approveBtn_${u._id||u.id}`]?"animate-pulse scale-95":""}`,onClick:()=>{e[`approve_${u._id||u.id}`]||(N(u._id||u.id),y(!1))},disabled:e[`approve_${u._id||u.id}`],children:e[`approve_${u._id||u.id}`]?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Approving..."]}):"Approve Reassignment"}),t.jsx("button",{className:`px-4 py-2 text-white rounded transition-all duration-200 transform ${e[`reject_${u._id||u.id}`]?"bg-gray-400 cursor-not-allowed scale-95":"bg-red-500 hover:bg-red-600 hover:scale-105 active:scale-95"} ${n[`rejectBtn_${u._id||u.id}`]?"animate-pulse scale-95":""}`,onClick:()=>{if(!e[`reject_${u._id||u.id}`]){const e=prompt("Enter reason for rejection:","Request denied by admin");null!==e&&(k(u._id||u.id,e),y(!1))}},disabled:e[`reject_${u._id||u.id}`],children:e[`reject_${u._id||u.id}`]?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Rejecting..."]}):"Reject Reassignment"})]}),t.jsx("button",{className:"px-4 py-2 bg-gray-300 text-gray-700 rounded ml-2 hover:bg-gray-400 transition-all duration-200 transform hover:scale-105 active:scale-95",onClick:()=>y(!1),children:"Close"})]})]})})]})}function na({onClose:e,onSelect:n,assignableUsers:i=[]}){const[r,o]=a.useState(""),l=[],d=s.useMemo(()=>[{id:"none",name:"None"},...i.length>0?i.map(e=>({id:e.id||e._id||e.user_id,name:e.name||`${e.first_name||""} ${e.last_name||""}`.trim()||e.username||e.id,designation:e.designation||"No Designation",department_name:e.department_name||"Unknown Department",displayName:`${e.name||`${e.first_name||""} ${e.last_name||""}`.trim()||e.username||e.id} (${e.designation||"No Designation"}) - ${e.department_name||"Unknown Department"}`})):l],[i]),[c,m]=a.useState(d);return a.useEffect(()=>{""===r.trim()?m(d):m(d.filter(e=>(e.name||"").toLowerCase().includes(r.toLowerCase())||(e.designation||"").toLowerCase().includes(r.toLowerCase())||(e.department_name||"").toLowerCase().includes(r.toLowerCase())))},[r,d]),t.jsx("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center bg-black bg-opacity-50",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.8)"},children:t.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-2xl w-[90%] max-w-md mx-auto relative",style:{backgroundColor:"white",zIndex:99999},children:[t.jsxs("div",{className:"flex items-center mb-4 bg-white p-3 rounded-t-xl",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-[#03B0F5] text-white flex items-center justify-center mr-3",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),t.jsx("div",{className:"flex flex-col",children:t.jsx("h3",{className:"font-bold text-lg text-black",children:"Select Assignee"})})]}),t.jsxs("div",{className:"mb-4 bg-white p-3 rounded-md",children:[t.jsx("label",{className:"block font-bold text-gray-700 mb-2",children:"Assign to"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:t.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("input",{type:"text",className:"w-full pl-10 pr-3 py-2 border border-cyan-400 rounded text-black font-bold",value:r,onChange:e=>o(e.target.value.toUpperCase()),placeholder:"Search by name, designation, or department"}),r&&t.jsx("button",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600",onClick:()=>o(""),type:"button",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),t.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto mb-4 border rounded-lg bg-white",children:c.length>0?c.map(a=>t.jsxs("li",{className:"p-3 border-b last:border-b-0 cursor-pointer text-black transition hover:bg-gray-100 flex items-center",onClick:()=>{return"none"===(t=a).id?(o("None"),n(t)):(o(t.name),n(t)),void e();var t},children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-[#03B0F5] text-white flex items-center justify-center mr-3 flex-shrink-0",children:a.name.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase()}),t.jsxs("div",{className:"flex flex-col flex-grow",children:[t.jsx("span",{className:"font-medium",children:a.name}),a.designation&&"none"!==a.id&&t.jsx("span",{className:"text-sm text-gray-600",children:a.designation}),a.department_name&&"none"!==a.id]})]},a.id||a.name)):""!==r.trim()&&t.jsx("li",{className:"p-3 text-gray-500 text-center",children:"No matching assignees found."})}),t.jsxs("div",{className:"flex justify-end gap-4 mt-4 bg-white p-3 rounded-b-xl",children:[t.jsx("button",{className:"px-6 py-3 bg-cyan-600 text-white rounded-xl shadow hover:bg-cyan-700 transition",onClick:()=>{if(r){const e=d.find(e=>(e.name||"").toLowerCase()===r.toLowerCase());n(e||{id:r.toLowerCase().replace(/\s+/g,"_"),name:r})}o(""),e()},children:"Assign"}),t.jsx("button",{className:"px-6 py-3 bg-gray-400 text-white rounded-xl shadow hover:bg-gray-500 transition",onClick:e,children:"Cancel"})]}),t.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-red-500 text-2xl font-bold",onClick:e,children:""})]})})}const ia=Object.freeze(Object.defineProperty({__proto__:null,checkReassignmentPermissions:ea,checkUserHasAddLeadPermission:ta,checkUserHasAssignPermissionGlobal:Xt,checkUserIsSuperAdmin:Zt,default:function(){const[e,s]=a.useState("all"),[n,i]=a.useState("leadinfo"),[r,o]=a.useState("");a.useRef(null);const l=localStorage.getItem("userPermissions");l&&(l.includes("page * and action *")||l.includes("page leads and action assign"))||Zt()||Xt()||ea(l);const{productType:d,setProductType:c,mobileNumber:m,setMobileNumber:u,mobileValidationError:g,handleMobileNumberChange:p,showLeadForm:y,campaignName:h,setCampaignName:f,dataCode:b,setDataCode:x,assignedTo:_,setAssignedTo:w,handleRemoveAssignee:v,handleAddAssignee:j,showAssignPopup:N,setShowAssignPopup:k,status:S,setStatus:C,customerName:L,setCustomerName:A,alternateNumber:T,setAlternateNumber:I,handleAlternateNumberChange:D,leadFormRef:E,handleCheckMobile:P,loanTypes:M,campaignNames:$,dataCodes:R,assignableUsers:B,loadingLoanTypes:O,loadingSettings:F,mobileCheckResult:q,showReassignmentOption:U,showLeadDetails:z,existingLeadData:V,setShowLeadDetails:H,setExistingLeadData:J,handleReassignmentRequest:Y,handleReassignmentCancel:W,statusOptions:G,newDataCode:K,setNewDataCode:Q,newCampaignName:Z,setNewCampaignName:X,changeDataCode:ee,setChangeDataCode:te,changeCampaignName:ae,setChangeCampaignName:se,handleSubmit:ne,formValidationErrors:ie,setFormValidationErrors:re,showValidationErrors:oe,checkMobileLoading:le,createLeadLoading:de,reassignmentActionLoading:ce,setReassignmentActionLoading:me,buttonAnimations:ue,animateButton:ge,hasAddLeadPermission:pe}=Qt();return t.jsxs(t.Fragment,{children:[t.jsx("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"}),t.jsxs("div",{className:"flex-1 p-6 mx-auto main-content max-w-8xl min-h-screen",children:[t.jsxs("div",{className:"flex items-center mb-8 space-x-2 sticky top-0 z-10 bg-black py-4 border-b border-gray-200",children:[t.jsx("button",{className:"px-6 py-2 rounded-t-md font-extrabold text-xl transition-all duration-200 transform hover:scale-105 active:scale-95 "+("all"===e?"bg-sky-400 text-white":"bg-neutral-800 text-gray-300 hover:bg-neutral-700"),onClick:()=>{ge("allTabBtn"),s("all")},children:"All"}),t.jsx("button",{className:"px-6 py-2 rounded-t-md font-extrabold text-xl transition-all duration-200 transform hover:scale-105 active:scale-95 "+("reassignment"===e?"bg-sky-400 text-white":"bg-neutral-800 text-gray-300 hover:bg-neutral-700"),onClick:()=>{ge("reassignmentTabBtn"),s("reassignment")},children:"Reassignment"})]}),"all"===e&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-md card",children:[t.jsx("div",{className:"mb-6 text-xl font-bold card-title text-[#03B0F5]",children:"Select Product Type"}),t.jsx("div",{className:"form-section",children:t.jsxs("div",{className:"form-group",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 items-end",children:[t.jsxs("div",{className:"lg:col-span-4",children:[t.jsxs("label",{className:"block mb-2 text-md font-bold text-black form-label required-field",children:["Product Type",t.jsx("span",{className:"ml-1 text-red-400",children:"*"})]}),t.jsxs("div",{className:"h-[42px]",children:[t.jsx($t,{options:M&&M.length>0?M.map(e=>({value:e.name,label:e.name})):[],value:d,onChange:e=>{c(e),e&&oe&&re(e=>({...e,productType:!1}))},placeholder:O?"Loading...":"Select Product",searchPlaceholder:"Search products...",disabled:O||y,emptyMessage:O?"Loading...":"No loan types available",className:"form-select h-full "+(oe&&ie.productType?"border-red-500":"")}),oe&&ie.productType&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Product Type is required"})]})]}),t.jsxs("div",{className:"lg:col-span-5",children:[t.jsxs("label",{className:"block mb-2 text-md font-bold text-black form-label required-field",children:["Mobile Number",t.jsx("span",{className:"ml-1 text-red-400",children:"*"})]}),t.jsx("div",{className:"h-[42px]",children:t.jsx("input",{type:"text",className:`w-full h-full px-3 py-2 text-white border rounded-lg form-control border-neutral-800 bg-neutral-800 focus:outline-none ${g||oe&&ie.mobileNumber?"border-red-500 focus:border-red-500":"focus:border-sky-400"} ${y?"opacity-60 cursor-not-allowed":""}`,placeholder:"Enter Mobile Number",value:m,onChange:p,disabled:y,readOnly:y})}),oe&&ie.mobileNumber&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Mobile Number is required"})]}),t.jsxs("div",{className:"lg:col-span-3",children:[t.jsx("label",{className:"block mb-2 text-md font-bold text-transparent",children:"Action"}),t.jsx("div",{className:"h-[42px]",children:t.jsx("button",{type:"button",className:`w-full h-full px-4 py-2 font-bold text-white rounded-lg btn transition-all duration-300 transform ${y?"bg-green-500 hover:bg-green-600 cursor-default":le?"bg-gray-400 cursor-not-allowed scale-95":"bg-sky-400 hover:bg-sky-500 hover:scale-105 active:scale-95"} ${ue.checkMobileBtn?"animate-pulse scale-95":""}`,id:"checkMobile",onClick:y?void 0:P,disabled:y||le,children:y?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-check mr-2"}),"Loaded"]}):le?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Checking..."]}):"Check & Load"})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 mt-2",children:[t.jsx("div",{className:"lg:col-span-4"}),t.jsx("div",{className:"lg:col-span-5",children:t.jsx("div",{className:"h-[32px] flex items-start",children:g&&t.jsx("div",{className:"text-xl font-bold text-red-600",children:g})})}),t.jsx("div",{className:"lg:col-span-3"})]})]})})]}),t.jsxs("div",{className:"min-h-[100px]",children:[q&&q.exists&&!U&&t.jsx("div",{className:"p-6 mb-6 bg-yellow-50 rounded-lg shadow-md border-l-4 border-yellow-500",children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"w-8 h-8 text-yellow-600",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-lg font-bold text-yellow-800 mb-2",children:"Lead Already Exists"}),t.jsx("p",{className:"text-yellow-700 text-base",children:q.message}),t.jsx("p",{className:"text-yellow-600 text-sm mt-2",children:"You do not have permission to view detailed reassignment information. Please contact your administrator if you need access."})]})]})}),U&&t.jsx("div",{className:"p-6 mb-6 bg-white rounded-lg shadow-md border-l-4 border-green-500",children:t.jsxs("div",{className:"bg-white bg-opacity-95 backdrop-blur-sm rounded-2xl shadow-2xl w-full",children:[t.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-t-2xl",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-7 h-7",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-xl font-bold",children:"Lead Check Result"}),t.jsxs("p",{className:"mt-2 text-green-100 text-sm",children:['Lead exists as "',V?.status||"Not a lead",'" assigned to ',(()=>{if(V?.created_by_name)return V.created_by_name;if(V?.assigned_to_name)return V.assigned_to_name;if(V?.assigned_to_user?.name)return V.assigned_to_user.name;if(V?.created_by){const e=String(V.created_by),t=B?.find(t=>t.id===e||t._id===e);if(t?.name)return t.name}if(V?.assigned_to){const e=Array.isArray(V.assigned_to)?V.assigned_to[0]:V.assigned_to,t=String(e),a=B?.find(e=>e.id===t||e._id===t);return a?.name?a.name:/^\d+$/.test(t)||/^[a-f\d]{24}$/i.test(t)?`User ID: ${t.substring(0,8)}...`:t}return"Unknown"})(),". You can reassign it to yourself."]})]}),t.jsx("button",{className:"w-10 h-10 bg-red-500 bg-opacity-80 hover:bg-red-600 hover:bg-opacity-90 rounded-full flex items-center justify-center text-white transition-all duration-200",onClick:()=>{W()},children:t.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),t.jsx("div",{className:"p-5",children:t.jsxs("div",{className:"mb-5",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 mb-5",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white text-lg font-bold",children:V?.name?.charAt(0)?.toUpperCase()||V?.customer_name?.charAt(0)?.toUpperCase()||"L"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Customer Name"}),t.jsx("p",{className:"text-lg font-bold text-gray-900",children:V?.name||V?.customer_name||"Unknown Customer"})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 bg-teal-500 rounded-full flex items-center justify-center text-white",children:t.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Mobile Number"}),t.jsx("p",{className:"text-lg font-bold text-gray-900",children:V?.mobile_number||V?.phone||m||"Unknown"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-5",children:[t.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Current Owner"})]}),t.jsx("p",{className:"text-base font-bold text-gray-900",children:(()=>{if(V?.created_by_name)return V.created_by_name;if(V?.created_by){const e=String(V.created_by),t=B?.find(t=>t.id===e||t._id===e);if(t?.name)return t.name}if(V?.assigned_to_name)return V.assigned_to_name;if(V?.assigned_to_user?.name)return V.assigned_to_user.name;if(V?.assigned_to){const e=Array.isArray(V.assigned_to)?V.assigned_to[0]:V.assigned_to,t=String(e),a=B?.find(e=>e.id===t||e._id===t);return a?.name?a.name:/^\d+$/.test(t)||/^[a-f\d]{24}$/i.test(t)?`User ID: ${t.substring(0,8)}...`:t}return"Unassigned"})()})]}),t.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("svg",{className:"w-4 h-4 text-orange-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Lead Status"})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:"px-2 py-1 bg-gray-600 text-white text-xs rounded-md font-medium",children:V?.status||"Unknown"}),V?.sub_status&&t.jsx("span",{className:"px-2 py-1 bg-blue-600 text-white text-xs rounded-md font-medium",children:V.sub_status}),V?.file_sent_to_login&&t.jsxs("span",{className:"px-2 py-1 bg-green-600 text-white text-xs rounded-md font-medium flex items-center gap-1",children:[t.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Sent to Login"]})]}),V?.reassignment_reason&&t.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[" ",V.reassignment_reason]}),V?.file_sent_to_login&&V?.login_department_sent_date&&t.jsxs("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("svg",{className:"w-3 h-3 text-yellow-600",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),t.jsx("span",{className:"text-xs font-medium text-yellow-800",children:"Lock-in Date:"})]}),t.jsx("p",{className:"text-xs text-yellow-700 font-medium mt-1",children:new Date(V.login_department_sent_date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})}),t.jsx("span",{className:"text-xs font-medium text-gray-600",children:V?.file_sent_to_login?"Login Date":"Created Date"})]}),t.jsx("p",{className:"text-base font-bold text-gray-900",children:(()=>{const e=V?.file_sent_to_login&&V?.login_department_sent_date?V.login_department_sent_date:V?.created_date;return e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"}):"Unknown Date"})()}),t.jsx("p",{className:"text-xs text-gray-600",children:void(V?.file_sent_to_login&&V?.login_department_sent_date&&new Date(V.login_department_sent_date))})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 mb-5",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Product Type:"}),t.jsx("span",{className:"ml-2 text-sm font-semibold text-gray-900",children:V?.product_type||V?.loan_type||"Not specified"})]}),void 0!==V?.file_sent_to_login&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Login Department Status:"}),t.jsx("span",{className:"px-2 py-1 text-xs rounded-md font-medium "+(V.file_sent_to_login?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:V.file_sent_to_login?"File Sent":"Not Sent"})]}),V?.login_department_sent_date&&t.jsxs("div",{className:"col-span-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Login Department Sent Date:"}),t.jsx("span",{className:"ml-2 text-sm font-semibold text-gray-900",children:new Date(V.login_department_sent_date).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(void 0!==V.can_reassign||V.reassignment_status)&&t.jsxs("div",{className:"bg-blue-50 border-2 border-blue-100 rounded-xl p-5 mb-5",children:[t.jsx("h4",{className:"text-base font-bold text-gray-900 mb-3",children:"Reassignment Information"}),void 0!==V.can_reassign&&t.jsxs("div",{className:"mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Reassignment Eligibility:"}),t.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(V.can_reassign?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:V.can_reassign?"Eligible":"Not Eligible"})]}),V.reassignment_reason&&t.jsx("p",{className:"text-xs text-gray-600 ml-4 italic",children:V.reassignment_reason})]}),V.reassignment_period>0&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[t.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Waiting Period:"}),t.jsxs("p",{className:"text-sm font-bold text-gray-900",children:[V.reassignment_period," days"]})]}),t.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Days Elapsed:"}),t.jsx("p",{className:"text-sm font-bold text-gray-900",children:(()=>{if(V?.file_sent_to_login&&V?.login_department_sent_date){const e=new Date(V.login_department_sent_date),t=new Date,a=Math.floor((t-e)/864e5);return`${a} ${1===a?"day":"days"}`}const e=new Date(V.created_date),t=new Date,a=Math.floor((t-e)/864e5);return`${a} ${1===a?"day":"days"}`})()})]}),V.days_remaining>0&&t.jsxs("div",{className:"col-span-2 bg-orange-50 border border-orange-200 p-3 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("svg",{className:"w-4 h-4 text-orange-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),t.jsxs("span",{className:"font-bold text-orange-800 text-sm",children:["Days Remaining: ",(()=>{if(V?.file_sent_to_login&&V?.login_department_sent_date){const e=new Date(V.login_department_sent_date),t=new Date,a=Math.floor((t-e)/864e5),s=Math.max(0,V.reassignment_period-a);return`${s} ${1===s?"day":"days"}`}const e=new Date(V.created_date),t=new Date,a=Math.floor((t-e)/864e5),s=Math.max(0,V.reassignment_period-a);return`${s} ${1===s?"day":"days"}`})()]}),t.jsx("span",{className:"px-2 py-1 bg-orange-200 text-orange-800 rounded-full text-xs font-medium",children:"Waiting Period Active"})]}),t.jsxs("p",{className:"text-xs text-orange-700",children:["Available for reassignment on: ",t.jsx("span",{className:"font-medium",children:(()=>{let e=new Date;return V?.file_sent_to_login&&V?.login_department_sent_date?(e=new Date(V.login_department_sent_date),e.setDate(e.getDate()+V.reassignment_period)):e.setDate(e.getDate()+V.days_remaining),e.toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"})})()})]})]}),V.is_manager_permission_required&&t.jsx("div",{className:"col-span-2 bg-yellow-50 border border-yellow-200 p-3 rounded-lg",children:t.jsxs("span",{className:"text-yellow-800 font-medium text-sm",children:[t.jsx("svg",{className:"w-4 h-4 inline mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Manager Permission Required"]})})]}),V.reassignment_status&&"none"!==V.reassignment_status&&t.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Current Reassignment Status:"}),t.jsx("span",{className:"ml-2 px-2 py-1 rounded-full text-xs font-medium "+("requested"===V.reassignment_status?"bg-yellow-100 text-yellow-800":"approved"===V.reassignment_status?"bg-green-100 text-green-800":"rejected"===V.reassignment_status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:V.reassignment_status.charAt(0).toUpperCase()+V.reassignment_status.slice(1)})]})]}),(!V.days_remaining||V.days_remaining<=0)&&t.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[t.jsxs("h5",{className:"text-sm font-bold text-blue-900 mb-4 flex items-center gap-2",children:[t.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})}),"Reassignment Options (Optional)"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("input",{type:"checkbox",checked:ee,onChange:e=>te(e.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Change Data Code"})]}),ee&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Select New Data Code"}),t.jsx($t,{options:R.map(e=>({value:e.name,label:e.name})),value:K,onChange:Q,placeholder:"Select data code...",searchPlaceholder:"Search data codes...",className:"text-sm"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("input",{type:"checkbox",checked:ae,onChange:e=>se(e.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Change Campaign Name"})]}),ae&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Select New Campaign Name"}),t.jsx($t,{options:$.map(e=>({value:e.name,label:e.name})),value:Z,onChange:X,placeholder:"Select campaign...",searchPlaceholder:"Search campaigns...",className:"text-sm"})]})]})]}),t.jsx("p",{className:"text-xs text-blue-700 mt-3 italic",children:" You can optionally change the data code and/or campaign name when requesting reassignment."})]}),(()=>{let e=V.days_remaining;if(V?.file_sent_to_login&&V?.login_department_sent_date){const t=new Date(V.login_department_sent_date),a=new Date,s=Math.floor((a-t)/864e5);e=Math.max(0,V.reassignment_period-s)}else{const t=new Date(V.created_date),a=new Date,s=Math.floor((a-t)/864e5);e=Math.max(0,V.reassignment_period-s)}return e>0})()&&t.jsxs("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-300 rounded-lg opacity-75",children:[t.jsxs("h5",{className:"text-sm font-bold text-gray-600 mb-4 flex items-center gap-2",children:[t.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),"Reassignment Options (Available in ",(()=>{let e=V.days_remaining;if(V?.file_sent_to_login&&V?.login_department_sent_date){const t=new Date(V.login_department_sent_date),a=new Date,s=Math.floor((a-t)/864e5);e=Math.max(0,V.reassignment_period-s)}else{const t=new Date(V.created_date),a=new Date,s=Math.floor((a-t)/864e5);e=Math.max(0,V.reassignment_period-s)}return`${e} ${1===e?"day":"days"}`})(),")"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("input",{type:"checkbox",checked:ee,onChange:e=>te(e.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500",disabled:!0}),t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Change Data Code"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Select New Data Code"}),t.jsx("div",{className:"bg-gray-100 border border-gray-200 rounded-md px-3 py-2 text-sm text-gray-400",children:"Available after waiting period"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("input",{type:"checkbox",checked:ae,onChange:e=>se(e.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500",disabled:!0}),t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Change Campaign Name"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Select New Campaign Name"}),t.jsx("div",{className:"bg-gray-100 border border-gray-200 rounded-md px-3 py-2 text-sm text-gray-400",children:"Available after waiting period"})]})]})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-3 italic",children:" These options will be available when the waiting period ends."})]}),(()=>{let e=V.days_remaining;if(V?.file_sent_to_login&&V?.login_department_sent_date){const t=new Date(V.login_department_sent_date),a=new Date,s=Math.floor((a-t)/864e5);e=Math.max(0,V.reassignment_period-s)}else{const t=new Date(V.created_date),a=new Date,s=Math.floor((a-t)/864e5);e=Math.max(0,V.reassignment_period-s)}return e<=0})()&&t.jsxs("div",{className:"flex justify-center gap-4",children:[t.jsxs("button",{className:"flex items-center gap-2 px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg",onClick:()=>Y(V),children:[t.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}),"Request Reassignment"]}),t.jsxs("button",{className:"flex items-center gap-2 px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg",onClick:W,children:[t.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Cancel"]})]}),(()=>{let e=V.days_remaining;if(V?.file_sent_to_login&&V?.login_department_sent_date){const t=new Date(V.login_department_sent_date),a=new Date,s=Math.floor((a-t)/864e5);e=Math.max(0,V.reassignment_period-s)}else{const t=new Date(V.created_date),a=new Date,s=Math.floor((a-t)/864e5);e=Math.max(0,V.reassignment_period-s)}return e>0})()&&t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"px-6 py-3 bg-orange-100 border border-orange-300 text-orange-800 font-medium rounded-xl text-center",children:t.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[t.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),t.jsxs("span",{children:["Reassignment available in ",(()=>{let e=V.days_remaining;if(V?.file_sent_to_login&&V?.login_department_sent_date){const t=new Date(V.login_department_sent_date),a=new Date,s=Math.floor((a-t)/864e5);e=Math.max(0,V.reassignment_period-s)}else{const t=new Date(V.created_date),a=new Date,s=Math.floor((a-t)/864e5);e=Math.max(0,V.reassignment_period-s)}return`${e} ${1===e?"day":"days"}`})()," "]})]})})})]})})]})})]}),z&&V&&!U&&t.jsx("div",{className:"p-6 mb-6 bg-white rounded-lg shadow-md border-l-4 border-red-500",children:t.jsxs("div",{className:"bg-white bg-opacity-95 backdrop-blur-sm rounded-2xl shadow-2xl w-full",children:[t.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white p-6 rounded-t-2xl",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-7 h-7",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-xl font-bold",children:"requested"===V.reassignment_status?"Reassignment Already Requested":"Lead Already Exists"}),t.jsx("p",{className:"mt-2 text-red-100 text-sm",children:"requested"===V.reassignment_status?"You have already submitted a reassignment request for this lead. Please wait for approval.":V.days_remaining>0?`A lead with this mobile number already exists. This lead will be available for reassignment in ${V.days_remaining} days.`:"A lead with this mobile number already exists. You cannot create a new lead."})]}),t.jsx("button",{className:"w-10 h-10 bg-red-500 bg-opacity-80 hover:bg-red-600 hover:bg-opacity-90 rounded-full flex items-center justify-center text-white transition-all duration-200",onClick:()=>{H(!1),J(null),u("")},children:t.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),t.jsx("div",{className:"p-5",children:t.jsxs("div",{className:"mb-5",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 mb-5",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white text-lg font-bold",children:V?.name?.charAt(0)?.toUpperCase()||V?.customer_name?.charAt(0)?.toUpperCase()||"L"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Customer Name"}),t.jsx("p",{className:"text-lg font-bold text-gray-900",children:V?.name||V?.customer_name||"Unknown Customer"})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 bg-teal-500 rounded-full flex items-center justify-center text-white",children:t.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Mobile Number"}),t.jsx("p",{className:"text-lg font-bold text-gray-900",children:V?.mobile_number||V?.phone||m||"Unknown"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-5",children:[t.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Current Owner"})]}),t.jsx("p",{className:"text-base font-bold text-gray-900",children:(()=>{if(V?.created_by_name)return V.created_by_name;if(V?.created_by){const e=String(V.created_by),t=B?.find(t=>t.id===e||t._id===e);if(t?.name)return t.name}if(V?.assigned_to_name)return V.assigned_to_name;if(V?.assigned_to_user?.name)return V.assigned_to_user.name;if(V?.created_by){const e=String(V.created_by),t=B?.find(t=>t.id===e||t._id===e);if(t?.name)return t.name}if(V?.assigned_to){const e=Array.isArray(V.assigned_to)?V.assigned_to[0]:V.assigned_to,t=String(e),a=B?.find(e=>e.id===t||e._id===t);return a?.name?a.name:/^\d+$/.test(t)||/^[a-f\d]{24}$/i.test(t)?`User ID: ${t.substring(0,8)}...`:t}return"Unassigned"})()})]}),t.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("svg",{className:"w-4 h-4 text-orange-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Lead Stage"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"px-2 py-1 bg-gray-600 text-white text-xs rounded-md font-medium",children:V?.status||"Unknown"}),V?.sub_status&&t.jsx("span",{className:"px-2 py-1 bg-blue-600 text-white text-xs rounded-md font-medium",children:V.sub_status}),V?.file_sent_to_login&&t.jsxs("span",{className:"px-2 py-1 bg-green-600 text-white text-xs rounded-md font-medium flex items-center gap-1",children:[t.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Sent to Login"]})]}),V?.reassignment_reason&&t.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[" ",V.reassignment_reason]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})}),t.jsx("span",{className:"text-xs font-medium text-gray-600",children:V?.file_sent_to_login?"Login Date":"Created Date"})]}),t.jsx("p",{className:"text-base font-bold text-gray-900",children:(()=>{const e=V?.file_sent_to_login&&V?.login_department_sent_date?V.login_department_sent_date:V?.created_date;return e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"}):"Unknown Date"})()}),t.jsx("p",{className:"text-xs text-gray-600",children:void(V?.file_sent_to_login&&V?.login_department_sent_date&&new Date(V.login_department_sent_date))})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 mb-5",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Product Type:"}),t.jsx("span",{className:"ml-2 text-sm font-semibold text-gray-900",children:V?.product_type||V?.loan_type||"Not specified"})]}),void 0!==V?.file_sent_to_login&&t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"File Sent to Login:"}),t.jsx("span",{className:"ml-2 text-sm font-semibold text-gray-900",children:V.file_sent_to_login?"Yes":"No"})]})]}),(void 0!==V.can_reassign||V.reassignment_status)&&t.jsxs("div",{className:"bg-blue-50 border-2 border-blue-100 rounded-xl p-5 mb-5",children:[t.jsx("h4",{className:"text-base font-bold text-gray-900 mb-3",children:"Reassignment Information"}),void 0!==V.can_reassign&&t.jsxs("div",{className:"mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Reassignment Eligibility:"}),t.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(V.can_reassign?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:V.can_reassign?"Eligible":"Not Eligible"})]}),V.reassignment_reason&&t.jsx("p",{className:"text-xs text-gray-600 ml-4 italic",children:V.reassignment_reason})]}),V.reassignment_period>0&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[t.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Waiting Period:"}),t.jsxs("p",{className:"text-sm font-bold text-gray-900",children:[V.reassignment_period," days"]})]}),t.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Days Elapsed:"}),t.jsx("p",{className:"text-sm font-bold text-gray-900",children:(()=>{if(V?.file_sent_to_login&&V?.login_department_sent_date){const e=new Date(V.login_department_sent_date),t=new Date,a=Math.floor((t-e)/864e5);return`${a} ${1===a?"day":"days"}`}const e=new Date(V.created_date),t=new Date,a=Math.floor((t-e)/864e5);return`${a} ${1===a?"day":"days"}`})()})]}),V.days_remaining>0&&t.jsxs("div",{className:"col-span-2 bg-orange-50 border border-orange-200 p-3 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("svg",{className:"w-4 h-4 text-orange-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),t.jsxs("span",{className:"font-bold text-orange-800 text-sm",children:["Days Remaining: ",(()=>{if(V?.file_sent_to_login&&V?.login_department_sent_date){const e=new Date(V.login_department_sent_date),t=new Date,a=Math.floor((t-e)/864e5),s=Math.max(0,V.reassignment_period-a);return`${s} ${1===s?"day":"days"}`}const e=new Date(V.created_date),t=new Date,a=Math.floor((t-e)/864e5),s=Math.max(0,V.reassignment_period-a);return`${s} ${1===s?"day":"days"}`})()]}),t.jsx("span",{className:"px-2 py-1 bg-orange-200 text-orange-800 rounded-full text-xs font-medium",children:"Waiting Period Active"})]}),t.jsxs("p",{className:"text-xs text-orange-700",children:["Available for reassignment on: ",t.jsx("span",{className:"font-medium",children:(()=>{let e=new Date;return V?.file_sent_to_login&&V?.login_department_sent_date?(e=new Date(V.login_department_sent_date),e.setDate(e.getDate()+V.reassignment_period)):e.setDate(e.getDate()+V.days_remaining),e.toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"})})()})]})]}),V.is_manager_permission_required&&t.jsx("div",{className:"col-span-2 bg-yellow-50 border border-yellow-200 p-3 rounded-lg",children:t.jsxs("span",{className:"text-yellow-800 font-medium text-sm",children:[t.jsx("svg",{className:"w-4 h-4 inline mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Manager Permission Required"]})})]}),V.reassignment_status&&"none"!==V.reassignment_status&&t.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[t.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Current Reassignment Status:"}),t.jsx("span",{className:"ml-2 px-2 py-1 rounded-full text-xs font-medium "+("requested"===V.reassignment_status?"bg-yellow-100 text-yellow-800":"approved"===V.reassignment_status?"bg-green-100 text-green-800":"rejected"===V.reassignment_status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:V.reassignment_status.charAt(0).toUpperCase()+V.reassignment_status.slice(1)})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("button",{className:"flex items-center gap-2 px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg",onClick:()=>{H(!1),J(null),u("")},children:[t.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Close"]})})]})})]})}),y&&t.jsxs("div",{className:"p-6 mb-6 bg-white rounded-lg shadow-md card min-h-[800px]",id:"leadForm",ref:E,children:[t.jsx("div",{className:"flex gap-4 mb-8 sticky top-16 z-10 bg-white pt-2 pb-4 border-b border-gray-100",children:t.jsx("button",{className:"flex-1 px-6 py-3 text-lg font-bold uppercase rounded-t-md border-b-4 transition "+("leadinfo"===n?"border-sky-400 text-[#03B0F5] bg-neutral-900":"border-transparent text-[#03B0F5] bg-neutral-800 hover:text-sky-300"),onClick:()=>{i("leadinfo")},children:"Lead Information"})}),"leadinfo"===n&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-8 bg-white rounded-xl shadow-lg p-6 border border-neutral-200 card",children:[t.jsx("div",{className:"mb-2 text-lg font-extrabold text-[#03B0F5]",children:"Lead Information"}),t.jsxs("div",{className:"form-section",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{className:"block mb-2 text-md font-bold text-black form-label required-field",children:["Campaign Name",t.jsx("span",{className:"ml-1 text-red-400",children:"*"})]}),t.jsx($t,{options:$.map(e=>({value:e.name,label:e.name})),value:h,onChange:e=>{f(e),ie.campaignName&&re(e=>({...e,campaignName:!1}))},placeholder:F?"Loading...":"Select Campaign",searchPlaceholder:"Search campaigns...",disabled:F,className:"form-select "+(oe&&ie.campaignName?"border-red-500":"")}),oe&&ie.campaignName&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Campaign Name is required"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{className:"block mb-2 text-md font-bold text-black form-label",children:"Data Code"}),t.jsx($t,{options:R.map(e=>({value:e.name,label:e.name})),value:b,onChange:x,placeholder:F?"Loading...":"Select Data Code",searchPlaceholder:"Search data codes...",disabled:F,className:"form-select"})]}),t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{className:"block mb-2 text-md font-bold text-black form-label required-field",children:["Status",t.jsx("span",{className:"ml-1 text-red-400",children:"*"})]}),t.jsx($t,{options:[...G.reduce((e,t)=>(e.push({value:t.value,label:t.label}),t.subOptions&&"lead"===S&&t.subOptions.forEach(t=>{e.push({value:t.value,label:`  ${t.label}`})}),e),[])],value:S,onChange:e=>{C(e),ie.status&&re(e=>({...e,status:!1}))},placeholder:"Select Status",searchPlaceholder:"Search status...",className:"form-select "+(oe&&ie.status?"border-red-500":"")}),oe&&ie.status&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Status is required"})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 form-row mt-4",children:t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{className:"block mb-2 text-md font-bold text-black form-label required-field",children:["Assigned TL",t.jsx("span",{className:"ml-1 text-red-400",children:"*"})]}),t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"w-full px-3 py-2 text-white border rounded-lg min-h-[40px] flex flex-wrap gap-2 items-center cursor-pointer "+(oe&&ie.assignedTo?"border-red-500 bg-neutral-800":"border-neutral-800 bg-neutral-800 focus:outline-none focus:border-sky-400"),onClick:e=>{e.preventDefault(),e.stopPropagation(),k(!0)},children:[0===_.length&&t.jsx("span",{className:"text-gray-400",children:"Click to select assignee"}),_.map(e=>{const a="object"==typeof e?e.name:e,s="object"==typeof e?e.id||e.name:e,n="object"==typeof e&&"none"===e.id||"string"==typeof e&&"None"===e||"None"===a;return t.jsxs("div",{className:"flex items-center gap-2 pl-2 pr-1 py-1 rounded-md text-sm "+(n?"bg-gray-500":"bg-gray-700"),children:[t.jsx("div",{className:"w-6 h-6 rounded-full text-white flex items-center justify-center flex-shrink-0 "+(n?"bg-gray-400":"bg-[#03B0F5]"),children:n?"":a.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase()}),t.jsx("span",{children:a}),t.jsx("button",{type:"button",className:"text-gray-300 hover:text-white ml-1",onClick:t=>{t.stopPropagation(),v(e)},children:""})]},s)}),_.length>0&&t.jsx("button",{type:"button",className:"w-6 h-6 rounded-full bg-cyan-600 hover:bg-cyan-700 text-white flex items-center justify-center",onClick:e=>{e.stopPropagation(),k(!0)},children:"+"})]})}),oe&&ie.assignedTo&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Please select a TL"})]})})]})]}),t.jsxs("div",{className:"mb-8 bg-white rounded-xl shadow-lg p-6 border border-neutral-200 card",children:[t.jsx("div",{className:"mb-2 text-lg font-extrabold text-[#03B0F5]",children:"Personal"}),t.jsxs("div",{className:"form-section",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{className:"block mb-2 text-md font-bold text-black form-label required-field",children:["Customer Name",t.jsx("span",{className:"ml-1 text-red-400",children:"*"})]}),t.jsx("input",{type:"text",className:"w-full px-3 py-2 text-black border rounded-lg form-control border-neutral-800 text-semibold focus:outline-none "+(oe&&ie.customerName?"border-red-500 focus:border-red-500":"focus:border-sky-400"),placeholder:"Full Name",value:L,onChange:e=>{A(e.target.value.toUpperCase()),ie.customerName&&re(e=>({...e,customerName:!1}))}}),oe&&ie.customerName&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Customer Name is required"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{className:"block mb-2 text-md font-bold text-black form-label",children:"Alternate Number"}),t.jsx("input",{type:"text",className:"w-full px-3 py-2 text-black border rounded-lg form-control focus:outline-none focus:border-sky-400 "+(T&&T===m?"border-red-500":"border-neutral-80"),placeholder:"Alternate Mobile Number",value:T,onChange:D}),T&&T===m&&t.jsx("p",{className:"mt-1 text-sm text-red-500",children:"Alternate number must be different from the main mobile number"}),T&&T.length>0&&T.length<10&&t.jsx("p",{className:"mt-1 text-sm text-orange-500",children:"Alternate number must be exactly 10 digits"}),T&&10===T.length&&!/^[6-9]/.test(T)&&t.jsx("p",{className:"mt-1 text-sm text-red-500",children:"Alternate number must start with 6, 7, 8, or 9"})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 form-row mt-4"})]})]})]}),t.jsxs("div",{className:"flex justify-end gap-4 mt-8 form-actions",children:[t.jsx("button",{type:"button",className:"px-5 py-2 font-semibold text-white rounded-lg btn btn-secondary bg-neutral-800 hover:bg-neutral-700",onClick:()=>{setShowLeadForm(!1),A(""),I(""),f(""),x(""),C(""),w([]),i("leadinfo"),setObligationDataSaved(!1),setObligationHasUnsavedChanges(!1),setObligationIsSaving(!1),o(""),setAvailableCities([])},children:"Cancel"}),t.jsx("button",{type:"button",className:`px-5 py-2 font-bold text-white rounded-lg btn transition-all duration-300 transform ${de||!pe?"bg-gray-400 cursor-not-allowed opacity-75 scale-95":"bg-green-500 hover:bg-green-600 hover:scale-105 active:scale-95 shadow-lg hover:shadow-green-500/25"} ${ue.createLeadBtn?"animate-pulse scale-95":""}`,onClick:ne,disabled:de||!pe,title:pe?de?"Creating lead, please wait...":"Click to create lead. Required fields will be validated.":" You don't have permission to create leads. Contact your administrator.",children:de?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Creating..."]}):pe?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-2",children:""}),"Create Lead"]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-2",children:""}),"No Permission"]})})]})]})]}),"reassignment"===e&&t.jsx(sa,{reassignmentActionLoading:ce,setReassignmentActionLoading:me,buttonAnimations:ue,animateButton:ge})]}),N&&t.jsx(na,{onClose:()=>{k(!1)},onSelect:e=>{j(e),k(!1)},assignableUsers:B})]})},getUserId:Yt},Symbol.toStringTag,{value:"Module"}));export{rt as $,u as A,h as B,S as C,y as D,U as E,J as F,q as G,b as H,W as I,at as J,G as K,ee as L,te as M,Xe as N,Ze as O,oe as P,Qe as Q,ce as R,pe as S,ke as T,Ae as U,Ve as V,he as W,Ie as X,R as Y,F as Z,Ee as _,He as a,ia as a$,lt as a0,dt as a1,Z as a2,Y as a3,We as a4,O as a5,_e as a6,se as a7,Ge as a8,P as a9,Nt as aA,jt as aB,kt as aC,nt as aD,st as aE,B as aF,K as aG,je as aH,ve as aI,H as aJ,qe as aK,Oe as aL,x as aM,Be as aN,g as aO,_ as aP,de as aQ,ne as aR,zt as aS,Ot as aT,pt as aU,Q as aV,be as aW,Ke as aX,w as aY,mt as aZ,Mt as a_,Ye as aa,Ne as ab,v as ac,fe as ad,tt as ae,p as af,X as ag,ye as ah,D as ai,M as aj,ie as ak,z as al,A as am,ae as an,Se as ao,ue as ap,re as aq,E as ar,$ as as,Tt as at,bt as au,xt as av,wt as aw,_t as ax,vt as ay,Ct as az,xe as b,V as c,I as d,T as e,C as f,Je as g,f as h,Pe as i,Me as j,Ue as k,Fe as l,Re as m,$e as n,j as o,N as p,Te as q,ze as r,le as s,ge as t,k as u,me as v,Ce as w,L as x,Le as y,we as z};
