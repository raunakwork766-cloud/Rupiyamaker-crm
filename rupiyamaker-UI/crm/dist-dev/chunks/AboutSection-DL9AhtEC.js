import{j as e}from"./vendor-mui-C1GmDdcn.js";import{r as t}from"./vendor-react-EzoxUMNY.js";import{g as a,aU as r}from"./lead-components-D4SHX7AQ.js";import"./vendor-utils-QXd9EeNt.js";import"./vendor-antd-BB3a0mYC.js";const n="/api";function o({onClose:a,onSelect:r,assignableUsers:n=[]}){const[o,s]=t.useState(""),l=n.length>0?n.map(e=>({id:e.id||e._id||e.user_id,name:e.name||`${e.first_name||""} ${e.last_name||""}`.trim()||e.username||e.id,designation:e.designation||e.title||e.role||""})):[],[i,d]=t.useState(l);return t.useEffect(()=>{""===o.trim()?d(l):d(l.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.designation&&e.designation.toLowerCase().includes(o.toLowerCase())))},[o,n]),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-transparent",children:e.jsxs("div",{className:"bg-white backdrop-blur-sm p-6 rounded-2xl shadow-2xl w-[90%] max-w-md mx-auto relative",children:[e.jsxs("div",{className:"flex items-center mb-4 p-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[#03B0F5] text-white flex items-center justify-center mr-3",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),e.jsx("h3",{className:"font-bold text-lg text-black",children:"Assign Lead"})]}),e.jsxs("div",{className:"mb-4 p-3",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-2",children:"Assign to"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",className:"w-full pl-10 pr-3 py-2 border border-cyan-400 rounded text-black font-bold",value:o,onChange:e=>s(e.target.value),placeholder:"Search by name or designation"}),o&&e.jsx("button",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600",onClick:()=>s(""),type:"button",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto mb-4 border rounded-lg",children:i.length>0?i.map(t=>e.jsxs("li",{className:"p-3 border-b last:border-b-0 cursor-pointer text-black transition hover:bg-gray-100 flex items-center",onClick:()=>{return s((e=t).name),r(e),void a();var e},children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[#03B0F5] text-white flex items-center justify-center mr-3 flex-shrink-0",children:t.name.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:t.name}),t.designation&&e.jsx("div",{className:"text-sm text-gray-500 font-normal",children:t.designation})]})]},t.id||t.name)):""!==o.trim()&&e.jsx("li",{className:"p-3 text-gray-500 text-center",children:"No matching assignees found."})}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4 p-3",children:[e.jsx("button",{className:"px-6 py-3 bg-cyan-600 text-white rounded-xl shadow hover:bg-cyan-700 transition",onClick:()=>{if(o){const e=l.find(e=>e.name.toLowerCase()===o.toLowerCase());r(e||{id:o.toLowerCase().replace(/\s+/g,"_"),name:o})}s(""),a()},children:"Assign"}),e.jsx("button",{className:"px-6 py-3 bg-gray-400 text-white rounded-xl shadow hover:bg-gray-500 transition",onClick:a,children:"Cancel"})]}),e.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-red-500 text-2xl font-bold",onClick:a,children:"Ã—"})]})})}function s({lead:s,onSave:l,canEdit:i=!0}){const[d,m]=t.useState([]),[c,u]=t.useState([]),[p,b]=t.useState([]),[g,_]=t.useState(!1),[h,f]=t.useState(!1),[y,x]=t.useState(!1),[N,w]=t.useState(""),[j,v]=t.useState(!1),C="block font-bold mb-2 uppercase",k={color:"black",fontWeight:650,fontSize:"15px"},[S,$]=t.useState({}),[A,T]=t.useState(!1),[I,L]=t.useState(null),[E,B]=t.useState([]),[U,D]=t.useState([]),[z,O]=t.useState(!1),[M,P]=t.useState([]),[R,G]=t.useState(!1),[W,J]=t.useState(!1),[F,H]=t.useState(!1),[V,q]=t.useState(""),[Y,K]=t.useState(""),[Q,X]=t.useState(""),Z=e=>{if(!s)return"";switch(e){case"id":return s.custom_lead_id||s.id||"";case"productName":return s.loan_type_name||s.loan_type||s.productName||"";case"loanTypeId":case"loan_type_id":return s.loan_type_id||"";case"loan_type":return s.loan_type||"";case"loan_type_name":return s.loan_type_name||s.loan_type||"";case"campaignName":return s.campaign_name||s.campaignName||"";case"dataCode":return s.data_code||s.dataCode||"";case"customerName":return s.name?s.name:`${s.first_name||""} ${s.last_name||""}`.trim()||s.customerName||"";case"mobileNumber":return s.mobile_number||s.phone||s.mobileNumber||"";case"alternateNumber":return s.alternative_phone||s.alternate_phone||s.alternateNumber||s.alternate_number||"";case"pincode_city":return s.pincode_city||"";default:return""}},[ee,te]=t.useState(()=>({id:s?.custom_lead_id||s?.id||"",productName:s?.loan_type_name||s?.loan_type||s?.productName||"",loanTypeId:s?.loan_type_id||"",loan_type:s?.loan_type||"",loan_type_id:s?.loan_type_id||"",loan_type_name:s?.loan_type_name||s?.loan_type||"",campaignName:s?.campaign_name||s?.campaignName||"",dataCode:s?.data_code||s?.dataCode||"",customerName:s?.name?s.name:`${s?.first_name||""} ${s?.last_name||""}`.trim()||s?.customerName||"",mobileNumber:s?.mobile_number||s?.phone||s?.mobileNumber||"",alternateNumber:s?.alternative_phone||s?.alternate_phone||s?.alternateNumber||s?.alternate_number||"",pincode_city:s?.pincode_city||""}));t.useEffect(()=>{if(s&&(te(e=>({id:Z("id")||e.id,productName:Z("productName")||e.productName,loanTypeId:Z("loanTypeId")||e.loanTypeId,loan_type:Z("loan_type")||e.loan_type,loan_type_id:Z("loan_type_id")||e.loan_type_id,loan_type_name:Z("loan_type_name")||e.loan_type_name,campaignName:Z("campaignName")||e.campaignName,dataCode:Z("dataCode")||e.dataCode,customerName:Z("customerName")||e.customerName,mobileNumber:Z("mobileNumber")||e.mobileNumber,alternateNumber:Z("alternateNumber")||e.alternateNumber,pincode_city:Z("pincode_city")||e.pincode_city})),s.assigned_to)){let t=[];try{if("string"==typeof s.assigned_to)try{t=JSON.parse(s.assigned_to)}catch{t=s.assigned_to.split(",").map(e=>({id:e.trim().toLowerCase().replace(/\s+/g,"_"),name:e.trim()}))}else Array.isArray(s.assigned_to)&&(t=s.assigned_to.map(e=>{if("string"==typeof e){const t=M.find(t=>t.id===e||t._id===e||t.user_id===e);return t?{id:t.id||t._id||t.user_id,name:t.name||t.username||`${t.first_name||""} ${t.last_name||""}`.trim()}:{id:e,name:e}}return"object"==typeof e?{id:e.id||e._id||e.user_id||e.name?.toLowerCase().replace(/\s+/g,"_"),name:e.name||e.username||`${e.first_name||""} ${e.last_name||""}`.trim()||e.id||"Unknown User"}:{id:String(e),name:String(e)}}))}catch(e){t=[]}B(t);let a=[];try{if(s.assign_report_to)if("string"==typeof s.assign_report_to)try{a=JSON.parse(s.assign_report_to)}catch{a=s.assign_report_to.split(",").map(e=>({id:e.trim().toLowerCase().replace(/\s+/g,"_"),name:e.trim()}))}else Array.isArray(s.assign_report_to)&&(a=s.assign_report_to.map(e=>{if("string"==typeof e){const t=M.find(t=>t.id===e||t._id===e||t.user_id===e);return t?{id:t.id||t._id||t.user_id,name:t.name||t.username||`${t.first_name||""} ${t.last_name||""}`.trim()}:{id:e,name:e}}return"object"==typeof e?{id:e.id||e._id||e.user_id||e.name?.toLowerCase().replace(/\s+/g,"_"),name:e.name||e.username||`${e.first_name||""} ${e.last_name||""}`.trim()||e.id||"Unknown User"}:{id:String(e),name:String(e)}}))}catch(e){a=[]}D(a),M.length>0&&re(s.assigned_to,s.assign_report_to,M)}},[s]),t.useEffect(()=>{oe(),se(),le(),ae(),ne()},[]),t.useEffect(()=>{const e=e=>{e.target.closest(".dropdown-container")||(G(!1),J(!1),H(!1),q(""),K(""),X(""))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const ae=async()=>{try{const e=localStorage.getItem("userId"),t=await fetch(`${n}/roles/users-one-level-above/${e}?requesting_user_id=${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(t.ok){const e=await t.json(),a=(Array.isArray(e)?e:[]).map(e=>({id:e._id||e.id,_id:e._id||e.id,name:e.name||`${e.first_name||""} ${e.last_name||""}`.trim()||e.username||"Unknown User",username:e.username,first_name:e.first_name,last_name:e.last_name,designation:e.designation,role_name:e.role_name,email:e.email,phone:e.phone}));P(a),s&&re(s.assigned_to,s.assign_report_to,a)}else P([])}catch(e){P([])}},re=async(e,t,a)=>{if(e||t)try{const r=Array.isArray(e)?e.filter(e=>"string"==typeof e):[],o=Array.isArray(t)?t.filter(e=>"string"==typeof e):[],s=[...new Set([...r,...o])],l={};for(const e of a){const t=e.id||e._id||e.user_id;t&&(l[t]=e)}const i=s.filter(e=>!l[e]);if(i.length>0){const e=await(async e=>{if(!e||0===e.length)return[];try{const t=localStorage.getItem("userId"),a=localStorage.getItem("token"),r=Array.isArray(e)?e:[e],o=await fetch(`${n}/users/details`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({user_ids:r,requesting_user_id:t})});return o.ok&&(await o.json()).users||[]}catch(t){return[]}})(i);for(const t of e){const e=t.id||t._id||t.user_id;e&&(l[e]=t)}}if(Array.isArray(e)&&e.length>0){const t=e.map(e=>"string"==typeof e?l[e]?{id:e,name:l[e].name||`${l[e].first_name||""} ${l[e].last_name||""}`.trim()||e}:{id:e,name:e}:e);B(t)}if(Array.isArray(t)&&t.length>0){const e=t.map(e=>"string"==typeof e?l[e]?{id:e,name:l[e].name||`${l[e].first_name||""} ${l[e].last_name||""}`.trim()||e}:{id:e,name:e}:e);D(e)}}catch(r){}},ne=()=>{const e=localStorage.getItem("userRole");localStorage.getItem("userDepartment");const t=a(),r=JSON.parse(localStorage.getItem("userData")||"{}");let n=!1;if("Super Admin"!==r.role_name&&"Super Admin"!==e||(n=!0),t&&Array.isArray(t)&&t.some(e=>"*"===e.page&&"*"===e.actions)&&(n=!0),r.permissions&&Array.isArray(r.permissions)&&r.permissions.some(e=>"*"===e.page&&"*"===e.actions)&&(n=!0),x(n),n)return void f(!0);const o=ge("alternateNumber")||"",s=!o||""===o.trim()||"none"===o.toLowerCase()||"null"===o.toLowerCase();f(s)},oe=async()=>{try{const e=localStorage.getItem("userId"),t=await fetch(`${n}/loan-types?user_id=${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(t.ok){const e=await t.json();m(e.items||e.loan_types||e||[])}}catch(e){}},se=async()=>{try{const e=localStorage.getItem("userId"),t=await fetch(`${n}/settings/campaign-names?user_id=${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(t.ok){const e=await t.json();u(e||[])}}catch(e){u([{_id:"1",name:"Digital Marketing"},{_id:"2",name:"Social Media"},{_id:"3",name:"Email Campaign"},{_id:"4",name:"Referral Program"}])}},le=async()=>{try{const e=localStorage.getItem("userId"),t=await fetch(`${n}/settings/data-codes?user_id=${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(t.ok){const e=await t.json();b(e||[])}}catch(e){b([{_id:"1",name:"DC001"},{_id:"2",name:"DC002"},{_id:"3",name:"DC003"},{_id:"4",name:"DC004"}])}},ie=()=>V?d.filter(e=>e.name.toLowerCase().includes(V.toLowerCase())):d,de=()=>Y?c.filter(e=>e.name.toLowerCase().includes(Y.toLowerCase())):c,me=()=>Q?p.filter(e=>e.name.toLowerCase().includes(Q.toLowerCase())):p,ce=async(e,t)=>{if(!("mobileNumber"===t&&e===s?.mobile_number||"alternateNumber"===t&&e===s?.alternative_phone))try{T(!0);const a=await(async(e,t=null)=>{try{const r=localStorage.getItem("userId");if(!r)return null;let n=`/api/leads/check-phone/${encodeURIComponent(e)}?user_id=${r}`;t&&(n+=`&loan_type_name=${encodeURIComponent(t)}`);const o=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const s=await o.json();if(s&&s.found&&s.leads&&s.leads.length>0)try{const e=`/api/leads/${s.leads[0].id}/reassignment-eligibility?user_id=${r}`,t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const e=await t.json();s.can_reassign=e.can_reassign,s.reassignment_reason=e.reason,s.days_elapsed=e.days_elapsed,s.reassignment_period=e.reassignment_period,s.days_remaining=e.days_remaining,s.is_manager_permission_required=e.is_manager_permission_required,e.lead&&(s.leads[0]={...s.leads[0],...e.lead})}}catch(a){}return s}catch(r){return null}})(e,ee.loan_type||ee.productName);if(a&&a.found){L(a);const e=(a.leads?a.leads.length:0)>0?a.leads[0]:null;let r="âš ï¸ This number is already registered";e&&(r+=` (Lead ID: ${e.custom_lead_id||e.id})`,e.name&&(r+=` - ${e.name}`)),$(e=>({...e,[t]:r})),w(`âš ï¸ Duplicate ${"mobileNumber"===t?"mobile":"alternate"} number found`),setTimeout(()=>w(""),5e3)}else $(e=>({...e,[t]:null})),L(null)}catch(a){}finally{T(!1)}},ue=(e,t)=>{let a=t;if("pincode_city"===e)a=(e=>{if(!e||""===e.trim())return"";let t=(e=e.toUpperCase()).replace(/,/g,"").replace(/\s+/g," ").trim();const a=t.replace(/[^0-9]/g,"");if(a.length<6)return a;const r=a.substring(0,6);let n=0,o=0;for(let l=0;l<t.length;l++)if(/[0-9]/.test(t[l])&&(o++,6===o)){n=l+1;break}const s=t.substring(n).trim();return s?`${r}, ${s}`:6===a.length?(e.includes(","),`${r}, `):r})(t);else if("alternateNumber"===e){if(a=t.replace(/\D/g,"").slice(0,10),a&&a===ee.mobileNumber)return void $(e=>({...e,alternateNumber:"Alternate number cannot be the same as mobile number"}));10===a.length?($(e=>({...e,alternateNumber:null})),ce(a,"alternateNumber")):0===a.length&&$(e=>({...e,alternateNumber:null}))}else if("mobileNumber"===e){a=t.replace(/\D/g,"").slice(0,10);const e=be(a);e.isValid?($(e=>({...e,mobileNumber:null})),10===a.length&&ce(a,"mobileNumber")):$(t=>({...t,mobileNumber:e.error})),a&&a===ee.alternateNumber&&(te(e=>({...e,alternateNumber:""})),$(e=>({...e,alternateNumber:"Alternate number cleared as it matched mobile number"})),setTimeout(()=>{$(e=>({...e,alternateNumber:null}))},3e3)),ee.alternateNumber&&a===ee.alternateNumber?$(e=>({...e,alternateNumber:"Alternate number cannot be the same as mobile number"})):ee.alternateNumber&&a!==ee.alternateNumber&&$(e=>({...e,alternateNumber:null}))}else"string"!=typeof t||["mobileNumber","alternateNumber"].includes(e)||(a=t.toUpperCase());const r={...ee,[e]:a};if("productName"===e){const e=d.find(e=>e.name===a);if(e)return r.loanTypeId=e._id,te({...r,loan_type:t,loan_type_id:e._id,loan_type_name:t}),r.loan_type=t,r.loan_type_id=e._id,void(r.loan_type_name=t)}te(r)},pe=async(e,t)=>{const a=ge(e);if("alternateNumber"===e){if(t&&t===ee.mobileNumber)return $(e=>({...e,alternateNumber:"Alternate number cannot be the same as mobile number"})),w("âŒ Save failed: Duplicate number"),void setTimeout(()=>w(""),3e3);if(t&&(10!==t.length||!/^[6-9]/.test(t)))return $(e=>({...e,alternateNumber:"Alternate number must be 10 digits starting with 6, 7, 8, or 9"})),w("âŒ Save failed: Invalid number format"),void setTimeout(()=>w(""),3e3)}if(("mobileNumber"===e||"alternateNumber"===e)&&S[e]&&S[e].includes("already registered"))return w("âŒ Save failed: Duplicate number detected"),void setTimeout(()=>w(""),3e3);if(t!==a){v(!0),w("ðŸ’¾ Saving...");try{te(a=>({...a,[e]:t}));let a={};const n={id:"custom_lead_id",productName:"loan_type",loanTypeId:"loan_type_id",campaignName:"campaign_name",dataCode:"data_code",customerName:"name",mobileNumber:"mobile_number",alternateNumber:"alternative_phone",pincode_city:"pincode_city"}[e]||e;if("customerName"===e){const e=t.trim().split(/\s+/),r=e[0]||"",n=e.slice(1).join(" ")||"";a={name:t,first_name:r,last_name:n}}else if("productName"===e){const e=d.find(e=>e.name===t);a=e?{loan_type_id:e._id,loan_type:t,loan_type_name:t}:{[n]:t}}else a={[n]:t};let o=!1;if(l&&"function"==typeof l)try{const e=l(a);e instanceof Promise&&await e,o=!0}catch(r){}!o&&s?._id&&await _e(e,t,a),te(a=>({...a,[e]:t})),w("âœ… Saved successfully!"),setTimeout(()=>w(""),3e3)}catch(r){w("âŒ Save failed"),setTimeout(()=>w(""),5e3)}finally{v(!1)}}},be=e=>e?10!==e.length?{isValid:!1,error:`Number must be 10 digits (${e.length} digits entered)`}:/^[6-9]/.test(e)?{isValid:!0,error:null}:{isValid:!1,error:"Number must start with 6, 7, 8, or 9"}:{isValid:!0,error:null},ge=e=>Z(e),_e=async(e,t,a=null)=>{if(!s?._id)return!1;try{const n=localStorage.getItem("userId");if(!n)return!1;const o=s.original_lead_id||s.login_created_at?`/api/lead-login/login-leads/${s._id}?user_id=${n}`:`/api/leads/${s._id}?user_id=${n}`;if(a){const e=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(a)});if(!e.ok){const t=await e.text();throw new Error(`HTTP error! status: ${e.status}, message: ${t}`)}await e.json();try{const e=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const t=await e.json();te(e=>({...e,id:t.custom_lead_id||t.id||e.id,productName:t.loan_type||e.productName,loanTypeId:t.loan_type_id||e.loanTypeId,loan_type:t.loan_type||e.loan_type,loan_type_id:t.loan_type_id||e.loan_type_id,loan_type_name:t.loan_type_name||t.loan_type||e.loan_type_name,campaignName:t.campaign_name||e.campaignName,dataCode:t.data_code||e.dataCode,customerName:t.name||e.customerName,mobileNumber:t.mobile_number||t.phone||e.mobileNumber,alternateNumber:t.alternative_phone||t.alternate_phone||e.alternateNumber}))}}catch(r){}return!0}const l={id:"custom_lead_id",productName:"loan_type",loanTypeId:"loan_type_id",campaignName:"campaign_name",dataCode:"data_code",customerName:"name",mobileNumber:"mobile_number",alternateNumber:"alternative_phone"}[e]||e;let i={};if("customerName"===e){const e=t.trim().split(/\s+/),a=e[0]||"",r=e.slice(1).join(" ")||"";i={name:t,first_name:a,last_name:r},s&&(s.name=t,s.first_name=a,s.last_name=r),te(e=>({...e,customerName:t,first_name:a,last_name:r}))}else if(l.includes(".")){const e=l.split(".");"dynamic_fields"===e[0]&&(i={dynamic_fields:{...s.dynamic_fields,[e[1]]:{...s.dynamic_fields?.[e[1]],[e[2]]:t}}})}else i={[l]:t};const d=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(i)});if(!d.ok){const e=await d.text();throw new Error(`HTTP error! status: ${d.status}, message: ${e}`)}await d.json();try{const e=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const t=await e.json();te(e=>({...e,id:t.custom_lead_id||t.id||e.id,productName:t.loan_type||e.productName,loanTypeId:t.loan_type_id||e.loanTypeId,loan_type:t.loan_type||e.loan_type,loan_type_id:t.loan_type_id||e.loan_type_id,loan_type_name:t.loan_type_name||t.loan_type||e.loan_type_name,campaignName:t.campaign_name||e.campaignName,dataCode:t.data_code||e.dataCode,customerName:t.name||e.customerName,mobileNumber:t.mobile_number||t.phone||e.mobileNumber,alternateNumber:t.alternative_phone||t.alternate_phone||e.alternateNumber}))}}catch(r){}return!0}catch(n){return!1}},he=async(e,t=[])=>{if(s?._id)try{const n=localStorage.getItem("userId");if(!n)return;const o=s.original_lead_id||s.login_created_at?`/api/lead-login/login-leads/${s._id}?user_id=${n}`:`/api/leads/${s._id}?user_id=${n}`,i=e.map(e=>"object"==typeof e?e.id||e._id||e.user_id||e.name?.toLowerCase().replace(/\s+/g,"_"):e).filter(e=>e),d=t.map(e=>"object"==typeof e?e.id||e._id||e.user_id||e.name?.toLowerCase().replace(/\s+/g,"_"):e).filter(e=>e),m={assigned_to:i.length>0?i.map(e=>String(e).replace(/[\[\]']/g,"")):null,assign_report_to:d.length>0?d.map(e=>String(e).replace(/[\[\]']/g,"")):null},c=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(m)});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);try{const e=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const t=await e.json();t.assigned_to&&re(t.assigned_to,t.assign_report_to,M)}}catch(a){}if(l){const e={...s,assigned_to:i,assign_report_to:d};try{const t=l(e);t instanceof Promise&&await t}catch(r){}}}catch(r){}};return e.jsxs("div",{className:"p-7 rounded-2xl border-2 border-cyan-400/70 bg-white shadow-2xl text-[1.1rem] relative overflow-visible",children:[e.jsx("div",{className:"absolute -right-12 -top-10 w-40 h-40 bg-white rounded-full blur-2xl"}),e.jsx("div",{className:"absolute -left-16 top-20 w-28 h-28 bg-white rounded-full blur-2xl"}),(j||N)&&e.jsx("div",{className:"absolute top-4 right-4 z-20",children:e.jsxs("div",{className:"px-3 py-1 rounded-full text-sm font-bold flex items-center gap-2 "+(j?"bg-blue-100 text-blue-700 border border-blue-300":N.includes("âœ…")?"bg-green-100 text-green-700 border border-green-300":"bg-red-100 text-red-700 border border-red-300"),children:[j&&e.jsx("div",{className:"w-3 h-3 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:N})]})}),e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 font-extrabold text-cyan-300 text-[1.2rem] z-10 relative",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"LEAD ID"}),e.jsx("input",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-gray-100 text-green-600 text-md font-bold cursor-not-allowed",value:ee.id,readOnly:!0,placeholder:"Lead ID (Read-only)",title:"Lead ID cannot be modified"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"LEAD DATE & TIME"}),e.jsx("input",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-gray-100 text-green-600 text-md font-bold cursor-not-allowed",value:s?.created_at?r(s.created_at):"N/A",readOnly:!0,placeholder:"Date & Time (Read-only)",title:"Lead creation date and time (IST)"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"CREATED BY"}),e.jsx("input",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-gray-100 text-green-600 text-md font-bold cursor-not-allowed",value:s?.created_by_name?"object"==typeof s.created_by_name?s.created_by_name.name||s.created_by_name.first_name||"Unknown":s.created_by_name:s?.created_by?"object"==typeof s.created_by?s.created_by.name||s.created_by.first_name||"Unknown":s.created_by:"N/A",readOnly:!0,placeholder:"Created By (Read-only)",title:"User who created this lead"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"TEAM NAME"}),e.jsx("input",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-gray-100 text-green-600 text-md font-bold cursor-not-allowed",value:s?.department_name?"object"==typeof s.department_name?s.department_name.name||"Unknown":s.department_name:s?.team_name?"object"==typeof s.team_name?s.team_name.name||"Unknown":s.team_name:"N/A",readOnly:!0,placeholder:"Team Name (Read-only)",title:"Department/Team name for this lead"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"PRODUCT NAME"}),e.jsxs("div",{className:"relative w-full dropdown-container",children:[e.jsxs("div",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold cursor-pointer flex items-center justify-between transition-all duration-300 focus-within:border-[#0097a7] focus-within:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] "+(i?"":"bg-gray-100 cursor-not-allowed"),onClick:()=>{i&&(J(!1),H(!1),G(!R))},children:[e.jsx("span",{children:ee.productName||"Select Product Type"}),e.jsx("svg",{className:"w-4 h-4 text-[#00bcd4]",fill:"none",stroke:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"m6 8 4 4 4-4"})})]}),R&&i&&e.jsxs("div",{className:"absolute w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto z-50 mt-1",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:border-[#00bcd4]",placeholder:"Search product types...",value:V,onChange:e=>q(e.target.value),onClick:e=>e.stopPropagation()})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:ie().length>0?ie().map(t=>e.jsx("div",{className:"px-4 py-2 text-md font-bold text-green-600 hover:bg-gray-100 cursor-pointer",onClick:()=>{ue("productName",t.name),pe("productName",t.name),G(!1),q("")},children:t.name},t._id)):e.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No products found"})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"CAMPAIGN NAME"}),e.jsxs("div",{className:"relative w-full dropdown-container",children:[e.jsxs("div",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold cursor-pointer flex items-center justify-between transition-all duration-300 focus-within:border-[#0097a7] focus-within:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] "+(i?"":"bg-gray-100 cursor-not-allowed"),onClick:()=>{i&&(G(!1),H(!1),J(!W))},children:[e.jsx("span",{children:ee.campaignName||"Select Campaign"}),e.jsx("svg",{className:"w-4 h-4 text-[#00bcd4]",fill:"none",stroke:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"m6 8 4 4 4-4"})})]}),W&&i&&e.jsxs("div",{className:"absolute w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto z-50 mt-1",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:border-[#00bcd4]",placeholder:"Search campaigns...",value:Y,onChange:e=>K(e.target.value),onClick:e=>e.stopPropagation()})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:de().length>0?de().map(t=>e.jsx("div",{className:"px-4 py-2 text-md font-bold text-green-600 hover:bg-gray-100 cursor-pointer",onClick:()=>{ue("campaignName",t.name),pe("campaignName",t.name),J(!1),K("")},children:t.name},t._id)):e.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No campaigns found"})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"DATA CODE"}),e.jsxs("div",{className:"relative w-full dropdown-container",children:[e.jsxs("div",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold cursor-pointer flex items-center justify-between transition-all duration-300 focus-within:border-[#0097a7] focus-within:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] "+(i?"":"bg-gray-100 cursor-not-allowed"),onClick:()=>{i&&(G(!1),J(!1),H(!F))},children:[e.jsx("span",{children:ee.dataCode||"Select Data Code"}),e.jsx("svg",{className:"w-4 h-4 text-[#00bcd4]",fill:"none",stroke:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"m6 8 4 4 4-4"})})]}),F&&i&&e.jsxs("div",{className:"absolute w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto z-50 mt-1",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:border-[#00bcd4]",placeholder:"Search data codes...",value:Q,onChange:e=>X(e.target.value),onClick:e=>e.stopPropagation()})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:me().length>0?me().map(t=>e.jsx("div",{className:"px-4 py-2 text-md font-bold text-green-600 hover:bg-gray-100 cursor-pointer",onClick:()=>{ue("dataCode",t.name),pe("dataCode",t.name),H(!1),X("")},children:t.name},t._id)):e.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No data codes found"})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"CUSTOMER NAME"}),e.jsx("input",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold transition-all duration-300 focus:border-[#0097a7] focus:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] "+(i?"":"bg-gray-100 cursor-not-allowed"),value:ee.customerName,onChange:e=>i&&ue("customerName",e.target.value.toLocaleUpperCase()),onBlur:e=>i&&pe("customerName",e.target.value.toLocaleUpperCase()),readOnly:!i,placeholder:i?"Enter customer name":"Read-only: No edit permission"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"MOBILE NUMBER"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{className:"w-full p-3 border-2 rounded-md text-green-600 text-md font-bold transition-all duration-300 focus:border-[#0097a7] focus:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] "+(y?S.mobileNumber?"border-red-500 bg-red-50":"border-[#00bcd4] bg-white":"bg-gray-100 cursor-not-allowed border-[#00bcd4]"),value:ee.mobileNumber,onChange:e=>y&&ue("mobileNumber",e.target.value),onBlur:e=>y&&pe("mobileNumber",e.target.value),readOnly:!y,placeholder:y?"Enter 10-digit mobile number":"Super Admin only",maxLength:"10",pattern:"[0-9]{10}",title:y?"Enter mobile number":"Only Super Admin can edit mobile number"}),S.mobileNumber&&e.jsx("div",{className:"text-red-500 text-sm mt-1 font-normal",children:S.mobileNumber}),A&&e.jsxs("div",{className:"text-blue-500 text-sm mt-1 font-normal flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),"Checking for duplicates..."]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"ALTERNATE NUMBER"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{className:"w-full p-3 border-2 rounded-md text-green-600 text-md font-bold transition-all duration-300 focus:border-[#0097a7] focus:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] "+(h?S.alternateNumber?"border-red-500 bg-red-50":"border-[#00bcd4] bg-white":"bg-gray-100 cursor-not-allowed border-[#00bcd4]"),value:ee.alternateNumber,onChange:e=>h&&ue("alternateNumber",e.target.value),onBlur:e=>h&&pe("alternateNumber",e.target.value),readOnly:!h,placeholder:h||y?"Enter 10-digit alternate number":"Super Admin only",maxLength:"10",pattern:"[0-9]{10}",title:h||y?"Enter alternate number":"Only Super Admin can edit alternate number"}),S.alternateNumber&&e.jsx("div",{className:"text-red-500 text-sm mt-1 font-normal",children:S.alternateNumber}),A&&e.jsxs("div",{className:"text-blue-500 text-sm mt-1 font-normal flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),"Checking for duplicates..."]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"PINCODE & CITY"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{className:"w-full p-3 pr-12 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold transition-all duration-300 focus:border-[#0097a7] focus:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] "+(i?"":"bg-gray-100 cursor-not-allowed"),value:ee.pincode_city,onChange:e=>i&&ue("pincode_city",e.target.value),onBlur:e=>i&&pe("pincode_city",e.target.value),readOnly:!i,placeholder:i?"Enter 6-digit pincode (auto-formats: 123456, City Name)":"Read-only: No edit permission"}),e.jsx("button",{type:"button",onClick:()=>{const e=ee.pincode_city||"";e.trim()?window.open(`https://www.google.com/maps/search/${encodeURIComponent(e)}`,"_blank"):window.open("https://www.google.com/maps","_blank")},className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-2 bg-[#00bcd4] hover:bg-[#0097a7] text-white rounded-md transition-all duration-200 flex items-center justify-center",title:"Search on Google Maps",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:C,style:k,children:"ASSIGNED TL"}),e.jsx("div",{className:"relative w-full dropdown-container",children:e.jsxs("div",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold min-h-[52px] flex flex-wrap gap-2 items-center cursor-pointer transition-all duration-300 focus-within:border-[#0097a7] focus-within:shadow-[0_0_0_3px_rgba(0,188,212,0.1)]",onClick:()=>O(!0),children:[0===U.length&&e.jsx("span",{className:"text-gray-400",children:"Click to select assignees"}),U.map(t=>{const a="object"==typeof t?t.name:t,r="object"==typeof t?t.id||t.name:t;return e.jsxs("div",{className:"flex items-center gap-2 bg-[#03B0F5] text-white pl-2 pr-1 py-1 rounded-md text-sm",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-white text-[#03B0F5] flex items-center justify-center flex-shrink-0 text-xs font-bold",children:a.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase()}),e.jsx("span",{className:"text-xs",children:a}),e.jsx("button",{type:"button",className:"text-white hover:text-red-200 ml-1 text-sm",onClick:e=>{e.stopPropagation(),(e=>{const t=U.filter(t=>("object"==typeof t?t.id:t)!==("object"==typeof e?e.id:e));D(t),he(E,t)})(t)},children:"Ã—"})]},r)}),U.length>0&&e.jsx("button",{type:"button",className:"w-6 h-6 rounded-full bg-[#03B0F5] hover:bg-cyan-700 text-white flex items-center justify-center text-sm",onClick:e=>{e.stopPropagation(),O(!0)},children:"+"})]})})]})]})}),z&&e.jsx(o,{onClose:()=>O(!1),onSelect:e=>{(e=>{"object"==typeof e&&e.id;const t="object"==typeof e?e.name:e;if(!U.some(a=>"object"==typeof a&&"object"==typeof e?a.id===e.id:"string"==typeof a&&"string"==typeof e?a===e:("object"==typeof a?a.name:a)===t)){const t=[...U,e];D(t),he(E,t)}})(e),O(!1)},assignableUsers:M})]})}export{s as default};
