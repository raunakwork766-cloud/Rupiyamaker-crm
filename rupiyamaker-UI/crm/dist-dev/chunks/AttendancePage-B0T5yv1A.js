import{j as e}from"./vendor-mui-C1GmDdcn.js";import{r as t}from"./vendor-react-EzoxUMNY.js";import{a7 as a}from"./vendor-utils-QXd9EeNt.js";import{f as s}from"./employee-components-DG4zFnGp.js";import{j as r,k as n,n as l,o as d,h as o,p as c,Y as i,l as x,X as m,aJ as h,U as g,S as y,s as b,ab as p}from"./lead-components-BqJ0uj9n.js";import"./vendor-antd-BB3a0mYC.js";import"./vendor-office-CbbGW2MO.js";const u="/api",f=()=>{const e=(()=>{const e=localStorage.getItem("userData");return e?JSON.parse(e):null})();return{"Content-Type":"application/json",...e?.token&&{Authorization:`Bearer ${e.token}`}}},j=async(e,t,s)=>{try{return(await a.get(`${u}/attendance/calendar`,{params:{year:e,month:t,user_id:s},headers:f()})).data}catch(r){throw r}},N=async(e,t,s)=>{try{return(await a.get(`${u}/attendance/detail/${e}/${t}`,{params:{requester_id:s},headers:f()})).data}catch(r){throw r}},v=async(e,t,s)=>{try{return(await a.get(`${u}/attendance/comments/${e}/${t}`,{params:{requester_id:s},headers:f()})).data}catch(r){throw r}},w=async(e,t,s)=>{try{return(await a.get(`${u}/attendance/history/${e}/${t}`,{params:{requester_id:s},headers:f()})).data}catch(r){throw r}},_=async(e=null,t=null,s)=>{try{const r={user_id:s};return e&&(r.year=e),t&&(r.month=t),(await a.get(`${u}/attendance/holidays`,{params:r,headers:f()})).data}catch(r){throw r}},k=t=>{switch(t){case"P":return e.jsx("div",{className:"w-8 h-8 bg-green-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"P"});case"L":return e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-yellow-500 to-orange-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"L"});case"LV":return e.jsx("div",{className:"w-8 h-8 bg-orange-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"LV"});case"H":return e.jsx("div",{className:"w-8 h-8 bg-blue-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"H"});case"HD":return e.jsx("div",{className:"w-8 h-8 bg-yellow-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"HD"});case"AB":return e.jsx("div",{className:"w-8 h-8 bg-red-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"AB"});default:return e.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center text-xs text-gray-400",children:"-"})}},C=(e,t,a)=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date(e,t-1,a).getDay()],S=["January","February","March","April","May","June","July","August","September","October","November","December"],A=({isOpen:r,onClose:n,holidays:l,onUpdateHolidays:d,selectedYear:o,selectedMonth:c})=>{const[i,x]=t.useState(""),[h,g]=t.useState(""),[y,j]=t.useState(""),[N,v]=t.useState(!1),[w,k]=t.useState(null),[C,A]=t.useState([]),[$,D]=t.useState("");t.useEffect(()=>{const e=localStorage.getItem("userData");e&&k(JSON.parse(e))},[]),t.useEffect(()=>{r&&w?.user_id&&E()},[r,w,o,c]);const E=async()=>{if(w?.user_id){v(!0),D("");try{const e=await _(o,c,w.user_id);e.success?A(e.holidays||[]):D("Failed to load holidays")}catch(e){D("Failed to load holidays. Please try again."),A([])}finally{v(!1)}}};if(!r)return null;const L=C.filter(e=>{const t=new Date(e.date);return t.getFullYear()===o&&t.getMonth()+1===c}),T=async e=>{if(w?.user_id){v(!0),D("");try{const t=await(async(e,t)=>{try{return(await a.delete(`${u}/attendance/holidays/${e}`,{params:{user_id:t},headers:f()})).data}catch($){throw $}})(e,w.user_id);t.success?(await E(),d(C.filter(t=>t._id!==e))):D(t.message||"Failed to delete holiday")}catch(t){D(t.response?.data?.detail||"Failed to delete holiday. Please try again.")}finally{v(!1)}}},H=e=>s(e);return e.jsx("div",{className:"fixed inset-0 bg-transparent bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 text-white p-4 rounded-t-lg relative",children:[e.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-white hover:text-gray-200 transition-colors",children:e.jsx(m,{className:"h-6 w-6"})}),e.jsx("h2",{className:"text-xl font-bold",children:"Holiday Management"}),e.jsxs("p",{className:"text-cyan-100 text-sm mt-1",children:["Manage company holidays for ",S[c-1]," ",o]})]}),e.jsxs("div",{className:"p-6 bg-gray-900",children:[$&&e.jsx("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-700 rounded-lg",children:e.jsx("p",{className:"text-red-200 text-sm",children:$})}),N&&e.jsxs("div",{className:"mb-4 flex items-center justify-center py-4",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-cyan-500"}),e.jsx("span",{className:"text-gray-300 ml-2",children:"Processing..."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Add New Holiday"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Holiday Date *"}),e.jsx("input",{type:"date",value:i,onChange:e=>x(e.target.value),className:"w-full p-3 border border-gray-600 rounded-lg bg-gray-800 text-gray-200 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",disabled:N})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Holiday Name *"}),e.jsx("input",{type:"text",value:h,onChange:e=>g(e.target.value),placeholder:"e.g., Independence Day",className:"w-full p-3 border border-gray-600 rounded-lg bg-gray-800 text-gray-200 placeholder-gray-500 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",disabled:N})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description (Optional)"}),e.jsx("input",{type:"text",value:y,onChange:e=>j(e.target.value),placeholder:"Additional details about the holiday",className:"w-full p-3 border border-gray-600 rounded-lg bg-gray-800 text-gray-200 placeholder-gray-500 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",disabled:N})]})]}),e.jsxs("button",{onClick:async()=>{if(i&&h&&w?.user_id){v(!0),D("");try{const e=await(async(e,t,s,r)=>{try{const n={name:e,date:t,user_id:r};return s&&(n.description=s),(await a.post(`${u}/attendance/holidays/add`,null,{params:n,headers:f()})).data}catch($){throw $}})(h,i,y,w.user_id);e.success?(await E(),x(""),g(""),j(""),d(C)):D(e.message||"Failed to add holiday")}catch(e){D(e.response?.data?.detail||"Failed to add holiday. Please try again.")}finally{v(!1)}}else D("Please fill in all required fields")},disabled:N||!i||!h,className:"mt-4 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 disabled:from-gray-600 disabled:to-gray-700 text-white px-6 py-2 flex items-center gap-2 rounded-md transition-colors",children:[e.jsx(b,{className:"h-4 w-4"}),N?"Adding...":"Add Holiday"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:["Holidays for ",S[c-1]," ",o]}),0===L.length?e.jsx("div",{className:"text-center py-8 bg-gray-800 rounded-lg border border-gray-700",children:e.jsx("p",{className:"text-gray-400",children:"No holidays set for this month"})}):e.jsx("div",{className:"space-y-3",children:L.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-200",children:t.name}),e.jsx("div",{className:"text-sm text-gray-400",children:H(t.date)}),t.description&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:t.description})]}),e.jsx("button",{onClick:()=>T(t._id),disabled:N,className:"text-red-400 border border-red-700 hover:bg-red-900/50 disabled:opacity-50 px-3 py-1 rounded-md text-sm transition-colors flex items-center gap-1",children:e.jsx(p,{className:"h-4 w-4"})})]},t._id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"All Company Holidays"}),0===C.length?e.jsx("div",{className:"text-center py-8 bg-gray-800 rounded-lg border border-gray-700",children:e.jsx("p",{className:"text-gray-400",children:"No holidays configured"})}):e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 bg-gray-800 rounded-lg border border-gray-700 p-4",children:C.sort((e,t)=>new Date(e.date)-new Date(t.date)).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded border border-gray-600 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-200",children:t.name}),e.jsx("span",{className:"text-gray-400 ml-2",children:H(t.date)}),t.description&&e.jsx("div",{className:"text-gray-500 text-xs mt-1",children:t.description})]}),e.jsx("button",{onClick:()=>T(t._id),disabled:N,className:"text-red-400 border border-red-700 hover:bg-red-900/50 disabled:opacity-50 px-2 py-1 rounded-md text-sm transition-colors",children:e.jsx(p,{className:"h-3 w-3"})})]},t._id))})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:n,className:"bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white px-6 py-2 rounded-md transition-colors",children:"Close"})})]})]})})},$=({employee:n,selectedDate:l,isOpen:d,onClose:o,onUpdate:c,selectedYear:i,selectedMonth:b,canUserEdit:p})=>{const[j,_]=t.useState(""),[k,C]=t.useState(!1),[S,A]=t.useState([]),[$,D]=t.useState(""),[E,L]=t.useState([]),[T,H]=t.useState(null),[P,O]=t.useState(!1),[M,U]=t.useState(null);t.useEffect(()=>{const e=localStorage.getItem("userData");e&&U(JSON.parse(e))},[]),t.useEffect(()=>{d&&n&&l&&M?.user_id&&F()},[d,n,l,M]);const I=()=>!!n?.id&&("own"!==r("attendance")&&(p&&"function"==typeof p?p(n.id):x("attendance",n.id))),F=async()=>{if(n&&l&&M?.user_id){O(!0);try{const t=`${i}-${String(b).padStart(2,"0")}-${String(l).padStart(2,"0")}`,a=await N(n.id,t,M.user_id);H(a);try{const e=await v(n.id,t,M.user_id);A(e.comments||[])}catch(e){A([])}try{const e=await w(n.id,t,M.user_id);L(e.history||[])}catch(e){L([])}}catch(e){}finally{O(!1)}}};if(!d||!n)return null;const R=(e=>{switch(e){case"P":return"PRESENT";case"L":return"LATE";case"LV":return"LEAVE";case"H":return"HOLIDAY";case"HD":return"HALF DAY";case"AB":return"ABSCONDING";default:return"NOT MARKED"}})(n[`day${l}`]||"A"),B=(e,t,a)=>`${e}-${String(t).padStart(2,"0")}-${String(a).padStart(2,"0")}`,Y=async()=>{if($.trim()&&M?.user_id&&n&&l){O(!0);try{const e=`${i}-${String(b).padStart(2,"0")}-${String(l).padStart(2,"0")}`;await(async(e,t,s,r)=>{try{return(await a.post(`${u}/attendance/comments/add?user_id=${e}&date=${t}&content=${encodeURIComponent(s)}&requester_id=${r}`,{},{headers:f()})).data}catch(n){throw n}})(n.id,e,$.trim(),M.user_id);const t=await v(n.id,e,M.user_id);A(t.comments||[]),D("")}catch(e){alert("Failed to add comment. Please try again.")}finally{O(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-transparent bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 text-white p-4 rounded-t-lg relative",children:[e.jsx("button",{onClick:o,className:"absolute top-4 right-4 text-white hover:text-gray-200 transition-colors",children:e.jsx(m,{className:"h-6 w-6"})}),e.jsx("h2",{className:"text-xl font-bold",children:"ADMIN PANEL"})]}),e.jsx("div",{className:" bg-gray-800 border-b border border-gray-700",children:e.jsxs("div",{className:"text-gray-200 space-y-2",children:[e.jsxs("p",{className:"font-semibold text-cyan-400",children:[n.department.toUpperCase()," | ADMIN"]}),e.jsxs("p",{className:"text-gray-300",children:["EMP-ID: ",n.employee_code||n.employee_number||n.empId||`EMP-${n.id?.slice(-6)||"UNKNOWN"}`]}),e.jsxs("p",{className:"text-gray-300",children:["ATTENDANCE: ",e.jsx("span",{className:"text-cyan-400 font-semibold",children:R})]}),T&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-300",children:["EMPLOYEE NAME: ",e.jsx("span",{className:"text-cyan-400",children:T.employee?.employee_name||T.employee_name})]}),e.jsxs("p",{className:"text-gray-300",children:["DATE: ",e.jsx("span",{className:"text-cyan-400",children:T.date})]}),e.jsxs("p",{className:"text-gray-300",children:["STATUS: ",e.jsx("span",{className:"text-cyan-400",children:T.status_text})]}),"leave"===T.type&&T.leave_details&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-300",children:["LEAVE TYPE: ",e.jsx("span",{className:"text-orange-400",children:T.leave_details.leave_type_display})]}),e.jsxs("p",{className:"text-gray-300",children:["REASON: ",e.jsx("span",{className:"text-yellow-400",children:T.leave_details.reason})]}),e.jsxs("p",{className:"text-gray-300",children:["DURATION: ",e.jsxs("span",{className:"text-green-400",children:[T.leave_details.duration_days," day(s)"]})]}),e.jsxs("p",{className:"text-gray-300",children:["APPROVED BY: ",e.jsx("span",{className:"text-purple-400",children:T.leave_details.approved_by_name})]}),T.leave_details.approval_comments&&e.jsxs("p",{className:"text-gray-300",children:["APPROVAL COMMENTS: ",e.jsx("span",{className:"text-blue-400",children:T.leave_details.approval_comments})]})]}),"attendance"===T.type&&e.jsxs(e.Fragment,{children:[T.attendance_details?.total_working_hours&&e.jsxs("p",{className:"text-gray-300",children:["TOTAL HOURS: ",e.jsxs("span",{className:"text-green-400",children:[T.attendance_details.total_working_hours," hours"]})]}),T.working_hours&&e.jsxs("p",{className:"text-gray-300",children:["TOTAL HOURS: ",e.jsxs("span",{className:"text-green-400",children:[T.working_hours," hours"]})]}),T.is_late&&e.jsxs("p",{className:"text-gray-300",children:["LATE: ",e.jsx("span",{className:"text-yellow-400",children:"Yes"})]})]})]})]})}),e.jsxs("div",{className:"p-6 bg-gray-900",children:[P?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"}),e.jsx("p",{className:"text-gray-400 mt-2",children:"Loading attendance details..."})]}):"leave"===T?.type?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-yellow-600 text-white p-4 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"ðŸ–ï¸ LEAVE DETAILS"}),e.jsx("p",{className:"text-orange-100",children:"Employee is on approved leave for this date"})]}),T.leave_details&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border border-gray-600 rounded-lg bg-gray-800",children:[e.jsx("div",{className:"bg-gray-700 p-3 border-b border-gray-600",children:e.jsx("h3",{className:"font-semibold text-gray-200",children:"LEAVE INFORMATION"})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Leave Type:"}),e.jsx("span",{className:"text-orange-400 font-semibold",children:T.leave_details.leave_type_display})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Duration:"}),e.jsxs("span",{className:"text-green-400 font-semibold",children:[T.leave_details.duration_days," day(s)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("span",{className:"text-green-400 font-semibold uppercase",children:T.leave_details.status_display||T.leave_details.status})]}),T.leave_details.from_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"From Date:"}),e.jsx("span",{className:"text-cyan-400",children:s(T.leave_details.from_date)})]}),T.leave_details.to_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"To Date:"}),e.jsx("span",{className:"text-cyan-400",children:s(T.leave_details.to_date)})]})]})]}),e.jsxs("div",{className:"border border-gray-600 rounded-lg bg-gray-800",children:[e.jsx("div",{className:"bg-gray-700 p-3 border-b border-gray-600",children:e.jsx("h3",{className:"font-semibold text-gray-200",children:"REASON & APPROVAL"})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400 block mb-1",children:"Reason:"}),e.jsx("div",{className:"bg-gray-700 p-3 rounded border text-yellow-400",children:T.leave_details.reason||"No reason provided"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Approved By:"}),e.jsx("span",{className:"text-purple-400 font-semibold",children:T.leave_details.approved_by_name||"Unknown"})]}),T.leave_details.approved_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Approved At:"}),e.jsx("span",{className:"text-cyan-400",children:s(T.leave_details.approved_at)})]}),T.leave_details.approval_comments&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400 block mb-1",children:"Approval Comments:"}),e.jsx("div",{className:"bg-gray-700 p-3 rounded border text-blue-400",children:T.leave_details.approval_comments})]})]})]})]}),T.leave_details?.leave_summary&&e.jsx("div",{className:"border border-orange-500 rounded-lg bg-gradient-to-r from-orange-900/20 to-yellow-900/20",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-semibold text-orange-400 mb-2",children:"ðŸ“‹ Leave Summary"}),e.jsx("p",{className:"text-gray-200",children:T.leave_details.leave_summary})]})}),T.leave_details?.attachments&&T.leave_details.attachments.length>0&&e.jsxs("div",{className:"border border-gray-600 rounded-lg bg-gray-800",children:[e.jsx("div",{className:"bg-gray-700 p-3 border-b border-gray-600",children:e.jsx("h3",{className:"font-semibold text-gray-200",children:"ðŸ“Ž ATTACHMENTS"})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"space-y-2",children:T.leave_details.attachments.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-700 p-3 rounded",children:[e.jsx("span",{className:"text-gray-200",children:t.filename||`Attachment ${a+1}`}),e.jsx("button",{onClick:()=>window.open(`${u}/media/${t.relative_path||t.file_path}`,"_blank"),className:"text-cyan-400 hover:text-cyan-300 underline",children:"View"})]},a))})})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border border-gray-600 rounded-lg bg-gray-800",children:[e.jsx("div",{className:"bg-gray-700 p-3 border-b border-gray-600",children:e.jsx("h3",{className:"font-semibold text-gray-200",children:"CHECK IN"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 text-center mb-4",children:[T?.check_in_photo||T?.attendance_details?.check_in_photo_path?e.jsx("img",{src:`${u}/${T.check_in_photo||T.attendance_details.check_in_photo_path}`,alt:"Check-in photo",className:"w-full h-32 object-cover rounded-lg mx-auto mb-2",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"}}):null,e.jsxs("div",{className:T?.check_in_photo||T?.attendance_details?.check_in_photo_path?"hidden":"block",children:[e.jsx(h,{className:"h-16 w-16 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400",children:"not found"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-400",children:[e.jsxs("p",{className:"text-gray-300",children:["PUNCH IN DATE: ",B(i,b,l)]}),e.jsxs("p",{className:"text-gray-300",children:["PUNCH IN TIME: ",T?.check_in_time||T?.attendance_details?.check_in_time||"N/A"]}),T?.check_in_geolocation?.address&&"Unknown"!==T.check_in_geolocation.address&&e.jsxs("p",{className:"text-gray-300",children:["LOCATION: ",T.check_in_geolocation.address]}),T?.attendance_details?.check_in_geolocation?.address&&"Unknown"!==T.attendance_details.check_in_geolocation.address&&e.jsxs("p",{className:"text-gray-300",children:["LOCATION: ",T.attendance_details.check_in_geolocation.address]})]})]})]}),e.jsxs("div",{className:"border border-gray-600 rounded-lg bg-gray-800",children:[e.jsx("div",{className:"bg-gray-700 p-3 border-b border-gray-600",children:e.jsx("h3",{className:"font-semibold text-gray-200",children:"CHECK OUT"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 text-center mb-4",children:[T?.check_out_photo||T?.attendance_details?.check_out_photo_path?e.jsx("img",{src:`${u}/${T.check_out_photo||T.attendance_details.check_out_photo_path}`,alt:"Check-out photo",className:"w-full h-32 object-cover rounded-lg mx-auto mb-2",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"}}):null,e.jsxs("div",{className:T?.check_out_photo||T?.attendance_details?.check_out_photo_path?"hidden":"block",children:[e.jsx(h,{className:"h-16 w-16 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400",children:"not found"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-400",children:[e.jsxs("p",{className:"text-gray-300",children:["PUNCH OUT DATE: ",B(i,b,l)]}),e.jsxs("p",{className:"text-gray-300",children:["PUNCH OUT TIME: ",T?.check_out_time||T?.attendance_details?.check_out_time||"N/A"]}),T?.check_out_geolocation?.address&&"Unknown"!==T.check_out_geolocation.address&&e.jsxs("p",{className:"text-gray-300",children:["LOCATION: ",T.check_out_geolocation.address]}),T?.attendance_details?.check_out_geolocation?.address&&"Unknown"!==T.attendance_details.check_out_geolocation.address&&e.jsxs("p",{className:"text-gray-300",children:["LOCATION: ",T.attendance_details.check_out_geolocation.address]})]})]})]})]}),"leave"!==T?.type&&I()&&e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-gray-200 font-semibold mb-2",children:"CHANGE ATTENDANCE:"}),e.jsxs("select",{value:j,onChange:e=>_(e.target.value),className:"w-full p-3 border border-gray-600 rounded-lg bg-gray-800 text-gray-200 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",children:[e.jsx("option",{value:"",children:"Select Attendance Status"}),e.jsx("option",{value:"P",children:"Present"}),e.jsx("option",{value:"L",children:"Late"}),e.jsx("option",{value:"H",children:"Holiday"}),e.jsx("option",{value:"AB",children:"Absconding"})]})]}),"leave"===T?.type&&e.jsx("div",{className:"mt-6 bg-gradient-to-r from-orange-700/20 to-yellow-700/20 border border-orange-500 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-orange-400 text-2xl",children:"ðŸ–ï¸"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-orange-400",children:"Employee is on Leave"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"This is an approved leave record. Attendance cannot be modified for leave days."})]})]})}),"leave"!==T?.type&&!I()&&e.jsx("div",{className:"mt-6 bg-gradient-to-r from-red-700/20 to-pink-700/20 border border-red-500 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-red-400 text-2xl",children:"ðŸš«"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-400",children:"No Edit Permission"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"own"===r("attendance")?"Regular employees cannot edit attendance records. Only managers and administrators can modify attendance data.":"You don't have permission to edit this attendance record. Contact your administrator for access."})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:["leave"!==T?.type&&I()&&e.jsx("button",{onClick:async()=>{if(j&&M?.user_id){O(!0);try{let e;switch(j){case"P":e=1;break;case"L":e=.5;break;case"H":e=0;break;default:e=-1}const t=`${i}-${String(b).padStart(2,"0")}-${String(l).padStart(2,"0")}`;if(T?.id){const t={status:e,comments:$||""};await(async(e,t,s)=>{try{return(await a.put(`${u}/attendance/edit/${e}?admin_id=${s}`,{...t},{headers:f()})).data}catch(r){throw r}})(T.id,t,M.user_id)}else{const s={employee_id:n.id,date:t,status:e,comments:$||"",check_in_time:null,check_out_time:null,is_holiday:!1};await(async(e,t)=>{try{return(await a.post(`${u}/attendance/mark?user_id=${t}`,{employee_id:e.employee_id,date:e.date,status:e.status,comments:e.comments||"",check_in_time:e.check_in_time||null,check_out_time:e.check_out_time||null,is_holiday:e.is_holiday||!1},{headers:f()})).data}catch(s){throw s}})(s,M.user_id)}c&&c(n.id,l,j),await F(),alert("Attendance updated successfully!")}catch(e){alert("Failed to update attendance. Please try again.")}finally{O(!1)}}},className:"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white px-6 py-2 w-full rounded-md transition-all duration-200 font-semibold",children:"UPDATE ATTENDANCE"}),e.jsx("button",{onClick:o,className:"bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white px-6 py-2 w-full rounded-md transition-all duration-200 font-semibold "+("leave"!==T?.type&&I()?"":"col-span-2"),children:"CLOSE"})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-2 rounded-md transition-all duration-200 font-semibold",children:"leave"===T?.type?"ðŸ’¬ ADD COMMENTS":"ðŸ  ADD COMMENTS"}),e.jsx("button",{onClick:()=>{C(!k)},className:"border border-gray-500 text-gray-300 px-6 py-2 bg-gray-800 rounded-md hover:bg-gray-700 transition-all duration-200 font-semibold",children:"ðŸ‘¤ HISTORY"})]}),e.jsxs("div",{className:"mt-6 border-t border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Comments"}),e.jsx("div",{className:"bg-gray-800 border border-gray-600 p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(g,{className:"h-6 w-6 text-gray-300"})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("input",{type:"text",value:$,onChange:e=>D(e.target.value),placeholder:"Add your comment here...",className:"flex-1 p-3 border border-gray-600 rounded-lg bg-gray-700 text-gray-200 placeholder-gray-400 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",onKeyPress:e=>"Enter"===e.key&&Y()}),e.jsxs("button",{onClick:Y,disabled:P,className:"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 disabled:from-gray-600 disabled:to-gray-700 text-white px-4 py-3 flex items-center gap-2 flex-shrink-0 rounded-md transition-all duration-200 font-semibold",children:[e.jsx(y,{className:"h-4 w-4"}),P?"Sending...":"Send"]})]})]})}),e.jsx("div",{className:"space-y-4 max-h-60 overflow-y-auto",children:S.length>0?S.map((t,a)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-800 border border-gray-600 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(g,{className:"h-6 w-6 text-gray-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-cyan-400",children:t.user_name||t.user||"Unknown User"}),e.jsx("span",{className:"text-sm text-gray-400",children:t.created_at?s(t.created_at):t.timestamp})]}),e.jsx("p",{className:"text-gray-200",children:t.content||t.message})]})]},t._id||a)):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-400",children:"No comments yet. Be the first to add one!"})})})]}),k&&e.jsxs("div",{className:"mt-6 border-t border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"History"}),e.jsx("div",{className:"overflow-x-auto bg-gray-800 rounded-lg border border-gray-600",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-700 text-cyan-400",children:[e.jsx("th",{className:"border border-gray-600 px-4 py-3 text-left font-semibold",children:"#"}),e.jsx("th",{className:"border border-gray-600 px-4 py-3 text-left font-semibold",children:"DATE"}),e.jsx("th",{className:"border border-gray-600 px-4 py-3 text-left font-semibold",children:"CREATED BY"}),e.jsx("th",{className:"border border-gray-600 px-4 py-3 text-left font-semibold",children:"CHANGES"})]})}),e.jsxs("tbody",{children:[E.map((t,a)=>e.jsxs("tr",{className:a%2==0?"bg-gray-800":"bg-gray-750",children:[e.jsx("td",{className:"border border-gray-600 px-4 py-3 text-gray-200",children:a+1}),e.jsx("td",{className:"border border-gray-600 px-4 py-3 text-gray-200",children:s(t.changed_at)}),e.jsx("td",{className:"border border-gray-600 px-4 py-3 text-gray-200",children:t.changed_by_name||"Unknown"}),e.jsxs("td",{className:"border border-gray-600 px-4 py-3 text-gray-200",children:[t.action," - ",void 0!==t.old_value?`${t.old_value} â†’ ${t.new_value}`:t.new_value]})]},t._id||a)),0===E.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"border border-gray-600 px-4 py-3 text-gray-400 text-center",children:"No history available"})})]})]})})]})]})]})})},D=(e,t,a,s,r)=>{let n=0,l=0,d=0,o=0,c=0,i=0;for(let m=1;m<=s;m++)switch(e[`day${m}`]){case"P":n++;break;case"L":l++;break;case"LV":d++;break;case"H":i++;break;case"HD":o++;break;case"AB":c++}const x=s-i;return{present:n,late:l,leave:d,halfDay:o,absconding:c,holidays:i,workingDays:x,attendancePercentage:x>0?((n+l+o)/x*100).toFixed(1):"0"}};function E(){const m=new Date,[h,g]=t.useState(m.getFullYear()),[y,b]=t.useState(m.getMonth()+1),[p,E]=t.useState([]),[L,T]=t.useState(!1),[H,P]=t.useState(null),[O,M]=t.useState(!1),[U,I]=t.useState(!1),[F,R]=t.useState(null),[B,Y]=t.useState(null),[V,z]=t.useState(null),[W,J]=t.useState(null),[K,q]=t.useState([]),[G,Q]=t.useState(""),[X,Z]=t.useState([]),[ee,te]=t.useState([]),[ae,se]=t.useState({enable_sunday_sandwich_rule:!0,enable_adjacent_absconding_rule:!0,minimum_working_days_for_sunday:5}),re=t.useRef(null),[ne,le]=t.useState(!1),[de,oe]=t.useState(!1);t.useEffect(()=>{const e=localStorage.getItem("userData");if(e){const t=JSON.parse(e);z(t)}},[]),t.useEffect(()=>{V?.user_id&&(async()=>{if(V?.user_id)try{const e=await _(h,null,V.user_id);e.success&&te(e.holidays||[])}catch(e){te([{_id:"1",date:"2025-01-01",name:"New Year's Day"},{_id:"2",date:"2025-01-26",name:"Republic Day"},{_id:"3",date:"2025-08-15",name:"Independence Day"},{_id:"4",date:"2025-12-25",name:"Christmas Day"}])}})()},[V,h]),t.useEffect(()=>{(async()=>{if(V?.user_id)try{const e=await(async e=>{try{return(await a.get(`${u}/attendance/permissions`,{params:{user_id:e},headers:f()})).data}catch(H){throw H}})(V.user_id);J(e)}catch(e){J({can_view_all:!1})}})()},[V]);const ce=t.useCallback(()=>{if(re.current){const{scrollLeft:e,scrollWidth:t,clientWidth:a}=re.current;le(e>0),oe(e<t-a-1)}},[]),ie=t.useCallback(e=>{if(re.current){const t=300;re.current.scrollBy({left:"left"===e?-t:t,behavior:"smooth"}),setTimeout(ce,100)}},[ce]);t.useEffect(()=>{ce();const e=re.current;if(e)return e.addEventListener("scroll",ce),()=>{e.removeEventListener("scroll",ce)}},[ce]),t.useEffect(()=>{setTimeout(ce,100)},[p,ce]),r("attendance"),n();const xe=()=>l("attendance"),me=()=>xe(),he=()=>xe(),ge=e=>e?.employees?.length?e.employees.map(e=>{const t={id:e.employee_id,name:e.employee_name,employeeId:e.employee_code||e.employee_number||e.empId||`EMP-${e.employee_id?.slice(-6)||"UNKNOWN"}`,department:e.department_name||"Unknown Department",role:e.role_name||"",photo:e.employee_photo};return e.days.forEach(e=>{const a=`day${e.day}`;if(null!==e.status&&void 0!==e.status){const s=parseFloat(e.status);1.5===s?t[a]="H":1===s||1===s?t[a]="P":.5===s?t[a]="HD":0===s||0===s?t[a]="LV":-1===s||-1===s?t[a]="":-2===s||-2===s?t[a]="AB":"L"===e.status?t[a]="L":t[a]=""}else e.is_weekend?t[a]="W":e.is_holiday?t[a]="H":t[a]=""}),t}):[];t.useEffect(()=>{(async()=>{if(V?.user_id){T(!0),P(null);try{const t=await j(h,y,V.user_id);let s=ae;try{const e=await a.get(`${u}/attendance/settings`,{headers:f()});e.data&&(s={...ae,...e.data},se(s))}catch(e){}if(t&&t.employees){const e=ge(t),r=await Promise.allSettled(e.map(e=>a.get(`${u}/settings/leave-balance/${e.id}`,{params:{user_id:V.user_id},headers:f()}).then(t=>({id:e.id,data:t.data?.data||{}})))),n={};r.forEach(e=>{"fulfilled"===e.status&&e.value?.id&&(n[e.value.id]=e.value.data)});const l=((e,t,a,s)=>{if(!t)return e;const{enable_adjacent_absconding_rule:r,enable_sunday_sandwich_rule:n,minimum_working_days_for_sunday:l=5}=t;return e.map(e=>{const t={...e},d=new Date(a,s,0).getDate();for(let o=1;o<=d;o++){const e=new Date(a,s-1,o).getDay();if(r&&6===e&&"AB"===t[`day${o}`]&&o+1<=d&&(t[`day${o+1}`]="AB"),r&&1===e&&"AB"===t[`day${o}`]&&o-2>=1&&(t["day"+(o-2)]="AB"),n&&0===e){let e=0;for(let a=Math.max(1,o-6);a<=Math.min(d,o-1);a++){const s=t[`day${a}`];"P"!==s&&"HD"!==s&&"L"!==s||e++}e<l&&(t[`day${o}`]&&"W"!==t[`day${o}`]||(t[`day${o}`]=""))}}return t})})(e.map(e=>{const t=n[e.id]||{};return{...e,earnedLeavesTotal:t.earned_leaves_total??15,earnedLeavesUsed:t.earned_leaves_used??0,earnedLeavesRemaining:t.earned_leaves_remaining??15,graceTotal:t.grace_leaves_total??24,graceUsed:t.grace_leaves_used??0,graceRemaining:t.grace_leaves_remaining??24}}),s,h,y);E(l)}else E([])}catch(t){P("Failed to load attendance data. Please try again."),E([])}finally{T(!1)}}})()},[h,y,V]);const ye=new Date(h,y,0).getDate(),be=e=>{"prev"===e?1===y?(b(12),g(h-1)):b(y-1):12===y?(b(1),g(h+1)):b(y+1)},pe=e=>{R(e),Y(1),M(!0)};return L||V&&null===W&&!me()?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-black",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("span",{className:"text-white text-lg",children:null===W?"Loading permissions...":"Loading attendance data..."})]})}):H?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-black",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-red-500 text-lg mb-2",children:H}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry"})]})}):e.jsxs("div",{className:"w-full p-6 space-y-6 bg-black min-h-screen",children:[e.jsx("div",{className:"bg-black rounded-lg p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>be("prev"),className:"border border-gray-600 bg-black text-white hover:bg-gray-800 px-3 py-2 rounded-md transition-colors",children:e.jsx(d,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2 min-w-[200px] justify-center",children:[e.jsx(o,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"font-semibold text-lg text-white",children:[S[y-1]," ",h]})]}),e.jsx("button",{onClick:()=>be("next"),className:"border border-gray-600 bg-black text-white hover:bg-gray-800 px-3 py-2 rounded-md transition-colors",children:e.jsx(c,{className:"h-4 w-4"})})]}),he()&&e.jsxs("button",{onClick:()=>I(!0),className:"border border-gray-600 bg-black text-white hover:bg-gray-800 px-3 py-2 rounded-md transition-colors flex items-center gap-2",children:[e.jsx(o,{className:"h-4 w-4 mr-2"}),"Holidays"]}),e.jsxs("button",{onClick:()=>((e,t,a,r)=>{const n=new Date(t,a,0).getDate();let l=`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <title>Monthly Attendance Report - ${S[a-1]} ${t}</title>\n      <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        .header { text-align: center; margin-bottom: 20px; }\n        .info { margin-bottom: 15px; font-size: 12px; }\n        table { width: 100%; border-collapse: collapse; font-size: 10px; }\n        th, td { border: 1px solid #ddd; padding: 4px; text-align: center; }\n        th { background-color: #2980b9; color: white; font-weight: bold; }\n        .employee-info { text-align: left; min-width: 120px; }\n        .summary { text-align: left; font-size: 9px; }\n        .status-P { background-color: #10b981; color: white; font-weight: bold; }\n        .status-A { background-color: #ef4444; color: white; font-weight: bold; }\n        .status-L { background: linear-gradient(135deg, #eab308, #f97316); color: white; font-weight: bold; }\n        .status-LV { background-color: #f97316; color: white; font-weight: bold; }\n        .status-H { background-color: #3b82f6; color: white; font-weight: bold; }\n        .status-HD { background-color: #eab308; color: white; font-weight: bold; }\n        .status-AB { background-color: #ef4444; color: white; font-weight: bold; }\n        .legend { margin-top: 20px; font-size: 11px; }\n        .legend-item { display: inline-block; margin-right: 15px; margin-bottom: 5px; }\n        .legend-color { display: inline-block; width: 20px; height: 15px; margin-right: 5px; vertical-align: middle; }\n        .monthly-summary { margin-top: 20px; font-size: 12px; }\n        @media print { body { margin: 10px; } }\n      </style>\n    </head>\n    <body>\n      <div class="header">\n        <h2></h2>\n        <h3>${S[a-1]} ${t}</h3>\n      </div>\n      \n      <div class="info">\n        <strong>Generated on:</strong> ${s(new Date)}<br>\n  `;const d=r.filter(e=>{const s=new Date(e.date);return s.getFullYear()===t&&s.getMonth()+1===a});d.length>0&&(l+=`<strong>Company Holidays:</strong> ${d.map(e=>e.name).join(", ")}<br>`),l+='\n      </div>\n      \n      <table>\n        <thead>\n          <tr>\n            <th class="employee-info">Employee Details</th>\n  ';for(let s=1;s<=n;s++){const e=C(t,a,s);l+=`<th>${s}<br><small>${e.substring(0,3)}</small></th>`}l+="\n            <th>Present</th>\n            <th>Late</th>\n            <th>Half Day</th>\n            <th>Holidays</th>\n            <th>Absconding</th>\n            <th>Attendance %</th>\n          </tr>\n        </thead>\n        <tbody>\n  ",e.forEach(e=>{const t=D(e,0,0,n);l+=`\n      <tr>\n        <td class="employee-info">\n          <strong>${e.name}</strong><br>\n          <small>${e.employeeId}</small><br>\n          <small>${e.department}</small>\n        </td>\n    `;for(let a=1;a<=n;a++){const t=e[`day${a}`]||"-";l+=`<td class="status-${t}">${t}</td>`}l+=`\n        <td>${t.present}</td>\n        <td>${t.late}</td>\n        <td>${t.halfDay}</td>\n        <td>${t.holidays}</td>\n        <td>${t.absconding}</td>\n        <td>${t.attendancePercentage}%</td>\n      </tr>\n    `}),l+='\n        </tbody>\n      </table>\n      \n      <div class="legend">\n        <h4>Legend:</h4>\n        <div class="legend-item">\n          <span class="legend-color" style="background-color: #10b981;"></span>P = Present\n        </div>\n        <div class="legend-item">\n          <span class="legend-color" style="background: linear-gradient(135deg, #eab308, #f97316);"></span>L = Late\n        </div>\n        <div class="legend-item">\n          <span class="legend-color" style="background-color: #f97316;"></span>LV = Leave\n        </div>\n        <div class="legend-item">\n          <span class="legend-color" style="background-color: #3b82f6;"></span>H = Holiday\n        </div>\n        <div class="legend-item">\n          <span class="legend-color" style="background-color: #eab308;"></span>HD = Half Day\n        </div>\n        <div class="legend-item">\n          <span class="legend-color" style="background-color: #ef4444;"></span>AB = Absconding\n        </div>\n      </div>\n      \n      <div class="monthly-summary">\n        <h4>Monthly Summary:</h4>\n  ';const o=e.reduce((e,t)=>e+D(t,0,0,n).present,0),c=e.reduce((e,t)=>e+D(t,0,0,n).late,0),i=(e.reduce((e,t)=>{const a=D(t,0,0,n);return e+Number.parseFloat(a.attendancePercentage)},0)/e.length).toFixed(1);l+=`\n        <p><strong>Total Present Days:</strong> ${o}</p>\n        <p><strong>Total Late Days:</strong> ${c}</p>\n        <p><strong>Average Attendance:</strong> ${i}%</p>\n      </div>\n    </body>\n    </html>\n  `;const x=new Blob([l],{type:"text/html"}),m=URL.createObjectURL(x),h=document.createElement("a");h.href=m,h.download=`Attendance_Report_${S[a-1]}_${t}.html`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(m);const g=window.open("","_blank");g.document.write(l),g.document.close(),setTimeout(()=>{g.print()},500)})(p,h,y,ee),className:"border border-gray-600 bg-black text-white hover:bg-gray-800 px-3 py-2 rounded-md transition-colors flex items-center gap-2",children:[e.jsx(i,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})}),e.jsx("div",{className:"bg-black rounded-lg p-4 ",children:e.jsxs("div",{className:"flex flex-wrap gap-6 items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Present (P)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-yellow-500 to-orange-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Late (L)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-orange-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Leave (LV)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Holiday (H)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-yellow-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Half Day (HD)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Absconding (AB)"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-black rounded-lg p-6 border border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-400",children:p.reduce((e,t)=>e+D(t,0,0,ye).present,0)}),e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:"Total Present Days"})]})}),e.jsx("div",{className:"bg-black rounded-lg p-6 border border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:p.reduce((e,t)=>e+D(t,0,0,ye).late,0)}),e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:"Total Late Days"})]})}),e.jsx("div",{className:"bg-black rounded-lg p-6 border border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-400",children:p.reduce((e,t)=>e+D(t,0,0,ye).leave,0)}),e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:"Total Leave Days"})]})}),e.jsx("div",{className:"bg-black rounded-lg p-6 border border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-400",children:[(p.reduce((e,t)=>{const a=D(t,0,0,ye);return e+Number.parseFloat(a.attendancePercentage)},0)/p.length).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:"Average Attendance"})]})})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-hidden shadow-2xl",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>ie("left"),className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-white p-4 rounded-full shadow-lg transition-all duration-200 opacity-80 hover:opacity-100",style:{backgroundColor:"rgba(37, 99, 235, 1)",zIndex:9999},onMouseEnter:e=>e.target.style.backgroundColor="rgba(29, 78, 216, 1)",onMouseLeave:e=>e.target.style.backgroundColor="rgba(37, 99, 235, 1)","aria-label":"Scroll left",children:e.jsx(d,{className:"w-9 h-9"})}),e.jsx("button",{onClick:()=>ie("right"),className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-white p-4 rounded-full shadow-lg transition-all duration-200 opacity-80 hover:opacity-100",style:{backgroundColor:"rgba(37, 99, 235, 1)",zIndex:9999},onMouseEnter:e=>e.target.style.backgroundColor="rgba(29, 78, 216, 1)",onMouseLeave:e=>e.target.style.backgroundColor="rgba(37, 99, 235, 1)","aria-label":"Scroll right",children:e.jsx(c,{className:"w-9 h-9"})}),e.jsx("div",{ref:re,className:"overflow-x-auto",onScroll:ce,children:e.jsxs("table",{className:"w-full bg-black border-collapse border border-gray-700",style:{minWidth:"1200px"},children:[e.jsxs("thead",{style:{backgroundColor:"#03b0f5"},children:[e.jsxs("tr",{children:[e.jsx("th",{colSpan:3,className:"sticky left-0 px-4 py-1 text-center font-bold text-white border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Employee Details"}),Array.from({length:ye},(e,t)=>t+1).map(t=>e.jsx("th",{rowSpan:2,className:"px-3 py-1 text-center font-bold text-white min-w-[50px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-bold",children:t}),e.jsx("span",{className:"text-xs text-blue-100 opacity-80",children:C(h,y,t)})]})},t)),e.jsx("th",{colSpan:7,className:"px-4 py-1 text-center font-bold text-white border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Summary"}),e.jsx("th",{colSpan:3,className:"px-4 py-1 text-center font-bold text-white border border-gray-300",style:{backgroundColor:"#1e7e34"},children:"Earned Leave"}),e.jsx("th",{colSpan:3,className:"px-4 py-1 text-center font-bold text-white border border-gray-300",style:{backgroundColor:"#6f42c1"},children:"Grace"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 px-4 py-1 text-left font-bold text-white min-w-[100px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Emp ID"}),e.jsx("th",{className:"px-4 py-1 text-left font-bold text-white min-w-[150px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Name"}),e.jsx("th",{className:"px-4 py-1 text-left font-bold text-white min-w-[130px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Team"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[60px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Present"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[60px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Leave"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[55px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Late"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[65px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Half Day"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[65px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Holiday"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[75px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Abscond"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[70px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Attend %"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[55px] border border-gray-300",style:{backgroundColor:"#1e7e34"},children:"Total"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[55px] border border-gray-300",style:{backgroundColor:"#1e7e34"},children:"Used"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[65px] border border-gray-300",style:{backgroundColor:"#1e7e34"},children:"Remaining"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[55px] border border-gray-300",style:{backgroundColor:"#6f42c1"},children:"Total"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[55px] border border-gray-300",style:{backgroundColor:"#6f42c1"},children:"Used"}),e.jsx("th",{className:"px-3 py-1 text-center font-bold text-white min-w-[65px] border border-gray-300",style:{backgroundColor:"#6f42c1"},children:"Remaining"})]})]}),e.jsx("tbody",{className:"bg-black",children:p.map((t,a)=>{const s=D(t,0,0,ye);return e.jsxs("tr",{className:"bg-black hover:bg-gray-800 transition-colors border-b border-gray-700",children:[e.jsx("td",{className:"sticky left-0 bg-black px-4 py-5 border border-gray-600 text-sm text-blue-300 font-medium cursor-pointer hover:bg-gray-700 transition-colors",onClick:()=>pe(t),children:t.employeeId}),e.jsx("td",{className:"px-4 py-5 border border-gray-600 cursor-pointer hover:bg-gray-700 transition-colors",onClick:()=>pe(t),children:e.jsx("div",{className:"font-semibold text-white text-base",children:t.name})}),e.jsx("td",{className:"px-4 py-5 border border-gray-600",children:e.jsx("div",{className:"text-sm text-gray-400",children:t.department})}),Array.from({length:ye},(e,t)=>t+1).map(a=>e.jsx("td",{className:"px-2 py-2 text-center cursor-pointer hover:bg-gray-700 border border-gray-600 transition-colors",onClick:()=>(async(e,t)=>{if(V?.user_id){R(e),Y(t),M(!0),T(!0);try{const s=`${h}-${String(y).padStart(2,"0")}-${String(t).padStart(2,"0")}`,r=await N(e.id,s,V.user_id);try{const t=await v(e.id,s,V.user_id);q(t.comments||[])}catch(a){q([])}try{const t=await w(e.id,s,V.user_id);Z(t.history||[])}catch(a){Z([])}R({...e,attendanceDetail:r})}catch(a){}T(!1),Y(t),M(!0)}})(t,a),children:k(t[`day${a}`])},a)),e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-green-400 text-sm",children:s.present}),e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-orange-400 text-sm",children:s.leave}),e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-yellow-400 text-sm",children:s.late}),e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-cyan-400 text-sm",children:s.halfDay}),e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-blue-400 text-sm",children:s.holidays}),e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-red-400 text-sm",children:s.absconding}),e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-sm",children:e.jsxs("span",{className:Number.parseFloat(s.attendancePercentage)>=90?"text-green-400":Number.parseFloat(s.attendancePercentage)>=75?"text-yellow-400":"text-red-400",children:[s.attendancePercentage,"%"]})}),(()=>{const a=Math.round((t.earnedLeavesTotal??15)/12)||1,r=s.leave,n=Math.max(0,a-r);return e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-green-300 text-sm",children:a}),e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-orange-300 text-sm",children:r}),e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-sm",children:e.jsx("span",{className:n>0?"text-green-400":"text-red-400",children:n})})]})})(),(()=>{const a=Math.round((t.graceTotal??24)/12)||2,r=s.late,n=Math.max(0,a-r);return e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-purple-300 text-sm",children:a}),e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-orange-300 text-sm",children:r}),e.jsx("td",{className:"px-2 py-3 text-center border border-gray-600 font-bold text-sm",children:e.jsx("span",{className:n>0?"text-purple-400":"text-red-400",children:n})})]})})()]},t.id)})})]})})]})}),e.jsx($,{employee:F,selectedDate:B,selectedYear:h,selectedMonth:y,isOpen:O,onClose:()=>M(!1),onUpdate:(e,t,a)=>{E(s=>s.map(s=>s.id===e?{...s,[`day${t}`]:a}:s))},canUserEdit:e=>"own"!==r("attendance")&&x("attendance",e)}),e.jsx(A,{isOpen:U,onClose:()=>I(!1),holidays:ee,onUpdateHolidays:async e=>{if(te(e),V?.user_id&&(null!==W||me()))try{const e=await j(h,y,V.user_id);if(e&&e.employees){let t=ge(e);he()||(t=t.filter(e=>e.id===V.user_id)),E(t)}}catch(t){}},selectedYear:h,selectedMonth:y})]})}export{E as default};
