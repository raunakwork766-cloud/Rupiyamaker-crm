import{j as e}from"./vendor-mui-C1GmDdcn.js";import{r as t}from"./vendor-react-EzoxUMNY.js";import{R as a,C as s,U as r,S as l}from"./lead-components-CFe8eyn0.js";import"./vendor-utils-QXd9EeNt.js";import"./vendor-antd-BB3a0mYC.js";const i="/api";function n({leadData:n}){const[o,d]=t.useState(""),[c,m]=t.useState([]),[x,u]=t.useState(!1),[h,f]=t.useState(null),[g,p]=t.useState({name:"",id:"",avatar:null});t.useEffect(()=>{const e=localStorage.getItem("userId"),t=`${localStorage.getItem("firstName")||""} ${localStorage.getItem("lastName")||""}`.trim()||"User";p({name:t,id:e,avatar:null})},[]),t.useEffect(()=>{n?._id&&j()},[n]);const j=async()=>{if(n?._id){u(!0),f(null);try{const e=localStorage.getItem("userId");if(!e)throw new Error("No user ID available");const t=n&&(n.original_lead_id||n.login_created_at)?`${i}/lead-login/login-leads/${n._id}/notes?user_id=${e}`:`${i}/leads/${n._id}/notes?user_id=${e}`,a=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();m(s||[])}catch(e){f("Failed to load remarks")}finally{u(!1)}}},y=async()=>{if(o.trim()&&n?._id){u(!0),f(null);try{const e=localStorage.getItem("userId");if(!e)throw new Error("No user ID available");const t=n&&(n.original_lead_id||n.login_created_at)?`${i}/lead-login/login-leads/${n._id}/notes?user_id=${e}`:`${i}/leads/${n._id}/notes?user_id=${e}`,a={lead_id:n._id,content:o,note_type:"remark",created_by:e},s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(a)});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);d(""),await j()}catch(e){f("Failed to add remark")}finally{u(!1)}}};return e.jsxs("div",{className:"max-w-7xl mx-auto p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Remarks"}),e.jsxs("button",{onClick:j,className:"text-blue-500 hover:text-blue-700 flex items-center text-sm",disabled:x,children:[e.jsx(a,{className:"w-4 h-4 mr-1 "+(x?"animate-spin":"")}),"Refresh"]})]}),h&&e.jsxs("div",{className:"bg-red-100 text-red-700 p-3 rounded-lg flex items-start",children:[e.jsx(s,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:h})]}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-full px-3 py-2 bg-white shadow-sm",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-tr from-purple-500 to-blue-500 p-[2px] mr-3",children:e.jsx("div",{className:"bg-white w-full h-full rounded-full flex items-center justify-center",children:g.avatar?e.jsx("img",{src:g.avatar,alt:"avatar",className:"w-full h-full object-cover rounded-full"}):e.jsx(r,{className:"text-black w-5 h-5"})})}),e.jsx("textarea",{placeholder:`Write a remark as ${g.name}... (Shift+Enter for new line)`,className:"flex-1 outline-none border-none text-sm text-gray-700 placeholder:text-gray-400 bg-transparent resize-none overflow-auto",rows:1,value:o,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y())},disabled:x,style:{minHeight:"24px",maxHeight:"120px"}}),e.jsx("button",{onClick:y,disabled:x||!o.trim(),className:o.trim()?"cursor-pointer":"opacity-50 cursor-not-allowed",children:e.jsx(l,{className:"w-5 h-5 "+(x?"text-gray-400":"text-blue-500 hover:text-blue-600")})})]}),x&&0===c.length&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),!x&&0===c.length&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(r,{className:"w-12 h-12 mx-auto mb-2 opacity-25"}),e.jsx("p",{children:"No remarks yet. Be the first to add one!"})]}),e.jsx("div",{className:"space-y-3",children:c.map(t=>{return e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center min-w-[50px]",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-tr from-purple-500 to-blue-500 p-[2px]",children:e.jsx("div",{className:"bg-white w-full h-full rounded-full flex items-center justify-center",children:e.jsx(r,{className:"text-black w-4 h-4"})})}),e.jsx("span",{className:"text-xs mt-1 text-gray-700 font-medium",children:t.creator_name||"User"})]}),e.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 shadow-sm flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:(a=t.created_at,new Intl.DateTimeFormat("default",{dateStyle:"medium",timeStyle:"short"}).format(new Date(a)))}),t.can_edit&&e.jsx("div",{className:"flex space-x-1"})]}),e.jsx("p",{className:"text-sm text-gray-800",children:t.content})]})]},t._id);var a})})]})}export{n as default};
