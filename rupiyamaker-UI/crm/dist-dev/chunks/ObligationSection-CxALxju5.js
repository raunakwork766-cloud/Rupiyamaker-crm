import{j as e}from"./vendor-mui-C1GmDdcn.js";import{R as t,r as a,c as n}from"./vendor-react-EzoxUMNY.js";import{aS as l,ac as i,t as o,aT as r}from"./lead-components-DDl3q2q3.js";import{A as s}from"./task-components-qiyFV74P.js";import{E as c}from"./employee-components-XEejiIRn.js";import d from"./html2canvas.esm-CPDoSj43.js";import"./vendor-utils-QXd9EeNt.js";import"./vendor-antd-BB3a0mYC.js";import"./vendor-office-CbbGW2MO.js";const m=()=>{try{const e=localStorage.getItem("userId");if(e)return e;const t=localStorage.getItem("user");if(t){const e=JSON.parse(t);return e.id||e._id||e.user_id}const a=localStorage.getItem("userData");if(a){const e=JSON.parse(a);return e.id||e._id||e.user_id}return null}catch(e){return null}},p=async e=>{try{const t=m();if(!t)return[];if(!e||e.trim().length<1)return[];const a=await fetch(`${s}/settings/company-names-from-vakilsearch?company_name=${encodeURIComponent(e)}&user_id=${t}`,{headers:{"Content-Type":"application/json",...localStorage.getItem("token")&&{Authorization:`Bearer ${localStorage.getItem("token")}`}}});if(!a.ok){const e=await a.text();throw new Error(`HTTP error! status: ${a.status} - ${e}`)}const n=await a.json();return Array.isArray(n)&&n.length>0?n:[]}catch(t){return[]}},u=async()=>{try{const e=m();if(!e)return["Custom"];const t=await fetch(`${s}/settings/bank-names?user_id=${e}`,{headers:{"Content-Type":"application/json",...localStorage.getItem("token")&&{Authorization:`Bearer ${localStorage.getItem("token")}`}}});if(!t.ok){const e=await t.text();throw new Error(`HTTP error! status: ${t.status} - ${e}`)}const a=await t.json();let n=[];return Array.isArray(a)?n=a:a.bank_names&&Array.isArray(a.bank_names)?n=a.bank_names:a.data&&Array.isArray(a.data)&&(n=a.data),["Custom",...n.map(e=>e.name||e)]}catch(e){return["Custom"]}},g=async()=>{try{return m(),[]}catch(e){return[]}};function y({leadData:y,handleChangeFunc:f,onDataUpdate:h,onUnsavedChangesUpdate:_,canEdit:w=!0}){if(void 0===t||!t.useState)return e.jsx("div",{children:"Loading..."});const[v,k]=a.useState(""),[j,N]=a.useState(""),[S,C]=a.useState(""),[$,O]=a.useState(null),[A,T]=a.useState(""),[L,P]=a.useState(""),[E,B]=a.useState([]),[R,I]=a.useState(!1),[D,z]=a.useState([]),[M,q]=a.useState(!1),[F,U]=a.useState("0"),[Y,W]=a.useState("0"),[Q,J]=a.useState(""),[H,G]=a.useState([{id:Date.now(),product:"",bankName:"",tenure:"",roi:"",totalLoan:"",outstanding:"",emi:"",action:"Obligate",selectedPercentage:null,selectedTenurePercentage:null,selectedRoiPercentage:null}]),[K,V]=a.useState(!1),[X,Z]=a.useState(!1),[ee,te]=a.useState({}),[ae,ne]=a.useState(!0),[le,ie]=a.useState(!1),[oe,re]=a.useState(""),[se,ce]=a.useState(!1),de=a.useRef(null),[me,pe]=a.useState(0),[ue,ge]=a.useState(Date.now()),[ye,be]=a.useState(0),[xe,fe]=a.useState(Date.now()),[he,_e]=a.useState(["Custom"]),[we,ve]=a.useState({0:{isOpen:!1,searchQuery:""}}),[ke,je]=a.useState({0:{isOpen:!1,searchQuery:""}}),[Ne,Se]=a.useState(!1),[Ce,$e]=a.useState(null),[Oe,Ae]=a.useState(!1),[Te,Le]=a.useState([]),[Pe,Ee]=a.useState(!1),[Be,Re]=a.useState(null),[Ie,De]=a.useState(!1),ze=a.useRef(null);a.useEffect(()=>{_&&"function"==typeof _&&_(K,()=>Z(!0))},[K,_]),a.useEffect(()=>()=>{ia.current&&clearTimeout(ia.current)},[]),a.useLayoutEffect(()=>{ye>0&&pe(e=>e+1)},[ye]),a.useEffect(()=>{},[H]);const Me=we||{},qe=ke||{},[Fe,Ue]=a.useState(!1),[Ye,We]=a.useState({totalIncome:"",foirAmount:"",totalObligations:"",totalBtPos:"",finalEligibility:"",multiplierEligibility:""}),[Qe,Je]=a.useState(!1),[He,Ge]=a.useState(null),[Ke,Ve]=a.useState(!1),[Xe,Ze]=a.useState("Not Eligible"),[et,tt]=a.useState(""),[at,nt]=a.useState(60),[lt,it]=a.useState(""),[ot,rt]=a.useState(0),[st,ct]=a.useState(""),[dt,mt]=a.useState(""),[pt,ut]=a.useState(""),[gt,yt]=a.useState("0"),[bt,xt]=a.useState(!1),[ft,ht]=a.useState(null),[_t,wt]=a.useState(!1),[vt,kt]=a.useState(null),[jt,Nt]=a.useState({}),[St,Ct]=a.useState(null),[$t,Ot]=a.useState({fileSentToLogin:!1,recoveryCount:0,lastRecoveryTime:null,dataCleared:!1,renderCount:0}),[At,Tt]=a.useState(!1);a.useEffect(()=>{y?.file_sent_to_login!==$t.fileSentToLogin&&Ot(e=>({...e,fileSentToLogin:!!y?.file_sent_to_login,renderCount:e.renderCount+1}))},[y?.file_sent_to_login,$t.fileSentToLogin]),a.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown-scroll]")||e.target.hasAttribute("data-dropdown-scroll")||(Object.values(Me).some(e=>e?.isOpen)||Object.values(qe).some(e=>e?.isOpen))&&ca()},t=e=>{const t=e.target;t.closest("[data-dropdown-container]")||t.closest("[data-dropdown-trigger]")||t.closest("[data-search-input]")||ca()};return window.addEventListener("scroll",e,!0),window.addEventListener("resize",ca),document.addEventListener("mousedown",t),()=>{window.removeEventListener("scroll",e,!0),window.removeEventListener("resize",ca),document.removeEventListener("mousedown",t)}},[Me,qe]);const Lt=e=>"CC (Credit Card)"===e||"CC (CREDIT CARD)"===e||"CC"===e||e&&"string"==typeof e&&"cc (credit card)"===e.toLowerCase(),Pt=(e,t)=>{if(!e||!t)return 0;const a=e.toLowerCase(),n=t.toLowerCase().trim(),l=n.split(" ").map(e=>e.trim()).filter(e=>e.length>0);let i=0;return a===n&&(i+=1e3),a.startsWith(n)&&(i+=500),a.includes(n)&&(i+=300),l.forEach(t=>{new RegExp(`\\b${t}\\b`,"i").test(e)&&(i+=100),a.startsWith(t)&&(i+=50),a.includes(t)&&(i+=20)}),e.length<30&&(i+=10),e.length>50&&(i-=5),i};a.useEffect(()=>{const e=e=>{if(!e||0===Object.keys(e).length)return;const t=t=>{for(const a of t){let t=e;const n=a.split(".");for(const e of n){if(!t||"object"!=typeof t||!(e in t)){t=void 0;break}t=t[e]}if(null!=t&&""!==t)return t}return null},a=[...H],n=e=>{const a=t(e);if(null!=a&&""!==a)return a;for(const t of e){let e=y;const a=t.split(".");for(const t of a){if(!e||"object"!=typeof e||!(t in e)){e=void 0;break}e=e[t]}if(null!=e&&""!==e)return e}if(y?.file_sent_to_login){const t=[...Object.keys(y||{}).filter(t=>e.some(e=>e.includes(t.toLowerCase())||t.toLowerCase().includes(e.split(".").pop()?.toLowerCase()))).map(e=>e),...(y?.form_data?Object.keys(y.form_data):[]).map(e=>`form_data.${e}`),...(y?.application_data?Object.keys(y.application_data):[]).map(e=>`application_data.${e}`)];for(const e of t){let t=y;const a=e.split(".");for(const e of a){if(!t||"object"!=typeof t||!(e in t)){t=void 0;break}t=t[e]}if(null!=t&&""!==t)return t}}return null},l=n(["dynamic_details.financial_details.monthly_income","dynamic_details.financial_details.salary","dynamic_details.personal_details.salary","dynamic_details.salary","salary","monthly_income","income","monthly_salary","gross_salary","net_salary","annual_income","employee_income","take_home","current_income","dynamic_fields.financial_details.monthly_income","dynamic_fields.financial_details.salary","dynamic_fields.financial_details.income","dynamic_fields.financial_details.monthly_salary","financial_details.monthly_income","financial_details.salary","financial_details.income","dynamic_fields.personal_details.salary","personal_details.salary","personal_details.income","dynamic_fields.create_lead.salary","dynamic_fields.create_lead.monthly_income","dynamic_fields.create_lead.income","dynamic_fields.lead_form.salary","dynamic_fields.lead_form.monthly_income","dynamic_fields.application.salary","dynamic_fields.obligation_data.salary","dynamic_fields.login_form.salary","obligation_data.salary","data.salary","data.monthly_income"]),i=n(["dynamic_details.financial_details.partner_salary","partnerSalary","partner_salary","dynamic_fields.financial_details.partner_salary","financial_details.partner_salary","dynamic_fields.login_form.partner_salary"]),o=n(["dynamic_details.financial_details.yearly_bonus","yearlyBonus","yearly_bonus","dynamic_fields.financial_details.yearly_bonus","financial_details.yearly_bonus","dynamic_fields.login_form.yearly_bonus"]),r=n(["dynamic_details.financial_details.bonus_division","bonusDivision","bonus_division","dynamic_fields.financial_details.bonus_division","financial_details.bonus_division","dynamic_fields.login_form.bonus_division"]),s=n(["loanRequired","loan_required","loan_amount","dynamic_fields.loanRequired","dynamic_fields.loan_required","dynamic_fields.loan_amount","dynamic_details.financial_details.loanRequired","dynamic_details.financial_details.loan_required","dynamic_details.financial_details.loan_amount","dynamic_details.loanRequired","dynamic_details.loan_required","dynamic_details.loan_amount","required_loan","loan_amt","amount_required","loan_requirement","finance_required","credit_amount","requested_amount","dynamic_fields.financial_details.loan_required","dynamic_fields.financial_details.loan_amount","dynamic_fields.financial_details.loanRequired","dynamic_fields.financial_details.required_loan","dynamic_fields.financial_details.loan_amt","financial_details.loan_required","financial_details.loan_amount","financial_details.required_loan","dynamic_fields.process.loan_amount_required","dynamic_fields.process.loan_required","dynamic_fields.login_form.loan_amount","dynamic_fields.login_form.loan_required","dynamic_fields.loan_required","dynamic_fields.loan_amount","dynamic_fields.create_lead.loan_required","dynamic_fields.create_lead.loan_amount","dynamic_fields.create_lead.required_loan","dynamic_fields.lead_form.loan_required","dynamic_fields.lead_form.loan_amount","dynamic_fields.application.loan_required","dynamic_fields.obligation_data.loan_required","dynamic_fields.obligation_data.loan_amount","obligation_data.loan_required","obligation_data.loan_amount","dynamic_fields.personal_details.loan_required","dynamic_fields.personal_details.loan_amount","personal_details.loan_required","personal_details.loan_amount","data.loan_required","data.loan_amount"]),c=n(["dynamic_details.personal_details.company_name","dynamic_details.company_name","dynamic_details.financial_details.company_name","companyName","company_name","customer_name","employer","company","employer_name","organization","workplace","office","firm","business","corporation","dynamic_fields.personal_details.company_name","dynamic_fields.personal_details.employer","dynamic_fields.personal_details.company","personal_details.company_name","personal_details.employer","dynamic_fields.company_name","dynamic_fields.employer","dynamic_fields.financial_details.company_name","dynamic_fields.create_lead.company_name","dynamic_fields.create_lead.employer","dynamic_fields.lead_form.company_name","dynamic_fields.lead_form.employer","dynamic_fields.application.company_name","dynamic_fields.obligation_data.companyName","dynamic_fields.obligation_data.company_name","dynamic_fields.login_form.company_name","obligation_data.companyName","obligation_data.company_name","dynamic_fields.basic_details.company_name","basic_details.company_name","data.company_name","data.companyName"]),d=n(["dynamic_details.personal_details.company_type","companyType","company_type","processingBank","processing_bank","bankName","selectedBanks","dynamic_fields.personal_details.company_type","personal_details.company_type","dynamic_fields.process.processing_bank","dynamic_fields.login_form.processing_bank"]);let m=d;"string"==typeof d&&d.includes(",")?m=d.split(",").map(e=>e.trim()).filter(Boolean):d&&!Array.isArray(d)&&(m=[d]);const p=n(["dynamic_details.personal_details.company_category","companyCategory","company_category","dynamic_fields.personal_details.company_category","personal_details.company_category","dynamic_fields.company_category","dynamic_fields.login_form.company_category","dynamic_fields.check_eligibility.company_category"]),g=n(["dynamic_details.financial_details.cibil_score","cibilScore","cibil_score","dynamic_fields.financial_details.cibil_score","financial_details.cibil_score","dynamic_fields.login_form.cibil_score"]),b=n(["obligations","dynamic_fields.obligations","dynamic_fields.obligation_data.obligations","dynamic_fields.login_form.obligations"]),x=n(["totalBtPos","total_bt_pos","dynamic_fields.eligibility_details.totalBtPos","dynamic_fields.eligibility_details.total_bt_pos","eligibility_details.totalBtPos","eligibility_details.total_bt_pos","eligibility.totalBtPos","eligibility.total_bt_pos","dynamic_fields.check_eligibility.total_bt_pos"]),f=n(["totalObligation","total_obligation","dynamic_fields.eligibility_details.totalObligations","eligibility_details.totalObligations","eligibility.totalObligations","dynamic_fields.check_eligibility.total_obligation"]);te({salary:l||"",partnerSalary:i||"",yearlyBonus:o||"",bonusDivision:r||null,loanRequired:s||"",companyName:c||"",companyType:d||[],companyCategory:p||[],cibilScore:g||"",obligations:b||[],totalBtPos:x||"0",totalObligation:f||"0"}),V(!1),ne(!1),ie(!1),Fe||u().then(e=>{if(Array.isArray(e)&&e.length>0){const t=e.map(e=>"string"==typeof e?e:e.name||e.label||String(e));t.includes("Custom")||t.unshift("Custom"),_e(t),Ue(!0)}}).catch(e=>{});const h=y?.file_sent_to_login,_=h||ft&&y?._id!==ft||ae,w=l?"string"==typeof l?l:Vt(String(l)):_?"":v;(_||w!==v)&&k(w);const R=i?"string"==typeof i?i:Vt(String(i)):_?"":j;(_||R!==j)&&N(R);const I=o?"string"==typeof o?o:Vt(String(o)):_?"":S;(_||I!==S)&&C(I);const M=r?Number(r):_?null:$;(_||M!==$)&&O(M);const q=s?"string"==typeof s?s:Vt(String(s)):_?"":A;(_||q!==A)&&T(q);const F=c?String(c):_?"":L;(_||F!==L)&&P(F);const Y=g?String(g):_?"":Q;(_||Y!==Q)&&J(Y);const W=m?Array.isArray(m)?m:[m]:_?[]:E;(_||JSON.stringify(W)!==JSON.stringify(E))&&B(W);const K=p?Array.isArray(p)?p:[p]:_?[]:D;(_||JSON.stringify(K)!==JSON.stringify(D))&&z(K),e.check_eligibility||e.dynamic_fields;const X=t(["ceFoirPercent","foirPercent","check_eligibility.foir_percent","dynamic_fields.check_eligibility.foir_percent"]);if(X)if("custom"===X){nt("custom");const e=t(["ceCustomFoirPercent","customFoirPercent","check_eligibility.custom_foir_percent","dynamic_fields.check_eligibility.custom_foir_percent"]);e&&it(String(e))}else nt(Number(X));if(b&&Array.isArray(b)&&b.length>0){const e=b.map((e,t)=>{let n=null;const l=a.find(t=>{const a=e.bank_name||e.bankName||"",n=e.total_loan||e.totalLoan||e.loan_amount||e.principal_amount||"0",l=e.outstanding||"0";return t.product===e.product&&t.bankName===a&&parseFloat(t.totalLoan?.replace(/[^\d.]/g,"")||"0")===parseFloat(n.toString().replace(/[^\d.]/g,"")||"0")&&parseFloat(t.outstanding?.replace(/[^\d.]/g,"")||"0")===parseFloat(l.toString().replace(/[^\d.]/g,"")||"0")});n=l?l.id:e.id||`${Date.now()}-${t}-${Math.random().toString(36).substr(2,9)}`;const i=e.bank_name||e.bankName||"",o=e.tenure,r=e.roi,s=e.total_loan||e.totalLoan||e.loan_amount||e.principal_amount||"",c=e.outstanding||"",d=e.emi||"",m=e.action||"Obligate";return{id:n,product:e.product||"",bankName:i,tenure:o&&0!==o&&"0"!==o?String(o).includes("Months")?String(o):Zt(String(o)):"",roi:r&&0!==r&&"0"!==r?String(r).includes("%")?String(r):ta(String(r)):"",totalLoan:s?Vt(String(s)):"",outstanding:c&&0!==c&&"0"!==c?Vt(String(c)):"",emi:d&&0!==d&&"0"!==d?Vt(String(d)):"",action:m&&""!==m.trim()?m:"Obligate",selectedPercentage:e.selectedPercentage||e.selected_percentage||null,selectedTenurePercentage:e.selectedTenurePercentage||e.selected_tenure_percentage?parseInt(e.selectedTenurePercentage||e.selected_tenure_percentage):null,selectedRoiPercentage:e.selectedRoiPercentage||e.selected_roi_percentage?parseInt(e.selectedRoiPercentage||e.selected_roi_percentage):null}}),t=e.map(e=>e.id),n=t.filter((e,a)=>t.indexOf(e)!==a);n.length>0&&e.forEach((e,t)=>{n.includes(e.id)&&(e.id=`${Date.now()}-${t}-${Math.random().toString(36).substr(2,9)}`)});const l=e.map(e=>e.id),i=l.filter((e,t)=>l.indexOf(e)!==t);i.length>0&&e.forEach((e,t)=>{i.includes(e.id)&&(e.id=`${Date.now()}-FINAL-${t}-${Math.random().toString(36).substr(2,9)}`)}),G(e),xt(!0)}else bt&&H.length>0&&H[0].product||(G([{id:`${Date.now()}-default-${Math.random().toString(36).substr(2,9)}`,product:"",bankName:"",tenure:"",roi:"",totalLoan:"",outstanding:"",emi:"",action:"Obligate",selectedPercentage:null,selectedTenurePercentage:null,selectedRoiPercentage:null}]),xt(!0));x&&U("string"==typeof x?x:Vt(String(x)));const Z=t(["eligibility","dynamic_fields.eligibility_details","eligibility_details","dynamic_fields.eligibility","dynamic_fields.obligation_data.eligibility"]);if(Z&&"object"==typeof Z){let e=Z.finalEligibility||Z.final_eligibility||Z.foir_eligibility||Z.loan_eligibility_foir||"",t=0;"number"==typeof e?t=e:"string"==typeof e&&(t=parseFloat(e.replace(/[^\d.-]/g,""))||0);const a=t>0?Vt(Math.round(t).toString()):"";Ke?Ve(!1):t>0?(Ge(a),Je(!0)):(Ge(null),Je(!1)),We({totalIncome:Z.totalIncome||Z.total_income||"",foirAmount:Z.foirAmount||Z.foir_amount||"",totalObligations:Z.totalObligations||Z.total_obligations||"",totalBtPos:Z.totalBtPos||Z.total_bt_pos||"",finalEligibility:a,multiplierEligibility:Z.multiplierEligibility||Z.multiplier_eligibility||""})}y?.file_sent_to_login&&(()=>{const t=[e?.check_eligibility,e?.eligibility,e?.dynamic_fields?.check_eligibility,e?.dynamic_fields?.eligibility,y?.dynamic_fields?.check_eligibility,y?.dynamic_fields?.eligibility,y?.check_eligibility,y?.eligibility,e?.dynamic_details?.check_eligibility,e?.dynamic_details?.eligibility,y?.dynamic_details?.check_eligibility,y?.dynamic_details?.eligibility];for(const e of t)if(e&&"object"==typeof e&&Object.keys(e).length>0)return e.company_category&&tt(String(e.company_category)),void 0!==e.foir_percent&&nt(e.foir_percent),e.custom_foir_percent&&it(String(e.custom_foir_percent)),void 0!==e.monthly_emi_can_pay&&rt(Number(e.monthly_emi_can_pay)),e.tenure_months&&ct(String(e.tenure_months)),e.tenure_years&&mt(String(e.tenure_years)),e.roi&&ut(String(e.roi)),e.multiplier&&yt(String(e.multiplier)),e.loan_eligibility_status&&Ze(String(e.loan_eligibility_status)),!0})();const ee=t(["ceCompanyCategory","check_eligibility.company_category","dynamic_fields.check_eligibility.company_category","dynamic_details.check_eligibility.company_category","eligibility.company_category","dynamic_fields.eligibility.company_category","dynamic_details.eligibility.company_category"]);ee&&tt(String(ee));const le=t(["ceMonthlyEmiCanPay","check_eligibility.monthly_emi_can_pay","dynamic_fields.check_eligibility.monthly_emi_can_pay"]);null!==le&&rt(Number(le));const oe=t(["ceTenureMonths","check_eligibility.tenure_months","dynamic_fields.check_eligibility.tenure_months"]);oe&&ct(String(oe));const re=t(["ceTenureYears","check_eligibility.tenure_years","dynamic_fields.check_eligibility.tenure_years"]);re&&mt(String(re));const se=t(["ceRoi","check_eligibility.roi","dynamic_fields.check_eligibility.roi"]);se&&ut(String(se));const ce=t(["ceMultiplier","check_eligibility.multiplier","dynamic_fields.check_eligibility.multiplier"]);yt(null!=ce?String(ce):"0");const de=t(["loanEligibilityStatus","check_eligibility.loan_eligibility_status","dynamic_fields.check_eligibility.loan_eligibility_status"]);de&&Ze(String(de)),y?.file_sent_to_login&&(Ct({salary:w||"",partnerSalary:R||"",yearlyBonus:I||"",bonusDivision:M||null,loanRequired:q||"",companyName:F||"",cibilScore:Y||"",companyType:W||[],companyCategory:K||[],rawSavedData:e||{},timestamp:Date.now()}),setTimeout(()=>{},100))};(async()=>{const t=y?._id;if(t&&t!==ft){ne(!0),ie(!1);try{const n=m();if(!n)return;ht(t);const i=y&&(y.original_lead_id||y.login_created_at)?`${s}/lead-login/login-leads/${t}/obligations?user_id=${n}`:`${s}/leads/${t}/obligations?user_id=${n}`,o=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const r=await o.json();kt(r);const c=r,d=((y?.name||"").toLowerCase().includes("gunjan")||(y?.customer_name||"").toLowerCase().includes("gunjan"),"create_lead"===y?.source||"lead_creation"===y?.created_from||"create_lead"===y?.lead_source||!y?.file_sent_to_login),p={salary_locations:{"leadData.salary":y?.salary,"leadData.monthly_income":y?.monthly_income,"leadData.dynamic_fields?.financial_details?.monthly_income":y?.dynamic_fields?.financial_details?.monthly_income,"leadData.dynamic_fields?.financial_details?.salary":y?.dynamic_fields?.financial_details?.salary,"leadData.dynamic_details?.financial_details?.monthly_income":y?.dynamic_details?.financial_details?.monthly_income,"leadData.dynamic_details?.financial_details?.salary":y?.dynamic_details?.financial_details?.salary,"savedData.salary":c?.salary,"savedData.monthly_income":c?.monthly_income},loan_required_locations:{"leadData.loan_required":y?.loan_required,"leadData.loan_amount":y?.loan_amount,"leadData.loanRequired":y?.loanRequired,"leadData.dynamic_fields?.financial_details?.loan_required":y?.dynamic_fields?.financial_details?.loan_required,"leadData.dynamic_details?.financial_details?.loan_required":y?.dynamic_details?.financial_details?.loan_required,"savedData.loan_required":c?.loan_required,"savedData.loanRequired":c?.loanRequired},company_name_locations:{"leadData.company_name":y?.company_name,"leadData.companyName":y?.companyName,"leadData.dynamic_fields?.personal_details?.company_name":y?.dynamic_fields?.personal_details?.company_name,"leadData.dynamic_details?.personal_details?.company_name":y?.dynamic_details?.personal_details?.company_name,"savedData.company_name":c?.company_name,"savedData.companyName":c?.companyName},eligibility_locations:{"leadData.dynamic_fields?.check_eligibility":y?.dynamic_fields?.check_eligibility?Object.keys(y.dynamic_fields.check_eligibility):null,"leadData.dynamic_fields?.eligibility":y?.dynamic_fields?.eligibility?Object.keys(y.dynamic_fields.eligibility):null,"savedData.check_eligibility":c?.check_eligibility?Object.keys(c.check_eligibility):null,"savedData.eligibility":c?.eligibility?Object.keys(c.eligibility):null}};Object.values(p.salary_locations).filter(e=>null!=e&&""!==e).length,Object.values(p.loan_required_locations).filter(e=>null!=e&&""!==e).length,Object.values(p.company_name_locations).filter(e=>null!=e&&""!==e).length,Object.values(p.eligibility_locations).filter(e=>null!=e).length;let u=null;if(c&&"object"==typeof c&&Object.keys(c).length>0&&(c.salary||c.partnerSalary||c.obligations||c.companyName||c.loanRequired||c.cibilScore||c.yearlyBonus)&&(u=c),!u&&c?.data&&"object"==typeof c.data&&(u=c.data),!u&&c?.obligation_data&&"object"==typeof c.obligation_data&&(u=c.obligation_data),u&&Object.keys(u).length>0){e(u),xt(!0);try{const e={leadId:y?._id,timestamp:Date.now(),source:"API_RESPONSE",data:u,rawApiResponse:c,leadDataSnapshot:{dynamic_fields:y?.dynamic_fields,dynamic_details:y?.dynamic_details,file_sent_to_login:y?.file_sent_to_login}};localStorage.setItem(`obligationBackup_${y?._id}`,JSON.stringify(e))}catch(a){}y?.file_sent_to_login&&setTimeout(()=>{wt(!0)},200)}else{if((y?.file_sent_to_login||d)&&(!u||0===Object.keys(u).length)){const t=[{name:"Dynamic Fields Obligation Data",data:y?.dynamic_fields?.obligation_data},{name:"Dynamic Details Root",data:y?.dynamic_details},{name:"Dynamic Fields Root",data:y?.dynamic_fields},{name:"Lead Root Data (Direct Fields)",data:(()=>{const e={};return(y?.salary||y?.monthly_income)&&(e.salary=y.salary||y.monthly_income),(y?.loan_required||y?.loan_amount||y?.loanRequired)&&(e.loan_required=y.loan_required||y.loan_amount||y.loanRequired),(y?.company_name||y?.companyName)&&(e.company_name=y.company_name||y.companyName),(y?.cibil_score||y?.cibilScore)&&(e.cibil_score=y.cibil_score||y.cibilScore),Object.keys(e).length>0?e:null})()},{name:"Lead Form Data (Alternative Fields)",data:(()=>{const e={};return(y?.income||y?.monthly_salary)&&(e.salary=y.income||y.monthly_salary),(y?.required_loan||y?.loan_amt)&&(e.loan_required=y.required_loan||y.loan_amt),(y?.employer||y?.company)&&(e.company_name=y.employer||y.company),Object.keys(e).length>0?e:null})()},{name:"Local Storage Backup",data:(()=>{try{const e=localStorage.getItem(`obligationBackup_${y?._id}`);return e?JSON.parse(e):null}catch(a){return null}})()}];let n=null;for(const e of t)if(e.data&&"object"==typeof e.data&&Object.keys(e.data).length>0&&(e.data.salary||e.data.monthly_income||e.data.loan_required||e.data.loan_amount||e.data.company_name||e.data.companyName||e.data.financial_details||e.data.personal_details||e.data.check_eligibility||e.data.eligibility||e.data.obligations)){n=e.data;break}n&&(e(n),xt(!0))}let t=[];t=y?.file_sent_to_login?[y?.dynamic_details,y?.dynamic_fields?.obligation_data,y?.dynamic_fields,y,l()]:[y?.dynamic_fields?.obligation_data,y?.dynamic_fields,l()];let n=null;for(let e=0;e<t.length;e++){const a=t[e];if(a&&"object"==typeof a&&Object.keys(a).length>0&&(a.salary||a.partnerSalary||a.obligations||a.companyName||a.company_name||a.loanRequired||a.loan_required||a.loan_amount||a.cibilScore||a.cibil_score||a.financial_details||a.personal_details||a.obligation_data||a.dynamic_details||a.dynamic_fields)){n=a;break}}n?(e(n),xt(!0),y?.file_sent_to_login&&setTimeout(()=>{wt(!0)},200)):xt(!0)}}catch(n){kt(null);const t=y?.dynamic_fields?.obligation_data||y?.dynamic_fields||l();t&&Object.keys(t).length>0&&(t.salary||t.partnerSalary||t.obligations||t.companyName||t.loanRequired||t.cibilScore||t.financial_details||t.obligation_data)?(e(t),xt(!0)):xt(!0)}}else if(!bt&&!t){const t=l();t&&Object.keys(t).length>0&&(e(t),xt(!0))}})(),setTimeout(()=>{ne(!1)},y?.file_sent_to_login?500:100),setTimeout(()=>{},100)},[y?._id,JSON.stringify(y?.dynamic_fields?.obligations),Fe]),a.useEffect(()=>{const e=y?.dynamic_fields?.obligations;if(e&&Array.isArray(e)&&e.length>0&&JSON.stringify(e)!==JSON.stringify(H)&&!K&&0===H.length&&!At){const t=e.map((e,t)=>({id:e.id||`${Date.now()}-sync-${t}`,product:e.product||"",bankName:e.bankName||e.bank_name||"",tenure:e.tenure||"",roi:e.roi||"",totalLoan:e.totalLoan||e.total_loan||"",outstanding:e.outstanding||"",emi:e.emi||"",action:e.action||"Obligate",selectedPercentage:e.selectedPercentage||e.selected_percentage||null,selectedTenurePercentage:e.selectedTenurePercentage||e.selected_tenure_percentage||null,selectedRoiPercentage:e.selectedRoiPercentage||e.selected_roi_percentage||null}));G(t)}},[JSON.stringify(y?.dynamic_fields?.obligations),K]),a.useEffect(()=>{const e={salary:v,partnerSalary:j,yearlyBonus:S,loanRequired:A,companyName:L,cibilScore:Q,obligationsCount:H.length,timestamp:Date.now()};if(!jt.timestamp||jt.salary!==v||jt.loanRequired!==A||jt.companyName,jt.timestamp&&!ae){const e=[];if(jt.salary&&!v&&e.push("salary"),jt.partnerSalary&&!j&&e.push("partnerSalary"),jt.yearlyBonus&&!S&&e.push("yearlyBonus"),jt.loanRequired&&!A&&e.push("loanRequired"),jt.companyName&&!L&&e.push("companyName"),jt.cibilScore&&!Q&&e.push("cibilScore"),e.length>0&&e.length>=2&&y?.file_sent_to_login){const t=[(()=>{try{const e=localStorage.getItem(`obligationBackup_${y._id}`);return e?JSON.parse(e):null}catch(e){return null}})(),(()=>{try{const e=localStorage.getItem(`stateSnapshot_${y._id}`);return e?JSON.parse(e):null}catch(e){return null}})(),St];for(const a of t)if(a&&"object"==typeof a){let t=!1;if(e.includes("salary")&&a.salary&&(k(a.salary),t=!0),e.includes("loanRequired")&&a.loanRequired&&(T(a.loanRequired),t=!0),e.includes("companyName")&&a.companyName&&(P(a.companyName),t=!0),t)break}}}if(y?.file_sent_to_login&&St&&_t){let e=!1;jt.salary&&!v&&St.salary&&(k(St.salary),e=!0),jt.loanRequired&&!A&&St.loanRequired&&(T(St.loanRequired),e=!0),jt.companyName&&!L&&St.companyName&&(P(St.companyName),e=!0)}Nt(e)},[v,j,S,A,L,Q,H.length,y?.file_sent_to_login,St,_t,ae,bt,le]),a.useEffect(()=>{if(y?.file_sent_to_login&&_t&&0===H.length){const e=y?.dynamic_fields?.obligation_data||y?.dynamic_fields||l();e&&Object.keys(e).length>0&&processObligationData(e)}},[y?.file_sent_to_login,_t,H.length]),a.useEffect(()=>{if(y?.file_sent_to_login&&St){const e=setInterval(()=>{let e=!1;St?.salary&&!v&&(k(St.salary),e=!0),St?.companyName&&!L&&(P(St.companyName),e=!0),St?.partnerSalary&&!j&&(N(St.partnerSalary),e=!0),St?.yearlyBonus&&!S&&(C(St.yearlyBonus),e=!0),St?.loanRequired&&!A&&(T(St.loanRequired),e=!0),St?.cibilScore&&!Q&&(J(St.cibilScore),e=!0),e&&Ot(e=>({...e,recoveryCount:e.recoveryCount+1,lastRecoveryTime:(new Date).toLocaleTimeString()}))},2e3);return()=>clearInterval(e)}},[y?.file_sent_to_login,St,v,L,j,S,A,Q]);const Et=()=>{y?.file_sent_to_login&&ae||(ie(!0),V(!0))};a.useEffect(()=>{if(ae)return;if(y?.file_sent_to_login&&!bt)return;H.filter(e=>"CC (Credit Card)"===e.product).length;const e=setTimeout(()=>{const e=H.reduce((e,t)=>{if("BT"===t.action){const a=Xt(t.outstanding);return e+(isNaN(a)?0:a)}return e},0),t=Vt(e.toString());F!==t&&U(t)},y?.file_sent_to_login?300:100);return()=>clearTimeout(e)},[H,ae,Y,F,y?.file_sent_to_login,bt]),a.useEffect(()=>{const e={},t={};H.forEach((a,n)=>{e[n]={isOpen:!1,searchQuery:""},t[n]={isOpen:!1,searchQuery:""}}),ve(e),je(t)},[H.length]),a.useEffect(()=>{try{Me&&"object"==typeof Me&&Object.keys(Me).length>0&&Object.keys(Me).forEach(e=>{Me[e]?.isOpen&&setTimeout(()=>{const e=document.querySelector('[data-search-input="product"]');e&&e.focus()},50)}),qe&&"object"==typeof qe&&Object.keys(qe).length>0&&Object.keys(qe).forEach(e=>{qe[e]?.isOpen&&setTimeout(()=>{const e=document.querySelector('[data-search-input="bank"]');e&&e.focus()},50)})}catch(e){}},[we,ke]),a.useEffect(()=>{const e=e=>{const t=e.target;t.closest("[data-dropdown-container]")||t.closest(".fixed.z-\\[9999\\]")||t.closest(".fixed.z-50")||t.closest("[data-dropdown-trigger]")||t.closest("[data-category-popup-container]")||t.closest("[data-category-popup-backdrop]")||t.closest("[data-category-popup-item]")||t.closest(".bg-transparent.backdrop-blur-sm")||ca()},t=e=>{const t=e.target;t.closest("[data-dropdown-container]")||t.closest(".fixed.z-\\[9999\\]")||t.closest("[data-dropdown-scroll]")||t.hasAttribute("data-dropdown-scroll")||t.classList.contains("max-h-60")||t.classList.contains("max-h-48")||t.classList.contains("overflow-y-auto")||ca()},a=()=>{ca()};return document.addEventListener("mousedown",e),window.addEventListener("scroll",t,!0),window.addEventListener("resize",a),()=>{document.removeEventListener("mousedown",e),window.removeEventListener("scroll",t,!0),window.removeEventListener("resize",a)}},[]);const Bt=(e=null)=>{const t=null!==e?e:H;let a=L;if(Array.isArray(D)&&D.length>0){const e=D.find(e=>!("object"!=typeof e||!e.company_name)&&""!==e.company_name.trim());e&&e.company_name&&(a=e.company_name)}const n={salary:v,partnerSalary:j,yearlyBonus:S,bonusDivision:$,loanRequired:A,companyName:a,companyType:E,companyCategory:Array.isArray(D)?D.map(e=>"string"==typeof e?{company_name:a||"",bank_name:"",category_name:e,display:e}:"object"==typeof e&&null!==e?{company_name:e.company_name||a||"",bank_name:e.bank_name||"",category_name:e.category_name||e.key||e.display||"",display:e.display||e.key||"",...e}:e):D,cibilScore:Q,obligations:t.map(e=>({...e,tenure:e.tenure?Xt(e.tenure):null,roi:e.roi?aa(e.roi):null,totalLoan:e.totalLoan?Xt(e.totalLoan):null,total_loan:e.totalLoan?Xt(e.totalLoan):null,outstanding:e.outstanding?Xt(e.outstanding):null,emi:e.emi?Xt(e.emi):null})),foirPercent:at,customFoirPercent:lt,totalBtPos:F,totalObligation:Y,eligibility:Ye,ceCompanyCategory:et,ceFoirPercent:at,ceCustomFoirPercent:lt,ceMonthlyEmiCanPay:ot,ceTenureMonths:st,ceTenureYears:dt,ceRoi:pt,ceMultiplier:gt,loanEligibilityStatus:Xe,processingBanks:E,processing_banks:E,processing_bank:E.length>0?E[0]:"",bank_name:E.length>0?E.join(", "):"",bankName:E.length>0?E.join(", "):"",selectedBanks:E,dynamic_fields:{salary:v,partnerSalary:j,yearlyBonus:S,bonusDivision:$,loanRequired:A,companyName:a,companyType:E,companyCategory:D,cibilScore:Q,financial_details:{monthly_income:v?Xt(v):null,partner_salary:j?Xt(j):null,yearly_bonus:S?Xt(S):null,bonus_division:$||null,cibil_score:Q?String(Q):null,loan_required:A?Xt(A):null,loanRequired:A?Xt(A):null,salary:v?Xt(v):null,income:v?Xt(v):null,monthly_salary:v?Xt(v):null,loan_amount:A?Xt(A):null,required_loan:A?Xt(A):null,loan_amt:A?Xt(A):null},personal_details:{company_name:a||"",company_type:Array.isArray(E)?E:E?[E]:[],employer:a||"",employer_name:a||"",company:a||"",organization:a||"",workplace:a||"",company_category:Array.isArray(D)?D.map(e=>"string"==typeof e?{company_name:a||"",bank_name:"",category_name:e,display:e}:"object"==typeof e&&null!==e?{company_name:e.company_name||a||"",bank_name:e.bank_name||"",category_name:e.category_name||e.key||e.display||"",display:e.display||e.key||"",...e}:e):D},check_eligibility:{company_category:et?String(et):null,foir_percent:at||60,custom_foir_percent:lt||null,monthly_emi_can_pay:ot||0,tenure_months:st||null,tenure_years:dt||null,roi:pt||null,multiplier:gt||null,loan_eligibility_status:Xe||"Not Eligible"},eligibility_details:{totalIncome:Ye?.totalIncome||"",total_income:Ye?.totalIncome||"",foirAmount:Ye?.foirAmount||"",foir_amount:Ye?.foirAmount||"",totalObligations:Ye?.totalObligations||"",total_obligations:Ye?.totalObligations||"",totalBtPos:Ye?.totalBtPos||"",total_bt_pos:Ye?.totalBtPos||"",finalEligibility:Ye?.finalEligibility||"",final_eligibility:Ye?.finalEligibility||"",multiplierEligibility:Ye?.multiplierEligibility||"",multiplier_eligibility:Ye?.multiplierEligibility||""},obligations:H.map((e,t)=>({product:e.product||"",bank_name:e.bankName||"",bankName:e.bankName||"",tenure:e.tenure?Xt(e.tenure):null,roi:e.roi?aa(e.roi):null,total_loan:e.totalLoan?Xt(e.totalLoan):null,outstanding:e.outstanding?Xt(e.outstanding):null,emi:e.emi?Xt(e.emi):null,action:e.action||"Obligate",selectedPercentage:e.selectedPercentage||null,selectedTenurePercentage:e.selectedTenurePercentage||null,selectedRoiPercentage:e.selectedRoiPercentage||null,selected_percentage:e.selectedPercentage||null,selected_tenure_percentage:e.selectedTenurePercentage||null,selected_roi_percentage:e.selectedRoiPercentage||null}))},dynamic_details:{financial_details:{monthly_income:v?Xt(v):null,salary:v?Xt(v):null,income:v?Xt(v):null,partner_salary:j?Xt(j):null,yearly_bonus:S?Xt(S):null,bonus_division:$||null,cibil_score:Q?String(Q):null,loan_required:A?Xt(A):null,loanRequired:A?Xt(A):null,loan_amount:A?Xt(A):null,required_loan:A?Xt(A):null},personal_details:{company_name:a||"",employer:a||"",employer_name:a||"",company:a||"",organization:a||"",company_type:Array.isArray(E)?E:E?[E]:[],company_category:D},check_eligibility:{company_category:et?String(et):null,foir_percent:at||60,custom_foir_percent:lt||null,monthly_emi_can_pay:ot||0,tenure_months:st||null,tenure_years:dt||null,roi:pt||null,multiplier:gt||null,loan_eligibility_status:Xe||"Not Eligible"},eligibility_details:{totalIncome:Ye?.totalIncome||"",total_income:Ye?.totalIncome||"",foirAmount:Ye?.foirAmount||"",foir_amount:Ye?.foirAmount||"",totalObligations:Ye?.totalObligations||"",total_obligations:Ye?.totalObligations||"",totalBtPos:Ye?.totalBtPos||"",total_bt_pos:Ye?.totalBtPos||"",finalEligibility:Ye?.finalEligibility||"",final_eligibility:Ye?.finalEligibility||"",multiplierEligibility:Ye?.multiplierEligibility||"",multiplier_eligibility:Ye?.multiplierEligibility||""}}};try{const e={leadId:y?._id,timestamp:Date.now(),source:"LEAD_CREATION_SAVE",salary:v,loanRequired:A,companyName:a,obligationData:n};localStorage.setItem(`leadCreationBackup_${y?._id}`,JSON.stringify(e))}catch(l){}return n},[Rt,It]=a.useState(!1);a.useLayoutEffect(()=>{try{we&&"object"==typeof we&&0!==Object.keys(we).length||ve({0:{isOpen:!1,searchQuery:""}}),ke&&"object"==typeof ke&&0!==Object.keys(ke).length||je({0:{isOpen:!1,searchQuery:""}})}catch(e){}},[]),a.useEffect(()=>{try{we&&"object"==typeof we||ve({0:{isOpen:!1,searchQuery:""}}),ke&&"object"==typeof ke||je({0:{isOpen:!1,searchQuery:""}})}catch(e){}},[]);const[Dt,zt]=a.useState({}),Mt=a.useRef({});a.useEffect(()=>{if(le&&K&&!ae)return de.current&&clearTimeout(de.current),de.current=setTimeout(()=>{(async()=>{if(y?._id&&!ae&&le){ce(!0),re("saving");try{const e=Bt();y?._id?(await ua(e),Ye?.finalEligibility&&(Ge(Ye.finalEligibility),Je(!0),Ve(!0)),re("saved"),V(!1),setTimeout(()=>re(""),3e3)):(r(e),re("saved"),setTimeout(()=>re(""),3e3))}catch(e){re("error"),setTimeout(()=>re(""),5e3)}finally{ce(!1)}}})()},300),()=>{de.current&&clearTimeout(de.current)}},[v,j,S,$,A,L,E,D,Q,H,at,lt,ot,st,dt,pt,gt,le,K,ae]),a.useEffect(()=>{!ae&&le&&(!y?.file_sent_to_login||le&&bt&&!ae)&&V(!0)},[v,j,S,$,A,L,E,D,Q,H,at,lt,F,Y,Ye,et,ot,st,dt,pt,gt,Xe,ae,le,y?.file_sent_to_login,bt]),a.useEffect(()=>{if(!ae&&bt&&le&&jt.timestamp){if(Date.now()-jt.timestamp<2e3)return;const e=!v&&!j&&!S&&!A&&!L&&!Q&&H.length<=1,t=jt.salary&&jt.salary.length>0||jt.loanRequired&&jt.loanRequired.length>0||jt.companyName&&jt.companyName.length>0;e&&t&&St&&!Rt&&(St.salary&&!v&&k(St.salary),St.loanRequired&&!A&&T(St.loanRequired),St.companyName&&!L&&P(St.companyName),St.partnerSalary&&!j&&N(St.partnerSalary),St.yearlyBonus&&!S&&C(St.yearlyBonus),St.cibilScore&&!Q&&J(St.cibilScore))}},[v,j,S,A,L,Q,H.length,ae,bt,St,jt,y?.file_sent_to_login,le,Rt]);const[qt,Ft]=a.useState(!1),[Ut,Yt]=a.useState([]),[Wt,Qt]=a.useState(!1),[Jt,Ht]=a.useState([{value:"private",label:"Private"},{value:"government",label:"Government"},{value:"psu",label:"PSU"},{value:"mnc",label:"MNC"},{value:"decide-bank-for-case",label:"Decide Bank For Case"}]),Gt=[{value:"",label:"Select Product"},{value:"PL (Personal Loan)",label:"PL (Personal Loan)"},{value:"OD (Overdraft)",label:"OD (Overdraft)"},{value:"CC (Credit Card)",label:"CC (Credit Card)"},{value:"BL (Business Loan)",label:"BL (Business Loan)"},{value:"HL (Home Loan)",label:"HL (Home Loan)"},{value:"LAP (Loan Against Property)",label:"LAP (Loan Against Property)"},{value:"AL (Auto Loan/ Car Loan)",label:"AL (Auto Loan/ Car Loan)"},{value:"EL (Education Loan)",label:"EL (Education Loan)"},{value:"GL (Gold Loan)",label:"GL (Gold Loan)"},{value:"LOC (Loan On Credit Card)",label:"LOC (Loan On Credit Card)"},{value:"CD (Consumer Durable Loan)",label:"CD (Consumer Durable Loan)"},{value:"APP LOAN",label:"APP LOAN"},{value:"INSURANCE",label:"INSURANCE"}],Kt=[{value:"BT",label:"BT",color:"green"},{value:"Obligate",label:"Obligate",color:"yellow"},{value:"CO-PAY",label:"CO-PAY",color:"orange"},{value:"NO-PAY",label:"NO-PAY",color:"blue"},{value:"Closed",label:"Closed",color:"red"}],Vt=e=>{if(!e)return"";const t=String(e),a=parseFloat(t.replace(/[^0-9.]/g,""));return isNaN(a)?"":new Intl.NumberFormat("en-IN").format(a)},Xt=e=>{if(!e)return 0;const t=String(e);return parseFloat(t.replace(/[^0-9.]/g,""))||0},Zt=e=>{if(!e)return"";const t=String(e).replace(/[^0-9]/g,"");return t?`${t} Months`:""},ea=e=>e?String(e).replace(/[^0-9]/g,""):"",ta=e=>{if(!e)return"";const t=String(e).replace(/[^0-9.]/g,"");return t?`${t}%`:""},aa=e=>e?String(e).replace(/[^0-9.]/g,""):"",na=()=>{if(Ne)return;const e={},t={};H.forEach((a,n)=>{e[n]={isOpen:!1,searchQuery:""},t[n]={isOpen:!1,searchQuery:""}}),ve(e),je(t);const a=H.reduce((e,t)=>{if("BT"===t.action){const a=Xt(t.outstanding);return e+(isNaN(a)?0:a)}return e},0);U(Vt(a.toString())),Ne||setTimeout(()=>{pe(e=>e+1),y?.file_sent_to_login||ge(Date.now())},y?.file_sent_to_login?200:100)},la=(e,t,a)=>{ie(!0),V(!0),G(n=>{const l=[...n];let i=a;if("string"!=typeof a||["emi","roi","tenure","totalLoan","outstanding","action"].includes(t)||(i=a.toUpperCase()),l[e]="bankName"===t?{...l[e],bankName:i,bank_name:i}:{...l[e],[t]:i},Lt(l[e].product)){if("product"===t){l[e]={...l[e],tenure:"",roi:"",emi:"",selectedPercentage:null,selectedRoiPercentage:null,selectedTenurePercentage:null};const t=Xt(l[e].outstanding);if(t>0){const a=.05*t;l[e]={...l[e],emi:Vt(a.toString()),roi:"5%",selectedRoiPercentage:5,selectedTenurePercentage:null}}}if("outstanding"===t){const t=Xt(a);if(t>0){const a=.05*t;l[e]={...l[e],emi:Vt(a.toString()),roi:"5%",selectedRoiPercentage:5,selectedTenurePercentage:null}}else l[e]={...l[e],emi:"",roi:"",selectedPercentage:null,selectedRoiPercentage:null,selectedTenurePercentage:null}}}else"product"!==t||Lt(l[e].product)||(l[e]={...l[e],selectedPercentage:null,selectedRoiPercentage:null,selectedTenurePercentage:null});return"action"===t?(f&&f("obligations",l),Et(),l):(Et(),l)})},ia=a.useRef(null),oa=()=>{K&&le&&y?._id&&(ia.current&&clearTimeout(ia.current),ia.current=setTimeout(async()=>{f&&f("obligations",H);try{await(async()=>{if(K){It(!0),h&&"function"==typeof h&&h({hasUnsavedChanges:!0,isSaving:!0});try{const t=Bt();if(t.obligations?.filter(e=>"CC (Credit Card)"===e.product),y?._id?await ua(t):r(t),V(!1),Ye?.finalEligibility&&(Ge(Ye.finalEligibility),Je(!0),Ve(!0)),ie(!1),na(),y?._id)try{const e=m();if(e){const t=y&&(y.original_lead_id||y.login_created_at)?`${s}/lead-login/login-leads/${y._id}/obligations?user_id=${e}`:`${s}/leads/${y._id}/obligations?user_id=${e}`,a=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const e=await a.json();e&&Object.keys(e).length>0&&(await processObligationData(e),na(),n.flushSync(()=>{pe(e=>e+1),ge(Date.now()),be(Date.now())}))}}}catch(e){na()}else{const e=l();e?(await processObligationData(e),na(),n.flushSync(()=>{pe(e=>e+1),ge(Date.now()),be(Date.now())})):na()}te({salary:v,partnerSalary:j,yearlyBonus:S,bonusDivision:$,loanRequired:A,companyName:L,companyType:E,companyCategory:D,cibilScore:Q,obligations:H,totalBtPos:F,totalObligation:Y}),n.flushSync(()=>{pe(e=>e+1),ge(Date.now()),be(Date.now()),G(e=>[...e])}),setTimeout(()=>{const e=H.reduce((e,t)=>{if("BT"===t.action){const a=Xt(t.outstanding);return e+(isNaN(a)?0:a)}return e},0);U(Vt(e.toString()))},100),h&&"function"==typeof h&&h({hasUnsavedChanges:!1,isSaving:!1})}catch(e){h&&"function"==typeof h&&h({hasUnsavedChanges:!0,isSaving:!1,error:e.message})}finally{It(!1)}}})()}catch(e){}},500))},ra=e=>{switch(e){case"BT":return"bg-green-400 border-green-600 text-black font-bold";case"Obligate":default:return"bg-yellow-400 border-yellow-600 text-black font-bold";case"CO-PAY":return"bg-orange-400 border-orange-600 text-black font-bold";case"NO-PAY":return"bg-blue-400 border-blue-600 text-black font-bold";case"Closed":return"bg-red-400 border-red-600 text-black font-bold"}};function sa(e){if(!e)return{openUpward:!1,left:0,top:0,width:200};const t=e.getBoundingClientRect(),a=window.innerHeight,n=window.innerWidth,l=250,i=Math.max(t.width,300),o=a-t.bottom,r=t.top,s=o<l&&r>o;let c=t.left,d=s?t.top-l:t.bottom;return c+i>n&&(c=n-i-10),c<10&&(c=10),d<10&&(d=10),d+l>a-10&&(d=a-l-10),{openUpward:s,left:c,top:d,width:i}}function ca(){ve(e=>{const t={};return Object.keys(e).forEach(a=>{t[a]={...e[a],isOpen:!1}}),t}),je(e=>{const t={};return Object.keys(e).forEach(a=>{t[a]={...e[a],isOpen:!1}}),t}),Ae(!1)}async function da(e){if(De(!0),P(e),Ae(!1),V(!0),Et(),f&&f("company_name",e),Le([]),setTimeout(()=>{ze.current&&(ze.current.focus(),ze.current.blur())},100),e&&e.trim()){Qt(!0);try{const t=await(async e=>{try{const t=m();if(!t)return[];if(!e)return[];const a=`${s}/settings/search-companies?user_id=${t}`,n={company_name:e,similarity_threshold:.6},l=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",...localStorage.getItem("token")&&{Authorization:`Bearer ${localStorage.getItem("token")}`}},body:JSON.stringify(n)});if(!l.ok){const e=await l.text();throw new Error(`HTTP error! status: ${l.status} - ${e}`)}const i=await l.json();let o=[];return Array.isArray(i)?o=i:i.companies&&Array.isArray(i.companies)?o=i.companies:i.categories&&Array.isArray(i.categories)?o=i.categories:i.data&&Array.isArray(i.data)&&(o=i.data),o.length,o}catch(t){return[]}})(e.trim());if(t&&t.length>0){const e=t.map((e,t)=>({id:`${e.company_name||"Unknown"}-${e.bank_names?.[0]||"Unknown"}-${e.categories?.[0]||"Unknown"}-${t}`,company_name:e.company_name||"Unknown",bank_name:e.bank_names?.[0]||e.bank_name||null,category_name:e.categories?.[0]||e.category_name||null,similarity_percentage:e.similarity_percentage||0,display_key:`${e.company_name||"Unknown"}-${e.bank_names?.[0]||e.bank_name||"Unknown"}-${e.categories?.[0]||e.category_name||"Unknown"}`,display_text:`${e.company_name||"Unknown"} → ${e.bank_names?.[0]||e.bank_name||"Unknown"} → ${e.categories?.[0]||e.category_name||"Unknown"}`,label:`${e.company_name||"Unknown"} → ${e.bank_names?.[0]||e.bank_name||"Unknown"} → ${e.categories?.[0]||e.category_name||"Unknown"}`,value:`${e.company_name||"Unknown"}-${e.bank_names?.[0]||e.bank_name||"Unknown"}-${e.categories?.[0]||e.category_name||"Unknown"}`}));Yt(e)}else Yt([])}catch(t){Yt([])}finally{Qt(!1)}}else Yt([]);setTimeout(()=>{De(!1)},500)}function ma(e){if(!Me||"object"!=typeof Me)return Gt.slice(1);const t=Me&&Me[e]?.searchQuery||"";return Gt.slice(1).filter(e=>e.label.toLowerCase().includes(t.toLowerCase()))}function pa(e){if(!ke||"object"!=typeof ke)return[];const t=ke&&ke[e]?.searchQuery||"",a=[];return E.forEach(e=>{e&&!he.includes(e)&&a.push(`${e}`)}),he.forEach(e=>{if(e){const t=E.includes(e);a.push(t?`${e}`:e)}}),a.filter(e=>e.toLowerCase().includes(t.toLowerCase()))}a.useEffect(()=>{(async()=>{Ft(!0);try{const[e,t]=await Promise.all([u(),g()]),a=(Array.isArray(e)?e:["Custom"]).map(e=>"string"==typeof e?e:e.name||e.label||String(e));if(a.includes("Custom")||a.unshift("Custom"),_e(a),t&&t.length>0&&Yt(t),(Array.isArray(E)?E:"string"==typeof E&&E?[E]:[]).includes("decide-bank-for-case")){const e=await g();e&&e.length>0&&Ht(t=>t.map(t=>"decide-bank-for-case"===t.value?{...t,categories:e}:t))}}catch(e){}finally{Ft(!1)}})()},[]),a.useEffect(()=>{(Array.isArray(E)?E:"string"==typeof E&&E?[E]:[]).includes("decide-bank-for-case")&&(async()=>{Qt(!0);try{const e=await g();Yt(e)}catch(e){}finally{Qt(!1)}})()},[E]),a.useEffect(()=>{const e=$?Xt(S)/$:0,t=Xt(v)+Xt(j)+e,a=t*("custom"===at?aa(lt):at)/100;let n=0,l=0;H.forEach(e=>{const t=Xt(e.emi),a=Xt(e.outstanding);switch(e.action){case"BT":l+=a;break;case"Obligate":default:n+=t;break;case"CO-PAY":n+=t/2;case"NO-PAY":case"Closed":}});const i=Math.max(0,a-n);rt(Math.round(i));const o=aa(pt),r=ea(st);let s=0;if(o>0&&r>0&&i>0){const e=o/100/12,t=Math.pow(1+e,r);s=i*(t-1)/(e*t)}const c=Number(gt)||0,d=(t-n)*c;let m;m=Qe&&He&&!le?He:Vt(Math.round(s).toString());const p={totalIncome:Vt(Math.round(t).toString()),foirAmount:Vt(Math.round(a).toString()),totalObligations:Vt(Math.round(n).toString()),totalBtPos:Vt(Math.round(l).toString()),finalEligibility:m,multiplierEligibility:Vt(Math.round(d).toString())};We(p),U(Vt(Math.round(l).toString()));const u=Xt(A),g=Math.round(s)>=u?"Eligible":"Not Eligible";Ze(g)},[v,j,S,$,H,at,lt,gt,pt,st,dt,A,Qe,He,le]),a.useEffect(()=>{let e=0;H.forEach((t,a)=>{const n=Xt(t.emi);switch(t.action){case"BT":case"NO-PAY":case"Closed":break;case"Obligate":default:e+=n;break;case"CO-PAY":e+=n/2}});const t=Vt(Math.round(e).toString());W(t),setTimeout(()=>{},100)},[H]);const ua=async(e,t=!1)=>{if(y?._id)try{const a=m();if(!a)return;const n=localStorage.getItem("token"),l={...e,processingBank:e.bank_name||"",processing_bank:e.bank_name||"",bank_name:e.bank_name||"",bankName:e.bank_name||""},i=y&&(y.original_lead_id||y.login_created_at)?`${s}/lead-login/login-leads/${y._id}/obligations?user_id=${a}`:`${s}/leads/${y._id}/obligations?user_id=${a}`,o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(l)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const r=await o.json();if(r&&r.personal_details,f&&!t){const t={...y.dynamic_fields,obligation_data:e,obligations:e.obligations||[],personal_details:{...y.dynamic_fields?.personal_details,salary:e.salary,partner_salary:e.partnerSalary,company_name:e.companyName,company_type:e.companyType,company_category:e.companyCategory,yearly_bonus:e.yearlyBonus,bonus_division:e.bonusDivision,loan_required:e.loanRequired,cibil_score:e.cibilScore?String(e.cibilScore):null},financial_details:{...y.dynamic_fields?.financial_details,monthly_income:e.salary,partner_salary:e.partnerSalary,yearly_bonus:e.yearlyBonus,bonus_division:e.bonusDivision,loan_required:e.loanRequired,cibil_score:e.cibilScore?String(e.cibilScore):null},check_eligibility:{...y.dynamic_fields?.check_eligibility,company_category:e.ceCompanyCategory,foir_percent:e.ceFoirPercent,custom_foir_percent:e.ceCustomFoirPercent,monthly_emi_can_pay:e.ceMonthlyEmiCanPay,tenure_months:e.ceTenureMonths,tenure_years:e.ceTenureYears,roi:e.ceRoi,multiplier:e.ceMultiplier,total_bt_pos:e.totalBtPos,total_obligation:e.totalObligation,eligibility:e.eligibility,loan_eligibility_status:e.loanEligibilityStatus}},a=(e.obligations||[]).map(e=>{const t=e=>{if(null==e||""===e)return null;if("number"==typeof e)return e;const t="string"==typeof e?parseFloat(e.replace(/,/g,"")):e;return isNaN(t)?null:t};return{...e,tenure:t(e.tenure),roi:t(e.roi),total_loan:t(e.total_loan),emi:t(e.emi),transfer_to_proposed_bank:t(e.transfer_to_proposed_bank),existing_emi:t(e.existing_emi),foirEmi:t(e.foirEmi)}}),n={...t,obligations:a};f("dynamic_fields",n),f("obligations",a),f("salary",e.salary),f("total_obligation",e.totalObligation),f("eligibility",e.eligibility),f("processing_banks",e.selectedBanks||[]),f("bank_name",e.bank_name||"")}h&&"function"==typeof h&&h({hasUnsavedChanges:!1,isSaving:!1})}catch(a){throw r(e),a}};if(!Me||!qe)return e.jsx("div",{className:"min-h-screen bg-black p-6 flex items-center justify-center",children:e.jsx("div",{className:"text-white text-xl",children:"Loading..."})});if(y?.file_sent_to_login&&!ae&&bt&&!v&&!L&&0===H.length)if(St)Ot(e=>({...e,recoveryCount:e.recoveryCount+1,lastRecoveryTime:(new Date).toLocaleTimeString()})),setTimeout(()=>{St?.salary&&k(St.salary),St?.companyName&&P(St.companyName),St?.partnerSalary&&N(St.partnerSalary),St?.yearlyBonus&&C(St.yearlyBonus),St?.loanRequired&&T(St.loanRequired),St?.cibilScore&&J(St.cibilScore)},0);else{const e=y?.dynamic_fields?.obligation_data||y?.dynamic_fields||{};e&&Object.keys(e).length>0&&setTimeout(()=>processObligationData(e),0)}return function(e,t,n,l,i,o,r,s,c,d){a.useEffect(()=>{const a=(e?.name||"").toLowerCase().includes("gunjan")||(e?.customer_name||"").toLowerCase().includes("gunjan"),r=e?.file_sent_to_login;if((a||r)&&e?._id&&(t||n||l))try{const a={salary:t,loanRequired:n,companyName:l,ceCompanyCategory:i,ceFoirPercent:o,timestamp:Date.now(),leadId:e._id};localStorage.setItem(`stateSnapshot_${e._id}`,JSON.stringify(a))}catch(s){}},[e?._id,e?.file_sent_to_login,t,n,l,i,o,r.length,s,c,d])}(y,v,A,L,et,at,H,bt,ae,vt),e.jsxs("div",{className:"min-h-screen bg-black p-6",children:[e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"mb-8 form-section",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"mb-2 flex justify-between items-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:"Customer Details"}),(()=>{try{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);if(t.role?.name&&t.role.name.toLowerCase().includes("super admin"))return!0;if(t.role?.permissions&&Array.isArray(t.role.permissions)){const e=t.role.permissions.find(e=>"leads.pl_&_odd_leads"===e.page||"leads.pl_odd_leads"===e.page||"leads_pl_&_odd_leads"===e.page||"leads_pl_odd_leads"===e.page);if(e&&e.actions){const t=Array.isArray(e.actions)?e.actions:[e.actions];if(t.includes("download_obligation")||t.includes("download"))return!0}const a=t.role.permissions.find(e=>"leads"===e.page||"Leads"===e.page);if(a&&a.actions){const e=Array.isArray(a.actions)?a.actions:[a.actions];if(e.includes("download_obligation")||e.includes("download"))return!0}}}return!1}catch(e){return!1}})()&&e.jsxs("button",{type:"button",onClick:async()=>{try{const e=document.createElement("div");e.style.position="fixed",e.style.top="-9999px",e.style.left="-9999px",e.style.width="1200px",e.style.background="white",e.style.padding="20px",e.style.fontFamily="Arial, sans-serif",e.style.color="black";const t=e=>{if(!e)return"0";const t=String(e),a=parseFloat(t.replace(/[^0-9.]/g,""));return isNaN(a)?"0":new Intl.NumberFormat("en-IN").format(a)};e.innerHTML=`\n        <div style="background: white; color: black; padding: 20px; width: 100%; box-sizing: border-box;">\n          \x3c!-- Header --\x3e\n          <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px;">\n            <h1 style="color: black; margin: 0; font-size: 28px; font-weight: bold;">Customer Obligation Report</h1>\n            <p style="margin: 10px 0; font-size: 16px;"><strong>Generated on:</strong> ${(new Date).toLocaleString()}</p>\n            ${y?.name?`<p style="margin: 5px 0; font-size: 16px;"><strong>Customer:</strong> ${y.name}</p>`:""}\n            ${y?.phone?`<p style="margin: 5px 0; font-size: 16px;"><strong>Phone:</strong> ${y.phone}</p>`:""}\n          </div>\n\n          \x3c!-- Customer Details Section --\x3e\n          <div style="margin-bottom: 30px;">\n            <h2 style="color: black; font-size: 24px; font-weight: bold; margin-bottom: 20px; border-bottom: 2px solid #ccc; padding-bottom: 10px;">Customer Details</h2>\n            \n            \x3c!-- Financial Information Row --\x3e\n            <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">\n              <div style="flex: 1; min-width: 200px;">\n                <label style="display: block; font-weight: bold; font-size: 18px; color: black; margin-bottom: 5px;">Salary</label>\n                <div style="padding: 12px; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; font-size: 18px; font-weight: bold;">₹${t(v)}</div>\n              </div>\n              <div style="flex: 1; min-width: 200px;">\n                <label style="display: block; font-weight: bold; font-size: 18px; color: black; margin-bottom: 5px;">Partner's Salary</label>\n                <div style="padding: 12px; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; font-size: 18px; font-weight: bold;">₹${t(j)}</div>\n              </div>\n              <div style="flex: 1; min-width: 200px;">\n                <label style="display: block; font-weight: bold; font-size: 18px; color: black; margin-bottom: 5px;">Bonus ${$?`(Divide by ${$} Month${1===$?"":"s"})`:""}</label>\n                <div style="padding: 12px; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; font-size: 18px; font-weight: bold;">₹${t(S)}</div>\n              </div>\n            </div>\n\n            \x3c!-- Second Row --\x3e\n            <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">\n              <div style="flex: 1; min-width: 200px;">\n                <label style="display: block; font-weight: bold; font-size: 18px; color: black; margin-bottom: 5px;">Loan Amount Required</label>\n                <div style="padding: 12px; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; font-size: 18px; font-weight: bold;">₹${t(A)}</div>\n              </div>\n              <div style="flex: 1; min-width: 200px;">\n                <label style="display: block; font-weight: bold; font-size: 18px; color: black; margin-bottom: 5px;">Company Name</label>\n                <div style="padding: 12px; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; font-size: 18px; font-weight: bold;">${L||"N/A"}</div>\n              </div>\n            </div>\n\n            \x3c!-- Third Row --\x3e\n            <div style="display: flex; flex-wrap: wrap; gap: 20px;">\n              <div style="flex: 1; min-width: 200px;">\n                <label style="display: block; font-weight: bold; font-size: 18px; color: black; margin-bottom: 5px;">Decide Bank For Case</label>\n                <div style="padding: 12px; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; font-size: 16px; font-weight: bold;">\n                  ${Array.isArray(E)&&E.length>0?E.map(e=>`<span style="display: inline-block; background: #dbeafe; color: #1e40af; padding: 4px 12px; margin: 2px; border-radius: 6px; font-weight: bold;">${e}</span>`).join(" "):"N/A"}\n                </div>\n              </div>\n              <div style="flex: 1; min-width: 200px;">\n                <label style="display: block; font-weight: bold; font-size: 18px; color: black; margin-bottom: 5px;">Company Category</label>\n                <div style="padding: 12px; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; font-size: 16px; font-weight: bold;">\n                  ${Array.isArray(D)&&D.length>0?D.map(e=>`<span style="display: inline-block; background: #dcfce7; color: #166534; padding: 4px 12px; margin: 2px; border-radius: 6px; font-weight: bold;">${"object"==typeof e?e.display_text||e.category_name||"Unknown":e}</span>`).join(" "):"N/A"}\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Customer Obligations Section --\x3e\n          <div style="margin-bottom: 30px;">\n            <h2 style="color: #10b981; font-size: 32px; font-weight: bold; text-align: center; margin-bottom: 20px;">Customer Obligations</h2>\n            \n            \x3c!-- Summary Section --\x3e\n            <div style="display: flex; gap: 20px; margin-bottom: 30px; justify-content: center;">\n              <div style="text-align: center;">\n                <label style="display: block; font-weight: bold; font-size: 18px; color: #10b981; margin-bottom: 10px;">TOTAL BT POS</label>\n                <div style="background: #10b981; color: black; padding: 15px 30px; border-radius: 8px; font-size: 24px; font-weight: bold; min-width: 200px;">₹${t(F)}</div>\n              </div>\n              <div style="text-align: center;">\n                <label style="display: block; font-weight: bold; font-size: 18px; color: #facc15; margin-bottom: 10px;">TOTAL OBLIGATION</label>\n                <div style="background: #facc15; color: black; padding: 15px 30px; border-radius: 8px; font-size: 24px; font-weight: bold; min-width: 200px;">₹${t(Y)}</div>\n              </div>\n              <div style="text-align: center;">\n                <label style="display: block; font-weight: bold; font-size: 18px; color: #60a5fa; margin-bottom: 10px;">CIBIL SCORE</label>\n                <div style="background: #dbeafe; color: black; padding: 15px 30px; border: 2px solid #60a5fa; border-radius: 8px; font-size: 24px; font-weight: bold; min-width: 200px;">${Q||"N/A"}</div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Obligations Table --\x3e\n          <div style="margin-bottom: 30px;">\n            <div style="background: #374151; color: white; padding: 15px; border-radius: 8px 8px 0 0;">\n              <h3 style="margin: 0; font-size: 20px; font-weight: bold;">Bank-wise Customer Obligations</h3>\n            </div>\n            \n            <table style="width: 100%; border-collapse: collapse; border: 2px solid #374151;">\n              <thead>\n                <tr style="background: black; color: white;">\n                  <th style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 14px;">#</th>\n                  <th style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 14px;">PRODUCT</th>\n                  <th style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 14px;">BANK NAME</th>\n                  <th style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 14px;">TENURE</th>\n                  <th style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 14px;">ROI %</th>\n                  <th style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 14px;">TOTAL LOAN</th>\n                  <th style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 14px;">OUTSTANDING</th>\n                  <th style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 14px;">EMI</th>\n                  <th style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 14px;">ACTION</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${H.map((e,a)=>{let n="#f8f9fa",l="black";switch((e.action||"").toLowerCase()){case"bt":n="#4ade80",l="black";break;case"obligate":n="#facc15",l="black";break;case"co-pay":case"copay":n="#fb923c",l="black";break;case"no-pay":case"nopay":n="#60a5fa",l="black";break;case"closed":n="#f87171",l="black"}return`\n                    <tr style="background: ${a%2==0?"#f8f9fa":"white"};">\n                      <td style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 12px;">${a+1}</td>\n                      <td style="padding: 12px 8px; border: 2px solid #6b7280; font-weight: bold; font-size: 12px;">${e.product||"N/A"}</td>\n                      <td style="padding: 12px 8px; border: 2px solid #6b7280; font-weight: bold; font-size: 12px;">${e.bankName||"N/A"}</td>\n                      <td style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 12px;">${e.tenure||"N/A"}</td>\n                      <td style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; font-weight: bold; font-size: 12px;">${e.roi||"N/A"}</td>\n                      <td style="padding: 12px 8px; border: 2px solid #6b7280; text-align: right; font-weight: bold; font-size: 12px;">${e.totalLoan?"₹"+t(e.totalLoan):"N/A"}</td>\n                      <td style="padding: 12px 8px; border: 2px solid #6b7280; text-align: right; font-weight: bold; font-size: 12px;">${e.outstanding?"₹"+t(e.outstanding):"N/A"}</td>\n                      <td style="padding: 12px 8px; border: 2px solid #6b7280; text-align: right; font-weight: bold; font-size: 12px;">${e.emi?"₹"+t(e.emi):"N/A"}</td>\n                      <td style="padding: 12px 8px; border: 2px solid #6b7280; text-align: center; background: ${n}; color: ${l}; font-weight: bold; font-size: 12px;">${e.action||"N/A"}</td>\n                    </tr>\n                  `}).join("")}\n              </tbody>\n            </table>\n          </div>\n\n          \x3c!-- Check Eligibility Section --\x3e\n          <div style="margin-bottom: 30px;">\n            <h2 style="color: black; font-size: 24px; font-weight: bold; margin-bottom: 20px; border-bottom: 2px solid #ccc; padding-bottom: 10px;">CHECK ELIGIBILITY</h2>\n            \n            \x3c!-- First Row --\x3e\n            <div style="display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">\n              \x3c!-- Total Income --\x3e\n              <div style="flex: 1; min-width: 150px;">\n                <label style="display: block; font-weight: bold; font-size: 16px; color: black; margin-bottom: 5px;">Total Income</label>\n                <div style="padding: 8px; background: black; color: white; border: 2px solid #6b7280; border-radius: 6px; font-size: 18px; font-weight: bold;">₹${t(Ye.totalIncome)}</div>\n              </div>\n              \x3c!-- Company Category --\x3e\n              <div style="flex: 1; min-width: 150px;">\n                <label style="display: block; font-weight: bold; font-size: 16px; color: black; margin-bottom: 5px;">Company Category</label>\n                <div style="padding: 8px; background: #f8f9fa; border: 2px solid #6b7280; border-radius: 6px; font-size: 16px; font-weight: bold;">${et||"N/A"}</div>\n              </div>\n              \x3c!-- FOIR % --\x3e\n              <div style="flex: 1; min-width: 120px;">\n                <label style="display: block; font-weight: bold; font-size: 16px; color: black; margin-bottom: 5px;">FOIR %</label>\n                <div style="padding: 8px; background: #f8f9fa; border: 2px solid #6b7280; border-radius: 6px; font-size: 18px; font-weight: bold; text-align: center;">${"custom"===at?lt||"60%":at+"%"}</div>\n              </div>\n              \x3c!-- FOIR Amount --\x3e\n              <div style="flex: 1; min-width: 160px;">\n                <label style="display: block; font-weight: bold; font-size: 16px; color: black; margin-bottom: 5px;">FOIR Amount</label>\n                <div style="padding: 8px; background: black; color: white; border: 2px solid #6b7280; border-radius: 6px; font-size: 18px; font-weight: bold;">₹${t(Ye.foirAmount)}</div>\n              </div>\n              \x3c!-- Total Obligation --\x3e\n              <div style="flex: 1; min-width: 180px;">\n                <label style="display: block; font-weight: bold; font-size: 16px; color: black; margin-bottom: 5px;">Total Obligation</label>\n                <div style="padding: 8px; background: #facc15; color: black; border: 2px solid #eab308; border-radius: 6px; font-size: 18px; font-weight: bold;">₹${t(Ye.totalObligations||Y)}</div>\n              </div>\n            </div>\n\n            \x3c!-- Second Row --\x3e\n            <div style="display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">\n              \x3c!-- Monthly EMI Can Pay --\x3e\n              <div style="flex: 1; min-width: 180px;">\n                <label style="display: block; font-weight: bold; font-size: 16px; color: black; margin-bottom: 5px;">Monthly EMI Can Pay</label>\n                <div style="padding: 8px; background: black; color: white; border: 2px solid #6b7280; border-radius: 6px; font-size: 18px; font-weight: bold;">₹${t(ot)}</div>\n              </div>\n              \x3c!-- Tenure (Months) --\x3e\n              <div style="flex: 1; min-width: 180px;">\n                <label style="display: block; font-weight: bold; font-size: 16px; color: black; margin-bottom: 5px;">TENURE (Months)</label>\n                <div style="padding: 8px; background: #f8f9fa; border: 2px solid #6b7280; border-radius: 6px; font-size: 18px; font-weight: bold; text-align: center;">${st||"N/A"}</div>\n              </div>\n              \x3c!-- Tenure (Years) --\x3e\n              <div style="flex: 1; min-width: 180px;">\n                <label style="display: block; font-weight: bold; font-size: 16px; color: black; margin-bottom: 5px;">TENURE (Years)</label>\n                <div style="padding: 8px; background: black; color: white; border: 2px solid #6b7280; border-radius: 6px; font-size: 18px; font-weight: bold; text-align: center;">${dt||"N/A"}</div>\n              </div>\n              \x3c!-- ROI --\x3e\n              <div style="flex: 1; min-width: 140px;">\n                <label style="display: block; font-weight: bold; font-size: 16px; color: black; margin-bottom: 5px;">ROI</label>\n                <div style="padding: 8px; background: #f8f9fa; border: 2px solid #6b7280; border-radius: 6px; font-size: 18px; font-weight: bold; text-align: center;">${pt||"N/A"}</div>\n              </div>\n              \x3c!-- TOTAL BT POS --\x3e\n              <div style="flex: 1; min-width: 180px;">\n                <label style="display: block; font-weight: bold; font-size: 16px; color: black; margin-bottom: 5px;">TOTAL BT POS</label>\n                <div style="padding: 8px; background: #22c55e; color: black; border: 2px solid #16a34a; border-radius: 6px; font-size: 18px; font-weight: bold;">₹${t(Ye.totalBtPos||F)}</div>\n              </div>\n            </div>\n\n            \x3c!-- Third Row - Loan Eligibility Results --\x3e\n            <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">\n              \x3c!-- FOIR Eligibility --\x3e\n              <div style="flex: 1; min-width: 280px;">\n                <label style="display: block; font-weight: bold; font-size: 16px; color: black; margin-bottom: 5px;">FOIR Eligibility</label>\n                <div style="padding: 20px; background: black; color: white; border: 2px solid #6b7280; border-radius: 6px; font-size: 24px; font-weight: bold; text-align: center;">₹${t(Ye.finalEligibility)}</div>\n              </div>\n              \x3c!-- Multiplier Eligibility --\x3e\n              <div style="flex: 1; min-width: 280px;">\n                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">\n                  <label style="font-weight: bold; font-size: 16px; color: black;">Multiplier Eligibility</label>\n                  <div style="display: flex; align-items: center; gap: 8px;">\n                    <span style="font-size: 12px; font-weight: bold; color: black;">Multiplier:</span>\n                    <div style="padding: 4px 8px; background: #facc15; color: black; border: 2px solid #eab308; border-radius: 4px; font-weight: bold; font-size: 14px;">${gt||"0"}</div>\n                  </div>\n                </div>\n                <div style="padding: 20px; background: black; color: white; border: 2px solid #6b7280; border-radius: 6px; font-size: 24px; font-weight: bold; text-align: center;">₹${t(Ye.multiplierEligibility)}</div>\n              </div>\n            </div>\n\n            \x3c!-- Balance Transfer Eligibility Message --\x3e\n            ${(()=>{const e=parseFloat((Ye?.finalEligibility||"0").replace(/[^\d.-]/g,""))||0,t=parseFloat((Ye?.totalBtPos||F||"0").replace(/[^\d.-]/g,""))||0;return e>0&&t>0?e>=t?'\n                    <div style="padding: 24px; background: #00FF00; color: black; border-radius: 8px; text-align: center; margin-top: 20px;">\n                      <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">\n                        <div style="width: 32px; height: 32px; margin-right: 12px;">✓</div>\n                        <h2 style="font-size: 28px; font-weight: bold; margin: 0;">Congratulations!</h2>\n                      </div>\n                      <p style="font-size: 20px; font-weight: bold; margin: 0;">Balance Transfer is Eligible</p>\n                    </div>\n                  ':`\n                    <div style="padding: 24px; background: #FF0000; color: white; border-radius: 8px; text-align: center; margin-top: 20px;">\n                      <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 8px;">\n                        <div style="width: 32px; height: 32px; margin-right: 12px;">✗</div>\n                        <h2 style="font-size: 28px; font-weight: bold; margin: 0;">Balance Transfer Not Possible</h2>\n                      </div>\n                      <p style="font-size: 20px; font-weight: bold; margin: 0;">There is a shortfall of ₹${(t-e).toLocaleString("en-IN")}</p>\n                    </div>\n                  `:""})()}\n          </div>\n\n          \x3c!-- Footer --\x3e\n          <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #ccc; font-size: 12px; color: #666;">\n            <p>This report was generated automatically from the Customer Obligation Management System</p>\n            <p>Report ID: ${Date.now()} | Version: 2.0</p>\n          </div>\n        </div>\n      `,document.body.appendChild(e),await new Promise(e=>setTimeout(e,500));const a=await d(e,{scale:2,useCORS:!0,backgroundColor:"#ffffff",width:1200,height:e.scrollHeight,scrollX:0,scrollY:0});document.body.removeChild(e);const n=a.toDataURL("image/png"),l=new c({orientation:"portrait",unit:"mm",format:"a4"}),i=210,o=297,r=a.height*i/a.width;let s=r,m=0;for(l.addImage(n,"PNG",0,m,i,r),s-=o;s>=0;)m=s-r,l.addPage(),l.addImage(n,"PNG",0,m,i,r),s-=o;const p=`Customer_Obligation_Report_${y?.name?y.name.replace(/[^a-zA-Z0-9]/g,"_"):"Report"}_${(new Date).getTime()}.pdf`;l.save(p)}catch(e){alert("Error generating PDF. Please try again.")}},className:"download-obligations-btn",style:{backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"8px",padding:"12px 24px",fontSize:"16px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.2s ease",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},onMouseOver:e=>{e.target.style.backgroundColor="#15803d",e.target.style.transform="translateY(-1px)",e.target.style.boxShadow="0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"},onMouseOut:e=>{e.target.style.backgroundColor="#16a34a",e.target.style.transform="translateY(0)",e.target.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7,10 12,15 17,10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Download Complete Report PDF"]})]}),e.jsxs("div",{className:"p-4 mb-4 border rounded-lg bg-black border-gray-600",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-4 mb-6",children:[e.jsxs("div",{className:"form-group flex-1 min-w-[140px] max-w-[180px]",children:[e.jsx("label",{className:"block mb-2 text-lg font-bold text-white",children:"Salary"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 text-white bg-gray-700 border text-lg rounded-lg border-gray-600 focus:outline-none focus:border-sky-400 font-bold placeholder-gray-400 uppercase",value:Vt(v),onChange:w?e=>{const t=e.target.value.replace(/[^0-9.]/g,""),a=Vt(t);k(a),Et(),V(!0),ie(!0)}:void 0,onBlur:oa,disabled:!w,placeholder:"In Rupees",inputMode:"numeric"})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[140px] max-w-[180px]",children:[e.jsx("label",{className:"block mb-2 text-lg font-bold text-white",children:"Partner's Salary"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 text-lg text-white bg-gray-700 border rounded-lg border-gray-600 focus:outline-none focus:border-sky-400 font-bold placeholder-gray-400 uppercase",value:Vt(j),onChange:w?e=>{const t=e.target.value.replace(/[^0-9.]/g,""),a=Vt(t);N(a),Et()}:void 0,onBlur:oa,disabled:!w,placeholder:"In Rupees",inputMode:"numeric"})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[200px]",children:[e.jsx("label",{htmlFor:"yearlyBonus",className:"block mb-2 text-lg font-bold text-white",children:"Bonus"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",id:"yearlyBonus",className:"flex-1 px-3 py-2 text-lg text-white bg-gray-700 border rounded-lg border-gray-600 focus:outline-none focus:border-sky-400 font-bold placeholder-gray-400 uppercase",value:Vt(S),onChange:w?e=>{const t=e.target.value.replace(/[^0-9.]/g,""),a=Vt(t);C(a),Et(),t||O(null)}:void 0,onBlur:oa,disabled:!w,placeholder:"In Rupees",inputMode:"numeric"}),S&&Xt(S)>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-bold text-white whitespace-nowrap",children:"Divide By:"}),e.jsxs("select",{className:"px-2 py-2 text-white text-lg bg-gray-700 border rounded-lg form-select border-gray-600 focus:outline-none focus:border-sky-400 font-bold",value:$||"",onChange:e=>{return w&&(t=Number(e.target.value),void(Xt(S)>0&&(O($===t?null:t),Et())));var t},disabled:!w,children:[e.jsx("option",{value:"",className:"text-gray-400 font-bold",children:"Select"}),[{value:1,label:"1"},{value:3,label:"3"},{value:6,label:"6"},{value:12,label:"12"},{value:24,label:"24"},{value:48,label:"48"}].map(t=>e.jsxs("option",{value:t.value,className:"text-white font-bold bg-gray-700",children:[t.label," ",1===t.value?"Month":"Months"]},t.value))]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-4 mb-4",children:[e.jsxs("div",{className:"form-group flex-1 min-w-[140px]",children:[e.jsx("label",{className:"block mb-2 text-lg font-bold text-white",children:"Loan Amount Required"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 text-white text-lg bg-gray-700 border rounded-lg border-gray-600 focus:outline-none focus:border-sky-400 font-bold placeholder-gray-400 uppercase",value:Vt(A),onChange:e=>{if(!w)return;const t=e.target.value;T(t),Et(),ie(!0),V(!0)},onBlur:oa,disabled:!w,placeholder:"In Rupees",inputMode:"numeric"})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[250px] relative",children:[e.jsx("label",{className:"block mb-2 text-lg font-bold text-white",children:"Company Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:ze,type:"text",className:"w-full px-3 py-2 text-lg text-white bg-gray-700 border rounded-lg border-gray-600 focus:outline-none focus:border-sky-400 font-bold placeholder-gray-400 uppercase",placeholder:"Type company name...",value:L,disabled:!w,onChange:e=>{if(!w)return;const t=e.target.value.toUpperCase();Ie||(P(t),Et(),e.nativeEvent&&e.nativeEvent.inputType&&(function(e){if(e.trim().length>=1){Be&&clearTimeout(Be);const t=setTimeout(()=>{!async function(e){Ee(!0);try{const a=await p(e.trim());let n=[];if(Array.isArray(a)?n=a.map(e=>e.name||e.company_name||e):a&&"object"==typeof a&&(a.companies&&Array.isArray(a.companies)?n=a.companies.map(e=>e.name||e.company_name||e):a.data&&Array.isArray(a.data)&&(n=a.data.map(e=>e.name||e.company_name||e))),n.length<5){const a=e.trim().split(" ").filter(e=>e.length>0);if(a.length>1)try{const e=await p(a[0]);let t=[];Array.isArray(e)?t=e.map(e=>e.name||e.company_name||e):e&&"object"==typeof e&&(e.companies&&Array.isArray(e.companies)?t=e.companies.map(e=>e.name||e.company_name||e):e.data&&Array.isArray(e.data)&&(t=e.data.map(e=>e.name||e.company_name||e))),n=[...n,...t]}catch(t){}}n=[...new Set(n.filter(e=>"string"==typeof e))];const l=n.filter(t=>((e,t)=>{if(!e||!t)return!1;const a=t.toLowerCase().split(" ").map(e=>e.trim()).filter(e=>e.length>0);if(0===a.length)return!1;const n=e.toLowerCase();return a.every(e=>n.includes(e))})(t,e.trim())).map(t=>({name:t,score:Pt(t,e.trim())})).sort((e,t)=>t.score-e.score).map(e=>e.name);0===l.length&&e.trim()?Le([e.trim()]):Le(l)}catch(t){Le([e.trim()])}finally{Ee(!1)}}(e.trim())},300);Re(t)}else Le([])}(t),!Oe&&t.length>=1&&(Ae(!0),De(!1))),f&&f("company_name",t))},onKeyDown:e=>{"Enter"===e.key&&L.trim().length>=1?(e.preventDefault(),Te.length>0?da(Te[0]):da(L.trim())):"Escape"===e.key&&Ae(!1)},onFocus:()=>{L.length>=1&&(Ae(!0),De(!1))},onBlur:e=>{const t=e.target.value.trim();setTimeout(()=>{Ae(!1),t&&t.length>=1&&!Ie&&t!==L.trim()&&da(t)},200)},"data-dropdown-trigger":"true"}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{window.open("https://www.zaubacorp.com/","_blank","noopener,noreferrer")},className:"p-1.5 bg-sky-500 hover:bg-sky-600 text-white rounded-md transition-all duration-200 flex items-center justify-center",title:"Search on Zaubacorp",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),Pe&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-sky-400"}),e.jsx(i,{className:"h-4 w-4 flex-shrink-0 text-gray-400"})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{className:"form-group flex-1 min-w-[140px]",children:[e.jsx("label",{className:"block mb-2 text-lg font-extrabold text-white",children:"Decide Bank For Case"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 border border-gray-600 rounded-lg bg-gray-700 p-2 min-h-[42px]",children:[E.map((t,a)=>{const n=(t&&"object"==typeof t?t.name||t.label||t.value||String(t):String(t||""))||"Unknown",l=n.length>0?n.charAt(0).toUpperCase():"B";return e.jsxs("div",{className:"bg-blue-100 text-blue-800 py-1 px-3 rounded-md flex items-center",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#03B0F5] text-white flex items-center justify-center mr-2 text-xs flex-shrink-0",children:l}),e.jsx("span",{className:"text-lg font-extrabold uppercase",children:n}),e.jsx("button",{type:"button",className:"ml-2 h-10 w-10 text-xl text-blue-500 hover:text-blue-700 font-bold",onClick:()=>{return w&&void((e=t)?(B(t=>{const a=t.filter(t=>t!==e);return f&&f("company_type",a),a}),Et(),V(!0),ie(!0)):(B([]),f&&f("company_type",[]),Et(),V(!0),ie(!0)));var e},disabled:!w,children:"×"})]},`${n}-${a}`)}),e.jsx("button",{type:"button",className:"text-white text-lg font-medium hover:text-gray-300 ml-auto",onClick:()=>w&&I(!0),disabled:!w,children:"+ Add Bank"})]})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[140px]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("label",{className:"text-lg font-extrabold text-white",children:"Company Category"}),Wt&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-yellow-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-t-2 border-b-2 border-yellow-400"}),"Loading..."]}),!Wt&&Ut.length>0&&e.jsxs("span",{className:"text-sm text-green-400",children:[Ut.length," found"]}),!Wt&&L&&L.trim()&&0===Ut.length&&e.jsx("span",{className:"text-sm text-red-400",children:"No categories found"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 border border-gray-600 rounded-lg bg-gray-700 p-2 min-h-[42px]",children:[Array.isArray(D)&&D.length>0?D.map((t,a)=>{let n,l,i;if("string"==typeof t)n=t,l=t,i=String(t);else if("object"==typeof t&&null!==t){n=t.display||t.display_text||t.label||t.category_name||(t.company_name&&t.bank_name&&t.category_name?`${t.company_name} → ${t.bank_name} → ${t.category_name}`:t.company_name&&t.category_name?`${t.company_name} → ${t.category_name}`:"Unknown Category"),l=t.key||t.display_key||t.value||t.display||`category-${a}`;const e=t.category_name||t.display||t.display_text||t.label||"CA";i=String(e)}else n="Unknown Category",l=`unknown-${a}`,i="CA";return e.jsxs("div",{className:"bg-green-100 text-green-800 py-1 px-3 rounded-md flex items-center",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#10B981] text-white flex items-center justify-center mr-2 text-xs flex-shrink-0",children:(()=>{try{return String(i||"CA").split(" ").map(e=>e&&e.length>0?e[0]:"").filter(e=>""!==e.trim()).slice(0,2).join("").toUpperCase()||"CA"}catch(e){return"CA"}})()}),e.jsx("span",{className:"text-lg font-extrabold uppercase",children:n}),e.jsx("button",{type:"button",className:"ml-2 h-10 w-10 text-xl text-green-500 hover:text-green-700 font-bold",onClick:()=>{return w&&(e=t,void z(t=>{const a=t.filter(t=>{if("string"==typeof e){if("string"==typeof t)return t!==e;if("object"==typeof t)return t.key!==e&&t.display!==e}else if("object"==typeof e){if("string"==typeof t)return t!==e.key&&t!==e.display;if("object"==typeof t)return t.key!==e.key}return!0});return f&&f("company_category",a),a}));var e},disabled:!w,children:"×"})]},`${l}-${a}`)}):e.jsx("span",{className:"text-gray-400 italic",children:"No categories selected"}),e.jsx("button",{type:"button",className:"text-white text-lg font-medium hover:text-gray-300 ml-auto",disabled:!w,onClick:async()=>{if(w&&(q(!0),0===Ut.length)){Qt(!0);try{const e=await g();Yt(e)}catch(e){}finally{Qt(!1)}}},children:"+ Add Categories"})]})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-center gap-4",children:[e.jsx("div",{className:"text-3xl font-bold text-center text-green-400",children:"Customer Obligations"}),oe&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold "+("saving"===oe?"bg-blue-500/20 text-blue-400 border border-blue-500":"saved"===oe?"bg-green-500/20 text-green-400 border border-green-500":"error"===oe?"bg-red-500/20 text-red-400 border border-red-500":""),children:["saving"===oe&&e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Auto-saving..."})]}),"saved"===oe&&e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:"Auto-saved"})]}),"error"===oe&&e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),e.jsx("span",{children:"Auto-save failed"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 p-6 mb-4 bg-black/90 border-2 border-gray-600 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"form-group flex-1 min-w-[250px]",children:[e.jsx("label",{className:"block mb-2 text-lg font-bold text-green-400 uppercase tracking-wide",children:"TOTAL BT POS"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 font-bold text-2xl text-center text-black bg-green-400 border-2 border-green-500 rounded-lg",value:F,readOnly:!0})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[250px]",children:[e.jsx("label",{className:"block mb-2 text-lg font-bold text-yellow-400 uppercase tracking-wide",children:"TOTAL OBLIGATION"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 font-bold text-2xl text-center text-black bg-yellow-400 border-2 border-yellow-500 rounded-lg",value:Y,readOnly:!0})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block mb-2 text-lg font-bold text-blue-400 uppercase tracking-wide",children:"CIBIL Score"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 text-xl text-center text-black bg-blue-100 border-2 border-blue-400 rounded-lg focus:outline-none focus:border-blue-600 font-bold placeholder-black",value:Q,onChange:e=>{const t=e.target.value;J(t),f&&f("cibil_score",t)},placeholder:"Enter CIBIL Score",inputMode:"numeric"})]})]})]}),Oe&&e.jsxs("div",{className:"fixed inset-0 z-[9999]",style:{zIndex:9999},children:[e.jsx("div",{className:"absolute inset-0",onClick:()=>Ae(!1)}),e.jsx("div",{className:"absolute bg-gray-800 border border-gray-600 rounded-lg shadow-lg",style:{left:ze.current?ze.current.getBoundingClientRect().left:0,top:ze.current?ze.current.getBoundingClientRect().bottom+5:0,width:ze.current?ze.current.getBoundingClientRect().width:300,minWidth:"300px"},"data-dropdown-container":"true",children:e.jsxs("div",{className:"max-h-60 overflow-y-auto","data-dropdown-scroll":"true",children:[Te.length>0?Te.map((t,a)=>{const n=(t&&"object"==typeof t?t.name||t.label||t.company_name||String(t):String(t||""))||"Unknown Company",l=n.length>0?n.charAt(0).toUpperCase():"C";return e.jsx("div",{className:"px-4 py-3 text-lg text-white cursor-pointer hover:bg-gray-700 border-b border-gray-700 last:border-b-0 transition-colors",onClick:()=>w&&da(t),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center mr-3 text-sm font-bold",children:l}),e.jsx("span",{className:"font-medium",children:n})]})},`company-${a}`)}):L.length>=2&&!Pe?e.jsxs("div",{className:"px-4 py-3 text-lg text-gray-400 italic",children:['No companies match "',L,'"']}):L.length<2?e.jsx("div",{className:"px-4 py-3 text-lg text-gray-400 italic",children:"Type at least 2 characters to search..."}):null,L.length>=2&&!Te.includes(L)&&e.jsx("div",{className:"px-4 py-3 text-lg text-sky-400 cursor-pointer hover:bg-gray-700 border-t border-gray-600 font-medium transition-colors",onClick:()=>w&&da(L),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-sky-500 text-white flex items-center justify-center mr-3 text-sm font-bold",children:"+"}),e.jsxs("span",{children:['Add "',L,'"']})]})})]})})]}),e.jsxs("div",{className:"mb-6 bg-black rounded-lg border-2 border-gray-600 shadow-lg relative",children:[e.jsx("div",{className:"bg-gray-800 px-4 py-3 border-b-2 border-gray-600",children:e.jsx("h3",{className:"text-lg font-bold text-white",children:"Bank-wise Customer Obligations"})}),e.jsx("div",{className:"relative",style:{position:"relative",zIndex:1},children:e.jsx("div",{className:"overflow-x-auto",style:{overflowY:"visible"},children:e.jsxs("table",{className:"w-full border-collapse align-middle",style:{position:"relative"},children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black border-b-2 border-gray-600 align-middle",children:[e.jsx("th",{className:"px-2 py-2 text-sm font-bold text-white border-r-2 border-gray-600 text-center w-8",children:"#"}),e.jsx("th",{className:"px-2 py-2 text-sm font-bold text-white border-r-2 border-gray-600 text-center w-48",children:"PRODUCT"}),e.jsx("th",{className:"px-2 py-2 text-sm font-bold text-white border-r-2 border-gray-600 text-center w-72",children:"BANK NAME"}),e.jsx("th",{className:"px-2 py-2 text-sm font-bold text-white border-r-2 border-gray-600 text-center w-26",children:"TENURE"}),e.jsx("th",{className:"px-2 py-2 text-sm font-bold text-white border-r-2 border-gray-600 text-center w-16",children:"ROI %"}),e.jsx("th",{className:"px-2 py-2 text-sm font-bold text-white border-r-2 border-gray-600 text-center w-32",children:"TOTAL LOAN"}),e.jsx("th",{className:"px-2 py-2 text-sm font-bold text-white border-r-2 border-gray-600 text-center w-32",children:"OUTSTANDING"}),e.jsx("th",{className:"px-2 py-2 text-sm font-bold text-white border-r-2 border-gray-600 text-center w-28",children:"EMI"}),e.jsx("th",{className:"px-2 py-2 text-sm font-bold text-white border-r-2 border-gray-600 text-center w-24",children:"ACTIONS"}),e.jsx("th",{className:"px-2 py-2 text-sm font-bold text-white text-center w-8",children:"DEL"})]})}),e.jsx("tbody",{children:H.map((t,a)=>{return Lt(t.product),e.jsxs("tr",{className:"border-b-2 text-[12px] border-gray-600 align-middle "+(t.action,"bg-white border-white"),children:[e.jsx("td",{className:"px-1 py-1 text-center  text-white font-bold border-r-2 border-gray-600 bg-black",children:a+1}),e.jsx("td",{className:"px-2 py-2 border-r-2 border-gray-600 bg-black relative",children:e.jsx("div",{className:"relative",children:e.jsxs("div",{ref:e=>Mt.current[`product-${a}`]=e,className:`w-full px-2 py-2 text-sm font-bold rounded border-2 focus:outline-none focus:ring-1 focus:ring-blue-400 cursor-pointer flex items-center justify-between ${ra(t.action)} ${w?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>w&&function(e){if(Me&&"object"==typeof Me)if(Me&&Me[e]?.isOpen)ve(t=>({...t,[e]:{...t[e],isOpen:!1,searchQuery:t[e]?.searchQuery||""}}));else{ca();const t=sa(Mt.current[`product-${e}`]);zt(a=>({...a,[`product-${e}`]:t})),ve(t=>({...t,[e]:{...t[e],isOpen:!0,searchQuery:t[e]?.searchQuery||""}}))}}(a),"data-dropdown-trigger":"true",children:[e.jsx("span",{className:(t.product?"":"text-black")+" uppercase",children:t.product?Gt.find(e=>e.value===t.product)?.label||t.product:"Select Product"}),e.jsx(i,{className:"h-4 w-4 ml-2 flex-shrink-0"})]})})}),e.jsx("td",{className:"px-2 py-2 border-r-2 border-gray-600 bg-black relative",children:e.jsx("div",{className:"relative",children:e.jsxs("div",{ref:e=>Mt.current[`bank-${a}`]=e,className:`w-full px-2 py-2 text-sm font-bold rounded border-2 focus:outline-none focus:ring-1 focus:ring-blue-400 cursor-pointer flex items-center justify-between ${ra(t.action)} ${w?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>w&&function(e){if(ke&&"object"==typeof ke)if(ke&&ke[e]?.isOpen)je(t=>({...t,[e]:{...t[e],isOpen:!1,searchQuery:t[e]?.searchQuery||""}}));else{ca();const t=sa(Mt.current[`bank-${e}`]);zt(a=>({...a,[`bank-${e}`]:t})),je(t=>({...t,[e]:{...t[e],isOpen:!0,searchQuery:t[e]?.searchQuery||""}}))}}(a),"data-dropdown-trigger":"true",children:[e.jsxs("span",{className:(t.bankName?"":"text-black")+" uppercase",children:[t.bankName||"",(t.bankName&&E.includes(t.bankName),"")]}),e.jsx(i,{className:"h-4 w-4 ml-2 flex-shrink-0"})]})})}),e.jsx("td",{className:"px-1 py-1 border-r-2 border-gray-600 bg-black",children:Lt(t.product)?e.jsx("div",{className:"flex gap-1 justify-center",children:e.jsx("button",{type:"button",className:`px-2 py-1 text-sm font-bold rounded border-2 transition-colors ${4===t.selectedTenurePercentage||"4"===t.selectedTenurePercentage||4===parseInt(t.selectedTenurePercentage)?"bg-green-500 text-white border-green-600":"bg-white text-black border-gray-300 hover:bg-gray-100"} ${t.outstanding&&0!==Xt(t.outstanding)?"cursor-pointer":"opacity-50 cursor-not-allowed"}`,onClick:()=>{var e;w&&(e=a,G(t=>{const a=[...t],n=Xt(a[e].outstanding);if(n>0){if(4===a[e].selectedTenurePercentage)a[e]={...a[e],tenure:"",roi:"",emi:"",selectedTenurePercentage:null,selectedRoiPercentage:null};else{a[e]={...a[e],tenure:"48 Months",roi:"4%",selectedTenurePercentage:4,selectedRoiPercentage:null};const t=.04*n;a[e].emi=Vt(t.toString())}return f&&f("obligations",a),Et(),a}return t}))},disabled:!w||!t.outstanding||0===Xt(t.outstanding),children:"4%"})}):e.jsx("input",{type:"text",className:`w-full px-2 py-2 text-sm text-center rounded border-2 focus:outline-none focus:ring-1 focus:ring-blue-400 ${ra(t.action)} placeholder-black`,placeholder:"months",maxLength:"12",value:t.tenure,disabled:!w,onFocus:e=>{const t=e.target,a=t.value.replace(/[^0-9]/g,"");a&&setTimeout(()=>{t.setSelectionRange(a.length,a.length)},0)},onChange:e=>{if(!w)return;const t=e.target,n=t.selectionStart,l=e.target.value.replace(/[^0-9]/g,""),i=l?Zt(l):"";la(a,"tenure",i),setTimeout(()=>{if(t&&l){const e=Math.min(n,l.length);t.setSelectionRange(e,e)}},0)},onBlur:oa})}),e.jsx("td",{className:"px-1 py-1 border-r-2 border-gray-600 bg-black",children:Lt(t.product)?e.jsx("div",{className:"flex gap-1 justify-center",children:e.jsx("button",{type:"button",className:`px-2 py-1 text-sm font-bold rounded border-2 transition-colors ${(()=>{const e=t.selectedRoiPercentage;return 5===e||"5"===e||5===parseInt(e)?"bg-green-500 text-white border-green-600":"bg-white text-black border-gray-300 hover:bg-gray-100"})()} ${t.outstanding&&0!==Xt(t.outstanding)?"cursor-pointer":"opacity-50 cursor-not-allowed"}`,onClick:()=>{var e;w&&(e=a,G(t=>{const a=[...t],n=Xt(a[e].outstanding);if(n>0){if(5===a[e].selectedRoiPercentage)a[e]={...a[e],tenure:"",roi:"",emi:"",selectedTenurePercentage:null,selectedRoiPercentage:null};else{a[e]={...a[e],tenure:"60 Months",roi:"5%",selectedTenurePercentage:null,selectedRoiPercentage:5};const t=.05*n;a[e].emi=Vt(t.toString())}return f&&f("obligations",a),Et(),a}return t}))},disabled:!w||!t.outstanding||0===Xt(t.outstanding),children:"5%"})}):e.jsx("input",{type:"text",className:`w-full px-2 py-2 text-sm text-center rounded border-2 focus:outline-none focus:ring-1 focus:ring-blue-400 ${ra(t.action)} placeholder-black`,placeholder:"%",maxLength:"8",value:t.roi,disabled:!w,onFocus:e=>{const t=e.target,a=t.value.replace(/[^0-9.]/g,"");a&&setTimeout(()=>{t.setSelectionRange(a.length,a.length)},0)},onChange:e=>{if(!w)return;const t=e.target,n=t.selectionStart,l=e.target.value.replace(/[^0-9.]/g,""),i=l?ta(l):"";la(a,"roi",i),setTimeout(()=>{if(t&&l){const e=Math.min(n,l.length);t.setSelectionRange(e,e)}},0)},onBlur:oa})}),e.jsx("td",{className:"px-1 py-1 border-r-2 border-gray-600 bg-black",children:e.jsx("input",{type:"text",className:`w-full px-1 py-1 text-sm text-center rounded border-2 focus:outline-none focus:ring-1 focus:ring-blue-400 ${ra(t.action)} placeholder-black`,placeholder:"Total loan",value:t.totalLoan,disabled:!w,onChange:e=>{if(!w)return;const t=e.target.value.replace(/[^0-9.]/g,"");la(a,"totalLoan",Vt(t))},onBlur:oa,inputMode:"numeric"})}),e.jsx("td",{className:"px-1 py-1 border-r-2 border-gray-600 bg-black",children:e.jsx("input",{type:"text",className:`w-full px-1 py-1 text-sm text-center rounded border-2 focus:outline-none focus:ring-1 focus:ring-blue-400 ${ra(t.action)} placeholder-black`,placeholder:"Outstanding",value:t.outstanding,disabled:!w,onChange:e=>{if(!w)return;const t=e.target.value.replace(/[^0-9.]/g,"");la(a,"outstanding",Vt(t))},onBlur:oa,inputMode:"numeric"})}),e.jsx("td",{className:"px-1 py-1 border-r-2 border-gray-600 bg-black",children:e.jsx("input",{type:"text",className:`w-full px-1 py-1 text-sm text-center rounded border-2 focus:outline-none focus:ring-1 focus:ring-blue-400 ${ra(t.action)} placeholder-black`,placeholder:"EMI",value:t.emi,disabled:!w,onChange:e=>{if(!w||Lt(t.product))return;const n=e.target.value.replace(/[^0-9.]/g,"");la(a,"emi",Vt(n))},onBlur:oa,readOnly:Lt(t.product),inputMode:"numeric"})}),e.jsxs("td",{className:"px-1 py-1 border-r-2 border-gray-600 bg-black",children:[null,e.jsxs("select",{className:"w-full px-1 py-1 text-sm text-center rounded border-2 focus:outline-none focus:ring-1 focus:ring-blue-400 font-bold",value:t.action||"",disabled:!w,onChange:(n=t.id,e=>{if(!w)return;const t=e.target.value;Se(!0),G(e=>{const a=e.map(e=>String(e.id)===String(n)?{...e,action:t}:e);return ie(!0),V(!0),f&&f("obligations",a),setTimeout(()=>{Se(!1),G(e=>{const t=(a=e,[...a].sort((e,t)=>{const a={BT:1,Obligate:2,"CO-PAY":3,"NO-PAY":4,Closed:5};return(a[e.action]||6)-(a[t.action]||6)}));var a;return f&&f("obligations",t),t})},100),a})}),style:{backgroundColor:"BT"===t.action?"#4ade80":"Obligate"===t.action?"#facc15":"CO-PAY"===t.action?"#fb923c":"NO-PAY"===t.action?"#60a5fa":"Closed"===t.action?"#f87171":"#ffffff",color:"#000000",fontWeight:"bold"},children:[e.jsx("option",{value:"",style:{backgroundColor:"#ffffff",color:"#666666"},children:"Select Action"}),(()=>{const n=t.action;return Kt.map(t=>e.jsxs("option",{value:t.value,style:{backgroundColor:"BT"===t.value?"#4ade80":"Obligate"===t.value?"#facc15":"CO-PAY"===t.value?"#fb923c":"NO-PAY"===t.value?"#60a5fa":"Closed"===t.value?"#f87171":"#ffffff",color:"#000000",fontWeight:"bold"},children:[t.label," ",t.value===n?"✓":""]},`${a}-${t.value}`))})()]},`action-select-${t.id}-${a}-${t.action}`)]}),e.jsx("td",{className:"px-1 py-1 text-center bg-black",children:e.jsx("button",{className:(H.length<=1?"text-gray-400 cursor-not-allowed":"text-red-500 hover:text-red-700 hover:bg-red-100")+" p-1 rounded transition-colors",onClick:()=>(e=>{if(H.length>1){Tt(!0);const t=H.filter((t,a)=>a!==e);G(t);const a={},n={};we&&"object"==typeof we&&Object.keys(we).forEach(t=>{const n=parseInt(t);n<e?a[n]=we[t]:n>e&&(a[n-1]=we[t])}),ke&&"object"==typeof ke&&Object.keys(ke).forEach(t=>{const a=parseInt(t);a<e?n[a]=ke[t]:a>e&&(n[a-1]=ke[t])}),ve(a),je(n),V(!0),f&&f("obligations",t),(async()=>{try{if(It(!0),!y?._id)return void It(!1);const e=Bt(t),a=(await ua(e,!0),m()),n=localStorage.getItem("token"),l=y&&(y.original_lead_id||y.login_created_at)?`${s}/lead-login/login-leads/${y._id}?user_id=${a}`:`${s}/leads/${y._id}?user_id=${a}`,i=await fetch(l,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});i.ok&&(await i.json(),V(!1)),It(!1)}catch(e){It(!1)}})()}else{const e=[{product:"",bankName:"",tenure:"",roi:"",totalLoan:"",outstanding:"",emi:"",action:"Obligate",selectedPercentage:null}];G(e),ve({0:{isOpen:!1,searchQuery:""}}),je({0:{isOpen:!1,searchQuery:""}}),V(!0),f&&f("obligations",e)}})(a),disabled:H.length<=1,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},`${t.id}-${a}-action-${t.action}`);var n})},`obligations-tbody-${me}-${ue}-${ye}-${H.map(e=>`${e.id}-${e.selectedRoiPercentage}-${e.selectedTenurePercentage}`).join(",")}`)]},`obligations-table-${me}-${ue}-${ye}-${H.length}`)})}),e.jsx("div",{className:"flex justify-center p-4 bg-black border-t-2 border-gray-600",children:e.jsx("button",{className:"px-6 py-3 font-bold text-lg text-white bg-blue-600 border-2 border-blue-700 rounded-lg hover:bg-blue-700 hover:border-blue-800 transition-all duration-200",onClick:()=>{const e=H.length,t=[...H,{id:Date.now()+Math.random(),product:"",bankName:"",tenure:"",roi:"",totalLoan:"",outstanding:"",emi:"",action:"Obligate",selectedPercentage:null,selectedTenurePercentage:null,selectedRoiPercentage:null}];var a;G(t),a=e,ve(e=>({...e,[a]:{isOpen:!1,searchQuery:""}})),je(e=>({...e,[a]:{isOpen:!1,searchQuery:""}})),f&&f("obligations",t)},type:"button",children:"ADD NEW ROW"})})]}),e.jsxs("div",{className:"p-4 mt-6 mb-4 border rounded-lg border-gray-600 bg-black",children:[e.jsx("div",{className:"mb-3 text-2xl font-bold text-green-400",children:"Check Eligibility"}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("div",{className:"form-group flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block mb-1 text-base font-bold text-white",children:"Total Income"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1 text-lg font-bold text-white bg-black border rounded-lg form-control border-gray-600",value:Ye.totalIncome,readOnly:!0})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[320px]",children:[e.jsx("label",{className:"block mb-1 text-base font-bold text-white",children:"Company Category"}),e.jsxs("select",{className:"w-full px-2 py-1 text-lg text-white bg-gray-700 border rounded-lg form-select border-gray-600 font-bold",value:et,onChange:w?e=>{const t=e.target.value;tt(t),ie(!0),V(!0)}:void 0,disabled:!w,children:[e.jsx("option",{value:"",className:"text-gray-400 font-bold",children:"Select Category"}),[{value:"category-a",label:"Category A"},{value:"category-b",label:"Category B"},{value:"category-c",label:"Category C"},{value:"category-d",label:"Category D"},{value:"unlisted-company",label:"Unlisted Company"}].map(t=>e.jsx("option",{value:t.value||t.id,className:"text-white font-bold bg-gray-700",children:t.label||t.display_text||t.category_name},t.value||t.id))]})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[120px] max-w-[120px]",children:[e.jsx("label",{className:"block mb-1 text-base font-bold text-white",children:"FOIR %"}),"custom"===at?e.jsx("input",{type:"text",className:"w-full px-2 py-1 text-lg text-white bg-gray-700 border rounded-lg form-control border-gray-600 font-bold [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none placeholder-gray-400",value:lt,placeholder:"Enter %",disabled:!w,onFocus:e=>{const t=e.target,a=t.value.replace(/[^0-9.]/g,"");a&&setTimeout(()=>{t.setSelectionRange(a.length,a.length)},0)},onChange:e=>{if(!w)return;const t=e.target,a=t.selectionStart,n=e.target.value.replace(/[^0-9.]/g,""),l=n?ta(n):"";it(l),ie(!0),V(!0),n||nt(60),setTimeout(()=>{if(t&&n){const e=Math.min(a,n.length);t.setSelectionRange(e,e)}},0)}}):e.jsxs("select",{className:"w-full px-2 py-1 text-lg text-white bg-gray-700 border rounded-lg form-select border-gray-600 font-bold",value:at,onChange:w?e=>{const t=e.target.value;nt(t),ie(!0),V(!0),"custom"===t&&it("")}:void 0,disabled:!w,children:[e.jsx("option",{value:45,className:"text-white font-bold bg-gray-700",children:"45%"}),e.jsx("option",{value:50,className:"text-white font-bold bg-gray-700",children:"50%"}),e.jsx("option",{value:55,className:"text-white font-bold bg-gray-700",children:"55%"}),e.jsx("option",{value:60,className:"text-white font-bold bg-gray-700",children:"60%"}),e.jsx("option",{value:65,className:"text-white font-bold bg-gray-700",children:"65%"}),e.jsx("option",{value:70,className:"text-white font-bold bg-gray-700",children:"70%"}),e.jsx("option",{value:75,className:"text-white font-bold bg-gray-700",children:"75%"}),e.jsx("option",{value:80,className:"text-white font-bold bg-gray-700",children:"80%"}),e.jsx("option",{value:"custom",className:"text-white font-bold bg-gray-700",children:"Custom"})]})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[160px]",children:[e.jsx("label",{className:"block mb-1 text-base font-bold text-white",children:"FOIR Amount"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1 text-lg font-bold text-white bg-black border rounded-lg form-control border-gray-600",value:Ye.foirAmount,readOnly:!0})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[180px] max-w-[180px]",children:[e.jsx("label",{className:"block mb-1 text-base font-bold text-white",children:"Total Obligation"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1 text-lg font-bold text-black bg-yellow-400 border border-yellow-600 rounded-lg form-control",value:Ye.totalObligations,readOnly:!0})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("div",{className:"form-group flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block mb-1 text-base font-bold text-white",children:"Monthly EMI Can Pay"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1 text-lg font-bold text-white bg-black border rounded-lg form-control border-gray-600",value:Vt(ot.toString()),readOnly:!0})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block mb-1 text-base font-bold text-white",children:"TENURE (Months)"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1 text-lg text-white bg-gray-700 border rounded-lg form-control border-gray-600 font-bold [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none placeholder-gray-400",value:st,placeholder:"Months",disabled:!w,onFocus:e=>{const t=e.target,a=t.value.replace(/[^0-9]/g,"");a&&setTimeout(()=>{t.setSelectionRange(a.length,a.length)},0)},onChange:w?e=>{const t=e.target,a=t.selectionStart,n=e.target.value.replace(/[^0-9]/g,""),l=n?Zt(n):"",i=Number(n);if(ct(l),ie(!0),V(!0),i){const e=Math.floor(i/12),t=i%12;mt(0===t?`${e} Years`:1===t?`${e} Years 1 Month`:`${e} Years ${t} Months`)}else mt("");setTimeout(()=>{if(t&&n){const e=Math.min(a,n.length);t.setSelectionRange(e,e)}},0)}:void 0})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block mb-1 text-base font-bold text-white",children:"TENURE (Years)"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1 text-lg text-white bg-black border rounded-lg form-control border-gray-600 font-bold [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none placeholder-gray-400",value:dt,placeholder:"Years",disabled:!0,onFocus:e=>{const t=e.target,a=t.value.replace(/[^0-9.]/g,"");a&&setTimeout(()=>{t.setSelectionRange(a.length,a.length)},0)},onChange:e=>{const t=e.target,a=t.selectionStart,n=e.target.value.replace(/[^0-9]/g,""),l=Number(n);ie(!0),V(!0),n?(mt(`${n} Years`),ct(Zt((12*l).toString()))):(mt(""),ct("")),setTimeout(()=>{if(t&&n){const e=Math.min(a,n.length);t.setSelectionRange(e,e)}},0)}})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[140px]",children:[e.jsx("label",{className:"block mb-1 text-base font-bold text-white",children:"ROI"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1 text-lg text-white bg-gray-700 border rounded-lg form-control border-gray-600 font-bold [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none placeholder-gray-400",value:pt,placeholder:"%",disabled:!w,onFocus:e=>{const t=e.target,a=t.value.replace(/[^0-9.]/g,"");a&&setTimeout(()=>{t.setSelectionRange(a.length,a.length)},0)},onChange:w?e=>{const t=e.target,a=t.selectionStart,n=e.target.value.replace(/[^0-9.]/g,""),l=n?ta(n):"";ut(l),ie(!0),V(!0),setTimeout(()=>{if(t&&n){const e=Math.min(a,n.length);t.setSelectionRange(e,e)}},0)}:void 0})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[180px] max-w-[180px]",children:[e.jsx("label",{className:"block mb-1 text-base font-bold text-white",children:"TOTAL BT POS"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1 text-lg font-bold text-black bg-green-400 border border-green-600 rounded-lg form-control",value:Ye.totalBtPos,readOnly:!0})]})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-4 mb-2",children:[e.jsxs("div",{className:"form-group flex-1 min-w-[280px]",children:[e.jsx("label",{className:"block mb-1 text-base font-bold text-white",children:"FOIR Eligibility"}),e.jsx("input",{type:"text",className:"w-full px-4 py-4 font-bold text-white bg-black border rounded-lg form-control border-gray-600 text-2xl",value:Ye.finalEligibility,readOnly:!0})]}),e.jsxs("div",{className:"form-group flex-1 min-w-[280px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-base font-bold text-white",children:"Multiplier Eligibility"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-white",children:"Multiplier:"}),e.jsx("input",{type:"text",className:"w-16 px-2 py-1 text-black bg-yellow-400 border rounded-lg form-control border-yellow-600 font-bold [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none placeholder-black text-sm",value:gt,onChange:w?e=>{const t=e.target.value;yt(t),ie(!0),V(!0)}:void 0,disabled:!w,placeholder:"0",inputMode:"numeric"})]})]}),e.jsx("input",{type:"text",className:"w-full px-4 py-4 font-bold text-white bg-black border rounded-lg form-control border-gray-600 text-2xl",value:Ye.multiplierEligibility,readOnly:!0})]})]}),e.jsx("div",{className:"mt-6",children:(()=>{try{const t=Xt(Ye?.finalEligibility)||0,a=Xt(Ye?.totalBtPos)||0;if(!((v&&Xt(v)>0||j&&Xt(j)>0)&&""!==at&&null!=at&&pt&&aa(pt)>0&&st&&ea(st)>0&&a>0))return null;if(t>=a)return e.jsxs("div",{className:"p-6 rounded-lg text-black text-center",style:{backgroundColor:"#00FF00"},children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("svg",{className:"w-8 h-8 mr-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("h2",{className:"text-3xl font-extrabold",children:"Congratulations!"})]}),e.jsx("p",{className:"text-2xl font-bold",children:"Balance Transfer is Eligible"})]});{const n=Math.max(0,a-t);return e.jsxs("div",{className:"p-6 rounded-lg text-white text-center",style:{backgroundColor:"#FF0000"},children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("svg",{className:"w-8 h-8 mr-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("h2",{className:"text-3xl font-extrabold",children:"Balance Transfer Not Possible"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:["There is a shortfall of ₹",Vt(n.toString())]})]})}}catch(t){return null}})()})]})]})}),(()=>{try{if(!Me||"object"!=typeof Me)return null;const t=Object.keys(Me||{});return 0===t.length?null:t.map(t=>{if(!Me||!Me[t]||"object"!=typeof Me[t])return null;const a=Me[t];return a&&a.isOpen?e.jsxs("div",{className:"fixed z-[9999] bg-white border-2 border-gray-300 rounded-lg shadow-2xl overflow-hidden","data-dropdown-container":"true",style:{left:`${Dt&&Dt[`product-${t}`]?.left||0}px`,top:`${Dt&&Dt[`product-${t}`]?.top||0}px`,width:`${Dt&&Dt[`product-${t}`]?.width||300}px`,maxHeight:"250px"},children:[e.jsx("div",{className:"p-3 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 text-sm text-black border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Search products...",value:Me&&Me[t]?.searchQuery||"",onChange:e=>{return w&&(a=parseInt(t),n=e.target.value,void(we&&"object"==typeof we&&ve(e=>({...e,[a]:{...e[a],searchQuery:n}}))));var a,n},disabled:!w,onClick:e=>e.stopPropagation(),"data-search-input":"product",autoFocus:!0})]})}),e.jsxs("div",{className:"max-h-48 overflow-y-auto bg-white","data-dropdown-scroll":"true",children:[ma(parseInt(t)).map((a,n)=>e.jsx("div",{className:"px-4 py-3 text-sm text-black cursor-pointer hover:bg-blue-50 font-medium border-b border-gray-100 last:border-b-0 transition-colors",onClick:e=>{e.stopPropagation(),function(e,t){la(e,"product",t.value),ve(t=>({...t,[e]:{isOpen:!1,searchQuery:""}})),V(!0)}(parseInt(t),a)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:a.label}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:["#",n+1]})]})},a.value)),0===ma(parseInt(t)).length&&e.jsxs("div",{className:"px-4 py-6 text-sm text-gray-500 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-1",children:"🔍"}),"No products found"]})]})]},`product-dropdown-${t}`):null})}catch(t){return null}})(),(()=>{try{if(!qe||"object"!=typeof qe)return null;const t=Object.keys(qe||{});return 0===t.length?null:t.map(t=>{if(!qe||!qe[t]||"object"!=typeof qe[t])return null;const a=qe[t];return a&&a.isOpen?e.jsxs("div",{className:"fixed z-[9999] bg-white border-2 border-gray-300 rounded-lg shadow-2xl overflow-hidden","data-dropdown-container":"true",style:{left:`${Dt&&Dt[`bank-${t}`]?.left||0}px`,top:`${Dt&&Dt[`bank-${t}`]?.top||0}px`,width:`${Dt&&Dt[`bank-${t}`]?.width||300}px`,maxHeight:"250px"},children:[e.jsx("div",{className:"p-3 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 text-sm text-black border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Search banks...",value:qe&&qe[t]?.searchQuery||"",onChange:e=>{return w&&(a=parseInt(t),n=e.target.value,void(ke&&"object"==typeof ke&&je(e=>({...e,[a]:{...e[a],searchQuery:n}}))));var a,n},disabled:!w,onClick:e=>e.stopPropagation(),"data-search-input":"bank",autoFocus:!0})]})}),e.jsxs("div",{className:"max-h-48 overflow-y-auto bg-white","data-dropdown-scroll":"true",children:[pa(parseInt(t)).map((a,n)=>e.jsx("div",{className:"px-4 py-3 text-sm text-black cursor-pointer hover:bg-blue-50 font-medium border-b border-gray-100 last:border-b-0 transition-colors",onClick:e=>{e.stopPropagation(),function(e,t){const a=t.includes("")?t.replace(" ",""):t;la(e,"bankName",a),je(t=>({...t,[e]:{isOpen:!1,searchQuery:""}})),V(!0)}(parseInt(t),a)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:a}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:["#",n+1]})]})},`${a}-${n}`)),0===pa(parseInt(t)).length&&e.jsxs("div",{className:"px-4 py-6 text-sm text-gray-500 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-1",children:"🔍"}),"No banks found"]})]})]},`bank-dropdown-${t}`):null})}catch(t){return null}})(),R&&e.jsx(b,{onClose:()=>I(!1),onSelect:(e,t=!1)=>{var a;t?(B(t=>{const a=t.filter(t=>t!==e);return f&&f("company_type",a),a}),Et(),V(!0),ie(!0)):(a=e,E.includes(a)||(B(e=>{const t=[...e,a];return f&&f("company_type",t),t}),Et(),V(!0),ie(!0),_e(e=>e.includes(a)?e:[...e,a])))},multiSelect:!0,companyTypes:Jt,selectedInitial:E}),M&&e.jsx(x,{className:"text-lg",initialCompanyName:L,onClose:()=>q(!1),onSelect:(e,t=!1)=>{z(t?t=>{const a=e=>"string"==typeof e?e:e.company_name&&e.bank_name&&e.category_name?`${e.company_name}_${e.bank_name}_${e.category_name}`:e.company_name&&e.category_name&&!e.bank_name?`${e.company_name}_${e.category_name}`:e.display_key||e.value||e.display_text||e.label||e.category_name||JSON.stringify(e),n=a(e);return t.filter(e=>a(e)!==n)}:t=>{const a=e=>"string"==typeof e?e:e.company_name&&e.bank_name&&e.category_name?`${e.company_name}_${e.bank_name}_${e.category_name}`:e.company_name&&e.category_name&&!e.bank_name?`${e.company_name}_${e.category_name}`:e.display_key||e.value||e.display_text||e.label||e.category_name||JSON.stringify(e),n=a(e);return t.some(e=>a(e)===n)?t:[...t,e]})},onSave:()=>{q(!1)},multiSelect:!0,companyCategories:Ut.length>0?Ut:[{value:"category-a",label:"Category A"},{value:"category-b",label:"Category B"},{value:"category-c",label:"Category C"}],selectedInitial:D,onAddCategory:e=>{if(z(e||[]),f){const t=(e||[]).map(e=>({company_name:e.company_name||L||"",bank_name:e.bank_name||"",category_name:e.category_name||e.key||e.display||"",display_text:e.display_text||e.display||e.label||"",...e}));f("company_category",t)}V(!0)}}),X&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-lg p-6 m-4 max-w-md w-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100 mb-4",children:e.jsx("svg",{className:"h-6 w-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.268 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Unsaved Changes"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"You have unsaved changes in the obligation section. Do you want to save your changes before leaving?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Z(!1),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium",children:"Stay Here"}),e.jsx("button",{onClick:()=>{Z(!1),V(!1),window.location.reload()},className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium",children:"Continue Without Saving"})]})]})})})]},y?.file_sent_to_login?`obligation-stable-${y._id}`:`obligation-component-${xe}-${ue}-${ye}`)}function b({onClose:t,onSelect:n,onSave:l,companyTypes:i,multiSelect:o=!0,selectedInitial:r=[]}){const[s,c]=a.useState(""),[d,m]=a.useState([]),[p,g]=a.useState([]),[y,b]=a.useState(!0),[x,f]=a.useState(r||[]),[h,_]=a.useState(["AXIS BANK","HDFC BANK","ICICI BANK","SBI","YES BANK","KOTAK BANK","IDFC FIRST BANK","BAJAJ FINANCE"]);return a.useEffect(()=>{(async()=>{b(!0);try{const e=await u();if(e&&e.length>0){const t=[...e.map(e=>({value:"string"==typeof e?e:e.name||e.label||String(e),label:"string"==typeof e?e:e.name||e.label||String(e)}))],a=[];h.forEach(e=>{const n=t.find(t=>t.label.toUpperCase().includes(e)||e.includes(t.label.toUpperCase()));n&&a.push(n)}),t.forEach(e=>{a.some(t=>t.value===e.value)||a.push(e)}),g(a),m(a)}else m(i)}catch(e){m(i)}finally{b(!1)}})()},[i,h]),a.useEffect(()=>{if(""===s.trim())m(p.length>0?p:i);else{const e=p.length>0?p:i;m(e.filter(e=>e.label.toLowerCase().includes(s.toLowerCase())))}},[s,p,i]),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-transparent",children:e.jsxs("div",{className:"bg-transparent backdrop-blur-sm p-6 rounded-2xl shadow-2xl w-[95%] max-w-2xl mx-auto relative",children:[e.jsxs("div",{className:"flex items-center mb-4 bg-white bg-opacity-90 p-3 rounded-t-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[#03B0F5] text-white text-lg flex items-center justify-center mr-3",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-4m-5 0H3m2 0h3M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 8h1m-1-4h1m4 4h1m-1-4h1"})})}),e.jsx("h3",{className:"font-bold text-lg text-black",children:o?"Select Multiple Banks":"Select Bank"}),o&&e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"(Click multiple items to select)"})]}),e.jsxs("div",{className:"mb-4 bg-white bg-opacity-90 p-3 rounded-md",children:[e.jsxs("label",{className:"block font-bold text-gray-700 mb-2 text-lg",children:["Search Banks ",o&&"(Select Multiple)"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",className:"w-full pl-10 pr-3 py-2 border border-cyan-400 rounded text-black font-bold text-lg",value:s,onChange:e=>c(e.target.value),placeholder:"Search or enter bank name"}),s&&e.jsx("button",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-lg text-gray-400 hover:text-gray-600",onClick:()=>c(""),type:"button",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto mb-4 border rounded-lg bg-white bg-opacity-90",children:y?e.jsxs("div",{className:"p-5 flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 text-lg border-t-2 border-b-2 border-cyan-500"}),e.jsx("span",{className:"ml-3 text-gray-600 text-lg",children:"Loading banks..."})]}):d.length>0?d.map(t=>{const a="string"==typeof t.label?t.label:String(t.label||t.value||""),l=x.some(e=>e===a||"object"==typeof e&&e?.label===a);return e.jsxs("div",{className:"p-3 border-b last:border-b-0 cursor-pointer text-lg text-black transition flex items-center "+(l?"bg-blue-100":"hover:bg-gray-100"),onClick:()=>(e=>{const t="string"==typeof e.label?e.label:String(e.label||e.value||"");x.includes(t)?(f(e=>e.filter(e=>e!==t)),"function"==typeof n&&n(t,!0)):(f(e=>[...e,t]),"function"==typeof n&&n(t,!1))})(t),children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${l?"bg-cyan-600":"bg-[#03B0F5]"} text-white flex items-center justify-center mr-3 flex-shrink-0`,children:"string"==typeof a?a.split(" ").map(e=>e[0]||"").slice(0,2).join("").toUpperCase():"BK"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"font-medium text-lg",children:a})}),l&&e.jsx("div",{className:"ml-2 text-cyan-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]},t.value||a)}):""!==s.trim()&&e.jsx("div",{className:"p-3 text-gray-500 text-center text-lg",children:"No matching banks found."})}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4 bg-white bg-opacity-90 p-3 rounded-b-xl",children:[s.trim()&&e.jsx("button",{className:"px-6 py-3 bg-cyan-600 text-white rounded-xl shadow text-lg hover:bg-cyan-700 transition",onClick:()=>{s.trim()&&(o?s.trim()&&!x.includes(s.trim())&&(n(s.trim(),!1),f(e=>[...e,s.trim()])):(n(s.trim(),!1),t()),c(""))},children:"Add Bank"}),o&&e.jsx("button",{className:"px-6 py-3 bg-blue-600 text-white rounded-xl shadow text-lg hover:bg-blue-700 transition",onClick:()=>{t()},children:"Done"}),e.jsx("button",{className:"px-6 py-3 bg-gray-400 text-white text-lg rounded-xl shadow hover:bg-gray-500 transition",onClick:t,children:"Cancel"})]}),e.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-red-500 text-2xl font-bold",onClick:t,children:"×"})]})})}function x({initialCompanyName:t="",onClose:n,onSelect:l,onSave:i,onAddCategory:o,companyCategories:r,multiSelect:c=!0,selectedInitial:d=[]}){const[p,u]=a.useState(t||""),[g,y]=a.useState([]),[b,x]=a.useState(!1),[f,h]=a.useState(d||[]),[_,w]=a.useState(null),[v,k]=a.useState([]),[j,N]=a.useState(!1),[S,C]=a.useState("");a.useEffect(()=>{d&&Array.isArray(d)&&d.length>0?h(d):h([])},[d]),a.useEffect(()=>{t&&t.trim().length>=2&&setTimeout(()=>{$()},100)},[t]),a.useEffect(()=>{if(_&&clearTimeout(_),""!==p.trim()&&p.trim().length>=2){const e=setTimeout(()=>{$()},500);return w(e),()=>{e&&clearTimeout(e)}}k([]),y([]),N(!1),C("")},[p]);const $=async()=>{const e=p.trim();if(!e||e.length<2)C("Please enter at least 2 characters to search");else{x(!0),C(""),N(!0);try{const t=m();if(!t)throw new Error("No user ID found. Please log in again.");const a={company_name:e,similarity_threshold:.6},n=await fetch(`${s}/settings/search-companies?user_id=${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok)throw 422===n.status?new Error("Invalid search query. Please check your input."):404===n.status?new Error("No companies found matching your search."):new Error(`Search failed with status ${n.status}`);const l=await n.json();if(Array.isArray(l)&&l.length>0){k(l);const e=l.map((e,t)=>{const a=e.company_name||"Unknown Company",n=e.categories||[],l=e.bank_names||[],i=e.similarity_percentage||0;return n.map((e,o)=>({id:`${a}-${e}-${l[0]||"Unknown"}-${t}-${o}`,company_name:a,category_name:e,bank_name:l[0]||"No Bank Info",bank_names:l,categories:n,similarity_percentage:i,display_text:`${a} → ${l[0]||"No Bank"} → ${e}`,display_key:`${a}-${l[0]||"Unknown"}-${e}`,label:`${a} → ${l[0]||"No Bank"} → ${e}`,value:`${a}-${l[0]||"Unknown"}-${e}`}))}).flat();y(e)}else k([]),y([]),C(`No companies found matching "${e}". Try a different search term.`)}catch(t){k([]),y([]),C(t.message||"Failed to search companies. Please try again.")}finally{x(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-transparent","data-category-popup-backdrop":"true",onClick:e=>{e.target===e.currentTarget&&n()},children:e.jsxs("div",{className:"bg-transparent backdrop-blur-sm p-6 rounded-2xl shadow-2xl w-[95%] max-w-2xl mx-auto relative","data-category-popup-container":"true",onClick:e=>{e.stopPropagation()},children:[e.jsxs("div",{className:"flex items-center mb-4 bg-white bg-opacity-90 p-3 rounded-t-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[#10B981] text-white flex items-center justify-center mr-3",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),e.jsx("h3",{className:"font-bold text-lg text-black",children:c?"Select Multiple Categories":"Select Category"}),c&&e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"(Select multiple, options stay open)"})]}),e.jsxs("div",{className:"mb-4 bg-white bg-opacity-90 p-3 rounded-md",children:[e.jsxs("label",{className:"block font-bold text-gray-700 mb-2 text-lg",children:["Search Categories ",c&&"(Options stay open for multiple selection)"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",className:"w-full pl-10 pr-3 py-2 border border-green-400 rounded text-black font-bold text-lg",value:p,onChange:e=>{u(e.target.value)},placeholder:"Search by company name",onKeyPress:e=>{"Enter"===e.key&&$()}}),p&&e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:()=>u(""),type:"button",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})})]})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto mb-4 border rounded-lg bg-white bg-opacity-90","data-category-list":"true",onClick:e=>{e.stopPropagation()},children:b?e.jsxs("div",{className:"p-5 flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading categories..."})]}):""===p.trim()?e.jsxs("div",{className:"p-5 text-center",children:[e.jsxs("div",{className:"text-gray-500 text-lg mb-2",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Search company name to choose Company Category"]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Type a company name above to see available categories"})]}):g.length>0?g.map((t,a)=>{let n,l;"string"==typeof t?(n=t,l=t):(n=t.label||t.display_text||t.category_name||"",l=t.display_text||t.label||`${t.company_name||""} → ${t.bank_name||""} → ${t.category_name||""}`);const i=(e=>{const t=e.display_key||e.value||e.display_text||e.category_name||JSON.stringify(e);return f.some(e=>(e.display_key||e.value||e.display_text||e.category_name||JSON.stringify(e))===t)})(t),o=t.display_key||t.value||t.display_text||t.category_name||JSON.stringify(t),r=i,s=r?{backgroundColor:"#dcfce7",borderColor:"#86efac",borderWidth:"3px",borderStyle:"solid",boxShadow:"0 0 10px rgba(134, 239, 172, 0.5)"}:{backgroundColor:"#ffffff",borderColor:"#e5e7eb",borderWidth:"1px",borderStyle:"solid",boxShadow:"none"};return e.jsxs("div",{className:"p-3 border-b last:border-b-0 cursor-pointer text-lg text-black transition flex items-center",style:s,onClick:e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),(e=>{if(c){let t=[...f];const a=e.display_key||e.value||e.display_text||e.category_name||JSON.stringify(e),n=t.findIndex(e=>(e.display_key||e.value||e.display_text||e.category_name||JSON.stringify(e))===a);n>=0?t.splice(n,1):t.push(e),h(t)}else h([e])})(t)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation()},onMouseUp:e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation()},"data-category-popup-item":"true",children:[e.jsx("div",{className:"w-8 h-8 rounded-full text-white flex items-center justify-center mr-3 flex-shrink-0",style:{backgroundColor:r?"#16a34a":"#10B981",border:r?"2px solid #059669":"none"},children:n?n.split(" ").map(e=>e[0]||"").slice(0,2).join("").toUpperCase():"CA"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{style:{color:r?"#166534":"#111827",fontWeight:r?"bold":"normal"},className:"font-medium text-lg",children:l})}),r&&e.jsx("div",{className:"ml-2",style:{color:"#16a34a"},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{stroke:"#16a34a",strokeWidth:"3"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]},`category-${o}-${a}`)}):e.jsxs("div",{className:"p-5 text-center",children:[e.jsxs("div",{className:"text-red-500 text-lg mb-2",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.47-.881-6.08-2.33"})}),"No search company found"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Try searching with a different company name"})]})}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4 bg-white bg-opacity-90 p-3 rounded-b-xl",children:[e.jsxs("div",{className:"px-4 py-2 bg-gray-100 rounded text-sm",children:["Selected: ",f.length," categories"]}),c&&e.jsx("button",{className:"px-6 py-3 bg-blue-600 text-white rounded-xl shadow text-lg hover:bg-blue-700 transition",onClick:()=>{o&&"function"==typeof o?o(f):f.forEach(e=>{l(e,!1)}),i?i():n()},children:"Done"}),e.jsx("button",{className:"px-6 py-3 bg-gray-400 text-white text-lg rounded-xl shadow hover:bg-gray-500 transition",onClick:n,children:"Cancel"})]}),e.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-red-500 text-2xl font-bold",onClick:n,children:"×"})]})})}export{y as default};
