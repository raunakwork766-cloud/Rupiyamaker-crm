import{j as e}from"./vendor-mui-C1GmDdcn.js";import{r as t}from"./vendor-react-EzoxUMNY.js";import{A as a}from"./task-components-BODc7Jo4.js";import{f as s}from"./employee-components-CPwJv_R0.js";import{g as r,i as n,q as l,r as i,aQ as o,aR as c,e as d,w as m,d as x,z as p,I as g,C as h,T as u,ac as b,S as f,c as y,aM as j}from"./lead-components-CxEP6yWP.js";import"./vendor-utils-QXd9EeNt.js";import"./vendor-antd-BB3a0mYC.js";import"./vendor-office-CbbGW2MO.js";const w=[{key:"total_sent",label:"TOTAL SENT",icon:c,gradient:"from-blue-500 to-cyan-400",shadowColor:"shadow-blue-500/25"},{key:"active",label:"ACTIVE",icon:d,gradient:"from-green-500 to-green-400",shadowColor:"shadow-green-500/25"},{key:"complete",label:"COMPLETE",icon:m,gradient:"from-emerald-500 to-teal-400",shadowColor:"shadow-emerald-500/25"},{key:"deactivate",label:"DEACTIVATE",icon:x,gradient:"from-red-500 to-pink-400",shadowColor:"shadow-red-500/25"}],N=()=>{const[c,d]=t.useState([]),[x,N]=t.useState(!1),[v,k]=t.useState(null),[_,S]=t.useState(null),[C,T]=t.useState(!1),[$,E]=t.useState(null),[A,L]=t.useState(!1),[I,D]=t.useState(null),[z,B]=t.useState("all"),[O,P]=t.useState({title:"",message:"",targetType:"all",targetDepartments:[],targetEmployees:[],notificationType:"general"}),[U,F]=t.useState([]),[M,H]=t.useState([]),[R,J]=t.useState([]),[G,V]=t.useState([]),[q,W]=t.useState(!1),[Y,Q]=t.useState(!1),[K,X]=t.useState(""),[Z,ee]=t.useState(""),[te,ae]=t.useState(!1),[se,re]=t.useState(!1),[ne,le]=t.useState({top:0,left:0,width:0}),[ie,oe]=t.useState({top:0,left:0,width:0}),ce=t.useRef(null),de=t.useRef(null),me=t.useRef(null),[xe,pe]=t.useState(!1),[ge,he]=t.useState([]),[ue,be]=t.useState(!1),[fe,ye]=t.useState(!1),[je,we]=t.useState(""),[Ne,ve]=t.useState(null);t.useRef(null);const[ke,_e]=t.useState({view:!0,send:!1,delete:!1});t.useEffect(()=>{try{const e=r();if(n(e))return void _e({view:!0,send:!0,delete:!0});const t={view:l(e,"notification","view")||l(e,"Notification","view"),send:l(e,"notification","send")||l(e,"Notification","send"),delete:l(e,"notification","delete")||l(e,"Notification","delete")};if("*"===e?.notification||"*"===e?.Notification)return void _e({view:!0,send:!0,delete:!0});_e({view:t.view||!0,send:t.send,delete:t.delete})}catch(e){_e({view:!0,send:!1,delete:!1})}},[]),t.useEffect(()=>{const e=e=>{ce.current&&!ce.current.contains(e.target)&&(W(!1),X("")),de.current&&!de.current.contains(e.target)&&(Q(!1),ee(""))};return(q||Y)&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[q,Y]),t.useEffect(()=>{C&&me.current&&(me.current.style.height="auto",me.current.style.height=me.current.scrollHeight+"px")},[O.message,C]);const Se=(e,t,a)=>{if(!e.current)return;const s=e.current.getBoundingClientRect(),r=window.innerHeight-s.bottom,n=s.top,l=r<280&&n>r;t(l),a({top:l?s.top-280:s.bottom,left:s.left,width:s.width})},Ce=R.filter(e=>(e.name||e.department_name||e.title||"").toLowerCase().includes(K.toLowerCase())),Te=G.filter(e=>(`${e.first_name||""} ${e.last_name||""}`.trim()||e.name||e.username||"").toLowerCase().includes(Z.toLowerCase())),$e={urgent:{icon:u,color:"text-red-600",bg:"bg-red-50",border:"border-red-200"},high:{icon:h,color:"text-orange-600",bg:"bg-orange-50",border:"border-orange-200"},normal:{icon:g,color:"text-blue-600",bg:"bg-blue-50",border:"border-blue-200"},low:{icon:p,color:"text-gray-600",bg:"bg-gray-50",border:"border-gray-200"}},Ee=()=>{try{const e=localStorage.getItem("userId")||localStorage.getItem("user_id");if(e)return e;const t=localStorage.getItem("user");if(t){const e=JSON.parse(t);return e._id||e.id||e.user_id}return null}catch(e){return null}},Ae=async()=>{N(!0);try{const e=Ee();if(!e)return k("User ID not found"),void N(!1);const t=await fetch(`${a}/pop-notifications/?user_id=${e}&include_inactive=true&per_page=500`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to fetch notifications");{const e=((await t.json()).notifications||[]).map(e=>({...e,id:e.id||e._id}));d(e),k(null)}}catch(e){k("Failed to load notifications")}finally{N(!1)}},Le=async()=>{try{const e=Ee();if(!e)return;const t=await fetch(`${a}/pop-notifications/stats/overview?user_id=${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const e=await t.json();D(e)}}catch(e){}},Ie=e=>e&&0!==e.length?e.map(e=>{const t=R.find(t=>t._id===e||t.id===e);return t?t.name:`Unknown (${e})`}):[],De=e=>e&&0!==e.length?e.map(e=>{const t=G.find(t=>t._id===e||t.id===e);return t&&(`${t.first_name||""} ${t.last_name||""}`.trim()||t.username)||`Unknown (${e})`}):[],ze=()=>{try{const e=JSON.parse(localStorage.getItem("userData")||"{}"),t=e.first_name||"";return`${t} ${e.last_name||""}`.trim()||e.name||e.username||"Admin User"}catch(e){return"Admin User"}},Be=e=>s(e),Oe=()=>{if(ue)he([]),be(!1);else{const e=c.map(e=>e.id||e._id);he(e),be(!0)}};return t.useEffect(()=>{Ae(),Le(),(async()=>{try{const e=await fetch(`${a}/departments?user_id=None`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const t=await e.json(),a=Array.isArray(t)?t:t.departments||[];J(a)}else await e.text()}catch(e){}})(),(async()=>{try{const e=await fetch(`${a}/users`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const t=await e.json(),a=Array.isArray(t)?t:t.users||[];V(a)}else await e.text()}catch(e){}})()},[]),t.useEffect(()=>{if(_||v){const e=setTimeout(()=>{S(null),k(null)},5e3);return()=>clearTimeout(e)}},[_,v]),t.useEffect(()=>{if(xe){const e=e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}},[xe]),t.useEffect(()=>{if(xe){const e=setTimeout(()=>{const e=document.getElementById("announcement-details-content"),t=document.getElementById("announcement-more-btn"),a=document.getElementById("announcement-modal"),s=document.getElementById("announcement-accept-btn"),r=document.getElementById("announcement-scroll-indicator"),n=document.getElementById("announcement-details-overlay");if(!(e&&t&&a&&s))return;let l=!1;if(e.scrollHeight>e.clientHeight){t.style.display="flex",s.style.display="none";const i=i=>{i.preventDefault(),i.stopPropagation(),e.classList.contains("expanded")?(e.classList.remove("expanded"),a.classList.remove("expanded"),t.textContent="More Details",t.classList.remove("expanded"),s.style.display="none",r&&r.classList.remove("show"),n&&(n.style.opacity="1"),l=!1,a.scrollTo({top:0,behavior:"smooth"})):(e.classList.add("expanded"),a.classList.add("expanded"),t.textContent="Show Less",t.classList.add("expanded"),r&&r.classList.add("show"),n&&(n.style.opacity="0"),setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"nearest"})},150))};t.addEventListener("click",i);const o=()=>{if(a.classList.contains("expanded")){const e=a.scrollTop,t=a.scrollHeight,n=e+a.clientHeight>=t-50,i=Math.min(e/50,.3);a.style.boxShadow="0 0 30px rgba(66, 165, 245, "+(.2+i)+")",n&&!l&&(l=!0,s.style.display="flex",r&&r.classList.remove("show"),s.style.animation="fadeInSuccess 0.5s ease")}};return a.addEventListener("scroll",o),()=>{t.removeEventListener("click",i),a.removeEventListener("scroll",o)}}t.style.display="none",s.style.display="flex",n&&(n.style.display="none"),l=!0},100);return()=>clearTimeout(e)}},[xe]),e.jsxs("div",{className:"min-h-screen bg-black text-white",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8 bg-black",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Announcements"})}),(ke.send||n(r()))&&e.jsxs("button",{onClick:()=>T(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold text-lg transition-all duration-300 flex items-center gap-3",children:[e.jsx(i,{className:"h-5 w-5"}),"Create Announcement"]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-700",children:[e.jsxs("button",{onClick:()=>B("all"),className:"px-6 py-3 font-semibold text-sm transition-all duration-300 "+("all"===z?"text-blue-400 border-b-2 border-blue-400 bg-blue-900/20":"text-gray-400 hover:text-white hover:bg-gray-800"),children:["All Notifications (",c.length,")"]}),e.jsxs("button",{onClick:()=>B("general"),className:"px-6 py-3 font-semibold text-sm transition-all duration-300 "+("general"===z?"text-blue-400 border-b-2 border-blue-400 bg-blue-900/20":"text-gray-400 hover:text-white hover:bg-gray-800"),children:["General (",c.filter(e=>"general"===e.notification_type).length,")"]}),e.jsxs("button",{onClick:()=>B("logout"),className:"px-6 py-3 font-semibold text-sm transition-all duration-300 flex items-center gap-2 "+("logout"===z?"text-red-400 border-b-2 border-red-400 bg-red-900/20":"text-gray-400 hover:text-red-400 hover:bg-gray-800"),children:[e.jsx(o,{className:"h-4 w-4"}),"Logout (",c.filter(e=>"logout"===e.notification_type).length,")"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 gap-6 mb-8",children:w.map(({key:t,label:a,icon:s,gradient:r,shadowColor:n},l)=>{let i=0;if(c&&c.length>0)switch(t){case"total_sent":i=c.length;break;case"active":i=c.filter(e=>{if(!e.is_active)return!1;const t=e.acceptance_stats||{},a=t.total_users||0,s=t.accepted_count||0;return!(a>0&&s===a)}).length;break;case"complete":i=c.filter(e=>{if(!e.is_active)return!1;const t=e.acceptance_stats||{},a=t.total_users||0,s=t.accepted_count||0;return a>0&&s===a}).length;break;case"deactivate":i=c.filter(e=>!e.is_active).length;break;default:i=0}return e.jsxs("div",{className:`p-4 rounded-xl bg-gradient-to-r ${r} shadow-lg ${n||"shadow-lg"} flex-1 cursor-pointer transition-transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(s,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"text-xl font-bold text-white",children:i})]}),e.jsx("p",{className:"mt-4 text-md text-white font-medium uppercase tracking-wide",children:a})]},l)})}),_&&e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-green-500/20 to-green-600/20 border border-green-500 text-green-300 rounded-lg backdrop-blur-sm",children:_}),v&&e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-red-500/20 to-red-600/20 border border-red-500 text-red-300 rounded-lg backdrop-blur-sm",children:v}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4 mt-5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[(ke.delete||n(r()))&&e.jsx(e.Fragment,{children:fe?e.jsxs("div",{className:"flex items-center gap-6 bg-gray-900 rounded-lg p-3",children:[e.jsxs("label",{className:"flex items-center cursor-pointer text-[#03B0F5] font-bold",children:[e.jsx("input",{type:"checkbox",className:"accent-blue-500 mr-2",checked:ue,onChange:Oe,style:{width:18,height:18}}),"Select All"]}),e.jsxs("span",{className:"text-white font-semibold",children:[ge.length," row",1!==ge.length?"s":""," selected"]}),e.jsxs("button",{className:"px-3 py-1 bg-red-600 text-white rounded font-bold hover:bg-red-700 transition",onClick:async()=>{if(0!==ge.length&&window.confirm(`Are you sure you want to PERMANENTLY DELETE ${ge.length} notification${1!==ge.length?"s":""}? This action cannot be undone!`))try{const e=localStorage.getItem("token"),t=Ee();if(!t)return void k("User ID not found");d(e=>e.filter(e=>!ge.includes(e.id||e._id))),he([]),be(!1),ye(!1);const s=ge.map(s=>fetch(`${a}/pop-notifications/${s}?user_id=${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}));(await Promise.all(s)).every(e=>e.ok)?S(`Successfully deleted ${ge.length} notification${1!==ge.length?"s":""}`):k("Some notifications could not be deleted. Refreshing..."),await Ae(),await Le()}catch(e){k("Failed to delete notifications. Please try again."),await Ae()}},disabled:0===ge.length,children:["Delete (",ge.length,")"]}),e.jsx("button",{className:"px-3 py-1 bg-gray-600 text-white rounded font-bold hover:bg-gray-700 transition",onClick:()=>{he([]),be(!1),ye(!1)},children:"Cancel"})]}):e.jsx("button",{className:"bg-[#03B0F5] text-white px-5 py-3 rounded-lg font-bold shadow hover:bg-[#0280b5] transition text-base",onClick:()=>{ye(!0)},children:ge.length>0?`Select (${ge.length})`:"Select"})}),je&&e.jsxs("div",{className:"text-base text-gray-300 bg-[#1b2230] px-4 py-3 rounded-lg border border-gray-600",children:[c.filter(e=>{const t=je.toLowerCase();return e.title?.toLowerCase().includes(t)||e.message?.toLowerCase().includes(t)||e.sender_name?.toLowerCase().includes(t)}).length," of ",c.length," notifications",e.jsxs("span",{className:"ml-2",children:['matching "',e.jsx("span",{className:"text-cyan-400 font-semibold",children:je}),'"']})]})]}),e.jsxs("div",{className:"relative w-[320px]",children:[e.jsx("input",{type:"text",placeholder:"Search announcements...",value:je,onChange:e=>we(e.target.value),className:"w-full px-4 py-3 pl-12 bg-[#1b2230] text-white border border-gray-600 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-base"}),e.jsx("svg",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),je&&e.jsx("button",{onClick:()=>we(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-x-auto max-h-[calc(100vh-200px)] overflow-y-auto",children:e.jsxs("table",{className:"min-w-full w-full bg-black relative",children:[e.jsx("thead",{className:"bg-white sticky top-0 z-50 shadow-lg border-b-2 border-gray-200",children:e.jsxs("tr",{children:[fe&&e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider sticky top-0 z-50 shadow-sm border-b border-gray-200 text-center w-16",children:e.jsx("input",{type:"checkbox",checked:ue,onChange:Oe,className:"w-5 h-5 accent-blue-500 cursor-pointer"})}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider sticky top-0 z-50 shadow-sm border-b border-gray-200 text-left",children:"#"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider sticky top-0 z-50 shadow-sm border-b border-gray-200 text-left",children:"Date & Time"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider sticky top-0 z-50 shadow-sm border-b border-gray-200 text-left",children:"Created By"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider sticky top-0 z-50 shadow-sm border-b border-gray-200 text-left",children:"Subject"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider sticky top-0 z-50 shadow-sm border-b border-gray-200 text-left",children:"Target"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider sticky top-0 z-50 shadow-sm border-b border-gray-200 text-left",children:"Progress"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider sticky top-0 z-50 shadow-sm border-b border-gray-200 text-left",children:"Action"})]})}),e.jsx("tbody",{className:"bg-black",children:x?e.jsx("tr",{children:e.jsx("td",{colSpan:fe?8:7,className:"py-20 text-center text-gray-400 text-lg bg-black",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-xl font-semibold",children:"Loading Notifications..."})]})})}):0===c.length?e.jsx("tr",{children:e.jsx("td",{colSpan:fe?8:7,className:"py-20 text-center text-gray-400 text-lg bg-black",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx(p,{className:"w-12 h-12 text-gray-600"}),e.jsx("span",{className:"text-xl font-semibold",children:"No Notifications Found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create your first notification to get started"})]})})}):(()=>{let t="all"===z?c:c.filter(e=>e.notification_type===z);return t=t.filter(e=>{if(!je)return!0;const t=je.toLowerCase();return e.title?.toLowerCase().includes(t)||e.message?.toLowerCase().includes(t)||e.sender_name?.toLowerCase().includes(t)||e.target_type?.toLowerCase().includes(t)}),0===t.length?e.jsx("tr",{children:e.jsx("td",{colSpan:fe?8:7,className:"py-20 text-center text-gray-400 text-lg bg-black",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx(p,{className:"w-12 h-12 text-gray-600"}),e.jsx("span",{className:"text-xl font-semibold",children:"No Notifications Match Your Search"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try different search terms"})]})})}):t.map((t,s)=>{($e[t.priority]||$e.normal).icon;const r=t.acceptance_stats||{},n=r.total_users||0,l=r.accepted_count||0,i=Math.max(0,n-l),o=n>0?l/n*100:0,d=t.id||t._id,m=ge.includes(d),x=!1===t.is_active;return e.jsxs("tr",{className:`border-b border-gray-800 hover:bg-gray-800/50 transition-colors cursor-pointer ${m&&fe?"bg-blue-900/20":""} ${x?"opacity-50 bg-red-900/10":""}`,onClick:()=>(async e=>{try{const t=Ee();if(!t)return void k("User ID not found");const s=await fetch(`${a}/pop-notifications/${e}/history?user_id=${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok)throw new Error("Failed to fetch notification history");{const e=await s.json();E(e),L(!0)}}catch(t){k(t.message)}})(t.id||t._id),title:x?"Deactivated notification - Click to view history":"Click to view notification history",children:[fe&&e.jsx("td",{className:"px-4 py-3 text-center",onClick:e=>e.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:m,onChange:e=>((e,t)=>{if(t.stopPropagation(),ge.includes(e))he(ge.filter(t=>t!==e)),be(!1);else{const t=[...ge,e];he(t),t.length===c.length&&be(!0)}})(d,e),className:"w-5 h-5 accent-blue-500 cursor-pointer"})}),e.jsx("td",{className:"px-4 py-3 text-white",children:e.jsx("span",{className:"text-blue-400 font-bold text-lg",children:s+1})}),e.jsx("td",{className:"px-4 py-3 text-white",children:e.jsx("div",{className:"text-white font-medium text-sm",children:Be(t.created_at)})}),e.jsx("td",{className:"px-4 py-3 text-white",children:e.jsx("div",{className:"text-white font-medium text-sm",children:t.sender_name||"Unknown"})}),e.jsx("td",{className:"px-4 py-3 text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-white text-sm",children:t.title}),x&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-semibold bg-red-600/20 text-red-400 border border-red-600 rounded",children:"DEACTIVATED"})]})}),e.jsxs("td",{className:"px-4 py-3 text-white",children:["all"===t.target_type&&e.jsx("span",{className:"text-green-400 font-medium text-sm",children:"All Employees"}),"department"===t.target_type&&e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-400 font-medium text-sm",children:"Departments:"}),e.jsx("div",{className:"text-xs text-gray-300 mt-1 max-w-xs",children:Ie(t.target_departments).length>0?e.jsx("div",{className:"space-y-0.5",children:Ie(t.target_departments).map((t,a)=>e.jsxs("div",{className:"truncate",title:t,children:["â€¢ ",t]},a))}):e.jsxs("span",{className:"text-gray-500",children:[t.target_departments?.length||0," department(s)"]})})]}),"individual"===t.target_type&&e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-400 font-medium text-sm",children:"Specific Employees:"}),e.jsx("div",{className:"text-xs text-gray-300 mt-1 max-w-xs",children:De(t.target_employees).length>0?e.jsx("div",{className:"space-y-0.5",children:De(t.target_employees).map((t,a)=>e.jsxs("div",{className:"truncate",title:t,children:["â€¢ ",t]},a))}):e.jsxs("span",{className:"text-gray-500",children:[t.target_employees?.length||0," employee(s)"]})})]}),!t.target_type&&e.jsx("span",{className:"text-green-400 font-medium text-sm",children:"All Employees"})]}),e.jsx("td",{className:"px-4 py-3 text-white",children:e.jsxs("div",{className:"flex flex-col gap-1 min-w-32",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-green-400 font-medium",title:"Accepted",children:l}),e.jsx("span",{className:"text-yellow-400 font-medium",title:"Pending",children:i}),e.jsx("span",{className:"text-white font-medium",title:"Total Targeted",children:n})]}),e.jsx("div",{className:"w-full h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-400 to-green-500 transition-all duration-300",style:{width:`${o}%`}})}),e.jsxs("span",{className:"text-white font-medium text-center text-xs",children:[o.toFixed(1),"%"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:t.is_active?t.is_active&&n>0&&l===n?e.jsx("span",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg font-bold text-sm uppercase tracking-wide",children:"COMPLETED"}):e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(confirm("Are you sure you want to deactivate this notification?"))try{const t=Ee();if(!t)return void k("User ID not found");if(!(await fetch(`${a}/pop-notifications/${e}/deactivate?user_id=${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({reason:"Manually deactivated by admin"})})).ok)throw new Error("Failed to deactivate notification");S("Notification deactivated successfully!"),Ae(),Le()}catch(t){k(t.message)}})(t.id||t._id)},className:"bg-gradient-to-r from-red-500 to-red-700 hover:from-red-600 hover:to-red-800 text-white px-4 py-2 rounded-lg font-bold text-sm uppercase tracking-wide transition-all duration-300 transform hover:-translate-y-1",title:"Deactivate Notification",children:"STOP"}):e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(confirm("Are you sure you want to activate this notification?"))try{const t=Ee();if(!t)return void k("User ID not found");if(!(await fetch(`${a}/pop-notifications/${e}/activate?user_id=${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({reason:"Manually activated by admin"})})).ok)throw new Error("Failed to activate notification");S("Notification activated successfully!"),Ae(),Le()}catch(t){k(t.message)}})(t.id||t._id)},className:"bg-gradient-to-r from-green-500 to-green-700 hover:from-green-600 hover:to-green-800 text-white px-4 py-2 rounded-lg font-bold text-sm uppercase tracking-wide transition-all duration-300 transform hover:-translate-y-1",title:"Activate Notification",children:"START"})})})]},t.id)})})()})]})})]}),C&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-transparent bg-opacity-20",children:e.jsxs("div",{className:"relative bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col",children:[e.jsx("button",{className:"absolute right-2 top-2 text-gray-500 hover:text-red-500 transition text-2xl font-bold z-10",onClick:()=>T(!1),"aria-label":"Close",type:"button",children:"Ã—"}),e.jsx("div",{className:"overflow-y-auto p-6 space-y-6",children:e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),N(!0),k(null),S(null);try{const e=Ee();if(!e)return k("User ID not found"),void N(!1);const t={title:O.title,message:O.message,priority:"normal",target_type:O.targetType,target_departments:"department"===O.targetType?U.map(e=>e.id||e):[],target_employees:"individual"===O.targetType?M.map(e=>e.id||e):[],notification_type:O.notificationType},s=await fetch(`${a}/pop-notifications/?user_id=${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)});if(!s.ok){const e=await s.json();throw new Error(e.detail||"Failed to send notification")}{const e=await s.json(),t="individual"===O.targetType?M.length:"department"===O.targetType?U.reduce((e,t)=>e+(t.employee_count||0),0):10;(e=>{const t="Sent: "+(new Date).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}).replace(",",""),a={...e,acceptedCount:0,isAcknowledged:!1,timestamp:t,senderRole:e.senderRole||"ADMIN"};localStorage.setItem("pendingAnnouncement",JSON.stringify(a)),ve(a),pe(!0)})({title:O.title,message:O.message,senderName:ze(),targetCount:t,targetType:O.targetType,priority:"normal",notificationId:e.id||e._id}),P({title:"",message:"",targetType:"all",targetDepartments:[],targetEmployees:[],notificationType:"general"}),F([]),H([]),T(!1),Ae(),Le(),window.triggerNotificationCheck&&window.triggerNotificationCheck(),(async(e,t,a)=>{try{if("all"===e){const e={type:"global_notification_created",timestamp:Date.now(),notificationId:"pending"};return void localStorage.setItem("globalNotificationTrigger",JSON.stringify(e))}if("department"===e&&t.length>0){const e={type:"department_notification_created",timestamp:Date.now(),departments:t.map(e=>e.id||e),notificationId:"pending"};return void localStorage.setItem("globalNotificationTrigger",JSON.stringify(e))}if("individual"===e&&a.length>0){const e={type:"individual_notification_created",timestamp:Date.now(),userIds:a.map(e=>e.id||e),notificationId:"pending"};return void localStorage.setItem("globalNotificationTrigger",JSON.stringify(e))}}catch(s){}})(O.targetType,U,M)}}catch(t){k(t.message)}finally{N(!1)}},children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Date & Time"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:Be(new Date),readOnly:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Created By"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:ze(),readOnly:!0})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Subject *"}),e.jsx("input",{type:"text",value:O.title,onChange:e=>P({...O,title:e.target.value}),onBlur:()=>{var e;"string"==typeof O[e="title"]&&P(t=>({...t,[e]:t[e].toUpperCase()}))},className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold",placeholder:"Enter announcement subject",required:!0})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Announcment Details *"}),e.jsx("textarea",{ref:me,value:O.message,onChange:e=>{P({...O,message:e.target.value}),e.target&&(e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px")},className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold resize-none overflow-hidden",rows:"3",placeholder:"Enter announcement details...",required:!0,style:{minHeight:"80px"}})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Target Type"}),e.jsxs("select",{value:O.targetType,onChange:e=>P({...O,targetType:e.target.value}),className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",children:[e.jsx("option",{value:"all",children:"All Employees"}),e.jsx("option",{value:"department",children:"Specific Departments"}),e.jsx("option",{value:"individual",children:"Individual Employees"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Notification Type"}),e.jsxs("select",{value:O.notificationType,onChange:e=>P({...O,notificationType:e.target.value}),className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",children:[e.jsx("option",{value:"general",children:"General Announcement"}),e.jsx("option",{value:"logout",children:"Logout Announcement"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"logout"===O.notificationType?"âš ï¸ Logout notifications will show a logout button to users. Users will be logged out when they acknowledge.":"ðŸ“¢ General announcements for standard communications."})]}),"department"===O.targetType&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Select Departments"}),e.jsxs("div",{className:"relative z-[10000]",ref:ce,children:[e.jsxs("div",{className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-white cursor-pointer flex items-center justify-between min-h-[40px]",onClick:()=>{q||Se(ce,ae,le),W(!q),q&&X("")},children:[U.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:U.map((t,a)=>e.jsxs("span",{className:"bg-cyan-500 text-white px-2 py-1 rounded-full text-sm flex items-center gap-1",children:[t.name||t,e.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),F(U.filter(e=>(e.id||e)!==(t.id||t)))},className:"text-white hover:text-gray-300",children:"Ã—"})]},t.id||a))}):e.jsx("span",{className:"text-gray-500",children:"Select departments..."}),e.jsx(b,{className:`transform transition-transform ${q?"rotate-180":""} text-gray-600`,size:20})]}),q&&e.jsxs("div",{className:"fixed bg-white border-2 border-cyan-400 rounded-lg shadow-2xl",style:{top:`${ne.top}px`,left:`${ne.left}px`,width:`${ne.width}px`,zIndex:10001,maxHeight:"280px"},children:[e.jsx("div",{className:"sticky top-0 bg-white p-3 border-b-2 border-cyan-400 z-10",children:e.jsx("input",{type:"text",placeholder:"Search departments...",value:K,onChange:e=>X(e.target.value),onClick:e=>e.stopPropagation(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-cyan-500"})}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"200px"},children:Ce.length>0?Ce.map(t=>{const a=t.name||t.department_name||t.title||"Unknown Department",s=t.id||t._id||t.department_id,r={id:s,name:a},n=U.some(e=>e.id===s);return e.jsxs("div",{className:"p-3 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-black",onClick:()=>{F(n?U.filter(e=>e.id!==s):[...U,r])},children:[e.jsx("div",{className:`w-4 h-4 border-2 border-gray-400 rounded ${n?"bg-cyan-500 border-cyan-500":""} flex items-center justify-center`,children:n&&e.jsx("span",{className:"text-white text-xs",children:"âœ“"})}),e.jsx("span",{className:"text-black font-medium",children:a})]},s)}):e.jsx("div",{className:"p-3 text-gray-500 text-center",children:K?"No departments found matching your search":0===R.length?"Loading departments...":"No departments found"})})]})]})]}),"individual"===O.targetType&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Select Employees"}),e.jsxs("div",{className:"relative z-[10000]",ref:de,children:[e.jsxs("div",{className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-white cursor-pointer flex items-center justify-between min-h-[40px]",onClick:()=>{Y||Se(de,re,oe),Q(!Y),Y&&ee("")},children:[M.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:M.map((t,a)=>e.jsxs("span",{className:"bg-cyan-500 text-white px-2 py-1 rounded-full text-sm flex items-center gap-1",children:[t.name||t,e.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),H(M.filter(e=>(e.id||e)!==(t.id||t)))},className:"text-white hover:text-gray-300",children:"Ã—"})]},t.id||a))}):e.jsx("span",{className:"text-gray-500",children:"Select employees..."}),e.jsx(b,{className:`transform transition-transform ${Y?"rotate-180":""} text-gray-600`,size:20})]}),Y&&e.jsxs("div",{className:"fixed bg-white border-2 border-cyan-400 rounded-lg shadow-2xl",style:{top:`${ie.top}px`,left:`${ie.left}px`,width:`${ie.width}px`,zIndex:10001,maxHeight:"280px"},children:[e.jsx("div",{className:"sticky top-0 bg-white p-3 border-b-2 border-cyan-400 z-10",children:e.jsx("input",{type:"text",placeholder:"Search employees...",value:Z,onChange:e=>ee(e.target.value),onClick:e=>e.stopPropagation(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-cyan-500"})}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"200px"},children:Te.length>0?Te.map(t=>{t.name||t.full_name||t.username||`${t.first_name||""} ${t.last_name||""}`.trim();const a=t.id||t._id||t.user_id,s=`${t.first_name||""} ${t.last_name||""}`.trim()||t.name||t.username||"Unknown User",r={id:a,name:s},n=M.some(e=>e.id===a);return e.jsxs("div",{className:"p-3 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-black",onClick:()=>{H(n?M.filter(e=>e.id!==a):[...M,r])},children:[e.jsx("div",{className:`w-4 h-4 border-2 border-gray-400 rounded ${n?"bg-cyan-500 border-cyan-500":""} flex items-center justify-center`,children:n&&e.jsx("span",{className:"text-white text-xs",children:"âœ“"})}),e.jsx("span",{className:"text-black font-medium",children:s})]},a)}):e.jsx("div",{className:"p-3 text-gray-500 text-center",children:Z?"No matching employees found":0===G.length?"Loading employees...":"No employees found"})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>T(!1),className:"px-6 py-3 bg-gray-400 text-white rounded-xl shadow hover:bg-gray-500 transition",disabled:x,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-3 bg-cyan-600 text-white rounded-xl shadow hover:bg-cyan-700 transition flex items-center gap-2 font-bold",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"h-5 w-5"}),"Create Announcement"]})})]})]})})]})}),A&&$&&e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-transparent",style:{backdropFilter:"blur(3px)"},children:e.jsxs("div",{className:"relative bg-white p-6 rounded-xl shadow-2xl w-full max-w-5xl mx-auto space-y-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{className:"absolute right-2 top-2 text-gray-500 hover:text-red-500 transition text-2xl font-bold",onClick:()=>L(!1),"aria-label":"Close",type:"button",children:"Ã—"}),e.jsx("h2",{className:"text-xl font-bold text-green-600 mb-4",children:"ANNOUNCEMENT DETAILS"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:$.title||"",readOnly:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Priority"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:$.priority?$.priority.toUpperCase():"",readOnly:!0})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Message"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold resize-none bg-gray-100",rows:3,value:$.message||"",readOnly:!0,style:{minHeight:"3rem",maxHeight:"400px"}})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mt-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Sent By"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:$.sender_name||"Unknown",readOnly:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Date & Time"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:Be($.created_at),readOnly:!0})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Target Type"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:"all"===$.target_type?"All Employees":"department"===$.target_type?`Departments (${$.target_departments?.length||0} selected)`:"individual"===$.target_type?`Specific Employees (${$.target_employees?.length||0} selected)`:"All Employees",readOnly:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6 mb-6",children:[e.jsx("div",{className:"bg-white border border-cyan-400 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-sm font-bold",children:"Accepted"}),e.jsx("p",{className:"text-2xl font-bold text-black",children:$.accepted_by?.length||0})]})]})}),e.jsx("div",{className:"bg-white border border-cyan-400 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"h-8 w-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-600 text-sm font-bold",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-black",children:$.pending_users?.length||0})]})]})}),e.jsx("div",{className:"bg-white border border-cyan-400 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 text-sm font-bold",children:"Acceptance Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-black",children:[$.total_active_users>0?(($.accepted_by?.length||0)/$.total_active_users*100).toFixed(1):0,"%"]})]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block font-bold text-gray-700 mb-1",children:["Accepted Users (",$.accepted_by?.length||0,")"]}),e.jsx("div",{className:"w-full px-3 py-2 border border-cyan-400 rounded bg-gray-100 max-h-32 overflow-y-auto",children:$.accepted_by?.length>0?e.jsx("div",{className:"space-y-2",children:$.accepted_by.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-white border border-gray-200 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full"}),e.jsx("span",{className:"font-medium text-black text-sm",children:t.user_name})]}),e.jsx("span",{className:"text-xs text-gray-600",children:Be(t.accepted_at)})]},a))}):e.jsxs("div",{className:"text-center py-4 text-gray-600",children:[e.jsx(m,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"No acceptances yet"})]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block font-bold text-gray-700 mb-1",children:["Pending Users (",$.pending_users?.length||0,")"]}),e.jsx("div",{className:"w-full px-3 py-2 border border-cyan-400 rounded bg-gray-100 max-h-32 overflow-y-auto",children:$.pending_users&&$.pending_users.length>0?e.jsx("div",{className:"space-y-2",children:$.pending_users.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-white border border-gray-200 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-600 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium text-black text-sm",children:t.user_name})]}),e.jsx("span",{className:"text-xs text-yellow-600",children:"Waiting for response"})]},t.user_id||a))}):e.jsxs("div",{className:"text-center py-4 text-gray-600",children:[e.jsx(m,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"All users have accepted this announcement!"})]})})]})]})})]})};export{N as default};
