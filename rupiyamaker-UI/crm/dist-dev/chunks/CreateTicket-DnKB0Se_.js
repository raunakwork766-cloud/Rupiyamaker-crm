import{j as e}from"./vendor-mui-C1GmDdcn.js";import{r as t}from"./vendor-react-EzoxUMNY.js";import{f as s,A as a}from"./employee-components-LRnF1nW4.js";import{y as r}from"./task-components-CWHBp-Rd.js";import"./vendor-utils-QXd9EeNt.js";import"./vendor-antd-BB3a0mYC.js";import"./lead-components-D4SHX7AQ.js";import"./vendor-office-CbbGW2MO.js";function l({onClose:s,onSelect:r}){const[l,n]=t.useState(""),[i,o]=t.useState([]),[d,c]=t.useState(!0);t.useEffect(()=>{(async()=>{try{c(!0);const e=await a.tickets.getAssignableUsers();if(e&&e.users&&Array.isArray(e.users)){const t=e.users.map(e=>({id:e.user_id||e._id||e.id,name:e.name||e.username||`${e.first_name||""} ${e.last_name||""}`.trim(),email:e.email||"",role:e.role||"",designation:e.designation||e.role||e.job_title||""}));o(t.filter(e=>e.name))}else if(e&&Array.isArray(e)){const t=e.map(e=>({id:e.user_id||e._id||e.id,name:e.name||e.username||`${e.first_name||""} ${e.last_name||""}`.trim(),email:e.email||"",role:e.role||"",designation:e.designation||e.role||e.job_title||""}));o(t.filter(e=>e.name))}}catch(e){try{const e=await a.users.getUsers();if(e&&Array.isArray(e)){const t=e.map(e=>({id:e._id||e.id,name:e.name||e.username||`${e.first_name||""} ${e.last_name||""}`.trim(),email:e.email||"",role:e.role||"",designation:e.designation||e.role||e.job_title||""}));o(t.filter(e=>e.name))}}catch(t){o([])}}finally{c(!1)}})()},[]);const[m,x]=t.useState([]);return t.useEffect(()=>{""===l.trim()?x(i):x(i.filter(e=>e.name.toLowerCase().includes(l.toLowerCase())||e.designation&&e.designation.toLowerCase().includes(l.toLowerCase())))},[l,i]),e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-transparent",children:e.jsxs("div",{className:"bg-transparent backdrop-blur-sm p-6 rounded-2xl shadow-2xl w-[80%] max-w-xl mx-auto relative",children:[e.jsxs("div",{className:"flex items-center mb-4 bg-white bg-opacity-90 p-3 rounded-t-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[#03B0F5] text-white flex items-center justify-center mr-3",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),e.jsx("h3",{className:"font-bold text-lg text-black",children:"Assign Ticket"})]}),e.jsxs("div",{className:"mb-4 bg-white bg-opacity-90 p-3 rounded-md",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-2",children:"Assign to"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",className:"w-full pl-10 pr-3 py-2 border border-cyan-400 rounded text-black font-bold",value:l,onChange:e=>n(e.target.value),placeholder:"Search or enter assignee name"}),l&&e.jsx("button",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600",onClick:()=>n(""),type:"button",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),d?e.jsx("div",{className:"text-center p-4 bg-white bg-opacity-90 rounded-lg",children:"Loading users..."}):e.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto mb-4 border rounded-lg bg-white bg-opacity-90",children:m.length>0?m.map(t=>e.jsxs("li",{className:"p-3 border-b last:border-b-0 cursor-pointer text-black transition hover:bg-gray-100 flex items-center",onClick:()=>(r(t),void s()),children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[#03B0F5] text-white flex items-center justify-center mr-3 flex-shrink-0",children:t.name.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase()}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-black font-medium",children:t.name}),t.designation&&e.jsx("span",{className:"text-gray-600 text-sm",children:t.designation})]})]},t.id)):""!==l.trim()&&e.jsx("li",{className:"p-3 text-gray-500 text-center",children:"No matching assignees found."})}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4 bg-white bg-opacity-90 p-3 rounded-b-xl",children:[e.jsx("button",{className:"px-6 py-3 bg-cyan-600 text-white rounded-xl shadow hover:bg-cyan-700 transition",onClick:()=>{if(l){const e=i.find(e=>e.name.toLowerCase()===l.toLowerCase());r(e?{id:e.id,name:e.name}:{name:l})}n(""),s()},children:"Assign"}),e.jsx("button",{className:"px-6 py-3 bg-gray-400 text-white rounded-xl shadow hover:bg-gray-500 transition",onClick:s,children:"Cancel"})]}),e.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-red-500 text-2xl font-bold",onClick:s,children:"×"})]})})}function n({onClose:a,onSubmit:n}){const[i,o]=t.useState({createdBy:"",subject:"",details:"",assignedTo:[],assignedUserIds:[],priority:"medium",attachment:null,attachmentName:"",selectedFiles:[]}),[d,c]=t.useState(!1),[m,x]=t.useState(!0),[u,g]=t.useState(s(new Date)),[b,h]=t.useState(!1),f=t.useRef(null);t.useEffect(()=>{f.current&&(f.current.style.height="auto",f.current.style.height=f.current.scrollHeight+"px")},[i.details]),t.useEffect(()=>{try{const t=localStorage.getItem("userName"),s=localStorage.getItem("userFirstName"),a=localStorage.getItem("userLastName");if(t)return void o(e=>({...e,createdBy:t}));if(s&&a)return void o(e=>({...e,createdBy:`${s} ${a}`}));if(s)return void o(e=>({...e,createdBy:s}));const r=localStorage.getItem("user");if(r)try{const e=JSON.parse(r);if(e.name)return void o(t=>({...t,createdBy:e.name}));if(e.fullName)return void o(t=>({...t,createdBy:e.fullName}));if(e.firstName&&e.lastName)return void o(t=>({...t,createdBy:`${e.firstName} ${e.lastName}`}));if(e.firstName)return void o(t=>({...t,createdBy:e.firstName}));if(e.username)return void o(t=>({...t,createdBy:e.username}));if(e.email)return void o(t=>({...t,createdBy:e.email}))}catch(e){}o(e=>({...e,createdBy:"Current User"}))}catch(t){o(e=>({...e,createdBy:"Current User"}))}},[]);const p=(e,t)=>{o(s=>({...s,[e]:t}))},y=e=>{["id","assignTo","priority","status"].includes(e)||"string"!=typeof i[e]||o(t=>({...t,[e]:t[e].toUpperCase()}))},j=()=>{x(!1),a&&a()};return m?e.jsxs("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-transparent",style:{backdropFilter:"blur(3px)"},children:[e.jsxs("div",{className:"relative bg-white p-6 rounded-xl shadow-2xl w-full max-w-2xl mx-auto space-y-2 max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{className:"absolute right-2 top-2 text-gray-500 hover:text-red-500 transition text-2xl font-bold",onClick:j,"aria-label":"Close",type:"button",children:"×"}),e.jsx("h2",{className:"text-xl font-bold text-blue-500 mb-4",children:"ADD TICKET"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),i.subject&&i.details){try{i.subject,i.details,i.priority,i.assignedUserIds.length>0&&i.assignedUserIds,n&&n({createdBy:i.createdBy,subject:i.subject,details:i.details,priority:i.priority,assignedTo:i.assignedTo,assignedUserIds:i.assignedUserIds,files:i.selectedFiles})}catch(t){r.error("Failed to create ticket")}x(!1),a&&a()}else r.error("Please fill all required fields")},children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Date & Time"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:u,readOnly:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",htmlFor:"createdBy",children:"Created By"}),e.jsx("input",{id:"createdBy",type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:i.createdBy,onChange:e=>p("createdBy",e.target.value),onBlur:()=>y("createdBy"),required:!0})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",htmlFor:"subject",children:"Subject"}),e.jsx("input",{id:"subject",type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold",value:i.subject,onChange:e=>p("subject",e.target.value),onBlur:()=>y("subject"),placeholder:"Enter subject",required:!0})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",htmlFor:"details",children:"Ticket Details"}),e.jsx("textarea",{ref:f,id:"details",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold resize-none overflow-hidden",rows:3,value:i.details,onChange:e=>p("details",e.target.value),onBlur:()=>y("details"),placeholder:"Enter ticket details...",required:!0,style:{minHeight:"3rem",maxHeight:"400px",transition:"height 0.2s"}})]}),e.jsxs("div",{className:"flex flex-col items-start mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-2",children:"Attachment"}),e.jsxs("label",{className:"inline-flex items-center px-4 py-2 bg-cyan-500 text-white font-bold rounded-lg shadow cursor-pointer hover:bg-cyan-600 transition",children:["Photo/PDF",e.jsx("input",{type:"file",accept:"image/*,application/pdf",className:"hidden",onChange:e=>{const t=e.target.files[0];if(t){p("attachment",t),p("attachmentName",t.name);const s=Array.from(e.target.files);o(e=>({...e,selectedFiles:[...e.selectedFiles,...s]}))}},multiple:!0})]}),i.attachmentName&&e.jsxs("span",{className:"mt-2 text-green-700 font-semibold text-sm",children:["Uploaded: ",i.attachmentName]}),i.selectedFiles.length>0&&e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:i.selectedFiles.map((t,s)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("img",{src:URL.createObjectURL(t),alt:`Preview ${s}`,className:"w-20 h-20 object-cover rounded-lg"}),e.jsx("span",{className:"text-sm text-black",children:t.name})]},s))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Assignee"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 border border-cyan-400 rounded-md bg-white p-1 pr-2 min-h-[42px]",children:[i.assignedTo.map((t,s)=>{const a="string"==typeof t?t:t.name;return e.jsxs("div",{className:"bg-blue-100 text-blue-800 py-1 px-3 rounded-md flex items-center",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#03B0F5] text-white flex items-center justify-center mr-2 text-xs flex-shrink-0",children:a.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase()}),e.jsx("span",{children:a}),e.jsx("button",{type:"button",className:"ml-2 text-blue-500 hover:text-blue-700",onClick:()=>{return e=a,void o(t=>({...t,assignedTo:t.assignedTo.filter(t=>"string"==typeof t?t!==e:t.name!==e),assignedUserIds:t.assignedUserIds.filter((s,a)=>{const r=t.assignedTo[a];return"string"==typeof r?r!==e:r.name!==e})}));var e},children:"×"})]},s)}),e.jsx("button",{type:"button",className:"text-blue-600 font-medium hover:text-blue-800 ml-auto",onClick:()=>h(!0),children:"+ Add more"})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"button",className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-100 transition text-lg",onClick:j,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-cyan-600 text-white font-bold rounded-lg shadow hover:bg-cyan-700 transition text-lg",children:"Add Ticket"})]})]})]}),b&&e.jsx(l,{onClose:()=>h(!1),onSelect:e=>{var t;t=e,o(e=>{const s="string"==typeof t?t:t.name,a="string"==typeof t?null:t.id;return e.assignedTo.some(e=>"string"==typeof e?e===s:e.name===s)?e:{...e,assignedTo:[...e.assignedTo,t],assignedUserIds:a?[...e.assignedUserIds||[],a]:e.assignedUserIds||[]}}),h(!1)}})]}):null}export{n as default};
