import{j as e,q as t,r as a,l as s,t as l,X as r,U as n,u as o,v as d,w as c}from"./vendor-mui-C1GmDdcn.js";import{r as i}from"./vendor-react-EzoxUMNY.js";import{j as x,aK as p,m,n as h,aL as b}from"./lead-components-v_oWzEmV.js";import"./vendor-utils-QXd9EeNt.js";import"./vendor-antd-BB3a0mYC.js";const u=[{key:"pending",label:"PENDING LEAVES",icon:s,backgroundColor:"bg-orange-500",gradient:"from-orange-400 to-orange-600",shadowColor:"shadow-orange-500/25"},{key:"approved",label:"APPROVED LEAVES",icon:l,backgroundColor:"bg-green-500",gradient:"from-green-400 to-green-600",shadowColor:"shadow-green-500/25"},{key:"rejected",label:"REJECTED LEAVES",icon:r,backgroundColor:"bg-red-500",gradient:"from-red-400 to-red-600",shadowColor:"shadow-red-500/25"},{key:"total",label:"TOTAL LEAVES",icon:n,backgroundColor:"bg-blue-500",gradient:"from-blue-400 to-blue-600",shadowColor:"shadow-blue-500/25"}],g=({leavetype:t,label:a})=>e.jsx("span",{className:`${(e=>{switch(e){case"paid_leave":return"bg-blue-500";case"casual_leave":return"bg-purple-500";case"sick_leave":return"bg-red-500";case"emergency_leave":return"bg-orange-500";default:return"bg-gray-500"}})(t)} text-white text-xs px-2 py-1 rounded-full font-semibold`,children:a}),f=({status:t,label:a})=>e.jsx("span",{className:`${(e=>{switch(e){case"approved":return"bg-green-500";case"rejected":return"bg-red-500";case"pending":return"bg-orange-500";default:return"bg-gray-500"}})(t)} text-white text-xs px-2 py-1 rounded-full font-semibold`,children:a}),v=()=>{const[s,n]=i.useState(!1),[v,y]=i.useState([]),[j,w]=i.useState(!1),[N,_]=i.useState(0),[k,C]=i.useState(!1),[S,A]=i.useState(!1),[E,L]=i.useState(null),[$,D]=i.useState({pending:0,approved:0,rejected:0,total:0}),[F,P]=i.useState({leave_type:"paid_leave",from_date:"",to_date:"",reason:"",attachments:[]}),[O,R]=i.useState(null),[U,T]=i.useState({status:"",leave_type:"",search:""}),[B,z]=i.useState({open:!1,message:"",severity:"info"}),[I,J]=i.useState([]),[V,q]=i.useState(!1),[M,G]=i.useState(!1),H=x("leaves");(()=>{const e=localStorage.getItem("userData");if(e){const{user_id:t}=JSON.parse(e)}})();const X=()=>{const e=localStorage.getItem("userData");if(e)try{if(JSON.parse(e).is_super_admin)return!0}catch(t){}return h("leaves")},Y=()=>{const e=localStorage.getItem("userData");if(e)try{if(JSON.parse(e).is_super_admin)return!0}catch(t){}return m("leaves")},K=()=>{const e=localStorage.getItem("userData");if(e)try{if(JSON.parse(e).is_super_admin)return!0}catch(t){}return b("leaves")},Q=()=>{const e=localStorage.getItem("userData");if(e)try{return!0===JSON.parse(e).is_super_admin}catch(t){}return!1},[W,Z]=i.useState({leaves_show:!0,leaves_own:!0,leave_admin:X(),leaves_create:K(),leaves_delete:p("leaves"),can_view_all:X(),can_approve_reject:Q()||Y()||X(),is_super_admin:Q(),permission_level:H}),[ee,te]=i.useState(!1),[ae,se]=i.useState(null),[le,re]=i.useState({status:"approved",rejection_reason:"",comments:""}),[ne,oe]=i.useState(null),[de,ce]=i.useState(null),[ie,xe]=i.useState(!1),pe="/api",me=()=>{const e=localStorage.getItem("userData");if(e){const{user_id:t}=JSON.parse(e);return t}return"6852b84716a499bb6868e6a4"},he=()=>{const e=localStorage.getItem("userData");if(e){const{access_token:t}=JSON.parse(e);return{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}return{"Content-Type":"application/json"}},be=()=>{const e=localStorage.getItem("userData");if(e){const{access_token:t}=JSON.parse(e);return{Authorization:`Bearer ${t}`}}return{}},ue=()=>{const e=x("leaves"),t=Q();let a=!1,s=!1,l=!1;t?(a=!0,s=!0,l=!0):(s=X(),l=Y(),a=l||s);const r={leaves_show:!0,leaves_own:!0,leave_admin:s,leaves_create:K(),leaves_delete:p("leaves"),can_view_all:s,can_approve_reject:a,is_super_admin:t,permission_level:e};return Z(r),r},ge=async()=>{try{w(!0);const e=me();if(!e)return void _e("User ID not found. Please login again.","error");const t=X(),a=Y(),s=Q(),l=new URLSearchParams;l.append("user_id",e),s?l.append("permission_level","superadmin"):t?l.append("permission_level","all"):a?l.append("permission_level","junior"):l.append("permission_level","own"),U.status&&l.append("status",U.status),U.leave_type&&l.append("leave_type",U.leave_type),U.search&&l.append("search",U.search);const r=await fetch(`${pe}/leaves/?${l}`,{headers:he()});if(r.ok){const e=await r.json();y(Array.isArray(e.leaves)?e.leaves:[])}else{const e=await r.json().catch(()=>({}));if(401===r.status)_e("Authentication failed. Please login again.","error");else{if(422!==r.status)throw new Error(`Failed to fetch leaves: ${r.status} - ${e.detail||"Unknown error"}`);_e("Invalid request parameters. Please refresh the page.","error")}}}catch(e){_e("Failed to fetch leaves. Please check your connection.","error"),y([])}finally{w(!1)}},fe=async e=>{try{const t=me();if(!t)return void _e("User not authenticated","error");const a=await fetch(`${pe}/leaves/${e}?user_id=${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(`Failed to delete leave: ${a.status} - ${e.detail||"Unknown error"}`)}return await a.json()}catch(t){throw t}},ve=e=>{q(e),J(e?Ce.map(e=>e.id):[])},ye=()=>{J([]),q(!1),G(!1)},je=async()=>{try{const e=me();if(!e)return;const t=new URLSearchParams;t.append("user_id",e);const a=Q(),s=X(),l=Y();a?t.append("permission_level","superadmin"):s?t.append("permission_level","all"):l?t.append("permission_level","junior"):t.append("permission_level","own");const r=await fetch(`${pe}/leaves/stats/overview?${t}`,{headers:he()});if(r.ok){const e=await r.json();D({pending:e.pending||0,approved:e.approved||0,rejected:e.rejected||0,total:e.total||0})}else D({pending:0,approved:0,rejected:0,total:0})}catch(e){D({pending:0,approved:0,rejected:0,total:0})}},we=(e,t)=>{se(e),re({status:t,rejection_reason:"",comments:""}),te(!0)},Ne=async e=>{if(O&&e)try{const t=me(),a=new URLSearchParams;t&&a.append("user_id",t);const s=new FormData;if(s.append("file",O),!(await fetch(`${pe}/leaves/${e}/attachments?${a}`,{method:"POST",headers:be(),body:s})).ok)throw new Error("Failed to upload attachment");_e("Attachment uploaded successfully","success"),R(null),ge()}catch(t){_e("Failed to upload attachment","error")}},_e=(e,t="info")=>{z({open:!0,message:e,severity:t})},ke=e=>e?new Date(e).toLocaleDateString():"N/A";i.useEffect(()=>{try{ge(),je()}catch(e){"function"==typeof _e&&_e("Failed to load component data","error")}},[U.status,U.leave_type,U.search]),i.useEffect(()=>{try{ue()}catch(e){"function"==typeof _e&&_e("Failed to load permissions","error")}},[]);const Ce=i.useMemo(()=>(()=>{if(!Array.isArray(v))return[];let e=v;return 1===N?e=e.filter(e=>"pending"===e.status):2===N?e=e.filter(e=>"approved"===e.status):3===N&&(e=e.filter(e=>"rejected"===e.status)),e})(),[v,N]);return i.useEffect(()=>{Ce.length>0&&(I.length===Ce.length?q(!0):q(!1))},[I,Ce]),i.useEffect(()=>{n(!0)},[]),s?e.jsxs("div",{className:"min-h-screen bg-black text-white text-base",children:[e.jsxs("div",{className:"flex items-center gap-3 px-2 sm:px-4 lg:px-6 py-6 bg-[#0c1019] border-b-4 border-cyan-400/70 shadow-lg w-full",children:[e.jsx("div",{className:"flex items-center gap-2",children:W.leaves_delete&&e.jsx("div",{className:"flex items-center gap-3",children:M?e.jsxs("div",{className:"flex items-center gap-4 bg-gray-900 rounded-lg p-2",children:[e.jsxs("label",{className:"flex items-center cursor-pointer text-[#03B0F5] font-bold text-sm",children:[e.jsx("input",{type:"checkbox",className:"accent-blue-500 mr-2",checked:V,onChange:e=>ve(e.target.checked),style:{width:16,height:16}}),"Select All"]}),e.jsxs("span",{className:"text-white font-semibold text-sm",children:[I.length," selected"]}),e.jsxs("button",{className:"px-2 py-1 bg-red-600 text-white rounded font-bold hover:bg-red-700 transition text-sm",onClick:async()=>{if(0!==I.length&&window.confirm(`Are you sure you want to delete ${I.length} selected leave(s)?`))try{for(const e of I)await fe(e);_e(`Successfully deleted ${I.length} leave(s)`,"success"),ge(),je(),ye()}catch(e){_e(e.message||"Failed to delete leaves","error")}},disabled:0===I.length,children:["Delete (",I.length,")"]}),e.jsx("button",{className:"px-2 py-1 bg-gray-600 text-white rounded font-bold hover:bg-gray-700 transition text-sm",onClick:ye,children:"Cancel"})]}):e.jsx("button",{className:"bg-[#03B0F5] text-white px-3 sm:px-5 py-1.5 rounded-lg font-bold shadow hover:bg-[#0280b5] transition text-sm sm:text-base",onClick:()=>{G(!0),J([]),q(!1)},children:I.length>0?`Select (${I.length})`:"Select"})})}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(W.leaves_create||W.leaves_own||W.leaves_show)&&e.jsxs("button",{onClick:()=>C(!0),className:"bg-gradient-to-b from-cyan-400 to-blue-700 px-3 sm:px-5 py-1.5 rounded-lg text-white font-bold shadow-lg hover:from-blue-700 hover:to-cyan-400 uppercase tracking-wide transition text-sm sm:text-base flex items-center",children:[e.jsx(t,{className:"mr-2 h-4 w-4"})," APPLY LEAVE"]}),e.jsxs("button",{onClick:()=>{ge(),je()},className:"bg-gradient-to-b from-cyan-400 to-blue-700 px-3 sm:px-5 py-1.5 rounded-lg text-white font-bold shadow-lg hover:from-blue-700 hover:to-cyan-400 uppercase tracking-wide transition text-sm sm:text-base flex items-center",children:[e.jsx(a,{className:"mr-2 h-4 w-4"})," REFRESH"]})]})]}),e.jsxs("div",{className:"px-2 sm:px-4 lg:px-6 py-6",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 gap-6 mb-8",children:u.map(t=>{const a=t.icon,s=$&&"number"==typeof $[t.key]?$[t.key]:0;return e.jsxs("div",{className:`p-4 rounded-xl bg-gradient-to-r ${t.gradient||t.backgroundColor} shadow-lg ${t.shadowColor||"shadow-lg"} flex-1`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(a,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"text-xl font-bold text-white",children:s})]}),e.jsx("p",{className:"mt-4 text-md text-white font-medium uppercase tracking-wide",children:t.label})]},t.key)})}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(o,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#03B0F5]",style:{fontSize:16}}),e.jsx("input",{type:"text",placeholder:"Search leaves...",value:U.search,onChange:e=>T({...U,search:e.target.value}),className:"w-full pl-12 pr-4 py-2 bg-[#1a2332] border border-[#2D3C56] rounded-lg text-white placeholder-gray-400 focus:border-[#03B0F5] focus:outline-none"})]})}),(U.search||U.status||U.leave_type)&&e.jsxs("div",{className:"text-base text-gray-300 bg-[#1b2230] px-4 py-3 rounded-lg border border-gray-600",children:[Ce.length," of ",v.length," leaves",U.search&&e.jsxs("span",{className:"ml-2",children:['matching "',e.jsx("span",{className:"text-cyan-400 font-semibold",children:U.search}),'"']})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:U.status,onChange:e=>T({...U,status:e.target.value}),className:"px-4 py-2 bg-[#1a2332] border border-[#2D3C56] rounded-lg text-white focus:border-[#03B0F5] focus:outline-none",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsxs("select",{value:U.leave_type,onChange:e=>T({...U,leave_type:e.target.value}),className:"px-4 py-2 bg-[#1a2332] border border-[#2D3C56] rounded-lg text-white focus:border-[#03B0F5] focus:outline-none",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"paid_leave",children:"Paid Leave"}),e.jsx("option",{value:"casual_leave",children:"Casual Leave"}),e.jsx("option",{value:"sick_leave",children:"Sick Leave"}),e.jsx("option",{value:"emergency_leave",children:"Emergency Leave"})]})]})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 mb-6 overflow-x-auto",children:[{label:`All Leaves (${$?.total||0})`,value:0},{label:`Pending (${$?.pending||0})`,value:1},{label:`Approved (${$?.approved||0})`,value:2},{label:`Rejected (${$?.rejected||0})`,value:3}].map((t,a)=>e.jsx("button",{className:`\n                flex items-center px-4 py-3 rounded-3xl font-extrabold border shadow-md text-sm sm:text-base transition whitespace-nowrap\n                ${a===N?"bg-[#03B0F5] via-blue-700 to-cyan-500 text-white border-cyan-400 shadow-lg scale-105":"bg-white text-[#03b0f5] border-[#2D3C56] hover:bg-cyan-400/10 hover:text-cyan-400"}\n                focus:outline-none\n              `,onClick:()=>{_(a)},children:t.label},a))}),j&&e.jsx("div",{className:"bg-[#1a2332] border border-[#2D3C56] rounded-lg p-4 mb-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#03B0F5]"}),e.jsx("span",{className:"ml-2 text-[#03B0F5]",children:"Loading leaves..."})]})}),e.jsx("div",{className:"overflow-auto rounded-xl",children:e.jsx("div",{className:"overflow-x-auto bg-transparent rounded-lg",children:e.jsxs("table",{className:"min-w-full w-full bg-transparent",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[W.leaves_delete&&M&&e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider text-left",children:e.jsx("input",{type:"checkbox",className:"accent-blue-500",checked:V,onChange:e=>ve(e.target.checked),style:{width:18,height:18}})}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider text-left",children:"S.No"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider text-left",children:"Employee Name"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider text-left",children:"Leave Type"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider text-left",children:"From"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider text-left",children:"To"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider text-left",children:"Duration"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider text-left",children:"Approved By"}),e.jsx("th",{className:"bg-white px-4 py-3 text-md font-extrabold text-[#03b0f5] uppercase tracking-wider text-left",children:"Status"})]})}),e.jsx("tbody",{className:"bg-transparent",children:0===Ce.length?e.jsx("tr",{children:e.jsx("td",{colSpan:M?"9":"8",className:"py-20 text-center text-gray-400 text-lg bg-transparent",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[j&&e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-xl font-semibold",children:j?"Loading Leaves...":"No leaves found"})]})})}):Ce.map((t,a)=>e.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-900/50 transition cursor-pointer bg-transparent",onClick:()=>(async e=>{try{const t=me(),a=new URLSearchParams;t&&a.append("user_id",t);const s=await fetch(`${pe}/leaves/${e}?${a}`,{headers:he()});if(!s.ok)throw new Error("Failed to fetch leave details");{const e=await s.json();L(e),A(!0),ue()}}catch(t){_e("Failed to load leave details","error")}})(t.id),title:"Click to view leave details",children:[W.leaves_delete&&M&&e.jsx("td",{className:"py-2 px-4 whitespace-nowrap",onClick:e=>e.stopPropagation(),children:e.jsx("input",{type:"checkbox",className:"accent-blue-500",checked:I.includes(t.id),onChange:e=>{return a=t.id,s=e.target.checked,void J(e=>s?[...e,a]:e.filter(e=>e!==a));var a,s},style:{width:18,height:18}})}),e.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:a+1}),e.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-green-500 to-blue-600 flex items-center justify-center text-white font-bold text-sm",children:(t.employee_name||"U").charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-md",children:t.employee_name||"Unknown"}),t.attachments&&t.attachments.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{className:"w-3 h-3 text-green-400"}),e.jsx("span",{className:"text-xs text-green-400",children:"Has Attachment"})]})]})]})}),e.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:e.jsx(g,{leavetype:t.leave_type,label:t.leave_type.replace("_"," ").toUpperCase()})}),e.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:ke(t.from_date)}),e.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:ke(t.to_date)}),e.jsxs("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:[t.duration_days," days"]}),e.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:t.approved_by_name||t.rejected_by_name||"N/A"}),e.jsx("td",{className:"text-md font-semibold py-2 px-4 whitespace-nowrap text-white",children:e.jsx(f,{status:t.status,label:t.status.toUpperCase()})})]},t.id))})]})})})]}),B.open&&e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsx("div",{className:"px-4 py-2 rounded-lg text-white "+("success"===B.severity?"bg-green-600":"error"===B.severity?"bg-red-600":"warning"===B.severity?"bg-orange-600":"bg-blue-600"),children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:B.message}),e.jsx("button",{onClick:()=>z({...B,open:!1}),className:"text-white hover:text-gray-200",children:e.jsx(c,{className:"w-4 h-4"})})]})})}),k&&e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-transparent",style:{backdropFilter:"blur(3px)"},children:e.jsxs("div",{className:"relative bg-white p-6 rounded-xl shadow-2xl w-full max-w-2xl mx-auto space-y-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{className:"absolute right-2 top-2 text-gray-500 hover:text-red-500 transition text-2xl font-bold",onClick:()=>C(!1),"aria-label":"Close",type:"button",children:"×"}),e.jsx("h2",{className:"text-xl font-bold text-green-600 mb-4",children:"APPLY FOR LEAVE"}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),(async()=>{try{const e=me(),t=new URLSearchParams;e&&t.append("user_id",e);const a=await fetch(`${pe}/leaves/?${t}`,{method:"POST",headers:he(),body:JSON.stringify(F)});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Failed to create leave application")}{const e=(await a.json()).id;_e("Leave application submitted successfully","success"),O&&e&&await Ne(e),C(!1),P({leave_type:"paid_leave",from_date:"",to_date:"",reason:"",attachments:[]}),R(null),ge(),je()}}catch(e){_e(e.message,"error")}})()},children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Leave Type"}),e.jsxs("select",{value:F.leave_type,onChange:e=>P({...F,leave_type:e.target.value}),className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold",children:[e.jsx("option",{value:"paid_leave",children:"Paid Leave"}),e.jsx("option",{value:"casual_leave",children:"Casual Leave"}),e.jsx("option",{value:"sick_leave",children:"Sick Leave"}),e.jsx("option",{value:"emergency_leave",children:"Emergency Leave"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Duration"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:`${(()=>{if(F.from_date&&F.to_date){const e=new Date(F.from_date),t=new Date(F.to_date),a=Math.abs(t-e);return Math.ceil(a/864e5)+1}return 0})()} days`,readOnly:!0})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mt-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:F.from_date,onChange:e=>P({...F,from_date:e.target.value}),className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold",required:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:F.to_date,onChange:e=>P({...F,to_date:e.target.value}),className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold",required:!0})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Reason for Leave"}),e.jsx("textarea",{rows:4,value:F.reason,onChange:e=>P({...F,reason:e.target.value}),placeholder:"Please provide a detailed reason for your leave application...",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold resize-none",required:!0})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Attachment"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"inline-flex items-center px-4 py-2 bg-cyan-500 text-white font-bold rounded-lg shadow cursor-pointer hover:bg-cyan-600 transition",children:["Photo/PDF",e.jsx("input",{type:"file",hidden:!0,accept:".pdf,.png,.jpg,.jpeg,.gif,.doc,.docx",onChange:e=>R(e.target.files[0])})]}),O&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600 font-medium",children:[e.jsx(d,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:O.name})]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>C(!1),className:"flex-1 px-6 py-3 bg-gray-400 text-white font-bold rounded-lg shadow hover:bg-gray-500 transition text-lg",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!F.from_date||!F.to_date||!F.reason.trim(),className:"flex-1 px-6 py-3 bg-cyan-600 text-white font-bold rounded-lg shadow hover:bg-cyan-700 transition text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:"Submit Application"})]})]})]})}),S&&E&&e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-transparent",style:{backdropFilter:"blur(3px)"},children:e.jsxs("div",{className:"relative bg-white p-6 rounded-xl shadow-2xl w-full max-w-2xl mx-auto space-y-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{className:"absolute right-2 top-2 text-gray-500 hover:text-red-500 transition text-2xl font-bold",onClick:()=>A(!1),"aria-label":"Close",type:"button",children:"×"}),e.jsx("h2",{className:"text-xl font-bold text-green-600 mb-4",children:"LEAVE APPLICATION DETAILS"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Employee Name"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:E.employee_name||"Unknown",readOnly:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Leave Type"}),e.jsx("div",{className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100 flex items-center",children:e.jsx(g,{leavetype:E.leave_type,label:E.leave_type.replace("_"," ").toUpperCase()})})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:ke(E.from_date),readOnly:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:ke(E.to_date),readOnly:!0})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Duration"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:`${E.duration_days} days`,readOnly:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Status"}),e.jsx("div",{className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100 flex items-center",children:e.jsx(f,{status:E.status,label:E.status.toUpperCase()})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Reason"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100 resize-none",rows:3,value:E.reason,readOnly:!0})]}),E.approved_by_name&&e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Approved By"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:E.approved_by_name,readOnly:!0})]}),E.rejected_by_name&&e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Rejected By"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:E.rejected_by_name,readOnly:!0})]}),E.rejection_reason&&e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Rejection Reason"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-red-400 rounded text-black font-bold bg-red-50 resize-none",rows:2,value:E.rejection_reason,readOnly:!0})]}),E.approval_comments&&e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"approved"===E.status?"Approval Comments":"Comments"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-green-400 rounded text-black font-bold bg-green-50 resize-none",rows:2,value:E.approval_comments,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Applied On"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:ke(E.created_at),readOnly:!0})]}),E.attachments&&E.attachments.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Attachments"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:E.attachments.map((t,a)=>e.jsxs("button",{onClick:()=>(async e=>{try{const t=me(),a=new URLSearchParams;t&&a.append("user_id",t);const s=E?.id,l=e.attachment_id,r=await fetch(`${pe}/leaves/${s}/attachments/${l}?${a}`,{method:"GET",headers:he()});if(!r.ok)throw new Error("Failed to download attachment");{const t=await r.blob(),a=window.URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=e.filename||"attachment",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(a),document.body.removeChild(s),_e("Attachment downloaded successfully","success")}}catch(t){_e("Failed to download attachment","error")}})(t),className:"flex items-center gap-1 bg-cyan-500 hover:bg-cyan-600 text-white px-3 py-2 rounded font-bold transition",children:[e.jsx(d,{className:"w-4 h-4"}),t.filename||`Attachment ${a+1}`]},a))})]}),(()=>{me(),E.employee_id;const e=W.can_approve_reject||W.is_super_admin;return W.permission_level,e})()&&e.jsx("div",{className:"border-t border-gray-300 pt-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>{A(!1),we(E,"approved")},className:"flex-1 px-6 py-3 bg-green-600 text-white font-bold rounded-lg shadow hover:bg-green-700 transition text-lg flex items-center justify-center gap-2",children:[e.jsx(l,{className:"w-5 h-5"}),"Approve"]}),e.jsxs("button",{onClick:()=>{A(!1),we(E,"rejected")},className:"flex-1 px-6 py-3 bg-red-600 text-white font-bold rounded-lg shadow hover:bg-red-700 transition text-lg flex items-center justify-center gap-2",children:[e.jsx(r,{className:"w-5 h-5"}),"Reject"]})]})})]})]})}),ee&&ae&&e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-transparent",style:{backdropFilter:"blur(3px)"},children:e.jsxs("div",{className:"relative bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg mx-auto space-y-6",children:[e.jsx("button",{className:"absolute right-2 top-2 text-gray-500 hover:text-red-500 transition text-2xl font-bold",onClick:()=>te(!1),"aria-label":"Close",type:"button",children:"×"}),e.jsx("h2",{className:"text-xl font-bold text-green-600 mb-4",children:"approved"===le.status?"APPROVE LEAVE":"REJECT LEAVE"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"block font-bold text-gray-700 mb-2",children:"Leave Details"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded border border-gray-300 space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Employee:"})," ",ae.employee_name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Leave Type:"})," ",ae.leave_type.replace("_"," ").toUpperCase()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Duration:"})," ",ae.duration_days," days"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"From:"})," ",ke(ae.from_date)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"To:"})," ",ke(ae.to_date)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Reason:"})," ",ae.reason]})]})]}),"rejected"===le.status&&e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Rejection Reason *"}),e.jsx("textarea",{rows:3,value:le.rejection_reason,onChange:e=>re({...le,rejection_reason:e.target.value}),className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold resize-none",placeholder:"Please provide a reason for rejection...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block font-bold text-gray-700 mb-1",children:["Comments (Optional - for ","approved"===le.status?"approval":"rejection",")"]}),e.jsx("textarea",{rows:2,value:le.comments,onChange:e=>re({...le,comments:e.target.value}),placeholder:"Add any additional comments...",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold resize-none"})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>te(!1),className:"flex-1 px-6 py-3 bg-gray-400 text-white font-bold rounded-lg shadow hover:bg-gray-500 transition text-lg",children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{const e=me(),t=new URLSearchParams;e&&t.append("user_id",e);const a=await fetch(`${pe}/leaves/${ae.id}/approve?${t}`,{method:"POST",headers:he(),body:JSON.stringify(le)});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Failed to process leave application")}{const e="approved"===le.status?"approved":"rejected";_e(`Leave application ${e} successfully`,"success"),te(!1),se(null),re({status:"approved",rejection_reason:"",comments:""}),ge(),je()}}catch(e){_e(e.message,"error")}},disabled:"rejected"===le.status&&!le.rejection_reason.trim(),className:"flex-1 px-6 py-3 text-white font-bold rounded-lg shadow transition text-lg disabled:opacity-50 disabled:cursor-not-allowed "+("approved"===le.status?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:"approved"===le.status?"Approve":"Reject"})]})]})]})}),ie&&e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-transparent",style:{backdropFilter:"blur(3px)"},children:e.jsxs("div",{className:"relative bg-white p-6 rounded-xl shadow-2xl w-full max-w-md mx-auto space-y-6",children:[e.jsx("button",{className:"absolute right-2 top-2 text-gray-500 hover:text-red-500 transition text-2xl font-bold",onClick:()=>xe(!1),"aria-label":"Close",type:"button",children:"×"}),e.jsx("h2",{className:"text-xl font-bold text-green-600 mb-4",children:"UPLOAD ATTACHMENT"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded border border-gray-300",children:e.jsx("p",{className:"text-sm text-gray-700 font-medium",children:"Upload your attachment for the leave application. Supported formats: PDF, PNG, JPG, DOCX."})}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Choose File"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"inline-flex items-center px-4 py-2 bg-cyan-500 text-white font-bold rounded-lg shadow cursor-pointer hover:bg-cyan-600 transition",children:["Photo/PDF",e.jsx("input",{type:"file",hidden:!0,accept:".pdf,.png,.jpg,.jpeg,.doc,.docx",onChange:e=>ce(e.target.files[0])})]}),de&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600 font-medium",children:[e.jsx(d,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:de.name})]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>xe(!1),className:"flex-1 px-6 py-3 bg-gray-400 text-white font-bold rounded-lg shadow hover:bg-gray-500 transition text-lg",children:"Cancel"}),e.jsx("button",{onClick:async()=>{ne&&de&&(await Ne(ne),xe(!1))},disabled:!de,className:"flex-1 px-6 py-3 bg-cyan-600 text-white font-bold rounded-lg shadow hover:bg-cyan-700 transition text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:"Upload Attachment"})]})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#03B0F5] mx-auto mb-4"}),e.jsx("p",{className:"text-[#03B0F5]",children:"Loading Leave Management..."})]})})};export{v as default};
