import{j as e}from"./vendor-mui-C1GmDdcn.js";import{r as t}from"./vendor-react-EzoxUMNY.js";import{i as s,g as a,r as n,aD as l,aE as r,X as i,ad as o,s as c,aF as d,b as x,a3 as m,aG as g,ab as p,ai as h,ao as u,ap as b,t as y,ar as f,Z as j,aH as w,aI as v}from"./lead-components-dsVEQyTM.js";import"./vendor-utils-QXd9EeNt.js";import"./vendor-antd-BB3a0mYC.js";const N="/api",_=e=>e?e.startsWith("https://rupiyamaker.com:8049/")?`/api/${e.replace("https://rupiyamaker.com:8049/","")}`:e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/media/")?`/api${e}`:e.startsWith("/")?e:`/api/media/app-images/${e}`:null,k=()=>{const[k,C]=t.useState([]),[E,S]=t.useState(!0),[A,I]=t.useState(null),[$,L]=t.useState(!1),[z,B]=t.useState(!1),[F,P]=t.useState(!1),[T,D]=t.useState(!1),[M,U]=t.useState(!1),[O,R]=t.useState(!1),[G,J]=t.useState(null),[W,H]=t.useState([]),[V,Y]=t.useState([]),[K,Z]=t.useState(!1),[q,Q]=t.useState({expires_in_days:7,max_access_count:999,notes:""}),[X,ee]=t.useState(null),[te,se]=t.useState(null),[ae,ne]=t.useState(null),[le,re]=t.useState(!1),[ie,oe]=t.useState(null),[ce,de]=t.useState(!1),xe=t.useRef(null),[me,ge]=t.useState(new Map);t.useEffect(()=>{const e=setInterval(()=>{ge(e=>{const t=new Map;return e.forEach((e,s)=>{e&&!e.closed&&t.set(s,e)}),t})},3e3);return()=>clearInterval(e)},[]);const[pe,he]=t.useState(""),[ue,be]=t.useState(!1),[ye,fe]=t.useState(""),[je,we]=t.useState(""),[ve,Ne]=t.useState({title:"",description:"",image_url:"",html_content:"",is_active:!0}),[_e,ke]=t.useState({allowed_roles:[]}),Ce=s(a())||n(a(),"apps","*")||n(a(),"apps","manage");t.useEffect(()=>{Ee(),Se()},[]),t.useEffect(()=>{const e=e=>{xe.current&&!xe.current.contains(e.target)&&oe(null)};return ie&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[ie]),t.useEffect(()=>{const e=()=>{const e=localStorage.getItem("token"),t=localStorage.getItem("userId");e||t||(me.forEach((e,t)=>{if(e&&!e.closed)try{e.close()}catch(s){}}),ge(new Map))},t=setInterval(e,3e3),s=t=>{"token"!==t.key&&"userId"!==t.key||t.newValue||setTimeout(e,500)};return window.addEventListener("storage",s),()=>{clearInterval(t),window.removeEventListener("storage",s),me.forEach((e,t)=>{if(e&&!e.closed)try{e.close()}catch(s){}})}},[me]),t.useEffect(()=>{const e=e=>{ue&&!e.target.closest(".role-dropdown")&&(be(!1),fe(""))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[ue]);const Ee=async()=>{try{S(!0);const e=l(),t=await r(`${N}/apps?user_id=${e}`),s=await t.json();s.apps&&s.apps.length>0&&s.apps.forEach(e=>{e.image_url}),C(s.apps||[])}catch(e){I("Failed to load apps")}finally{S(!1)}},Se=async()=>{try{const e=l(),t=await r(`${N}/app-roles?user_id=${e}`),s=await t.json();H(s.roles||[])}catch(e){H([])}},Ae=pe?k.filter(e=>e.allowed_roles&&e.allowed_roles.includes(pe)):k,Ie=W.filter(e=>e.name&&e.name.toLowerCase().includes(ye.toLowerCase())),$e=()=>{if(!pe)return"All Roles";const e=W.find(e=>e._id===pe||e.id===pe);return e?.name||"Unknown Role"},Le=e=>{const t=e.target.files[0];if(t){if(!t.type.startsWith("image/"))return void I("Please select a valid image file");if(t.size>5242880)return void I("Image size should be less than 5MB");se(t);const e=new FileReader;e.onloadend=()=>{ne(e.result)},e.readAsDataURL(t)}},ze=async e=>{const t=new FormData;t.append("image",e);try{re(!0);const e=l(),s=await r(`${N}/upload-image?user_id=${e}`,{method:"POST",body:t});if(s.ok)return(await s.json()).image_url;{const e=await s.json();throw new Error(e.message||"Failed to upload image")}}catch(s){throw s}finally{re(!1)}},Be=()=>{Ne({title:"",description:"",image_url:"",html_content:"",is_active:!0}),se(null),ne(null)},Fe=async e=>{try{Z(!0);const t=l(),s=await r(`${N}/app-share-links/app/${e}?user_id=${t}`);if(s.ok){const e=await s.json();Y(e||[])}}catch(t){Y([])}finally{Z(!1)}},Pe=()=>je.trim()?W.filter(e=>e.name&&e.name.toLowerCase().includes(je.toLowerCase())):W,Te=()=>{const e=Pe();return 0!==e.length&&e.every(e=>_e.allowed_roles.includes(e.id))};return M&&G?e.jsxs("div",{className:"min-h-screen bg-transparent",children:[e.jsx("div",{className:"bg-gray-900 border-b border-gray-700 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{U(!1),J(null)},className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[e.jsx(i,{size:16}),"Back to Apps"]}),e.jsx("h1",{className:"text-xl font-bold text-white",children:G.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full "+(G.is_active?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:"text-sm text-gray-400",children:G.is_active?"Active":"Inactive"})]})]})}),e.jsx("div",{className:"h-[calc(100vh-80px)]",children:e.jsx("iframe",{srcDoc:G.html_content,className:"w-full h-full border-0",sandbox:"allow-scripts allow-same-origin allow-popups allow-forms",title:`App: ${G.title}`,style:{backgroundColor:"white"}})})]}):E?e.jsx("div",{className:"min-h-screen bg-transparent text-white py-10 px-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#08B8EA] mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-[#08B8EA]",children:"Loading apps..."})]})})})}):e.jsx("div",{className:"min-h-screen bg-transparent text-white py-10 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl text-[#08B8EA]"}),e.jsx("div",{})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative role-dropdown",children:[e.jsxs("button",{className:(pe?"bg-[#08B8EA] hover:bg-[#12d8fa] border-[#08B8EA]":"bg-gray-700 hover:bg-gray-600 border-gray-600")+" text-white px-4 py-2 rounded-lg flex items-center gap-2 min-w-[200px] justify-between border transition-colors",onClick:()=>be(!ue),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{size:16}),e.jsx("span",{className:"text-sm",children:$e()}),pe&&e.jsx("span",{className:"text-xs bg-white bg-opacity-20 px-1.5 py-0.5 rounded",children:Ae.length})]}),e.jsx("svg",{className:"w-4 h-4 transition-transform "+(ue?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),ue&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 w-full bg-gray-800 border border-gray-600 rounded-lg shadow-lg z-50 max-h-60 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-gray-600",children:e.jsx("input",{type:"text",placeholder:"Search roles...",value:ye,onChange:e=>fe(e.target.value),onKeyDown:e=>{"Escape"===e.key&&(be(!1),fe(""))},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 text-sm focus:outline-none focus:border-[#08B8EA]",autoFocus:!0})}),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-700 transition-colors text-sm "+(pe?"text-white":"bg-gray-700 text-[#08B8EA]"),onClick:()=>{he(""),be(!1),fe("")},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"All Roles"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[k.length," app",1!==k.length?"s":""]})]})}),Ie.length>0?Ie.map(t=>{const s=t._id||t.id,a=k.filter(e=>e.allowed_roles&&e.allowed_roles.includes(s)).length;return e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-700 transition-colors text-sm "+(pe===(t._id||t.id)?"bg-gray-700 text-[#08B8EA]":"text-white"),onClick:()=>{(e=>{he(e),be(!1),fe("")})(t._id||t.id,t.name)},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:t.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:[a," app",1!==a?"s":""]})]})},t._id||t.id)}):e.jsx("div",{className:"px-4 py-2 text-gray-400 text-sm",children:ye?"No roles found":"No roles available"})]})]})]}),Ce&&e.jsxs("button",{className:"bg-[#08B8EA] hover:bg-[#12d8fa] text-white text-xl font-bold px-7 py-2 rounded-2xl shadow-lg transition transform hover:scale-105 flex items-center gap-2",onClick:()=>L(!0),children:[e.jsx(c,{size:24}),"Create App"]})]})]}),A&&e.jsx("div",{className:"mb-6 p-4 bg-red-900 border border-red-600 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-red-200",children:A}),e.jsx("button",{onClick:()=>I(null),className:"text-red-300 hover:text-red-100 text-xl font-bold",children:"Ã—"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ae.length>0?Ae.map(t=>e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg overflow-visible hover:border-[#08B8EA] transition-colors relative",children:[Ce&&e.jsxs("div",{className:"absolute top-4 right-4 z-30",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),oe(ie===t.id?null:t.id)},className:"bg-gray-800 bg-opacity-90 hover:bg-opacity-100 text-white p-2 rounded-full shadow-lg transition",children:e.jsx(d,{size:20})}),ie===t.id&&e.jsxs("div",{ref:xe,className:"absolute right-0 mt-2 w-56 bg-gray-800 border border-gray-600 rounded-lg shadow-2xl z-40 overflow-hidden",style:{boxShadow:"0 10px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(8, 184, 234, 0.2)"},children:[e.jsxs("button",{onClick:e=>{e.stopPropagation(),(e=>{J(e),Ne({title:e.title,description:e.description||"",image_url:e.image_url||"",html_content:e.html_content,is_active:e.is_active}),ne(_(e.image_url)||null),se(null),B(!0)})(t),oe(null)},className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-3 transition-colors duration-150 first:rounded-t-lg",children:[e.jsx(x,{size:16}),e.jsx("span",{children:"Edit"})]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),J(t),Ne({...ve,image_url:t.image_url||""}),de(!0),oe(null)},className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-3 transition-colors duration-150 border-t border-gray-700",children:[e.jsx(m,{size:16}),e.jsx("span",{children:"Change Image"})]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),(e=>{J(e),ke({allowed_roles:e.allowed_roles||[]}),P(!0)})(t),oe(null)},className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-3 transition-colors duration-150 border-t border-gray-700",children:[e.jsx(o,{size:16}),e.jsx("span",{children:"Permissions"})]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),(async e=>{J(e),R(!0),await Fe(e.id)})(t),oe(null)},className:"w-full text-left px-4 py-3 hover:bg-gray-700 text-white flex items-center gap-3 transition-colors duration-150 border-t border-gray-700",children:[e.jsx(g,{size:16}),e.jsx("span",{children:"Share Links"})]}),e.jsxs("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(confirm("Are you sure you want to delete this app?"))try{const t=l(),s=await r(`${N}/apps/${e}?user_id=${t}`,{method:"DELETE"});if(s.ok)await Ee();else{const e=await s.json();I(e.message||"Failed to delete app")}}catch(t){I("Failed to delete app")}})(t.id),oe(null)},className:"w-full text-left px-4 py-3 hover:bg-red-600 text-red-400 hover:text-white flex items-center gap-3 transition-colors duration-150 border-t border-gray-700 rounded-b-lg",children:[e.jsx(p,{size:16}),e.jsx("span",{children:"Delete"})]})]})]}),e.jsxs("div",{onClick:()=>(e=>{try{const t=e.html_content&&e.html_content.trim().toLowerCase().includes("<html"),s=e.html_content&&e.html_content.trim().toLowerCase().includes("<!doctype");let a;if(t||s){const t=e.html_content.lastIndexOf("</body>");a=-1!==t?e.html_content.substring(0,t)+`\n  <script>\n    // Update title\n    document.title = '${e.title}';\n    \n    // Monitor authentication state and auto-close on logout\n    function checkParentAuth() {\n      try {\n        const token = localStorage.getItem('token');\n        const userId = localStorage.getItem('userId');\n        if (!token && !userId) {\n          console.log('Logout detected in app tab, closing window...');\n          window.close();\n        }\n      } catch (error) {\n        console.log('Cannot access parent authentication, closing tab...');\n        window.close();\n      }\n    }\n    \n    // Check authentication every 2 seconds\n    setInterval(checkParentAuth, 2000);\n    \n    // Listen for storage changes (logout events)\n    window.addEventListener('storage', function(e) {\n      if ((e.key === 'token' || e.key === 'userId') && !e.newValue) {\n        setTimeout(() => {\n          console.log('Storage change detected - authentication removed, closing tab...');\n          window.close();\n        }, 1000);\n      }\n    });\n  <\/script>\n          `+e.html_content.substring(t):e.html_content+`\n  <script>\n    document.title = '${e.title}';\n    function checkParentAuth() {\n      try {\n        const token = localStorage.getItem('token');\n        const userId = localStorage.getItem('userId');\n        if (!token && !userId) {\n          window.close();\n        }\n      } catch (error) {\n        window.close();\n      }\n    }\n    setInterval(checkParentAuth, 2000);\n    window.addEventListener('storage', function(e) {\n      if ((e.key === 'token' || e.key === 'userId') && !e.newValue) {\n        setTimeout(() => window.close(), 1000);\n      }\n    });\n  <\/script>`}else a=`<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${e.title}</title>\n  <style>\n    body {\n      margin: 0;\n      padding: 0;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', sans-serif;\n    }\n    .no-content {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100vh;\n      text-align: center;\n      color: #666;\n      font-size: 1.1rem;\n      flex-direction: column;\n    }\n  </style>\n</head>\n<body>\n  ${e.html_content||'<div class="no-content"><h2>No content available</h2><p>This app does not have any content to display.</p></div>'}\n  \n  <script>\n    // Monitor authentication state and auto-close on logout\n    function checkParentAuth() {\n      try {\n        const token = localStorage.getItem('token');\n        const userId = localStorage.getItem('userId');\n        if (!token && !userId) {\n          console.log('Logout detected in app tab, closing window...');\n          window.close();\n        }\n      } catch (error) {\n        console.log('Cannot access parent authentication, closing tab...');\n        window.close();\n      }\n    }\n    \n    // Check authentication every 2 seconds\n    setInterval(checkParentAuth, 2000);\n    \n    // Listen for storage changes (logout events)  \n    window.addEventListener('storage', function(e) {\n      if ((e.key === 'token' || e.key === 'userId') && !e.newValue) {\n        setTimeout(() => {\n          console.log('Storage change detected - authentication removed, closing tab...');\n          window.close();\n        }, 1000);\n      }\n    });\n  <\/script>\n</body>\n</html>`;const n=new Blob([a],{type:"text/html"}),l=URL.createObjectURL(n),r=window.open(l,"_blank","noopener,noreferrer");if(r){setTimeout(()=>{URL.revokeObjectURL(l)},2e3),ge(t=>{const s=new Map(t);return s.set(e.id,r),s});const t=setInterval(()=>{r.closed&&(clearInterval(t),ge(t=>{const s=new Map(t);return s.delete(e.id),s}))},5e3)}else{const t="data:text/html;charset=utf-8,"+encodeURIComponent(a),s=window.open(t,"_blank");s?ge(t=>{const a=new Map(t);return a.set(e.id,s),a}):alert("Please enable pop-ups for this site to open apps in new tabs.")}}catch(t){alert("Error opening app: "+t.message)}})(t),className:"cursor-pointer",children:[e.jsx("div",{className:"w-full h-48 bg-gray-800 overflow-hidden flex items-center justify-center",children:t.image_url?e.jsx("img",{src:_(t.image_url),alt:t.title,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none",e.target.parentElement.innerHTML='<div class="flex flex-col items-center justify-center h-full text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg><span class="mt-2 text-sm">Image Not Available</span></div>'}}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-500",children:[e.jsx(m,{size:48,strokeWidth:1.5}),e.jsx("span",{className:"mt-2 text-sm",children:"No Image"})]})}),e.jsxs("div",{className:"p-6 pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 pr-8",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:t.title}),t.description&&e.jsx("p",{className:"text-gray-400 text-sm",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full "+(t.is_active?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:"text-xs text-gray-400",children:t.is_active?"Active":"Inactive"})]})]}),me.has(t.id)&&me.get(t.id)&&!me.get(t.id).closed&&e.jsxs("div",{className:"flex items-center gap-1 bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs w-fit",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Tab Open"]})]})]}),Ce&&t.allowed_roles&&t.allowed_roles.length>0&&e.jsxs("div",{className:"px-6 pb-4 pt-2 border-t border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"Allowed Roles:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.allowed_roles.map(t=>{const s=W.find(e=>e.id===t);return e.jsx("span",{className:"bg-gray-700 text-gray-300 px-2 py-1 rounded text-xs",children:s?.name||`Role ${t}`},t)})})]})]},t.id)):e.jsxs("div",{className:"col-span-full text-center py-20",children:[e.jsx(h,{size:64,className:"mx-auto text-gray-600 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-400 mb-2",children:pe?"No Apps Found for Selected Role":"No Apps Yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:pe?`No apps are assigned to the selected role "${$e()}"`:"Create your first app to get started"}),!pe&&Ce&&e.jsx("button",{onClick:()=>L(!0),className:"bg-[#08B8EA] hover:bg-[#12d8fa] text-white px-6 py-3 rounded-lg",children:"Create First App"})]})}),($||z)&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-transparent bg-opacity-50",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:$?"Create New App":"Edit App"}),e.jsx("button",{onClick:()=>{L(!1),B(!1),Be(),J(null)},className:"text-gray-400 hover:text-white",children:e.jsx(i,{size:24})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"App Title"}),e.jsx("input",{type:"text",value:ve.title,onChange:e=>Ne({...ve,title:e.target.value}),className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-[#08B8EA]",placeholder:"Enter app title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description (Optional)"}),e.jsx("input",{type:"text",value:ve.description,onChange:e=>Ne({...ve,description:e.target.value}),className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-[#08B8EA]",placeholder:"Enter app description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"App Image"}),ae&&e.jsxs("div",{className:"relative w-full h-48 bg-gray-800 rounded-lg border border-gray-600 overflow-hidden mb-3",children:[e.jsx("img",{src:ae,alt:"App preview",className:"w-full h-full object-contain"}),e.jsx("button",{type:"button",onClick:()=>{ne(null),se(null),Ne({...ve,image_url:""})},className:"absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white p-2 rounded-full transition-colors",children:e.jsx(i,{size:16})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("label",{className:"flex-1 bg-gray-800 hover:bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 cursor-pointer transition-colors flex items-center justify-center gap-2",children:[e.jsx(u,{size:16}),e.jsx("span",{children:te?"Change Image":"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:Le,className:"hidden"})]})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Supported formats: JPG, PNG, GIF (Max 5MB)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"HTML Content"}),e.jsx("textarea",{value:ve.html_content,onChange:e=>Ne({...ve,html_content:e.target.value}),className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-[#08B8EA] font-mono text-sm",rows:15,placeholder:"Enter HTML content here..."})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:ve.is_active,onChange:e=>Ne({...ve,is_active:e.target.checked}),className:"mr-2"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm text-gray-300",children:"Active"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 mt-6",children:[e.jsx("button",{onClick:()=>{L(!1),B(!1),Be(),J(null)},className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg",disabled:le,children:"Cancel"}),e.jsx("button",{onClick:$?async()=>{try{let e=ve.image_url;te&&(e=await ze(te));const t=l(),s=await r(`${N}/apps?user_id=${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...ve,image_url:e})});if(s.ok)await Ee(),L(!1),Be();else{const e=await s.json();I(e.message||"Failed to create app")}}catch(e){I("Failed to create app")}}:async()=>{try{let e=ve.image_url;te&&(e=await ze(te));const t=l(),s=await r(`${N}/apps/${G.id}?user_id=${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...ve,image_url:e})});if(s.ok)await Ee(),B(!1),Be(),J(null);else{const e=await s.json();I(e.message||"Failed to update app")}}catch(e){I("Failed to update app")}},disabled:le,className:"bg-[#08B8EA] hover:bg-[#12d8fa] text-white px-4 py-2 rounded-lg flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:le?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{size:16}),$?"Create":"Update"]})})]})]})}),ce&&G&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-transparent bg-opacity-50",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Change App Image"}),e.jsx("button",{onClick:()=>{de(!1),J(null),se(null),ne(null)},className:"text-gray-400 hover:text-white",children:e.jsx(i,{size:24})})]}),e.jsxs("div",{className:"space-y-4",children:[G.image_url&&!ae&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Current Image"}),e.jsx("div",{className:"relative w-full h-48 bg-gray-800 rounded-lg border border-gray-600 overflow-hidden",children:e.jsx("img",{src:_(G.image_url),alt:G.title,className:"w-full h-full object-contain",onError:e=>{e.target.onerror=null,e.target.src="",e.target.alt="Failed to load image"}})})]}),ae&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"New Image Preview"}),e.jsxs("div",{className:"relative w-full h-48 bg-gray-800 rounded-lg border border-gray-600 overflow-hidden",children:[e.jsx("img",{src:ae,alt:"Preview",className:"w-full h-full object-contain"}),e.jsx("button",{type:"button",onClick:()=>{ne(null),se(null)},className:"absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white p-2 rounded-full",children:e.jsx(i,{size:16})})]})]}),e.jsxs("label",{className:"w-full bg-gray-800 hover:bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 cursor-pointer transition-colors flex items-center justify-center gap-2",children:[e.jsx(u,{size:20}),e.jsx("span",{children:te?"Change Image":"Upload New Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:Le,className:"hidden"})]}),e.jsx("p",{className:"text-xs text-gray-400 text-center",children:"Supported formats: JPG, PNG, GIF (Max 5MB)"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 mt-6",children:[e.jsx("button",{onClick:()=>{de(!1),J(null),se(null),ne(null)},className:"bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded-lg",disabled:le,children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{let e=G.image_url;te&&(e=await ze(te));const t=l(),s=await r(`${N}/apps/${G.id}?user_id=${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:G.title,description:G.description,image_url:e,html_content:G.html_content,is_active:G.is_active})});if(s.ok)await Ee(),de(!1),J(null),se(null),ne(null);else{const e=await s.json();I(e.message||"Failed to update image")}}catch(e){I("Failed to update image")}},disabled:le||!te,className:"bg-[#08B8EA] hover:bg-[#12d8fa] text-white px-6 py-2 rounded-lg flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:le?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{size:16}),"Save Image"]})})]})]})}),F&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-transparent bg-opacity-50",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-6 w-full max-w-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"App Permissions"}),e.jsx("button",{onClick:()=>{P(!1),J(null),ke({allowed_roles:[]}),we("")},className:"text-gray-400 hover:text-white",children:e.jsx(i,{size:24})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Select which roles can access this app:"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search roles...",value:je,onChange:e=>we(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-[#08B8EA]"})]})}),Pe().length>0&&e.jsx("div",{className:"mb-3 pb-3 border-b border-gray-600",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:Te(),onChange:()=>{const e=Pe().map(e=>e.id),t=e.every(e=>_e.allowed_roles.includes(e));ke(t?t=>({...t,allowed_roles:t.allowed_roles.filter(t=>!e.includes(t))}):t=>({...t,allowed_roles:[...new Set([...t.allowed_roles,...e])]}))},className:"mr-3"}),e.jsxs("span",{className:"text-white font-medium",children:[Te()?"Deselect All":"Select All",je&&` (${Pe().length} filtered)`]})]})}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:Pe().length>0?Pe().map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:_e.allowed_roles.includes(t.id),onChange:()=>{return e=t.id,void ke(t=>({...t,allowed_roles:t.allowed_roles.includes(e)?t.allowed_roles.filter(t=>t!==e):[...t.allowed_roles,e]}));var e},className:"mr-3"}),e.jsx("span",{className:"text-white",children:t.name})]},t.id)):e.jsx("div",{className:"text-gray-400 text-center py-4",children:je?"No roles found matching your search":"No roles available"})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4",children:[e.jsx("button",{onClick:()=>{P(!1),J(null),ke({allowed_roles:[]}),we("")},className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:async()=>{try{const e=l(),t=await r(`${N}/apps/${G.id}/permissions?user_id=${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(_e)});if(t.ok)await Ee(),P(!1),J(null),ke({allowed_roles:[]});else{const e=await t.json();I(e.message||"Failed to update permissions")}}catch(e){I("Failed to update permissions")}},className:"bg-[#08B8EA] hover:bg-[#12d8fa] text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[e.jsx(b,{size:16}),"Save Permissions"]})]})]})}),O&&G&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(g,{size:24,className:"text-[#08B8EA]"}),'Share Links for "',G.title,'"']}),e.jsx("button",{onClick:()=>{R(!1),J(null),Y([]),Q({expires_in_days:7,max_access_count:999,notes:""})},className:"text-gray-400 hover:text-white",children:e.jsx(i,{size:24})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-800 rounded-lg border border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Create New Share Link"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Expires in (days)"}),e.jsx("input",{type:"number",min:"1",max:"365",value:q.expires_in_days,onChange:e=>Q({...q,expires_in_days:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-[#08B8EA]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Max Access Count"}),e.jsx("input",{type:"number",min:"1",value:q.max_access_count,onChange:e=>Q({...q,max_access_count:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-[#08B8EA]"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:q.notes,onChange:e=>Q({...q,notes:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-[#08B8EA]",rows:"2",placeholder:"Add notes about this share link..."})]}),e.jsxs("button",{onClick:async()=>{try{const e=l(),t=window.location.origin,s=await r(`${N}/app-share-links/create?user_id=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({app_id:G.id,expires_in_days:parseInt(q.expires_in_days),max_access_count:parseInt(q.max_access_count),base_url:t,notes:q.notes||null})});if(s.ok)await Fe(G.id),Q({expires_in_days:7,max_access_count:999,notes:""});else{const e=await s.json();I(e.detail||"Failed to create share link")}}catch(e){I("Failed to create share link")}},className:"bg-[#08B8EA] hover:bg-[#12d8fa] text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[e.jsx(c,{size:16}),"Generate Share Link"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Existing Share Links"}),K?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#08B8EA] mx-auto"}),e.jsx("p",{className:"text-gray-400 mt-2",children:"Loading share links..."})]}):0===V.length?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(g,{size:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No share links created yet"})]}):e.jsx("div",{className:"space-y-3",children:V.map(t=>{const s=(a=t.share_token,`${window.location.origin}/public/app/${a}`);var a;const n=new Date(t.expires_at)<new Date,i=t.access_count>=t.max_access_count;return e.jsxs("div",{className:"p-4 rounded-lg border "+(!t.is_active||n||i?"bg-gray-800 bg-opacity-50 border-gray-700 opacity-60":"bg-gray-800 border-gray-700"),children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-2 py-1 text-xs rounded "+(!t.is_active||n||i?"bg-red-500 bg-opacity-20 text-red-400":"bg-green-500 bg-opacity-20 text-green-400"),children:t.is_active?n?"Expired":i?"Max Reached":"Active":"Deactivated"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Created: ",new Date(t.created_at).toLocaleDateString()]}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Expires: ",new Date(t.expires_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-900 p-2 rounded border border-gray-600",children:[e.jsx("input",{type:"text",value:s,readOnly:!0,className:"flex-1 bg-transparent text-sm text-gray-300 outline-none"}),e.jsx("button",{onClick:()=>{return e=s,a=t.share_token,void navigator.clipboard.writeText(e).then(()=>{ee(a),setTimeout(()=>ee(null),2e3)});var e,a},className:"text-[#08B8EA] hover:text-[#12d8fa] p-1",title:"Copy link",children:X===t.share_token?e.jsx("span",{className:"text-green-400 text-xs",children:"Copied!"}):e.jsx(f,{size:16})}),e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-[#08B8EA] hover:text-[#12d8fa] p-1",title:"Open in new tab",children:e.jsx(j,{size:16})})]}),t.notes&&e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Note: ",t.notes]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-400",children:[e.jsxs("span",{children:["Accesses: ",t.access_count," / ",t.max_access_count]}),t.last_accessed_at&&e.jsxs("span",{children:["Last accessed: ",new Date(t.last_accessed_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>(async(e,t)=>{try{const s=l(),a=await r(`${N}/app-share-links/${e}/toggle?user_id=${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_active:!t})});if(a.ok)await Fe(G.id);else{const e=await a.json();I(e.detail||"Failed to toggle share link")}}catch(s){I("Failed to toggle share link")}})(t.share_token,t.is_active),className:"flex items-center gap-1 px-3 py-1 rounded text-xs "+(t.is_active?"bg-yellow-500 bg-opacity-20 text-yellow-400 hover:bg-opacity-30":"bg-green-500 bg-opacity-20 text-green-400 hover:bg-opacity-30"),title:t.is_active?"Deactivate link":"Reactivate link",children:[t.is_active?e.jsx(w,{size:14}):e.jsx(v,{size:14}),t.is_active?"Deactivate":"Activate"]}),e.jsxs("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this share link?"))try{const t=l(),s=await r(`${N}/app-share-links/${e}?user_id=${t}`,{method:"DELETE"});if(s.ok)await Fe(G.id);else{const e=await s.json();I(e.detail||"Failed to delete share link")}}catch(t){I("Failed to delete share link")}})(t.share_token),className:"bg-red-500 bg-opacity-20 text-red-400 hover:bg-opacity-30 px-3 py-1 rounded text-xs flex items-center gap-1",title:"Delete link",children:[e.jsx(p,{size:14}),"Delete"]})]})]})]},t.id)})})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>{R(!1),J(null),Y([])},className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg",children:"Close"})})]})})]})})};export{k as default};
