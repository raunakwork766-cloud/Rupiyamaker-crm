import{j as e}from"./vendor-mui-C1GmDdcn.js";import{r}from"./vendor-react-EzoxUMNY.js";import"./vendor-utils-QXd9EeNt.js";import"./vendor-antd-BB3a0mYC.js";function o({process:o,onSave:s,lead:a,canEdit:n=!0}){const t=o||a?.dynamic_fields?.process||{},l=[{_id:"PL",name:"PL (Personal Loan)"},{_id:"OD",name:"OD (Overdraft)"},{_id:"CC",name:"CC (Credit Card)"},{_id:"BL",name:"BL (Business Loan)"},{_id:"HL",name:"HL (Home Loan)"},{_id:"LAP",name:"LAP (Loan Against Property)"},{_id:"AL",name:"AL (Auto Loan / Car Loan)"},{_id:"EL",name:"EL (Education Loan)"},{_id:"GL",name:"GL (Gold Loan)"},{_id:"LOC",name:"LOC (Loan On Credit Card)"},{_id:"CD",name:"CD (Consumer Durable Loan)"},{_id:"APP_LOAN",name:"APP LOAN"},{_id:"INSURANCE",name:"INSURANCE"}],[d,i]=r.useState(l),[c,u]=r.useState(null),[p,m]=r.useState([]),[_,f]=r.useState(!1),[g,h]=r.useState(!1),[x,y]=r.useState(""),[b,w]=r.useState(""),[v,N]=r.useState(!1),j=r.useRef(null),T=e=>{if(!e)return"";const r=parseFloat(e.toString().replace(/[^\d.-]/g,""));return isNaN(r)?e:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(r)},L=e=>e?e.toString().replace(/[^\d.-]/g,""):"",C=e=>{if(!e)return"";const r=parseInt(e)||0,o=Math.floor(r/12),s=r%12;return o>0&&s>0?`${o} years ${s} months`:o>0?`${o} years`:s>0?`${s} months`:""},[q,k]=r.useState({processingBank:t.processing_bank||a?.dynamic_fields?.process?.processing_bank||"",loanAmountRequired:t.loan_amount_required?T(t.loan_amount_required):a?.dynamic_fields?.process?.loan_amount_required?T(a.dynamic_fields.process.loan_amount_required):"",purposeOfLoan:t.purpose_of_loan||a?.dynamic_fields?.process?.purpose_of_loan||"",howToProcess:t.how_to_process||a?.dynamic_fields?.process?.how_to_process||"",loanType:t.loan_type||a?.dynamic_fields?.process?.loan_type||"",requiredTenure:t.required_tenure?`${t.required_tenure} months`:a?.dynamic_fields?.process?.required_tenure?`${a.dynamic_fields.process.required_tenure} months`:"",caseType:t.case_type||a?.dynamic_fields?.process?.case_type||"",year:t.required_tenure?C(t.required_tenure):a?.dynamic_fields?.process?.required_tenure?C(a.dynamic_fields.process.required_tenure):""}),O="block font-bold mb-2 uppercase",A={color:"black",fontWeight:650,fontSize:"15px"},S=r.useRef(null),P=r.useRef(null),I=e=>{e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)},R=(e,r)=>{const o="howToProcess"===e||"purposeOfLoan"===e?r.toUpperCase():r;k(r=>({...r,[e]:o})),"howToProcess"===e&&S.current&&setTimeout(()=>{I(S.current)},0),"purposeOfLoan"===e&&P.current&&setTimeout(()=>{I(P.current)},0)};r.useEffect(()=>{const e=o||a?.process_data||a?.dynamic_fields?.process||{},r=e.required_tenure||a?.process_data?.required_tenure||a?.dynamic_fields?.process?.required_tenure;k({processingBank:e.processing_bank||a?.process_data?.processing_bank||a?.dynamic_fields?.process?.processing_bank||"",loanAmountRequired:e.loan_amount_required?T(e.loan_amount_required):a?.process_data?.loan_amount_required?T(a.process_data.loan_amount_required):a?.dynamic_fields?.process?.loan_amount_required?T(a.dynamic_fields.process.loan_amount_required):"",purposeOfLoan:e.purpose_of_loan||a?.process_data?.purpose_of_loan||a?.dynamic_fields?.process?.purpose_of_loan||"",howToProcess:e.how_to_process||a?.process_data?.how_to_process||a?.dynamic_fields?.process?.how_to_process||"",loanType:e.loan_type||a?.process_data?.loan_type||a?.dynamic_fields?.process?.loan_type||"",requiredTenure:r?`${r} months`:"",caseType:e.case_type||a?.process_data?.case_type||a?.dynamic_fields?.process?.case_type||"",year:r?C(r):""});const s=a?.process_data?.loan_type||a?.dynamic_fields?.process?.loan_type;if(s){const e=d.find(e=>e._id===s||e.name===s);e&&u(e)}},[a?._id,o,a?.process_data,a?.dynamic_fields?.process,d]),r.useEffect(()=>{B(),E()},[]),r.useEffect(()=>{S.current&&q.howToProcess&&I(S.current),P.current&&q.purposeOfLoan&&I(P.current)},[q.howToProcess,q.purposeOfLoan]),r.useEffect(()=>{const e=e=>{e.target.closest(".dropdown-container")||(f(!1),h(!1),y(""),w(""))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const E=async()=>{try{const e=localStorage.getItem("userId");if(!e)return void m(["HDFC","ICICI","SBI","Axis"]);const r=`/api/settings/bank-names?user_id=${e}`,o=await fetch(r,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(o.ok){const e=(await o.json()).filter(e=>e.is_active).map(e=>e.name);e.length>0?m(e):m(["HDFC","ICICI","SBI","Axis"])}else m(["HDFC","ICICI","SBI","Axis"])}catch(e){m(["HDFC","ICICI","SBI","Axis"])}},B=async()=>{try{if(i(l),a?.loan_type){const e=a.loan_type,r=l.find(r=>r._id===e||r.name===e);r&&u(r)}}catch(e){}},$=(e,r)=>{let o=r;if("string"!=typeof r||["loanAmountRequired","requiredTenure"].includes(e)||(o=r.toUpperCase()),"requiredTenure"===e){const r=parseInt(o.toString().replace(/[^\d]/g,""))||0,s=Math.floor(r/12),a=r%12;let n="";s>0&&a>0?n=`${s} years ${a} months`:s>0?n=`${s} years`:a>0&&(n=`${a} months`);const t=v?o:o?`${o} months`:"";k(r=>({...r,[e]:t,year:n}))}else{const r={...q,[e]:o};k(r)}},D=async(e,r)=>{if(null==r)return;const n=(e=>{const r={processingBank:"processing_bank",loanAmountRequired:"loan_amount_required",purposeOfLoan:"purpose_of_loan",howToProcess:"how_to_process",loanType:"loan_type",requiredTenure:"required_tenure",caseType:"case_type",year:"year"}[e]||e;return a?.process_data?.[r]||a?.dynamic_fields?.process?.[r]||""})(e);let t=r,l=n;if("loanAmountRequired"===e?(t=parseFloat(L(r))||0,l=parseFloat(n)||0):"requiredTenure"===e||"year"===e?(t=parseInt(r.toString().replace(/[^\d]/g,""))||0,l=parseInt(n)||0):(t=(r||"").toString().trim(),l=(n||"").toString().trim()),"purposeOfLoan"===e||"howToProcess"===e||t!==l)try{if(k(o=>({...o,[e]:r})),a?._id&&await H(e,r),s){const a={...o,[e]:r};s(a)}}catch(d){}},F=()=>x?p.filter(e=>e.toLowerCase().includes(x.toLowerCase())):p,U=()=>b?d.filter(e=>e.name.toLowerCase().includes(b.toLowerCase())):d,H=async(e,r)=>{if(!a?._id)return!1;try{const o=localStorage.getItem("userId");if(!o)return!1;const n=a.original_lead_id||a.login_created_at?`/api/lead-login/login-leads/${a._id}?user_id=${o}`:`/api/leads/${a._id}?user_id=${o}`,t={processingBank:"processing_bank",loanAmountRequired:"loan_amount_required",purposeOfLoan:"purpose_of_loan",howToProcess:"how_to_process",loanType:"loan_type",requiredTenure:"required_tenure",caseType:"case_type",year:"year"}[e]||e;let l=r;"loanAmountRequired"===e&&r?l=parseFloat(L(r))||null:"requiredTenure"!==e&&"year"!==e||!r||(l=parseInt(r.toString().replace(/[^\d]/g,""))||null);const d={process_data:{[t]:l}},i=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(d)});if(!i.ok){const e=await i.text();throw new Error(`HTTP error! status: ${i.status}, message: ${e}`)}return await i.json(),a.process_data||(a.process_data={}),a.process_data[t]=l,s&&"function"==typeof s&&s({processField:t,processedValue:l,process_data:a.process_data}),!0}catch(o){return!1}};return e.jsx("div",{className:"max-w-9xl mx-auto",children:e.jsxs("div",{className:"bg-white border-3 border-[#00bcd4] rounded-b-xl p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-8 items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:O,style:A,children:"PROCESSING BANK"}),e.jsxs("div",{className:"relative dropdown-container",children:[e.jsxs("div",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold cursor-pointer flex items-center justify-between transition-all duration-300 focus-within:border-[#0097a7] focus-within:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] "+(n?"":"bg-gray-100 cursor-not-allowed"),onClick:()=>{n&&(h(!1),f(!_))},children:[e.jsx("span",{children:q.processingBank||"Select Bank"}),e.jsx("svg",{className:"w-4 h-4 text-[#00bcd4]",fill:"none",stroke:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"m6 8 4 4 4-4"})})]}),_&&n&&e.jsxs("div",{className:"absolute w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto z-50 mt-1",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:border-[#00bcd4]",placeholder:"Search banks...",value:x,onChange:e=>y(e.target.value),onClick:e=>e.stopPropagation()})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:F().length>0?F().map((r,o)=>e.jsx("div",{className:"px-4 py-2 text-md font-bold text-green-600 hover:bg-gray-100 cursor-pointer",onClick:()=>{$("processingBank",r),D("processingBank",r),f(!1),y("")},children:r},o)):e.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No banks found"})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:O,style:A,children:"LOAN TYPE"}),e.jsxs("div",{className:"relative dropdown-container",children:[e.jsxs("div",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold cursor-pointer flex items-center justify-between transition-all duration-300 focus-within:border-[#0097a7] focus-within:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] "+(n?"":"bg-gray-100 cursor-not-allowed"),onClick:()=>{n&&(f(!1),h(!g))},children:[e.jsx("span",{children:c?.name||"Select Loan Type"}),e.jsx("svg",{className:"w-4 h-4 text-[#00bcd4]",fill:"none",stroke:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"m6 8 4 4 4-4"})})]}),g&&n&&e.jsxs("div",{className:"absolute w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto z-50 mt-1",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:border-[#00bcd4]",placeholder:"Search loan types...",value:b,onChange:e=>w(e.target.value),onClick:e=>e.stopPropagation()})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:U().length>0?U().map(r=>e.jsx("div",{className:"px-4 py-2 text-md font-bold text-green-600 hover:bg-gray-100 cursor-pointer",onClick:()=>{(async e=>{const r=d.find(r=>r._id===e);u(r),r&&(k(e=>({...e,loanType:r.name})),a?._id&&await H("loanType",r.name))})(r._id),h(!1),w("")},children:r.name},r._id)):e.jsx("div",{className:"px-4 py-2 text-sm text-gray-500",children:"No loan types found"})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:O,style:A,children:"CASE TYPE"}),e.jsxs("select",{className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold transition-all duration-300 focus:border-[#0097a7] focus:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] appearance-none bg-[url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2300bcd4' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e\")] bg-no-repeat bg-[right_12px_center] bg-[length:16px] pr-10 "+(n?"":"bg-gray-100 cursor-not-allowed"),value:q.caseType,onChange:e=>n&&$("caseType",e.target.value),onBlur:e=>n&&D("caseType",e.target.value),disabled:!n,children:[e.jsx("option",{value:"",className:"text-[#10b981] bg-[#f0f9ff]",children:"Select Case Type"}),e.jsx("option",{value:"FRESH ONLY",children:"FRESH ONLY"}),e.jsx("option",{value:"BT ONLY",children:"BT ONLY"}),e.jsx("option",{value:"BT+TOP UP",children:"BT+TOP UP"}),e.jsx("option",{value:"INTERNAL TOP UP",children:"INTERNAL TOP UP"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-8 items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:O,style:A,children:"LOAN AMOUNT REQUIRED"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-[#00bcd4] font-semibold z-10",children:"â‚¹"}),e.jsx("input",{type:"text",className:"w-full p-3 pl-8 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold transition-all duration-300 focus:border-[#0097a7] focus:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] "+(n?"":"bg-gray-100 cursor-not-allowed"),value:q.loanAmountRequired,onChange:e=>n&&$("loanAmountRequired",e.target.value),onFocus:e=>{if(n&&q.loanAmountRequired){const r=L(q.loanAmountRequired);e.target.value=r,k(e=>({...e,loanAmountRequired:r}))}},onBlur:e=>{if(!n)return;const r=L(e.target.value),o=r?T(r):"";k(e=>({...e,loanAmountRequired:o})),D("loanAmountRequired",r)},readOnly:!n,placeholder:"0"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:O,style:A,children:"REQUIRED TENURE MONTHS"}),e.jsx("input",{ref:j,type:"text",className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold transition-all duration-300 focus:border-[#0097a7] focus:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] "+(n?"":"bg-gray-100 cursor-not-allowed"),value:(()=>{if(v)return q.requiredTenure.replace(/[^\d]/g,"");{const e=q.requiredTenure.replace(/[^\d]/g,"");return e?`${e} months`:""}})(),onChange:e=>{if(!n)return;const r=e.target.value.replace(/[^\d]/g,"");$("requiredTenure",r)},onFocus:e=>{N(!0),setTimeout(()=>{if(j.current){const e=q.requiredTenure.replace(/[^\d]/g,"");j.current.setSelectionRange(e.length,e.length)}},0)},onBlur:e=>{const r=e.target.value.replace(/[^\d]/g,"");N(!1),r&&k(e=>({...e,requiredTenure:`${r} months`})),n&&D("requiredTenure",r)},onKeyDown:e=>{["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(e.key)||/[0-9]/.test(e.key)||e.preventDefault()},readOnly:!n,placeholder:"Enter months"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:O,style:A,children:"REQUIRED TENURE YEAR"}),e.jsx("input",{type:"text",className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-[#f0f9ff] text-green-600 text-md font-bold italic cursor-not-allowed",value:q.year||"Auto-calculated from months...",readOnly:!0,placeholder:"Auto-calculated from months..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-0",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:O,style:A,children:"PURPOSE OF LOAN"}),e.jsx("textarea",{ref:P,className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold transition-all duration-300 focus:border-[#0097a7] focus:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] resize-y min-h-[80px] font-inherit "+(n?"":"bg-gray-100 cursor-not-allowed"),value:q.purposeOfLoan||"",onChange:e=>R("purposeOfLoan",e.target.value),onBlur:()=>n&&D("purposeOfLoan",q.purposeOfLoan),readOnly:!n,placeholder:"Enter purpose of loan...",rows:"4"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:O,style:A,children:"HOW TO PROCESS"}),e.jsx("textarea",{ref:S,className:"w-full p-3 border-2 border-[#00bcd4] rounded-md bg-white text-green-600 text-md font-bold transition-all duration-300 focus:border-[#0097a7] focus:shadow-[0_0_0_3px_rgba(0,188,212,0.1)] resize-y min-h-[80px] font-inherit "+(n?"":"bg-gray-100 cursor-not-allowed"),value:q.howToProcess||"",onChange:e=>R("howToProcess",e.target.value),onBlur:()=>n&&D("howToProcess",q.howToProcess),readOnly:!n,placeholder:"Enter processing remarks and instructions here...",rows:"4"})]})]})]})})}export{o as default};
