import{j as e}from"./vendor-mui-C1GmDdcn.js";import{r as t}from"./vendor-react-EzoxUMNY.js";import{A as s,f as a}from"./employee-components-BaVQwk9A.js";import{a as r,y as n}from"./task-components-B9cd7tnZ.js";import"./vendor-utils-QXd9EeNt.js";import"./vendor-antd-BB3a0mYC.js";import"./lead-components-DTzlhBhz.js";import"./vendor-office-CbbGW2MO.js";function i({onClose:a,onSelect:r}){const[n,i]=t.useState(""),[l,o]=t.useState([]),[d,c]=t.useState(!0);t.useEffect(()=>{(async()=>{try{c(!0);const e=await s.tickets.getAssignableUsers();if(e&&e.users&&Array.isArray(e.users)){const t=e.users.map(e=>({id:e.user_id||e._id||e.id,name:e.name||e.username||`${e.first_name||""} ${e.last_name||""}`.trim(),email:e.email||"",role:e.role||"",designation:e.designation||e.role||e.job_title||""}));o(t.filter(e=>e.name))}else if(e&&Array.isArray(e)){const t=e.map(e=>({id:e.user_id||e._id||e.id,name:e.name||e.username||`${e.first_name||""} ${e.last_name||""}`.trim(),email:e.email||"",role:e.role||"",designation:e.designation||e.role||e.job_title||""}));o(t.filter(e=>e.name))}}catch(e){try{const e=await s.users.getUsers();if(e&&Array.isArray(e)){const t=e.map(e=>({id:e._id||e.id,name:e.name||e.username||`${e.first_name||""} ${e.last_name||""}`.trim(),email:e.email||"",role:e.role||"",designation:e.designation||e.role||e.job_title||""}));o(t.filter(e=>e.name))}}catch(t){o([])}}finally{c(!1)}})()},[]);const[m,x]=t.useState([]);return t.useEffect(()=>{""===n.trim()?x(l):x(l.filter(e=>e.name.toLowerCase().includes(n.toLowerCase())||e.designation&&e.designation.toLowerCase().includes(n.toLowerCase())))},[n,l]),e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-transparent",children:e.jsxs("div",{className:"bg-transparent backdrop-blur-sm p-6 rounded-2xl shadow-2xl w-[90%] max-w-5xl mx-auto relative",children:[e.jsxs("div",{className:"flex items-center mb-4 bg-white bg-opacity-90 p-3 rounded-t-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[#03B0F5] text-white flex items-center justify-center mr-3",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),e.jsx("h3",{className:"font-bold text-lg text-black",children:"Assign Ticket"})]}),e.jsxs("div",{className:"mb-4 bg-white bg-opacity-90 p-3 rounded-md",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-2",children:"Assign to"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",className:"w-full pl-10 pr-3 py-2 border border-cyan-400 rounded text-black font-bold",value:n,onChange:e=>i(e.target.value),placeholder:"Search or enter assignee name"}),n&&e.jsx("button",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600",onClick:()=>i(""),type:"button",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),d?e.jsx("div",{className:"text-center p-4 bg-white bg-opacity-90 rounded-lg",children:"Loading users..."}):e.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto mb-4 border rounded-lg bg-white bg-opacity-90",children:m.length>0?m.map(t=>e.jsxs("li",{className:"p-3 border-b last:border-b-0 cursor-pointer text-black transition hover:bg-gray-100 flex items-center",onClick:()=>(r(t),void a()),children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[#03B0F5] text-white flex items-center justify-center mr-3 flex-shrink-0",children:t.name.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase()}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-black font-medium",children:t.name}),t.designation&&e.jsx("span",{className:"text-gray-600 text-sm",children:t.designation})]})]},t.id)):""!==n.trim()?e.jsx("li",{className:"p-3 text-gray-500 text-center",children:"No matching assignees found."}):null}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4 bg-white bg-opacity-90 p-3 rounded-b-xl",children:[e.jsx("button",{className:"px-6 py-3 bg-cyan-600 text-white rounded-xl shadow hover:bg-cyan-700 transition",onClick:()=>{if(n){const e=l.find(e=>e.name.toLowerCase()===n.toLowerCase());r(e?{id:e.id,name:e.name}:{name:n})}i(""),a()},children:"Assign"}),e.jsx("button",{className:"px-6 py-3 bg-gray-400 text-white rounded-xl shadow hover:bg-gray-500 transition",onClick:a,children:"Cancel"})]}),e.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-red-500 text-2xl font-bold",onClick:a,children:"Ã—"})]})})}function l({ticket:l,onSave:o,onClose:d}){const[c,m]=t.useState({id:(x=l)._id||x.id,createdBy:x.created_by_name||"Unknown",status:x.status?.toUpperCase()||"OPEN",subject:x.subject||"",message:x.description||"",assign:Array.isArray(x.assigned_users_details)&&x.assigned_users_details.length>0?x.assigned_users_details.map(e=>e.name).join(", "):"Unassigned",assigned_users:x.assigned_users||[],assignedTo:Array.isArray(x.assigned_users_details)?x.assigned_users_details.map(e=>({id:e.user_id||e._id||e.id,name:e.name||`${e.first_name||""} ${e.last_name||""}`.trim()})):[],priority:x.priority||"medium",created_by:x.created_by||"",comments:x.comments?x.comments.map(e=>({user:e.created_by_name||"Unknown",text:e.content,time:new Date(e.created_at).toLocaleString()})):[],attachments:x.attachments?x.attachments.map(e=>{let t;if(e.file_path)if(e.file_path.startsWith("http"))t=e.file_path;else if(e.file_path.startsWith("/")){const s=e.file_path.split("/").pop();t=r(`media/tickets/${s}`)}else t=r(e.file_path);else t="";return{id:e.attachment_id,name:e.filename,url:t,isFromBackend:!0,size:e.file_size,mimeType:e.mime_type,uploadedBy:e.uploaded_by,uploadedAt:e.uploaded_at}}):[],removedAttachments:[],newAttachments:[],newComment:"",showAttachments:x.attachments&&x.attachments.length>0});var x;const[u,h]=t.useState(!0),[g,p]=t.useState(a(new Date)),[b,f]=t.useState(!0),[y,j]=t.useState(!1),[w,N]=t.useState(!1),[v,k]=t.useState(!1),[C,T]=t.useState(null),[A,E]=t.useState(!1),[S,U]=t.useState([]),[_,D]=t.useState(!1),[F,L]=t.useState(!1),[B,M]=t.useState(!1),[O,I]=t.useState(!1),[P,R]=t.useState("all"),$=t.useRef(null);t.useEffect(()=>{(async()=>{if(!_&&c.id){M(!0);try{const e=await s.tickets.getHistory(c.id);if(e&&e.history&&Array.isArray(e.history)){const t=e.history.map((e,t)=>({id:e.id||`history-${Date.now()}-${t}`,user:(e.user||"UNKNOWN USER").toUpperCase(),action:e.action||"Unknown Action",time:e.time?new Date(e.time):new Date,details:e.details||"",isFromBackend:!0}));U(t),D(!0)}else U([]),D(!0)}catch(e){U([]),D(!0)}finally{M(!1)}}})()},[c.id,_,l]);const W=async()=>{try{if(!c.id)return;const e=await s.tickets.getHistory(c.id);if(e&&e.history&&Array.isArray(e.history)){const t=e.history.map((e,t)=>({id:e.id||`history-${Date.now()}-${t}`,user:(e.user||"UNKNOWN USER").toUpperCase(),action:e.action||"Unknown Action",time:e.time?new Date(e.time):new Date,details:e.details||"",isFromBackend:!0}));U(t)}else U([])}catch(e){}};t.useEffect(()=>{$.current&&($.current.style.height="auto",$.current.style.height=$.current.scrollHeight+"px")},[c.message]);const z=(e,t)=>{m(s=>({...s,[e]:t}))},K=e=>{["id","assignTo","priority","status","ticketNumber"].includes(e)||"string"!=typeof c[e]||m(t=>({...t,[e]:t[e].toUpperCase()}))},H=async e=>{if(e.preventDefault(),e.stopPropagation(),!c.newComment.trim()||O)return!1;I(!0);const t=c.newComment.trim();m(e=>({...e,newComment:""}));try{await s.tickets.addComment(c.id,t);const e=(new Date).toLocaleString("en-IN",{timeZone:"Asia/Kolkata",hour12:!0,hour:"2-digit",minute:"2-digit",day:"2-digit",month:"short",year:"numeric"}),a={user:c.createdBy||"You",text:t,time:e};m(e=>({...e,comments:[a,...e.comments]})),setTimeout(async()=>{await W()},500),n.success("Comment added successfully")}catch(a){m(e=>({...e,newComment:t})),G("Failed to add comment","Comment submission failed"),n.error("Failed to add comment")}finally{I(!1)}return!1},G=(e,t="")=>{const s=c.createdBy||"Current User",a={id:Date.now(),user:s,action:e,time:new Date,details:t,isFromBackend:!1};U(e=>[a,...e])},V=async()=>{try{k(!0);const e={status:"open"};await s.tickets.updateTicket(c.id,e),n.success("Ticket reopened successfully");const t={...c,status:"OPEN"};if(m(t),o){const e={...t,status:"open",_id:c.id||c._id,id:c.id||c._id};await o(e)}setTimeout(async()=>{await W()},500)}catch(e){n.error("Failed to reopen ticket"),G("Failed to reopen ticket","Reopen operation failed")}finally{k(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-transparent",style:{backdropFilter:"blur(3px)"},children:[e.jsxs("div",{className:"relative bg-white p-6 rounded-xl shadow-2xl w-full max-w-5xl mx-auto space-y-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{className:"absolute right-2 top-2 text-gray-500 hover:text-red-500 transition text-2xl font-bold",onClick:()=>{A&&G("Cancelled editing","Exited edit mode without saving changes"),h(!1),d&&d()},"aria-label":"Close",type:"button",children:"Ã—"}),e.jsx("h2",{className:"text-xl font-bold text-blue-500 mb-4",children:"EDIT TICKET"}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),k(!0),T(null);try{const e={subject:c.subject,description:c.message,priority:c.priority||"medium",status:c.status.toLowerCase(),assigned_users:c.assigned_users||[]};if(!e.subject.trim())return void T("Subject is required");if(!e.description.trim())return void T("Message is required");c.newAttachments,o&&(await o({...c,_id:c.id,attachmentsToRemove:c.removedAttachments.filter(e=>e.id).map(e=>e.id),newAttachments:c.newAttachments}),setTimeout(async()=>{await W()},500)),E(!1),n.success("Ticket updated successfully")}catch(t){T("Failed to update ticket"),n.error("Failed to update ticket"),G("Failed to update ticket","Update operation failed")}finally{k(!1)}},children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Date & Time"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:g,readOnly:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",htmlFor:"createdBy",children:"Created By"}),e.jsx("input",{id:"createdBy",type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold bg-gray-100",value:c.createdBy,onChange:e=>z("createdBy",e.target.value),required:!0,readOnly:!0})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",htmlFor:"subject",children:"Subject"}),e.jsx("input",{id:"subject",type:"text",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold "+(A?"":"bg-gray-100"),value:c.subject,onChange:e=>z("subject",e.target.value),onBlur:()=>K("subject"),placeholder:"Enter subject",required:!0,readOnly:!A})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",htmlFor:"message",children:"Ticket Details"}),e.jsx("textarea",{ref:$,id:"message",className:"w-full px-3 py-2 border border-cyan-400 rounded text-black font-bold resize-none overflow-hidden "+(A?"":"bg-gray-100"),rows:3,value:c.message,onChange:e=>z("message",e.target.value),onBlur:()=>K("message"),placeholder:"Enter ticket details...",required:!0,readOnly:!A,style:{minHeight:"3rem",maxHeight:"400px",transition:"height 0.2s"}})]}),e.jsxs("div",{className:"flex flex-col items-start mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-2",children:"Attachment"}),e.jsxs("label",{className:"inline-flex items-center px-4 py-2 font-bold rounded-lg shadow transition "+(A?"bg-cyan-500 text-white cursor-pointer hover:bg-cyan-600":"bg-gray-400 text-gray-600 cursor-not-allowed"),children:["Photo/PDF",e.jsx("input",{type:"file",accept:"image/*,application/pdf",className:"hidden",onChange:e=>{const t=Array.from(e.target.files);if(t.length>0){const e=t.filter(e=>e.type.startsWith("image/")||"application/pdf"===e.type).map(e=>({file:e,name:e.name,url:URL.createObjectURL(e),isNew:!0,isFromBackend:!1}));m(t=>({...t,attachments:[...t.attachments,...e],newAttachments:[...t.newAttachments,...e],showAttachments:!0}))}},multiple:!0,disabled:!A})]}),e.jsx("h4",{className:"font-semibold text-gray-700 mt-4 mb-2 w-full",children:c.attachments.filter(e=>e.isFromBackend).length>0?"Previous Attachments":""}),c.attachments.filter(e=>e.isFromBackend).length>0&&e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-4 w-full",children:c.attachments.filter(e=>e.isFromBackend).map((t,s)=>e.jsxs("div",{className:"flex items-center bg-gray-100 p-2 rounded-lg relative border-2 border-blue-200",children:[t.url&&(t.url.match(/\.(jpeg|jpg|gif|png)$/i)||t.mimeType&&t.mimeType.startsWith("image/"))?e.jsx("img",{src:t.url,alt:`Preview ${s}`,className:"w-20 h-20 object-cover rounded-lg mr-2",onError:e=>{e.target.onerror=null,e.target.src="https://via.placeholder.com/80x80?text=Error"}}):e.jsx("div",{className:"w-20 h-20 flex items-center justify-center bg-gray-200 rounded-lg mr-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("span",{className:"text-sm text-black font-medium truncate",children:t.name}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline",children:"View"}),t.uploadedAt&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Uploaded: ",new Date(t.uploadedAt).toLocaleString()]})]})]}),A&&e.jsx("button",{type:"button",className:"absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600",onClick:()=>{m(e=>({...e,attachments:e.attachments.filter(e=>e!==t),removedAttachments:[...e.removedAttachments||[],t]}))},children:"Ã—"})]},`backend-${s}`))}),e.jsx("h4",{className:"font-semibold text-gray-700 mt-4 mb-2 w-full",children:c.attachments.filter(e=>!e.isFromBackend).length>0?"New Attachments":""}),c.attachments.filter(e=>!e.isFromBackend).length>0?e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-4 w-full",children:c.attachments.filter(e=>!e.isFromBackend).map((t,s)=>e.jsxs("div",{className:"flex items-center bg-gray-100 p-2 rounded-lg relative border-2 border-green-200",children:[t.url&&t.url.match(/\.(jpeg|jpg|gif|png)$/i)?e.jsx("img",{src:t.url,alt:`Preview ${s}`,className:"w-20 h-20 object-cover rounded-lg mr-2",onError:e=>{e.target.onerror=null,e.target.src="https://via.placeholder.com/80x80?text=Error"}}):e.jsx("div",{className:"w-20 h-20 flex items-center justify-center bg-gray-200 rounded-lg mr-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("span",{className:"text-sm text-black font-medium truncate",children:t.name}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline",children:"Preview"}),e.jsx("span",{className:"text-xs text-green-600",children:"New file - not yet uploaded"})]})]}),A&&e.jsx("button",{type:"button",className:"absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600",onClick:()=>{m(e=>({...e,attachments:e.attachments.filter(e=>e!==t),newAttachments:e.newAttachments.filter(e=>e!==t)}))},children:"Ã—"})]},`new-${s}`))}):null,0===c.attachments.length&&e.jsx("div",{className:"mt-2 p-4 bg-gray-100 rounded-lg text-gray-500 text-center w-full",children:"No attachments available. Add some using the button above."})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-bold text-gray-700 mb-1",children:"Assignee"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 border border-cyan-400 rounded-md bg-white p-1 pr-2 min-h-[42px]",children:[c.assignedTo&&c.assignedTo.map((t,s)=>{const a="string"==typeof t?t:t.name;return e.jsxs("div",{className:"bg-blue-100 text-blue-800 py-1 px-3 rounded-md flex items-center",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#03B0F5] text-white flex items-center justify-center mr-2 text-xs flex-shrink-0",children:a.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase()}),e.jsx("span",{children:a}),A&&e.jsx("button",{type:"button",className:"ml-2 text-blue-500 hover:text-blue-700",onClick:()=>{return e=a,void m(t=>{const s=t.assignedTo.filter(t=>"string"==typeof t?t!==e:t.name!==e),a=t.assigned_users.filter((s,a)=>{const r=t.assignedTo[a];return"string"==typeof r?r!==e:r.name!==e}),r=s.map(e=>"string"==typeof e?e:e.name),n=r.length>0?r.join(", "):"Unassigned";return G("Removed assignee",`Removed: ${e}. Current assignees: ${n}`),{...t,assignedTo:s,assign:r.join(", "),assigned_users:a}});var e},children:"Ã—"})]},s)}),A&&e.jsx("button",{type:"button",className:"text-blue-600 font-medium hover:text-blue-800 ml-auto",onClick:()=>N(!0),children:"+ Add more"})]})]}),e.jsx("div",{className:"flex gap-4 mt-6",children:"OPEN"===c.status?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"flex-1 px-6 py-3 bg-green-600 text-white font-bold rounded-lg shadow hover:bg-green-700 transition text-lg",onClick:async()=>{try{k(!0);const e={status:"closed"};await s.tickets.updateTicket(c.id,e),n.success("Ticket closed successfully");const t={...c,status:"CLOSED"};if(m(t),o){const e={...t,status:"closed",_id:c.id||c._id,id:c.id||c._id};await o(e)}setTimeout(async()=>{await W()},500)}catch(e){n.error("Failed to close ticket"),G("Failed to close ticket","Close operation failed")}finally{k(!1)}},disabled:v,children:v?"Processing...":"Close Ticket"}),e.jsx("button",{type:"button",className:"flex-1 px-6 py-3 bg-red-600 text-white font-bold rounded-lg shadow hover:bg-red-700 transition text-lg",onClick:async()=>{try{k(!0);const e={status:"failed"};await s.tickets.updateTicket(c.id,e),n.success("Ticket marked as failed");const t={...c,status:"FAILED"};if(m(t),o){const e={...t,status:"failed",_id:c.id||c._id,id:c.id||c._id};await o(e)}setTimeout(async()=>{await W()},500)}catch(e){n.error("Failed to mark ticket as failed"),G("Failed to mark ticket as failed","Fail operation failed")}finally{k(!1)}},disabled:v,children:v?"Processing...":"Failed Ticket"}),!A&&e.jsx("button",{type:"button",className:"flex-1 px-6 py-3 bg-orange-600 text-white font-bold rounded-lg shadow hover:bg-orange-700 transition text-lg",onClick:()=>{E(!0),G("Started editing","Entered edit mode to modify ticket details")},children:"Edit Ticket"}),A&&e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-cyan-600 text-white font-bold rounded-lg shadow hover:bg-cyan-700 transition text-lg",disabled:v,children:v?"Updating...":"Update Ticket"})]}):"CLOSED"===c.status?e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",className:"flex-1 px-6 py-3 bg-green-600 text-white font-bold rounded-lg shadow hover:bg-green-700 transition text-lg",onClick:V,disabled:v,children:v?"Reopening...":"Reopen Task"})}):"FAILED"===c.status?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"flex-1 px-6 py-3 bg-green-600 text-white font-bold rounded-lg shadow hover:bg-green-700 transition text-lg",onClick:V,disabled:v,children:v?"Reopening...":"Reopen Task"}),!A&&e.jsx("button",{type:"button",className:"flex-1 px-6 py-3 bg-orange-600 text-white font-bold rounded-lg shadow hover:bg-orange-700 transition text-lg",onClick:()=>{E(!0),G("Started editing","Entered edit mode to modify ticket details")},children:"Edit Ticket"}),A&&e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-cyan-600 text-white font-bold rounded-lg shadow hover:bg-cyan-700 transition text-lg",disabled:v,children:v?"Updating...":"Update Ticket"})]}):null})]}),e.jsxs("div",{className:"mt-6 border-t pt-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",className:"px-4 py-2 font-semibold rounded-lg shadow "+(b?"bg-green-500 text-white hover:bg-green-600":"bg-white text-gray-700 hover:bg-gray-100"),onClick:()=>{f(!b),j(!1)},children:"âž• Comments"}),e.jsx("button",{type:"button",className:"px-4 py-2 font-semibold rounded-lg shadow "+(y?"bg-green-500 text-white hover:bg-green-600":"bg-white text-gray-700 hover:bg-gray-100"),onClick:()=>{j(!y),f(!1)},children:"ï¿½ History"})]}),b&&e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:H,className:"mt-4",children:e.jsxs("div",{className:"bg-white border-2 border-green-200 rounded-lg p-3 shadow-sm",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"ðŸ’¬ ADD COMMENT"}),e.jsx("textarea",{value:c.newComment,onChange:e=>z("newComment",e.target.value),onBlur:()=>K("newComment"),placeholder:"Type your comment here... (Press Enter for new line, Ctrl+Enter to submit)",className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg text-sm text-black font-semibold focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-none",disabled:O,rows:3,style:{minHeight:"80px"},onKeyDown:e=>{e.ctrlKey&&"Enter"===e.key&&(e.preventDefault(),H(e))}}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["Press ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Ctrl+Enter"})," to submit"]}),e.jsx("button",{type:"submit",disabled:!c.newComment.trim()||O,className:"px-6 py-2 rounded-lg text-sm font-bold transition-all "+(!c.newComment.trim()||O?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700 hover:shadow-md"),children:O?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),e.jsx("span",{children:"ADDING..."})]}):"âž¤ ADD COMMENT"})]})]})}),e.jsx("div",{className:"mt-4 space-y-3 max-h-[400px] overflow-y-auto pr-2",children:F?e.jsxs("div",{className:"text-center py-8 bg-white rounded-lg border-2 border-gray-200",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2 font-bold",children:"LOADING COMMENTS..."})]}):c.comments&&c.comments.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs font-bold text-gray-500 mb-2 uppercase tracking-wide",children:["ðŸ’¬ ",c.comments.length," ",1===c.comments.length?"Comment":"Comments"]}),c.comments.map((t,s)=>e.jsxs("div",{className:"bg-gradient-to-r from-white to-green-50 border-2 border-green-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-green-500 to-green-600 text-white flex items-center justify-center text-sm font-bold shadow-sm",children:(t.user||"U").charAt(0).toUpperCase()}),e.jsx("span",{className:"font-bold text-gray-800 text-sm",children:(t.user||"UNKNOWN USER").toUpperCase()}),e.jsxs("span",{className:"bg-green-100 text-green-700 text-xs font-bold px-2 py-0.5 rounded-full",children:["#",s+1]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),e.jsx("span",{className:"font-semibold",children:t.time})]})]}),e.jsx("div",{className:"text-sm font-semibold text-gray-800 leading-relaxed whitespace-pre-wrap break-words",children:t.text})]},t.id||s))]}):e.jsxs("div",{className:"text-center py-12 bg-gradient-to-br from-gray-50 to-green-50 rounded-lg border-2 border-dashed border-green-300",children:[e.jsx("div",{className:"text-5xl mb-3",children:"ðŸ’¬"}),e.jsx("p",{className:"text-gray-600 font-bold text-lg",children:"NO COMMENTS YET"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Be the first to share your thoughts!"})]})})]}),y&&e.jsx("div",{className:"mt-4",children:B?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-green-500 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-3 font-medium",children:"Loading activity history..."})]}):S&&S.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between bg-white p-4 rounded-lg border-2 border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-bold text-gray-700",children:"ðŸ“Š FILTER:"}),e.jsxs("select",{value:P,onChange:e=>R(e.target.value),className:"px-4 py-2 border-2 border-gray-300 rounded-lg text-sm font-semibold text-gray-700 bg-white hover:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition cursor-pointer",children:[e.jsxs("option",{value:"all",children:["ALL ACTIVITIES (",S.length,")"]}),e.jsxs("option",{value:"created",children:["ðŸ“ CREATED (",S.filter(e=>e.action&&e.action.toUpperCase().includes("CREATED")).length,")"]}),e.jsxs("option",{value:"status",children:["ðŸ”„ STATUS (",S.filter(e=>e.action&&e.action.toUpperCase().includes("STATUS")).length,")"]}),e.jsxs("option",{value:"comment",children:["ðŸ’¬ COMMENTS (",S.filter(e=>e.action&&e.action.toUpperCase().includes("COMMENT")).length,")"]}),e.jsxs("option",{value:"assignment",children:["ðŸ‘¤ ASSIGNMENTS (",S.filter(e=>e.action&&(e.action.toUpperCase().includes("ASSIGN")||e.action.toUpperCase().includes("UPDATED TICKET"))).length,")"]}),e.jsxs("option",{value:"updated",children:["âœï¸ UPDATES (",S.filter(e=>e.action&&e.action.toUpperCase().includes("UPDATE")).length,")"]})]})]}),e.jsxs("div",{className:"text-sm font-bold text-gray-600",children:["SHOWING: ",e.jsx("span",{className:"text-blue-600",children:S.filter(e=>{if("all"===P)return!0;const t=(e.action||"").toUpperCase();return"created"===P?t.includes("CREATED"):"status"===P?t.includes("STATUS"):"comment"===P?t.includes("COMMENT"):"assignment"===P?t.includes("ASSIGN")||t.includes("UPDATED TICKET"):"updated"===P&&t.includes("UPDATE")}).length})," OF ",e.jsx("span",{className:"text-blue-600",children:S.length})]})]}),e.jsx("div",{className:"bg-white rounded-lg border-2 border-gray-200 shadow-sm overflow-hidden",children:e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wider border-r border-blue-500",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wider border-r border-blue-500",children:"TYPE"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wider border-r border-blue-500",children:"DETAILS"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wider border-r border-blue-500",children:"USER"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wider",children:"DATE & TIME"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:(()=>{const t=S.filter(e=>{if("all"===P)return!0;const t=(e.action||"").toUpperCase();return"created"===P?t.includes("CREATED"):"status"===P?t.includes("STATUS"):"comment"===P?t.includes("COMMENT"):"assignment"===P?t.includes("ASSIGN")||t.includes("UPDATED TICKET"):"updated"===P&&t.includes("UPDATE")});return 0===t.length?e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",className:"px-4 py-12 text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ”"}),e.jsx("p",{className:"text-gray-500 font-bold",children:"NO ACTIVITIES FOUND"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try selecting a different filter"})]})}):t.map((t,s)=>{let a="UNKNOWN DATE",r="UNKNOWN TIME";if(t.time)try{const e=new Date(t.time);a=e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).toUpperCase(),r=e.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!0}).toUpperCase()}catch(m){}const n=(t.action||"").toUpperCase(),i=(t.details||"").toUpperCase();let l="ðŸ“Œ",o="ACTIVITY",d="bg-gray-100 text-gray-800",c=s%2==0?"bg-gray-50":"bg-white";return n.includes("CREATED")?(l="ðŸ“",o="CREATED",d="bg-blue-100 text-blue-800"):n.includes("STATUS")?(l="ðŸ”„",o="STATUS",d="bg-green-100 text-green-800"):n.includes("COMMENT")?(l="ðŸ’¬",o="COMMENT",d="bg-purple-100 text-purple-800"):n.includes("ASSIGN")||n.includes("UPDATED TICKET")?(l="ðŸ‘¤",o="ASSIGNMENT",d="bg-orange-100 text-orange-800"):n.includes("UPDATE")&&(l="âœï¸",o="UPDATED",d="bg-yellow-100 text-yellow-800"),e.jsxs("tr",{className:`${c} hover:bg-blue-50 transition-colors`,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-gray-700 border-r border-gray-200",children:s+1}),e.jsx("td",{className:"px-4 py-3 border-r border-gray-200",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-bold ${d}`,children:[l," ",o]})}),e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-800 border-r border-gray-200",children:i||n}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-gray-700 border-r border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-blue-600 text-white flex items-center justify-center text-xs font-bold",children:(t.user||"U").charAt(0).toUpperCase()}),(t.user||"UNKNOWN").toUpperCase()]})}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[e.jsx("div",{className:"font-bold text-gray-700",children:a}),e.jsx("div",{className:"font-semibold text-gray-500 text-xs",children:r})]})]},t.id||s)})})()})]})})})]}):e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border-2 border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-5xl mb-3",children:"ðŸ“‹"}),e.jsx("p",{className:"text-gray-600 font-bold text-lg",children:"NO ACTIVITY HISTORY"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Activity will appear here as actions are performed"})]})})]})]}),w&&e.jsx(i,{onClose:()=>N(!1),onSelect:e=>{var t;t=e,m(e=>{const s="string"==typeof t?t:t.name,a="string"==typeof t?null:t.id;if(!e.assignedTo.some(e=>"string"==typeof e?e===s:e.name===s)){const r=[...e.assignedTo,t],n=a?[...e.assigned_users||[],a]:e.assigned_users||[],i=r.map(e=>"string"==typeof e?e:e.name);return G("Added assignee",`Added: ${s}. Current assignees: ${i.join(", ")}`),{...e,assignedTo:r,assign:i.join(", "),assigned_users:n}}return e}),N(!1)}})]})}export{l as default};
