import{j as e}from"./vendor-mui-C1GmDdcn.js";import{r as a}from"./vendor-react-EzoxUMNY.js";import{a7 as t}from"./vendor-utils-QXd9EeNt.js";import{f as s}from"./employee-components-BaVQwk9A.js";import{j as r,k as l,n,o as d,h as c,p as o,Y as i,l as m,X as x,aJ as h,U as g,S as y,s as b,ab as p}from"./lead-components-DTzlhBhz.js";import"./vendor-antd-BB3a0mYC.js";import"./vendor-office-CbbGW2MO.js";const u="/api",j=()=>{const e=(()=>{const e=localStorage.getItem("userData");return e?JSON.parse(e):null})();return{"Content-Type":"application/json",...e?.token&&{Authorization:`Bearer ${e.token}`}}},f=async(e,a,s)=>{try{return(await t.get(`${u}/attendance/calendar`,{params:{year:e,month:a,user_id:s},headers:j()})).data}catch(r){throw r}},N=async(e,a,s)=>{try{return(await t.get(`${u}/attendance/detail/${e}/${a}`,{params:{requester_id:s},headers:j()})).data}catch(r){throw r}},v=async(e,a,s)=>{try{return(await t.get(`${u}/attendance/comments/${e}/${a}`,{params:{requester_id:s},headers:j()})).data}catch(r){throw r}},w=async(e,a,s)=>{try{return(await t.get(`${u}/attendance/history/${e}/${a}`,{params:{requester_id:s},headers:j()})).data}catch(r){throw r}},_=async(e=null,a=null,s)=>{try{const r={user_id:s};return e&&(r.year=e),a&&(r.month=a),(await t.get(`${u}/attendance/holidays`,{params:r,headers:j()})).data}catch(r){throw r}},k=a=>{switch(a){case"P":return e.jsx("div",{className:"w-8 h-8 bg-green-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"P"});case"L":return e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-yellow-500 to-orange-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"L"});case"LV":return e.jsx("div",{className:"w-8 h-8 bg-orange-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"LV"});case"H":return e.jsx("div",{className:"w-8 h-8 bg-blue-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"H"});case"HD":return e.jsx("div",{className:"w-8 h-8 bg-yellow-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"HD"});case"AB":return e.jsx("div",{className:"w-8 h-8 bg-red-500 text-white rounded flex items-center justify-center text-xs font-bold",children:"AB"});default:return e.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded flex items-center justify-center text-xs text-gray-400",children:"-"})}},S=(e,a,t)=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date(e,a-1,t).getDay()],A=["January","February","March","April","May","June","July","August","September","October","November","December"],C=({isOpen:r,onClose:l,holidays:n,onUpdateHolidays:d,selectedYear:c,selectedMonth:o})=>{const[i,m]=a.useState(""),[h,g]=a.useState(""),[y,f]=a.useState(""),[N,v]=a.useState(!1),[w,k]=a.useState(null),[S,C]=a.useState([]),[$,E]=a.useState("");a.useEffect(()=>{const e=localStorage.getItem("userData");e&&k(JSON.parse(e))},[]),a.useEffect(()=>{r&&w?.user_id&&D()},[r,w,c,o]);const D=async()=>{if(w?.user_id){v(!0),E("");try{const e=await _(c,o,w.user_id);e.success?C(e.holidays||[]):E("Failed to load holidays")}catch(e){E("Failed to load holidays. Please try again."),C([])}finally{v(!1)}}};if(!r)return null;const L=S.filter(e=>{const a=new Date(e.date);return a.getFullYear()===c&&a.getMonth()+1===o}),T=async e=>{if(w?.user_id){v(!0),E("");try{const a=await(async(e,a)=>{try{return(await t.delete(`${u}/attendance/holidays/${e}`,{params:{user_id:a},headers:j()})).data}catch($){throw $}})(e,w.user_id);a.success?(await D(),d(S.filter(a=>a._id!==e))):E(a.message||"Failed to delete holiday")}catch(a){E(a.response?.data?.detail||"Failed to delete holiday. Please try again.")}finally{v(!1)}}},H=e=>s(e);return e.jsx("div",{className:"fixed inset-0 bg-transparent bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 text-white p-4 rounded-t-lg relative",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 text-white hover:text-gray-200 transition-colors",children:e.jsx(x,{className:"h-6 w-6"})}),e.jsx("h2",{className:"text-xl font-bold",children:"Holiday Management"}),e.jsxs("p",{className:"text-cyan-100 text-sm mt-1",children:["Manage company holidays for ",A[o-1]," ",c]})]}),e.jsxs("div",{className:"p-6 bg-gray-900",children:[$&&e.jsx("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-700 rounded-lg",children:e.jsx("p",{className:"text-red-200 text-sm",children:$})}),N&&e.jsxs("div",{className:"mb-4 flex items-center justify-center py-4",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-cyan-500"}),e.jsx("span",{className:"text-gray-300 ml-2",children:"Processing..."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Add New Holiday"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Holiday Date *"}),e.jsx("input",{type:"date",value:i,onChange:e=>m(e.target.value),className:"w-full p-3 border border-gray-600 rounded-lg bg-gray-800 text-gray-200 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",disabled:N})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Holiday Name *"}),e.jsx("input",{type:"text",value:h,onChange:e=>g(e.target.value),placeholder:"e.g., Independence Day",className:"w-full p-3 border border-gray-600 rounded-lg bg-gray-800 text-gray-200 placeholder-gray-500 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",disabled:N})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description (Optional)"}),e.jsx("input",{type:"text",value:y,onChange:e=>f(e.target.value),placeholder:"Additional details about the holiday",className:"w-full p-3 border border-gray-600 rounded-lg bg-gray-800 text-gray-200 placeholder-gray-500 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",disabled:N})]})]}),e.jsxs("button",{onClick:async()=>{if(i&&h&&w?.user_id){v(!0),E("");try{const e=await(async(e,a,s,r)=>{try{const l={name:e,date:a,user_id:r};return s&&(l.description=s),(await t.post(`${u}/attendance/holidays/add`,null,{params:l,headers:j()})).data}catch($){throw $}})(h,i,y,w.user_id);e.success?(await D(),m(""),g(""),f(""),d(S)):E(e.message||"Failed to add holiday")}catch(e){E(e.response?.data?.detail||"Failed to add holiday. Please try again.")}finally{v(!1)}}else E("Please fill in all required fields")},disabled:N||!i||!h,className:"mt-4 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 disabled:from-gray-600 disabled:to-gray-700 text-white px-6 py-2 flex items-center gap-2 rounded-md transition-colors",children:[e.jsx(b,{className:"h-4 w-4"}),N?"Adding...":"Add Holiday"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:["Holidays for ",A[o-1]," ",c]}),0===L.length?e.jsx("div",{className:"text-center py-8 bg-gray-800 rounded-lg border border-gray-700",children:e.jsx("p",{className:"text-gray-400",children:"No holidays set for this month"})}):e.jsx("div",{className:"space-y-3",children:L.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-200",children:a.name}),e.jsx("div",{className:"text-sm text-gray-400",children:H(a.date)}),a.description&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:a.description})]}),e.jsx("button",{onClick:()=>T(a._id),disabled:N,className:"text-red-400 border border-red-700 hover:bg-red-900/50 disabled:opacity-50 px-3 py-1 rounded-md text-sm transition-colors flex items-center gap-1",children:e.jsx(p,{className:"h-4 w-4"})})]},a._id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"All Company Holidays"}),0===S.length?e.jsx("div",{className:"text-center py-8 bg-gray-800 rounded-lg border border-gray-700",children:e.jsx("p",{className:"text-gray-400",children:"No holidays configured"})}):e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 bg-gray-800 rounded-lg border border-gray-700 p-4",children:S.sort((e,a)=>new Date(e.date)-new Date(a.date)).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded border border-gray-600 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-200",children:a.name}),e.jsx("span",{className:"text-gray-400 ml-2",children:H(a.date)}),a.description&&e.jsx("div",{className:"text-gray-500 text-xs mt-1",children:a.description})]}),e.jsx("button",{onClick:()=>T(a._id),disabled:N,className:"text-red-400 border border-red-700 hover:bg-red-900/50 disabled:opacity-50 px-2 py-1 rounded-md text-sm transition-colors",children:e.jsx(p,{className:"h-3 w-3"})})]},a._id))})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:l,className:"bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white px-6 py-2 rounded-md transition-colors",children:"Close"})})]})]})})},$=({employee:l,selectedDate:n,isOpen:d,onClose:c,onUpdate:o,selectedYear:i,selectedMonth:b,canUserEdit:p})=>{const[f,_]=a.useState(""),[k,S]=a.useState(!1),[A,C]=a.useState([]),[$,E]=a.useState(""),[D,L]=a.useState([]),[T,H]=a.useState(null),[P,O]=a.useState(!1),[M,U]=a.useState(null);a.useEffect(()=>{const e=localStorage.getItem("userData");e&&U(JSON.parse(e))},[]),a.useEffect(()=>{d&&l&&n&&M?.user_id&&F()},[d,l,n,M]);const I=()=>!!l?.id&&("own"!==r("attendance")&&(p&&"function"==typeof p?p(l.id):m("attendance",l.id))),F=async()=>{if(l&&n&&M?.user_id){O(!0);try{const a=`${i}-${String(b).padStart(2,"0")}-${String(n).padStart(2,"0")}`,t=await N(l.id,a,M.user_id);H(t);try{const e=await v(l.id,a,M.user_id);C(e.comments||[])}catch(e){C([])}try{const e=await w(l.id,a,M.user_id);L(e.history||[])}catch(e){L([])}}catch(e){}finally{O(!1)}}};if(!d||!l)return null;const R=(e=>{switch(e){case"P":return"PRESENT";case"L":return"LATE";case"LV":return"LEAVE";case"H":return"HOLIDAY";case"HD":return"HALF DAY";case"AB":return"ABSCONDING";default:return"NOT MARKED"}})(l[`day${n}`]||"A"),Y=(e,a,t)=>`${e}-${String(a).padStart(2,"0")}-${String(t).padStart(2,"0")}`,B=async()=>{if($.trim()&&M?.user_id&&l&&n){O(!0);try{const e=`${i}-${String(b).padStart(2,"0")}-${String(n).padStart(2,"0")}`;await(async(e,a,s,r)=>{try{return(await t.post(`${u}/attendance/comments/add?user_id=${e}&date=${a}&content=${encodeURIComponent(s)}&requester_id=${r}`,{},{headers:j()})).data}catch(l){throw l}})(l.id,e,$.trim(),M.user_id);const a=await v(l.id,e,M.user_id);C(a.comments||[]),E("")}catch(e){alert("Failed to add comment. Please try again.")}finally{O(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-transparent bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 text-white p-4 rounded-t-lg relative",children:[e.jsx("button",{onClick:c,className:"absolute top-4 right-4 text-white hover:text-gray-200 transition-colors",children:e.jsx(x,{className:"h-6 w-6"})}),e.jsx("h2",{className:"text-xl font-bold",children:"ADMIN PANEL"})]}),e.jsx("div",{className:" bg-gray-800 border-b border border-gray-700",children:e.jsxs("div",{className:"text-gray-200 space-y-2",children:[e.jsxs("p",{className:"font-semibold text-cyan-400",children:[l.department.toUpperCase()," | ADMIN"]}),e.jsxs("p",{className:"text-gray-300",children:["EMP-ID: ",l.employee_code||l.employee_number||l.empId||`EMP-${l.id?.slice(-6)||"UNKNOWN"}`]}),e.jsxs("p",{className:"text-gray-300",children:["ATTENDANCE: ",e.jsx("span",{className:"text-cyan-400 font-semibold",children:R})]}),T&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-300",children:["EMPLOYEE NAME: ",e.jsx("span",{className:"text-cyan-400",children:T.employee?.employee_name||T.employee_name})]}),e.jsxs("p",{className:"text-gray-300",children:["DATE: ",e.jsx("span",{className:"text-cyan-400",children:T.date})]}),e.jsxs("p",{className:"text-gray-300",children:["STATUS: ",e.jsx("span",{className:"text-cyan-400",children:T.status_text})]}),"leave"===T.type&&T.leave_details&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-300",children:["LEAVE TYPE: ",e.jsx("span",{className:"text-orange-400",children:T.leave_details.leave_type_display})]}),e.jsxs("p",{className:"text-gray-300",children:["REASON: ",e.jsx("span",{className:"text-yellow-400",children:T.leave_details.reason})]}),e.jsxs("p",{className:"text-gray-300",children:["DURATION: ",e.jsxs("span",{className:"text-green-400",children:[T.leave_details.duration_days," day(s)"]})]}),e.jsxs("p",{className:"text-gray-300",children:["APPROVED BY: ",e.jsx("span",{className:"text-purple-400",children:T.leave_details.approved_by_name})]}),T.leave_details.approval_comments&&e.jsxs("p",{className:"text-gray-300",children:["APPROVAL COMMENTS: ",e.jsx("span",{className:"text-blue-400",children:T.leave_details.approval_comments})]})]}),"attendance"===T.type&&e.jsxs(e.Fragment,{children:[T.attendance_details?.total_working_hours&&e.jsxs("p",{className:"text-gray-300",children:["TOTAL HOURS: ",e.jsxs("span",{className:"text-green-400",children:[T.attendance_details.total_working_hours," hours"]})]}),T.working_hours&&e.jsxs("p",{className:"text-gray-300",children:["TOTAL HOURS: ",e.jsxs("span",{className:"text-green-400",children:[T.working_hours," hours"]})]}),T.is_late&&e.jsxs("p",{className:"text-gray-300",children:["LATE: ",e.jsx("span",{className:"text-yellow-400",children:"Yes"})]})]})]})]})}),e.jsxs("div",{className:"p-6 bg-gray-900",children:[P?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"}),e.jsx("p",{className:"text-gray-400 mt-2",children:"Loading attendance details..."})]}):"leave"===T?.type?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-yellow-600 text-white p-4 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"ðŸ–ï¸ LEAVE DETAILS"}),e.jsx("p",{className:"text-orange-100",children:"Employee is on approved leave for this date"})]}),T.leave_details&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border border-gray-600 rounded-lg bg-gray-800",children:[e.jsx("div",{className:"bg-gray-700 p-3 border-b border-gray-600",children:e.jsx("h3",{className:"font-semibold text-gray-200",children:"LEAVE INFORMATION"})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Leave Type:"}),e.jsx("span",{className:"text-orange-400 font-semibold",children:T.leave_details.leave_type_display})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Duration:"}),e.jsxs("span",{className:"text-green-400 font-semibold",children:[T.leave_details.duration_days," day(s)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("span",{className:"text-green-400 font-semibold uppercase",children:T.leave_details.status_display||T.leave_details.status})]}),T.leave_details.from_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"From Date:"}),e.jsx("span",{className:"text-cyan-400",children:s(T.leave_details.from_date)})]}),T.leave_details.to_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"To Date:"}),e.jsx("span",{className:"text-cyan-400",children:s(T.leave_details.to_date)})]})]})]}),e.jsxs("div",{className:"border border-gray-600 rounded-lg bg-gray-800",children:[e.jsx("div",{className:"bg-gray-700 p-3 border-b border-gray-600",children:e.jsx("h3",{className:"font-semibold text-gray-200",children:"REASON & APPROVAL"})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400 block mb-1",children:"Reason:"}),e.jsx("div",{className:"bg-gray-700 p-3 rounded border text-yellow-400",children:T.leave_details.reason||"No reason provided"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Approved By:"}),e.jsx("span",{className:"text-purple-400 font-semibold",children:T.leave_details.approved_by_name||"Unknown"})]}),T.leave_details.approved_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Approved At:"}),e.jsx("span",{className:"text-cyan-400",children:s(T.leave_details.approved_at)})]}),T.leave_details.approval_comments&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400 block mb-1",children:"Approval Comments:"}),e.jsx("div",{className:"bg-gray-700 p-3 rounded border text-blue-400",children:T.leave_details.approval_comments})]})]})]})]}),T.leave_details?.leave_summary&&e.jsx("div",{className:"border border-orange-500 rounded-lg bg-gradient-to-r from-orange-900/20 to-yellow-900/20",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-semibold text-orange-400 mb-2",children:"ðŸ“‹ Leave Summary"}),e.jsx("p",{className:"text-gray-200",children:T.leave_details.leave_summary})]})}),T.leave_details?.attachments&&T.leave_details.attachments.length>0&&e.jsxs("div",{className:"border border-gray-600 rounded-lg bg-gray-800",children:[e.jsx("div",{className:"bg-gray-700 p-3 border-b border-gray-600",children:e.jsx("h3",{className:"font-semibold text-gray-200",children:"ðŸ“Ž ATTACHMENTS"})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"space-y-2",children:T.leave_details.attachments.map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-700 p-3 rounded",children:[e.jsx("span",{className:"text-gray-200",children:a.filename||`Attachment ${t+1}`}),e.jsx("button",{onClick:()=>window.open(`${u}/media/${a.relative_path||a.file_path}`,"_blank"),className:"text-cyan-400 hover:text-cyan-300 underline",children:"View"})]},t))})})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border border-gray-600 rounded-lg bg-gray-800",children:[e.jsx("div",{className:"bg-gray-700 p-3 border-b border-gray-600",children:e.jsx("h3",{className:"font-semibold text-gray-200",children:"CHECK IN"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 text-center mb-4",children:[T?.check_in_photo||T?.attendance_details?.check_in_photo_path?e.jsx("img",{src:`${u}/${T.check_in_photo||T.attendance_details.check_in_photo_path}`,alt:"Check-in photo",className:"w-full h-32 object-cover rounded-lg mx-auto mb-2",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"}}):null,e.jsxs("div",{className:T?.check_in_photo||T?.attendance_details?.check_in_photo_path?"hidden":"block",children:[e.jsx(h,{className:"h-16 w-16 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400",children:"not found"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-400",children:[e.jsxs("p",{className:"text-gray-300",children:["PUNCH IN DATE: ",Y(i,b,n)]}),e.jsxs("p",{className:"text-gray-300",children:["PUNCH IN TIME: ",T?.check_in_time||T?.attendance_details?.check_in_time||"N/A"]}),T?.check_in_geolocation?.address&&"Unknown"!==T.check_in_geolocation.address&&e.jsxs("p",{className:"text-gray-300",children:["LOCATION: ",T.check_in_geolocation.address]}),T?.attendance_details?.check_in_geolocation?.address&&"Unknown"!==T.attendance_details.check_in_geolocation.address&&e.jsxs("p",{className:"text-gray-300",children:["LOCATION: ",T.attendance_details.check_in_geolocation.address]})]})]})]}),e.jsxs("div",{className:"border border-gray-600 rounded-lg bg-gray-800",children:[e.jsx("div",{className:"bg-gray-700 p-3 border-b border-gray-600",children:e.jsx("h3",{className:"font-semibold text-gray-200",children:"CHECK OUT"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 text-center mb-4",children:[T?.check_out_photo||T?.attendance_details?.check_out_photo_path?e.jsx("img",{src:`${u}/${T.check_out_photo||T.attendance_details.check_out_photo_path}`,alt:"Check-out photo",className:"w-full h-32 object-cover rounded-lg mx-auto mb-2",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"}}):null,e.jsxs("div",{className:T?.check_out_photo||T?.attendance_details?.check_out_photo_path?"hidden":"block",children:[e.jsx(h,{className:"h-16 w-16 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400",children:"not found"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-400",children:[e.jsxs("p",{className:"text-gray-300",children:["PUNCH OUT DATE: ",Y(i,b,n)]}),e.jsxs("p",{className:"text-gray-300",children:["PUNCH OUT TIME: ",T?.check_out_time||T?.attendance_details?.check_out_time||"N/A"]}),T?.check_out_geolocation?.address&&"Unknown"!==T.check_out_geolocation.address&&e.jsxs("p",{className:"text-gray-300",children:["LOCATION: ",T.check_out_geolocation.address]}),T?.attendance_details?.check_out_geolocation?.address&&"Unknown"!==T.attendance_details.check_out_geolocation.address&&e.jsxs("p",{className:"text-gray-300",children:["LOCATION: ",T.attendance_details.check_out_geolocation.address]})]})]})]})]}),"leave"!==T?.type&&I()&&e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-gray-200 font-semibold mb-2",children:"CHANGE ATTENDANCE:"}),e.jsxs("select",{value:f,onChange:e=>_(e.target.value),className:"w-full p-3 border border-gray-600 rounded-lg bg-gray-800 text-gray-200 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",children:[e.jsx("option",{value:"",children:"Select Attendance Status"}),e.jsx("option",{value:"P",children:"Present"}),e.jsx("option",{value:"L",children:"Late"}),e.jsx("option",{value:"H",children:"Holiday"}),e.jsx("option",{value:"AB",children:"Absconding"})]})]}),"leave"===T?.type&&e.jsx("div",{className:"mt-6 bg-gradient-to-r from-orange-700/20 to-yellow-700/20 border border-orange-500 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-orange-400 text-2xl",children:"ðŸ–ï¸"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-orange-400",children:"Employee is on Leave"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"This is an approved leave record. Attendance cannot be modified for leave days."})]})]})}),"leave"!==T?.type&&!I()&&e.jsx("div",{className:"mt-6 bg-gradient-to-r from-red-700/20 to-pink-700/20 border border-red-500 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-red-400 text-2xl",children:"ðŸš«"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-400",children:"No Edit Permission"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"own"===r("attendance")?"Regular employees cannot edit attendance records. Only managers and administrators can modify attendance data.":"You don't have permission to edit this attendance record. Contact your administrator for access."})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:["leave"!==T?.type&&I()&&e.jsx("button",{onClick:async()=>{if(f&&M?.user_id){O(!0);try{let e;switch(f){case"P":e=1;break;case"L":e=.5;break;case"H":e=0;break;default:e=-1}const a=`${i}-${String(b).padStart(2,"0")}-${String(n).padStart(2,"0")}`;if(T?.id){const a={status:e,comments:$||""};await(async(e,a,s)=>{try{return(await t.put(`${u}/attendance/edit/${e}?admin_id=${s}`,{...a},{headers:j()})).data}catch(r){throw r}})(T.id,a,M.user_id)}else{const s={employee_id:l.id,date:a,status:e,comments:$||"",check_in_time:null,check_out_time:null,is_holiday:!1};await(async(e,a)=>{try{return(await t.post(`${u}/attendance/mark?user_id=${a}`,{employee_id:e.employee_id,date:e.date,status:e.status,comments:e.comments||"",check_in_time:e.check_in_time||null,check_out_time:e.check_out_time||null,is_holiday:e.is_holiday||!1},{headers:j()})).data}catch(s){throw s}})(s,M.user_id)}o&&o(l.id,n,f),await F(),alert("Attendance updated successfully!")}catch(e){alert("Failed to update attendance. Please try again.")}finally{O(!1)}}},className:"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white px-6 py-2 w-full rounded-md transition-all duration-200 font-semibold",children:"UPDATE ATTENDANCE"}),e.jsx("button",{onClick:c,className:"bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white px-6 py-2 w-full rounded-md transition-all duration-200 font-semibold "+("leave"!==T?.type&&I()?"":"col-span-2"),children:"CLOSE"})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-2 rounded-md transition-all duration-200 font-semibold",children:"leave"===T?.type?"ðŸ’¬ ADD COMMENTS":"ðŸ  ADD COMMENTS"}),e.jsx("button",{onClick:()=>{S(!k)},className:"border border-gray-500 text-gray-300 px-6 py-2 bg-gray-800 rounded-md hover:bg-gray-700 transition-all duration-200 font-semibold",children:"ðŸ‘¤ HISTORY"})]}),e.jsxs("div",{className:"mt-6 border-t border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Comments"}),e.jsx("div",{className:"bg-gray-800 border border-gray-600 p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(g,{className:"h-6 w-6 text-gray-300"})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("input",{type:"text",value:$,onChange:e=>E(e.target.value),placeholder:"Add your comment here...",className:"flex-1 p-3 border border-gray-600 rounded-lg bg-gray-700 text-gray-200 placeholder-gray-400 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",onKeyPress:e=>"Enter"===e.key&&B()}),e.jsxs("button",{onClick:B,disabled:P,className:"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 disabled:from-gray-600 disabled:to-gray-700 text-white px-4 py-3 flex items-center gap-2 flex-shrink-0 rounded-md transition-all duration-200 font-semibold",children:[e.jsx(y,{className:"h-4 w-4"}),P?"Sending...":"Send"]})]})]})}),e.jsx("div",{className:"space-y-4 max-h-60 overflow-y-auto",children:A.length>0?A.map((a,t)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-800 border border-gray-600 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(g,{className:"h-6 w-6 text-gray-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-cyan-400",children:a.user_name||a.user||"Unknown User"}),e.jsx("span",{className:"text-sm text-gray-400",children:a.created_at?s(a.created_at):a.timestamp})]}),e.jsx("p",{className:"text-gray-200",children:a.content||a.message})]})]},a._id||t)):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-400",children:"No comments yet. Be the first to add one!"})})})]}),k&&e.jsxs("div",{className:"mt-6 border-t border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"History"}),e.jsx("div",{className:"overflow-x-auto bg-gray-800 rounded-lg border border-gray-600",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-700 text-cyan-400",children:[e.jsx("th",{className:"border border-gray-600 px-4 py-3 text-left font-semibold",children:"#"}),e.jsx("th",{className:"border border-gray-600 px-4 py-3 text-left font-semibold",children:"DATE"}),e.jsx("th",{className:"border border-gray-600 px-4 py-3 text-left font-semibold",children:"CREATED BY"}),e.jsx("th",{className:"border border-gray-600 px-4 py-3 text-left font-semibold",children:"CHANGES"})]})}),e.jsxs("tbody",{children:[D.map((a,t)=>e.jsxs("tr",{className:t%2==0?"bg-gray-800":"bg-gray-750",children:[e.jsx("td",{className:"border border-gray-600 px-4 py-3 text-gray-200",children:t+1}),e.jsx("td",{className:"border border-gray-600 px-4 py-3 text-gray-200",children:s(a.changed_at)}),e.jsx("td",{className:"border border-gray-600 px-4 py-3 text-gray-200",children:a.changed_by_name||"Unknown"}),e.jsxs("td",{className:"border border-gray-600 px-4 py-3 text-gray-200",children:[a.action," - ",void 0!==a.old_value?`${a.old_value} â†’ ${a.new_value}`:a.new_value]})]},a._id||t)),0===D.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"border border-gray-600 px-4 py-3 text-gray-400 text-center",children:"No history available"})})]})]})})]})]})]})})},E=(e,a,t,s,r)=>{let l=0,n=0,d=0,c=0,o=0,i=0;for(let x=1;x<=s;x++)switch(e[`day${x}`]){case"P":l++;break;case"L":n++;break;case"LV":d++;break;case"H":i++;break;case"HD":c++;break;case"AB":o++}const m=s-i;return{present:l,late:n,leave:d,halfDay:c,absconding:o,holidays:i,workingDays:m,attendancePercentage:m>0?((l+n+c)/m*100).toFixed(1):"0"}};function D(){const x=new Date,[h,g]=a.useState(x.getFullYear()),[y,b]=a.useState(x.getMonth()+1),[p,D]=a.useState([]),[L,T]=a.useState(!1),[H,P]=a.useState(null),[O,M]=a.useState(!1),[U,I]=a.useState(!1),[F,R]=a.useState(null),[Y,B]=a.useState(null),[V,z]=a.useState(null),[J,W]=a.useState(null),[K,q]=a.useState([]),[G,Q]=a.useState(""),[X,Z]=a.useState([]),[ee,ae]=a.useState([]),te=a.useRef(null),[se,re]=a.useState(!1),[le,ne]=a.useState(!1);a.useEffect(()=>{const e=localStorage.getItem("userData");if(e){const a=JSON.parse(e);z(a)}},[]),a.useEffect(()=>{V?.user_id&&(async()=>{if(V?.user_id)try{const e=await _(h,null,V.user_id);e.success&&ae(e.holidays||[])}catch(e){ae([{_id:"1",date:"2025-01-01",name:"New Year's Day"},{_id:"2",date:"2025-01-26",name:"Republic Day"},{_id:"3",date:"2025-08-15",name:"Independence Day"},{_id:"4",date:"2025-12-25",name:"Christmas Day"}])}})()},[V,h]),a.useEffect(()=>{(async()=>{if(V?.user_id)try{const e=await(async e=>{try{return(await t.get(`${u}/attendance/permissions`,{params:{user_id:e},headers:j()})).data}catch(H){throw H}})(V.user_id);W(e)}catch(e){W({can_view_all:!1})}})()},[V]);const de=a.useCallback(()=>{if(te.current){const{scrollLeft:e,scrollWidth:a,clientWidth:t}=te.current;re(e>0),ne(e<a-t-1)}},[]),ce=a.useCallback(e=>{if(te.current){const a=300;te.current.scrollBy({left:"left"===e?-a:a,behavior:"smooth"}),setTimeout(de,100)}},[de]);a.useEffect(()=>{de();const e=te.current;if(e)return e.addEventListener("scroll",de),()=>{e.removeEventListener("scroll",de)}},[de]),a.useEffect(()=>{setTimeout(de,100)},[p,de]),r("attendance"),l();const oe=()=>n("attendance"),ie=()=>oe(),me=()=>oe(),xe=e=>e?.employees?.length?e.employees.map(e=>{const a={id:e.employee_id,name:e.employee_name,employeeId:e.employee_code||e.employee_number||e.empId||`EMP-${e.employee_id?.slice(-6)||"UNKNOWN"}`,department:e.department_name||"Unknown Department",role:e.role_name||"",photo:e.employee_photo};return e.days.forEach(e=>{const t=`day${e.day}`;if(null!==e.status&&void 0!==e.status){const s=parseFloat(e.status);1.5===s?a[t]="H":1===s||1===s?a[t]="P":.5===s?a[t]="HD":0===s||0===s?a[t]="LV":-1===s||-1===s?a[t]="":-2===s||-2===s?a[t]="AB":"L"===e.status?a[t]="L":a[t]=""}else e.is_weekend?a[t]="W":e.is_holiday?a[t]="H":a[t]=""}),a}):[];a.useEffect(()=>{(async()=>{if(V?.user_id){T(!0),P(null);try{const e=await f(h,y,V.user_id);if(e&&e.employees){const a=xe(e);D(a)}else D([])}catch(e){P("Failed to load attendance data. Please try again."),D([])}finally{T(!1)}}})()},[h,y,V]);const he=new Date(h,y,0).getDate(),ge=e=>{"prev"===e?1===y?(b(12),g(h-1)):b(y-1):12===y?(b(1),g(h+1)):b(y+1)},ye=e=>{R(e),B(1),M(!0)};return L||V&&null===J&&!ie()?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-black",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("span",{className:"text-white text-lg",children:null===J?"Loading permissions...":"Loading attendance data..."})]})}):H?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-black",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-red-500 text-lg mb-2",children:H}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry"})]})}):e.jsxs("div",{className:"w-full p-6 space-y-6 bg-black min-h-screen",children:[e.jsx("div",{className:"bg-black rounded-lg p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ge("prev"),className:"border border-gray-600 bg-black text-white hover:bg-gray-800 px-3 py-2 rounded-md transition-colors",children:e.jsx(d,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2 min-w-[200px] justify-center",children:[e.jsx(c,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"font-semibold text-lg text-white",children:[A[y-1]," ",h]})]}),e.jsx("button",{onClick:()=>ge("next"),className:"border border-gray-600 bg-black text-white hover:bg-gray-800 px-3 py-2 rounded-md transition-colors",children:e.jsx(o,{className:"h-4 w-4"})})]}),me()&&e.jsxs("button",{onClick:()=>I(!0),className:"border border-gray-600 bg-black text-white hover:bg-gray-800 px-3 py-2 rounded-md transition-colors flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Holidays"]}),e.jsxs("button",{onClick:()=>((e,a,t,r)=>{const l=new Date(a,t,0).getDate();let n=`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <title>Monthly Attendance Report - ${A[t-1]} ${a}</title>\n      <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        .header { text-align: center; margin-bottom: 20px; }\n        .info { margin-bottom: 15px; font-size: 12px; }\n        table { width: 100%; border-collapse: collapse; font-size: 10px; }\n        th, td { border: 1px solid #ddd; padding: 4px; text-align: center; }\n        th { background-color: #2980b9; color: white; font-weight: bold; }\n        .employee-info { text-align: left; min-width: 120px; }\n        .summary { text-align: left; font-size: 9px; }\n        .status-P { background-color: #10b981; color: white; font-weight: bold; }\n        .status-A { background-color: #ef4444; color: white; font-weight: bold; }\n        .status-L { background: linear-gradient(135deg, #eab308, #f97316); color: white; font-weight: bold; }\n        .status-LV { background-color: #f97316; color: white; font-weight: bold; }\n        .status-H { background-color: #3b82f6; color: white; font-weight: bold; }\n        .status-HD { background-color: #eab308; color: white; font-weight: bold; }\n        .status-AB { background-color: #ef4444; color: white; font-weight: bold; }\n        .legend { margin-top: 20px; font-size: 11px; }\n        .legend-item { display: inline-block; margin-right: 15px; margin-bottom: 5px; }\n        .legend-color { display: inline-block; width: 20px; height: 15px; margin-right: 5px; vertical-align: middle; }\n        .monthly-summary { margin-top: 20px; font-size: 12px; }\n        @media print { body { margin: 10px; } }\n      </style>\n    </head>\n    <body>\n      <div class="header">\n        <h2></h2>\n        <h3>${A[t-1]} ${a}</h3>\n      </div>\n      \n      <div class="info">\n        <strong>Generated on:</strong> ${s(new Date)}<br>\n  `;const d=r.filter(e=>{const s=new Date(e.date);return s.getFullYear()===a&&s.getMonth()+1===t});d.length>0&&(n+=`<strong>Company Holidays:</strong> ${d.map(e=>e.name).join(", ")}<br>`),n+='\n      </div>\n      \n      <table>\n        <thead>\n          <tr>\n            <th class="employee-info">Employee Details</th>\n  ';for(let s=1;s<=l;s++){const e=S(a,t,s);n+=`<th>${s}<br><small>${e.substring(0,3)}</small></th>`}n+="\n            <th>Present</th>\n            <th>Late</th>\n            <th>Half Day</th>\n            <th>Holidays</th>\n            <th>Absconding</th>\n            <th>Attendance %</th>\n          </tr>\n        </thead>\n        <tbody>\n  ",e.forEach(e=>{const a=E(e,0,0,l);n+=`\n      <tr>\n        <td class="employee-info">\n          <strong>${e.name}</strong><br>\n          <small>${e.employeeId}</small><br>\n          <small>${e.department}</small>\n        </td>\n    `;for(let t=1;t<=l;t++){const a=e[`day${t}`]||"-";n+=`<td class="status-${a}">${a}</td>`}n+=`\n        <td>${a.present}</td>\n        <td>${a.late}</td>\n        <td>${a.halfDay}</td>\n        <td>${a.holidays}</td>\n        <td>${a.absconding}</td>\n        <td>${a.attendancePercentage}%</td>\n      </tr>\n    `}),n+='\n        </tbody>\n      </table>\n      \n      <div class="legend">\n        <h4>Legend:</h4>\n        <div class="legend-item">\n          <span class="legend-color" style="background-color: #10b981;"></span>P = Present\n        </div>\n        <div class="legend-item">\n          <span class="legend-color" style="background: linear-gradient(135deg, #eab308, #f97316);"></span>L = Late\n        </div>\n        <div class="legend-item">\n          <span class="legend-color" style="background-color: #f97316;"></span>LV = Leave\n        </div>\n        <div class="legend-item">\n          <span class="legend-color" style="background-color: #3b82f6;"></span>H = Holiday\n        </div>\n        <div class="legend-item">\n          <span class="legend-color" style="background-color: #eab308;"></span>HD = Half Day\n        </div>\n        <div class="legend-item">\n          <span class="legend-color" style="background-color: #ef4444;"></span>AB = Absconding\n        </div>\n      </div>\n      \n      <div class="monthly-summary">\n        <h4>Monthly Summary:</h4>\n  ';const c=e.reduce((e,a)=>e+E(a,0,0,l).present,0),o=e.reduce((e,a)=>e+E(a,0,0,l).late,0),i=(e.reduce((e,a)=>{const t=E(a,0,0,l);return e+Number.parseFloat(t.attendancePercentage)},0)/e.length).toFixed(1);n+=`\n        <p><strong>Total Present Days:</strong> ${c}</p>\n        <p><strong>Total Late Days:</strong> ${o}</p>\n        <p><strong>Average Attendance:</strong> ${i}%</p>\n      </div>\n    </body>\n    </html>\n  `;const m=new Blob([n],{type:"text/html"}),x=URL.createObjectURL(m),h=document.createElement("a");h.href=x,h.download=`Attendance_Report_${A[t-1]}_${a}.html`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(x);const g=window.open("","_blank");g.document.write(n),g.document.close(),setTimeout(()=>{g.print()},500)})(p,h,y,ee),className:"border border-gray-600 bg-black text-white hover:bg-gray-800 px-3 py-2 rounded-md transition-colors flex items-center gap-2",children:[e.jsx(i,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})}),e.jsx("div",{className:"bg-black rounded-lg p-4 ",children:e.jsxs("div",{className:"flex flex-wrap gap-6 items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Present (P)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-yellow-500 to-orange-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Late (L)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-orange-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Leave (LV)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Holiday (H)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-yellow-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Half Day (HD)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Absconding (AB)"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-black rounded-lg p-6 border border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-400",children:p.reduce((e,a)=>e+E(a,0,0,he).present,0)}),e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:"Total Present Days"})]})}),e.jsx("div",{className:"bg-black rounded-lg p-6 border border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:p.reduce((e,a)=>e+E(a,0,0,he).late,0)}),e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:"Total Late Days"})]})}),e.jsx("div",{className:"bg-black rounded-lg p-6 border border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-400",children:p.reduce((e,a)=>e+E(a,0,0,he).leave,0)}),e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:"Total Leave Days"})]})}),e.jsx("div",{className:"bg-black rounded-lg p-6 border border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-400",children:[(p.reduce((e,a)=>{const t=E(a,0,0,he);return e+Number.parseFloat(t.attendancePercentage)},0)/p.length).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:"Average Attendance"})]})})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-hidden shadow-2xl",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>ce("left"),className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-white p-4 rounded-full shadow-lg transition-all duration-200 opacity-80 hover:opacity-100",style:{backgroundColor:"rgba(37, 99, 235, 1)",zIndex:9999},onMouseEnter:e=>e.target.style.backgroundColor="rgba(29, 78, 216, 1)",onMouseLeave:e=>e.target.style.backgroundColor="rgba(37, 99, 235, 1)","aria-label":"Scroll left",children:e.jsx(d,{className:"w-9 h-9"})}),e.jsx("button",{onClick:()=>ce("right"),className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-white p-4 rounded-full shadow-lg transition-all duration-200 opacity-80 hover:opacity-100",style:{backgroundColor:"rgba(37, 99, 235, 1)",zIndex:9999},onMouseEnter:e=>e.target.style.backgroundColor="rgba(29, 78, 216, 1)",onMouseLeave:e=>e.target.style.backgroundColor="rgba(37, 99, 235, 1)","aria-label":"Scroll right",children:e.jsx(o,{className:"w-9 h-9"})}),e.jsx("div",{ref:te,className:"overflow-x-auto",onScroll:de,children:e.jsxs("table",{className:"w-full bg-black border-collapse border border-gray-700",style:{minWidth:"1200px"},children:[e.jsxs("thead",{style:{backgroundColor:"#03b0f5"},children:[e.jsxs("tr",{children:[e.jsx("th",{colSpan:3,className:"sticky left-0 px-4 py-1 text-center font-bold text-white border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Employee Details"}),Array.from({length:he},(e,a)=>a+1).map(a=>e.jsx("th",{rowSpan:2,className:"px-3 py-1 text-center font-bold text-white min-w-[50px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-bold",children:a}),e.jsx("span",{className:"text-xs text-blue-100 opacity-80",children:S(h,y,a)})]})},a)),e.jsx("th",{rowSpan:2,className:"px-4 py-1 text-center font-bold text-white border border-gray-300 min-w-[140px]",style:{backgroundColor:"#03b0f5"},children:"Summary"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 px-4 py-1 text-left font-bold text-white min-w-[100px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Emp ID"}),e.jsx("th",{className:"px-4 py-1 text-left font-bold text-white min-w-[150px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Name"}),e.jsx("th",{className:"px-4 py-1 text-left font-bold text-white min-w-[130px] border border-gray-300",style:{backgroundColor:"#03b0f5"},children:"Team"})]})]}),e.jsx("tbody",{className:"bg-black",children:p.map((a,t)=>{const s=E(a,0,0,he);return e.jsxs("tr",{className:"bg-black hover:bg-gray-800 transition-colors border-b border-gray-700",children:[e.jsx("td",{className:"sticky left-0 bg-black px-4 py-5 border border-gray-600 text-sm text-blue-300 font-medium cursor-pointer hover:bg-gray-700 transition-colors",onClick:()=>ye(a),children:a.employeeId}),e.jsx("td",{className:"px-4 py-5 border border-gray-600 cursor-pointer hover:bg-gray-700 transition-colors",onClick:()=>ye(a),children:e.jsx("div",{className:"font-semibold text-white text-base",children:a.name})}),e.jsx("td",{className:"px-4 py-5 border border-gray-600",children:e.jsx("div",{className:"text-sm text-gray-400",children:a.department})}),Array.from({length:he},(e,a)=>a+1).map(t=>e.jsx("td",{className:"px-2 py-2 text-center cursor-pointer hover:bg-gray-700 border border-gray-600 transition-colors",onClick:()=>(async(e,a)=>{if(V?.user_id){R(e),B(a),M(!0),T(!0);try{const s=`${h}-${String(y).padStart(2,"0")}-${String(a).padStart(2,"0")}`,r=await N(e.id,s,V.user_id);try{const a=await v(e.id,s,V.user_id);q(a.comments||[])}catch(t){q([])}try{const a=await w(e.id,s,V.user_id);Z(a.history||[])}catch(t){Z([])}R({...e,attendanceDetail:r})}catch(t){}T(!1),B(a),M(!0)}})(a,t),children:k(a[`day${t}`])},t)),e.jsx("td",{className:"px-4 py-3 border border-gray-600",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Present:"}),e.jsx("span",{className:"font-bold text-green-400",children:s.present})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Late:"}),e.jsx("span",{className:"font-bold text-yellow-400",children:s.late})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Leave:"}),e.jsx("span",{className:"font-bold text-orange-400",children:s.leave})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Half Day:"}),e.jsx("span",{className:"font-bold text-cyan-400",children:s.halfDay})]}),s.holidays>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Holidays:"}),e.jsx("span",{className:"font-bold text-blue-400",children:s.holidays})]}),s.absconding>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Absconding:"}),e.jsx("span",{className:"font-bold text-red-400",children:s.absconding})]}),e.jsx("div",{className:"border-t border-gray-600 pt-1 mt-2",children:e.jsxs("div",{className:"flex justify-between items-center font-semibold",children:[e.jsx("span",{className:"text-gray-300",children:"Attendance:"}),e.jsxs("span",{className:Number.parseFloat(s.attendancePercentage)>=90?"text-green-400":Number.parseFloat(s.attendancePercentage)>=75?"text-yellow-400":"text-red-400",children:[s.attendancePercentage,"%"]})]})})]})})]},a.id)})})]})})]})}),e.jsx($,{employee:F,selectedDate:Y,selectedYear:h,selectedMonth:y,isOpen:O,onClose:()=>M(!1),onUpdate:(e,a,t)=>{D(s=>s.map(s=>s.id===e?{...s,[`day${a}`]:t}:s))},canUserEdit:e=>"own"!==r("attendance")&&m("attendance",e)}),e.jsx(C,{isOpen:U,onClose:()=>I(!1),holidays:ee,onUpdateHolidays:async e=>{if(ae(e),V?.user_id&&(null!==J||ie()))try{const e=await f(h,y,V.user_id);if(e&&e.employees){let a=xe(e);me()||(a=a.filter(e=>e.id===V.user_id)),D(a)}}catch(a){}},selectedYear:h,selectedMonth:y})]})}export{D as default};
